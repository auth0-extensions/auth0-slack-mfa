module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(89),o=n(62),i=n(123),s=n(22),a=n(65),c=n(128);o.urlHelpers.getBaseUrl=function(e){var t=r.parse(e.originalUrl||"").pathname||"";return r.format({protocol:"https",host:e.headers.host,pathname:t.replace(e.path,"").replace(/\/$/g,"")})};var u=o.createServer(function(e,t){return a.info("Starting Slack MFA Extension - Version:","1.0.1"),i(e,t)});e.exports=function(e,t,n){s.setValue("PUBLIC_WT_URL",c.getUrl(t)),u(e,t,n)}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";var r=n(3).MongoError,o=function(e){var t={};for(var n in e)t[n]=e[n];return t},i=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},s=t.formatSortValue=function(e){var t=(""+e).toLowerCase();switch(t){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},a=t.formattedOrderClause=function(e){var t={};if(null==e)return null;if(Array.isArray(e)){if(0===e.length)return null;for(var n=0;n<e.length;n++)e[n].constructor==String?t[e[n]]=1:t[e[n][0]]=s(e[n][1])}else if(null!=e&&"object"==typeof e)t=e;else{if("string"!=typeof e)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t},c=function(e){if("string"!=typeof e)throw Error("collection name must be a String");if(!e||e.indexOf("..")!=-1)throw Error("collection names cannot be empty");if(e.indexOf("$")!=-1&&null==e.match(/((^\$cmd)|(oplog\.\$main))/))throw Error("collection names must not contain '$'");if(null!=e.match(/^\.|\.$/))throw Error("collection names must not start or end with '.'");if(~e.indexOf("\0"))throw new Error("collection names cannot contain a null character")},u=function(e,t,n,r){try{if(null==e)return;if(e)return r?e(t,n,r):e(t,n)}catch(e){return process.nextTick(function(){throw e}),!1}return!0},l=function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,n=r.create({message:t,driver:!0}),o="object"==typeof e?Object.keys(e):[],i=0;i<o.length;i++)try{n[o[i]]=e[o[i]]}catch(e){}return n},f=function(e){var t=null;if("string"==typeof e)t=e;else if(Array.isArray(e))t={},e.forEach(function(e){t[e]=1});else if(null!=e&&"object"==typeof e){t={};for(var n in e)t[n]=e[n]}return t},p=function(e){var t,n={},r=[];return"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?e.forEach(function(e){"string"==typeof e?(r.push(e+"_1"),n[e]=1):Array.isArray(e)?(r.push(e[0]+"_"+(e[1]||1)),n[e[0]]=e[1]||1):d(e)&&(t=Object.keys(e),t.forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]}))}):d(e)&&(t=Object.keys(e),t.forEach(function(t){r.push(t+"_"+e[t]),n[t]=e[t]})),{name:r.join("_"),keys:t,fieldHash:n}},d=t.isObject=function(e){return"[object Object]"==toString.call(e)},h=function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},m=function(e,t,n){for(var r in t)null==n[r]&&(e[r]=t[r]);return e},y=function(e,t){for(var n in t)e[n]=t[n];return e},g=function(e,t){var n={sslCA:"ca",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var r in t)n[r]?e[n[r]]=t[r]:e[r]=t[r];return e},b=function(e,t){var n={};for(var r in e)t.indexOf(r)!=-1&&(n[r]=e[r]);return n},v=Object.assign?Object.assign:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var o=Object.keys(Object(r)),i=0,s=o.length;i<s;i++){var a=o[i],c=Object.getOwnPropertyDescriptor(r,a);void 0!==c&&c.enumerable&&(t[a]=r[a])}}return t};t.filterOptions=b,t.mergeOptions=y,t.translateOptions=g,t.shallowClone=o,t.getSingleProperty=i,t.checkCollectionName=c,t.toError=l,t.formattedOrderClause=a,t.parseIndexOptions=p,t.normalizeHintField=f,t.handleCallback=u,t.decorateCommand=m,t.isObject=d,t.debugOptions=h,t.MAX_JS_INT=9007199254740992,t.assign=v},function(e,t,n){var r=n(66);try{try{r=n(!function(){var e=new Error('Cannot find module "bson-ext"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){r=require_optional("bson-ext")}}catch(e){}e.exports={MongoError:n(4),Connection:n(106),Server:n(79),ReplSet:n(187),Mongos:n(186),Logger:n(15),Cursor:n(58),ReadPreference:n(43),BSON:r,Query:n(5).Query,MongoCR:n(54),X509:n(57),Plain:n(55),GSSAPI:n(53),ScramSHA1:n(56)}},function(e,t){"use strict";function n(e){this.name="MongoError",this.message=e,Error.captureStackTrace(this,n)}n.create=function(e){var t=null;if(e instanceof Error)t=new n(e.message),t.stack=e.stack;else if("string"==typeof e)t=new n(e);else{t=new n(e.message||e.errmsg||e.$err||"n/a");for(var r in e)t[r]=e[r]}return t},n.prototype=new Error,e.exports=n},function(e,t,n){"use strict";var r=n(7).retrieveBSON,o=r(),i=o.Long,s=0,a=2004,c=2005,u=2007,l=2,f=4,p=8,d=16,h=32,m=64,y=128,g=0,b=2,v=4,w=8,S=function(e,t,n,r){var o=this;if(null==t)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(~t.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=n,this.options=r||{},this.numberToSkip=r.numberToSkip||0,this.numberToReturn=r.numberToReturn||0,this.returnFieldSelector=r.returnFieldSelector||null,this.requestId=S.getRequestId(),this.serializeFunctions="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,this.ignoreUndefined="boolean"==typeof r.ignoreUndefined&&r.ignoreUndefined,this.maxBsonSize=r.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof r.checkKeys||r.checkKeys,this.batchSize=o.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof r.slaveOk&&r.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};S.prototype.incRequestId=function(){this.requestId=s++},S.nextRequestId=function(){return s+1},S.prototype.toBin=function(){var e=this,t=[],n=null,r=0;this.tailable&&(r|=l),this.slaveOk&&(r|=f),this.oplogReplay&&(r|=p),this.noCursorTimeout&&(r|=d),this.awaitData&&(r|=h),this.exhaust&&(r|=m),this.partial&&(r|=y),e.batchSize!=e.numberToReturn&&(e.numberToReturn=e.batchSize);var o=new Buffer(20+Buffer.byteLength(e.ns)+1+4+4);t.push(o);var i=e.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(i),e.returnFieldSelector&&Object.keys(e.returnFieldSelector).length>0&&(n=e.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),t.push(n));var s=o.length+i.length+(n?n.length:0),c=4;return o[3]=s>>24&255,o[2]=s>>16&255,o[1]=s>>8&255,o[0]=255&s,o[c+3]=this.requestId>>24&255,o[c+2]=this.requestId>>16&255,o[c+1]=this.requestId>>8&255,o[c]=255&this.requestId,c+=4,o[c+3]=0,o[c+2]=0,o[c+1]=0,o[c]=0,c+=4,o[c+3]=a>>24&255,o[c+2]=a>>16&255,o[c+1]=a>>8&255,o[c]=255&a,c+=4,o[c+3]=r>>24&255,o[c+2]=r>>16&255,o[c+1]=r>>8&255,o[c]=255&r,c+=4,c=c+o.write(this.ns,c,"utf8")+1,o[c-1]=0,o[c+3]=this.numberToSkip>>24&255,o[c+2]=this.numberToSkip>>16&255,o[c+1]=this.numberToSkip>>8&255,o[c]=255&this.numberToSkip,c+=4,o[c+3]=this.numberToReturn>>24&255,o[c+2]=this.numberToReturn>>16&255,o[c+1]=this.numberToReturn>>8&255,o[c]=255&this.numberToReturn,c+=4,t},S.getRequestId=function(){return++s};var x=function(e,t,n,r){r=r||{},this.numberToReturn=r.numberToReturn||0,this.requestId=s++,this.bson=e,this.ns=t,this.cursorId=n};x.prototype.toBin=function(){var e=4+Buffer.byteLength(this.ns)+1+4+8+16,t=0,n=new Buffer(e);return n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,t+=4,n[t+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,t+=4,n[t+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t+=4,n[t+3]=c>>24&255,n[t+2]=c>>16&255,n[t+1]=c>>8&255,n[t]=255&c,t+=4,n[t+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t+=4,t=t+n.write(this.ns,t,"utf8")+1,n[t-1]=0,n[t+3]=this.numberToReturn>>24&255,n[t+2]=this.numberToReturn>>16&255,n[t+1]=this.numberToReturn>>8&255,n[t]=255&this.numberToReturn,t+=4,n[t+3]=this.cursorId.getLowBits()>>24&255,n[t+2]=this.cursorId.getLowBits()>>16&255,n[t+1]=this.cursorId.getLowBits()>>8&255,n[t]=255&this.cursorId.getLowBits(),t+=4,n[t+3]=this.cursorId.getHighBits()>>24&255,n[t+2]=this.cursorId.getHighBits()>>16&255,n[t+1]=this.cursorId.getHighBits()>>8&255,n[t]=255&this.cursorId.getHighBits(),t+=4,n};var k=function(e,t){this.requestId=s++,this.cursorIds=t};k.prototype.toBin=function(){var e=24+8*this.cursorIds.length,t=0,n=new Buffer(e);n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,t+=4,n[t+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,t+=4,n[t+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t+=4,n[t+3]=u>>24&255,n[t+2]=u>>16&255,n[t+1]=u>>8&255,n[t]=255&u,t+=4,n[t+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t+=4,n[t+3]=this.cursorIds.length>>24&255,n[t+2]=this.cursorIds.length>>16&255,n[t+1]=this.cursorIds.length>>8&255,n[t]=255&this.cursorIds.length,t+=4;for(var r=0;r<this.cursorIds.length;r++)n[t+3]=this.cursorIds[r].getLowBits()>>24&255,n[t+2]=this.cursorIds[r].getLowBits()>>16&255,n[t+1]=this.cursorIds[r].getLowBits()>>8&255,n[t]=255&this.cursorIds[r].getLowBits(),t+=4,n[t+3]=this.cursorIds[r].getHighBits()>>24&255,n[t+2]=this.cursorIds[r].getHighBits()>>16&255,n[t+1]=this.cursorIds[r].getHighBits()>>8&255,n[t]=255&this.cursorIds[r].getHighBits(),t+=4;return n};var _=function(e,t,n){n=n||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.index=0,this.raw=t,this.data=t,this.bson=e,this.opts=n,this.length=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4,this.requestId=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4,this.responseTo=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4,this.index=this.index+4,this.responseFlags=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4;var r=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24;this.index=this.index+4;var o=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24;this.index=this.index+4,this.cursorId=new i(r,o),this.startingFrom=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4,this.numberReturned=t[this.index]|t[this.index+1]<<8|t[this.index+2]<<16|t[this.index+3]<<24,this.index=this.index+4,this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(this.responseFlags&g),this.queryFailure=0!=(this.responseFlags&b),this.shardConfigStale=0!=(this.responseFlags&v),this.awaitCapable=0!=(this.responseFlags&w),this.promoteLongs="boolean"!=typeof n.promoteLongs||n.promoteLongs,this.promoteValues="boolean"!=typeof n.promoteValues||n.promoteValues,this.promoteBuffers="boolean"==typeof n.promoteBuffers&&n.promoteBuffers};_.prototype.isParsed=function(){return this.parsed},_.prototype.parse=function(e){if(!this.parsed){e=e||{};var t,n,r=e.raw||!1,o=e.documentsReturnedIn||null,s="boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,a="boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,c="boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers;if(n={promoteLongs:s,promoteValues:a,promoteBuffers:c},1==this.numberReturned&&null!=o&&r){t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24;var u=this.data.slice(this.index,this.index+t),l={};l[o]=!0,n.fieldsAsRaw=l;var f=this.bson.deserialize(u,n);return this.documents=f.cursor[o],this.numberReturned=this.documents.length,this.cursorId="number"==typeof f.cursor.id?i.fromNumber(f.cursor.id):f.cursor.id,this.index=this.index+t,void(this.parsed=!0)}for(var p=0;p<this.numberReturned;p++)t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,r?this.documents[p]=this.data.slice(this.index,this.index+t):this.documents[p]=this.bson.deserialize(this.data.slice(this.index,this.index+t),n),this.index=this.index+t;this.parsed=!0}},e.exports={Query:S,GetMore:x,Response:_,KillCursor:k}},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function r(e){K=e}function o(e){Y=e}function i(){return function(){return process.nextTick(l)}}function s(){return function(){G(l)}}function a(){var e=0,t=new X(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function u(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<H;e+=2){var t=ee[e],n=ee[e+1];t(n),ee[e]=void 0,ee[e+1]=void 0}H=0}function f(){try{var e=n(!function(){var e=new Error('Cannot find module "vertx"');throw e.code="MODULE_NOT_FOUND",e}());return G=e.runOnLoop||e.runOnContext,s()}catch(e){return u()}}function p(e,t){var n=arguments,r=this,o=new this.constructor(h);void 0===o[ne]&&B(o);var i=r._state;return i?!function(){var e=n[i-1];Y(function(){return A(i,o,e,r._result)})}():C(r,o,e,t),o}function d(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(h);return x(n,e),n}function h(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(e){return se.error=e,se}}function b(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function v(e,t,n){Y(function(e){var r=!1,o=b(n,t,function(n){r||(r=!0,t!==n?x(e,n):_(e,n))},function(t){r||(r=!0,O(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,O(e,o))},e)}function w(e,t){t._state===oe?_(e,t._result):t._state===ie?O(e,t._result):C(t,void 0,function(t){return x(e,t)},function(t){return O(e,t)})}function S(e,n,r){n.constructor===e.constructor&&r===p&&n.constructor.resolve===d?w(e,n):r===se?O(e,se.error):void 0===r?_(e,n):t(r)?v(e,n,r):_(e,n)}function x(t,n){t===n?O(t,m()):e(n)?S(t,n,g(n)):_(t,n)}function k(e){e._onerror&&e._onerror(e._result),E(e)}function _(e,t){e._state===re&&(e._result=t,e._state=oe,0!==e._subscribers.length&&Y(E,e))}function O(e,t){e._state===re&&(e._state=ie,e._result=t,Y(k,e))}function C(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+oe]=n,o[i+ie]=r,0===i&&e._state&&Y(E,e)}function E(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?A(n,r,o,i):o(i);e._subscribers.length=0}}function I(){this.error=null}function N(e,t){try{return e(t)}catch(e){return ae.error=e,ae}}function A(e,n,r,o){var i=t(r),s=void 0,a=void 0,c=void 0,u=void 0;if(i){if(s=N(r,o),s===ae?(u=!0,a=s.error,s=null):c=!0,n===s)return void O(n,y())}else s=o,c=!0;n._state!==re||(i&&c?x(n,s):u?O(n,a):e===oe?_(n,s):e===ie&&O(n,s))}function M(e,t){try{t(function(t){x(e,t)},function(t){O(e,t)})}catch(t){O(e,t)}}function T(){return ce++}function B(e){e[ne]=ce++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(h),this.promise[ne]||B(this.promise),V(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?_(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&_(this.promise,this._result))):O(this.promise,R())}function R(){return new Error("Array Methods must be provided an Array")}function P(e){return new D(this,e).promise}function L(e){var t=this;return new t(V(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function j(e){var t=this,n=new t(h);return O(n,e),n}function z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function U(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function q(e){this[ne]=T(),this._result=this._state=void 0,this._subscribers=[],h!==e&&("function"!=typeof e&&z(),this instanceof q?M(this,e):U())}function F(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=q}var W=void 0;W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var V=W,H=0,G=void 0,K=void 0,Y=function(e,t){ee[H]=e,ee[H+1]=t,H+=2,2===H&&(K?K(l):te())},Z="undefined"!=typeof window?window:void 0,J=Z||{},X=J.MutationObserver||J.WebKitMutationObserver,Q="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ee=new Array(1e3),te=void 0;te=Q?i():X?a():$?c():void 0===Z?f():u();var ne=Math.random().toString(36).substring(16),re=void 0,oe=1,ie=2,se=new I,ae=new I,ce=0;return D.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===re&&n<e;n++)this._eachEntry(t[n],n)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===d){var o=g(e);if(o===p&&e._state!==re)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===q){var i=new n(h);S(i,e,o),this._willSettleAt(i,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===re&&(this._remaining--,e===ie?O(r,n):this._result[t]=n),0===this._remaining&&_(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(oe,t,e)},function(e){return n._settledAt(ie,t,e)})},q.all=P,q.race=L,q.resolve=d,q.reject=j,q._setScheduler=r,q._setAsap=o,q._asap=Y,q.prototype={constructor:q,then:p,catch:function(e){return this.then(null,e)}},F(),q.polyfill=F,q.Promise=q,q})},function(e,t,n){"use strict";var r=n(1).format,o=n(20),i=function(e,t,n,o){Object.defineProperty(e,t.name,{enumerable:!0,set:function(e){if("boolean"!=typeof e)throw new Error(r("%s required a boolean",t.name));1==e&&(o.flags|=n),0==e&&(o.flags&n)==n&&(o.flags^=n),t.value=e},get:function(){return t.value}})},s=function(e,t,n,r,o){Object.defineProperty(e,t,{enumerable:!0,get:function(){return null==r[n]&&e.isParsed&&!e.isParsed()&&e.parse(),"function"==typeof o?o(r[n]):r[n]}})},a=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},c=function(e,t){t=t||{};for(var n in e)t[n]=e[n];return t},u=function(e,t){var n={};return e.forEach(function(e){n[e]=t[e]}),n},l=function(){var e=n(66);e.native=!1;try{try{e=n(!function(){var e=new Error('Cannot find module "bson-ext"');throw e.code="MODULE_NOT_FOUND",e}()),e.native=!0}catch(e){var t=o("bson-ext");if(t)return t.native=!0,t}}catch(e){}return e};t.setProperty=i,t.getProperty=s,t.getSingleProperty=a,t.copy=c,t.debugOptions=u,t.retrieveBSON=l},function(e,t,n){var r=n(1).format,o=function(e,t,n){this.name=e,this.object=t,this.stream="boolean"==typeof n&&n,this.instrumentations={}};o.prototype.classMethod=function(e,t){var n=Object.keys(t).sort(),r=i(n,t);null==this.instrumentations[r]&&(this.instrumentations[r]={methods:[],options:t}),this.instrumentations[r].methods.push(e)};var i=function(e,t){for(var n=[],o=0;o<e.length;o++)n.push(r("%s=%s",e[o],t[e[o]]));return n.join()};o.prototype.staticMethod=function(e,t){t.static=!0;var n=Object.keys(t).sort(),r=i(n,t);null==this.instrumentations[r]&&(this.instrumentations[r]={methods:[],options:t}),this.instrumentations[r].methods.push(e)},o.prototype.generate=function(){var e={name:this.name,obj:this.object,stream:this.stream,instrumentations:[]};for(var t in this.instrumentations)e.instrumentations.push(this.instrumentations[t]);return e},e.exports=o},function(e,t){e.exports=require("events")},function(e,t,n){var r=n(99)("wks"),o=n(103),i=n(11).Symbol,s="function"==typeof i,a=e.exports=function(e){return r[e]||(r[e]=s&&i[e]||(s?i:o)("Symbol."+e))};a.store=r},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){"use strict";function r(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}function o(e){var t=e.clientInfo?i(e.clientInfo):{driver:{name:"nodejs-core",version:c},os:{type:l,name:f,architecture:p,version:d}};if(t.platform&&t.platform.indexOf("mongodb-core")==-1?t.platform=a("%s, mongodb-core: %s",t.platform,c):t.platform||(t.platform=u),e.appname){var n=new Buffer(e.appname),r=n.length>128?n.slice(0,128).toString("utf8"):e.appname;t.application={name:r}}return t}function i(e){return JSON.parse(JSON.stringify(e))}var s=n(64),a=n(1).format,c=n(183).version,u=a("Node.js %s, %s",process.version,s.endianness()),l=s.type(),f=process.platform,p=process.arch,d=s.release(),h=function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription},m=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:e.s.topologyId!=-1?e.s.topologyId:e.id,address:e.name,previousDescription:h(e),newDescription:t}),e.s.serverDescription=t)},y=function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription},g=function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:e.s.topologyId!=-1?e.s.topologyId:e.id,address:e.name,previousDescription:y(e),newDescription:t}),e.s.serverDescription=t)},b=function(e,t,n){var r=v(e,t),o=v(e,n);return o!=r},v=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&!t.hosts?"Standalone":t.ismaster&&"isdbgrid"==t.msg?"Mongos":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},w=function(e){return function(t){if("destroyed"!=e.s.state){var n=(new Date).getTime();r(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},function(o,i){if(o)r(e,"serverHeartbeatFailed",{durationMS:s,failure:o,connectionId:e.name});else{e.emit("ismaster",i,e);var s=(new Date).getTime()-n;r(e,"serverHeartbeatSucceeded",{durationMS:s,reply:i.result,connectionId:e.name}),b(e,e.s.ismaster,i.result)&&m(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?v(e):"Standalone"}),e.s.ismaster=i.result,e.s.isMasterLatencyMS=s}return"function"==typeof t?t(o,i):void(e.s.inquireServerStateTimeout=setTimeout(w(e),e.s.haInterval))})}}},S=Object.assign?Object.assign:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var o=Object.keys(Object(r)),i=0,s=o.length;i<s;i++){var a=o[i],c=Object.getOwnPropertyDescriptor(r,a);void 0!==c&&c.enumerable&&(t[a]=r[a])}}return t},x=function(e){var t={};for(var n in e)t[n]=e[n];return t};e.exports.inquireServerState=w,e.exports.getTopologyType=v,e.exports.emitServerDescriptionChanged=m,e.exports.emitTopologyDescriptionChanged=g,e.exports.cloneOptions=x,e.exports.assign=S,e.exports.createClientInfo=o,e.exports.clone=i},function(e,t,n){"use strict";var r=n(1).inherits,o=n(1).format,i=n(2).formattedOrderClause,s=n(2).handleCallback,a=n(14),c=n(3).MongoError,u=n(16).Readable||n(61).Readable,l=n(8),f=n(3).Cursor,p=n(3).BSON.Map,d=n(3).ReadPreference,h=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],m=["numberOfRetries","tailableRetryInterval"],y=Array.prototype.push,g=function(e,t,r,o,i,s){f.apply(this,Array.prototype.slice.call(arguments,0));var a=this,c=g.INIT,l={},p=o.numberOfRetries||5,d=o.tailableRetryInterval||500,h=p,m=o.promiseLibrary;m||(m="function"==typeof global.Promise?global.Promise:n(6).Promise),u.call(this,{objectMode:!0}),this.s={numberOfRetries:p,tailableRetryInterval:d,currentNumberOfRetries:h,state:c,streamOptions:l,bson:e,ns:t,cmd:r,options:o,topology:i,topologyOptions:s,promiseLibrary:m,currentDoc:null},1==a.s.options.noCursorTimeout&&a.addCursorFlag("noCursorTimeout",!0),this.sortValue=a.s.cmd.sort};r(g,u),f.prototype._next=f.prototype.next;for(var b in f.prototype)g.prototype[b]=f.prototype[b];var v=g.define=new l("Cursor",g,!0);g.prototype.hasNext=function(e){var t=this;return"function"==typeof e?t.s.currentDoc?e(null,!0):w(t,function(n,r){return r?(t.s.currentDoc=r,void e(null,!0)):e(null,!1)}):new this.s.promiseLibrary(function(e,n){t.s.currentDoc?e(!0):w(t,function(r,o){return t.s.state==g.CLOSED||t.isDead()?e(!1):r?n(r):o?(t.s.currentDoc=o,void e(!0)):e(!1)})})},v.classMethod("hasNext",{callback:!0,promise:!0}),g.prototype.next=function(e){var t=this;if("function"==typeof e){if(t.s.currentDoc){var n=t.s.currentDoc;return t.s.currentDoc=null,e(null,n)}return w(t,e)}return new this.s.promiseLibrary(function(e,n){if(t.s.currentDoc){var r=t.s.currentDoc;return t.s.currentDoc=null,e(r)}w(t,function(t,r){return t?n(t):void e(r)})})},v.classMethod("next",{callback:!0,promise:!0}),g.prototype.filter=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.query=e,this},v.classMethod("filter",{callback:!1,promise:!1,returns:[g]}),g.prototype.maxScan=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxScan=e,this},v.classMethod("maxScan",{callback:!1,promise:!1,returns:[g]}),g.prototype.hint=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.hint=e,this},v.classMethod("hint",{callback:!1,promise:!1,returns:[g]}),g.prototype.min=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.min=e,this},v.classMethod("min",{callback:!1,promise:!1,returns:[g]}),g.prototype.max=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.max=e,this},v.classMethod("max",{callback:!1,promise:!1,returns:[g]}),g.prototype.returnKey=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.returnKey=e,this},v.classMethod("returnKey",{callback:!1,promise:!1,returns:[g]}),g.prototype.showRecordId=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.showDiskLoc=e,this},v.classMethod("showRecordId",{callback:!1,promise:!1,returns:[g]}),g.prototype.snapshot=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.snapshot=e,this},v.classMethod("snapshot",{callback:!1,promise:!1,returns:[g]}),g.prototype.setCursorOption=function(e,t){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(m.indexOf(e)==-1)throw c.create({message:o("option %s not a supported option %s",e,m),driver:!0});return this.s[e]=t,"numberOfRetries"==e&&(this.s.currentNumberOfRetries=t),this},v.classMethod("setCursorOption",{callback:!1,promise:!1,returns:[g]}),g.prototype.addCursorFlag=function(e,t){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(h.indexOf(e)==-1)throw c.create({message:o("flag %s not a supported flag %s",e,h),driver:!0});if("boolean"!=typeof t)throw c.create({message:o("flag %s must be a boolean value",e),driver:!0});return this.s.cmd[e]=t,this},v.classMethod("addCursorFlag",{callback:!1,promise:!1,returns:[g]}),g.prototype.addQueryModifier=function(e,t){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("$"!=e[0])throw c.create({message:o("%s is not a valid query modifier"),driver:!0});var n=e.substr(1);return this.s.cmd[n]=t,"orderby"==n&&(this.s.cmd.sort=this.s.cmd[n]),this},v.classMethod("addQueryModifier",{callback:!1,promise:!1,returns:[g]}),g.prototype.comment=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.comment=e,this},v.classMethod("comment",{callback:!1,promise:!1,returns:[g]}),g.prototype.maxAwaitTimeMS=function(e){if("number"!=typeof e)throw c.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxAwaitTimeMS=e,this},v.classMethod("maxAwaitTimeMS",{callback:!1,promise:!1,returns:[g]}),g.prototype.maxTimeMS=function(e){if("number"!=typeof e)throw c.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.maxTimeMS=e,this},v.classMethod("maxTimeMS",{callback:!1,promise:!1,returns:[g]}),g.prototype.maxTimeMs=g.prototype.maxTimeMS,v.classMethod("maxTimeMs",{callback:!1,promise:!1,returns:[g]}),g.prototype.project=function(e){if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.s.cmd.fields=e,this},v.classMethod("project",{callback:!1,promise:!1,returns:[g]}),g.prototype.sort=function(e,t){if(this.s.options.tailable)throw c.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state==g.CLOSED||this.s.state==g.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});var n=e;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new p(n.map(function(e){var t=[e[0],null];if("asc"==e[1])t[1]=1;else if("desc"==e[1])t[1]=-1;else{if(1!=e[1]&&e[1]!=-1)throw new c("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[1]=e[1]}return t}))),null!=t&&(n=[[e,t]]),this.s.cmd.sort=n,this.sortValue=n,this},v.classMethod("sort",{callback:!1,promise:!1,returns:[g]}),g.prototype.batchSize=function(e){if(this.s.options.tailable)throw c.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state==g.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.batchSize=e,this.setCursorBatchSize(e),this},v.classMethod("batchSize",{
callback:!1,promise:!1,returns:[g]}),g.prototype.collation=function(e){return this.s.cmd.collation=e,this},v.classMethod("collation",{callback:!1,promise:!1,returns:[g]}),g.prototype.limit=function(e){if(this.s.options.tailable)throw c.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state==g.OPEN||this.s.state==g.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"limit requires an integer",driver:!0});return this.s.cmd.limit=e,this.setCursorLimit(e),this},v.classMethod("limit",{callback:!1,promise:!1,returns:[g]}),g.prototype.skip=function(e){if(this.s.options.tailable)throw c.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state==g.OPEN||this.s.state==g.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"skip requires an integer",driver:!0});return this.s.cmd.skip=e,this.setCursorSkip(e),this},v.classMethod("skip",{callback:!1,promise:!1,returns:[g]}),g.prototype.nextObject=g.prototype.next;var w=function(e,t){if(e.s.state==g.CLOSED||e.isDead&&e.isDead())return s(t,c.create({message:"Cursor is closed",driver:!0}));if(e.s.state==g.INIT&&e.s.cmd.sort)try{e.s.cmd.sort=i(e.s.cmd.sort)}catch(e){return s(t,e)}e._next(function(n,r){return e.s.state=g.OPEN,n?s(t,n):void s(t,null,r)})};v.classMethod("nextObject",{callback:!0,promise:!0});var S=function(e,t){if(0!=e.bufferedCount())return e._next(t),S};g.prototype.next=g.prototype.nextObject,v.classMethod("next",{callback:!0,promise:!0}),g.prototype.each=function(e){this.rewind(),this.s.state=g.INIT,x(this,e)},v.classMethod("each",{callback:!0,promise:!1});var x=function(e,t){if(!t)throw c.create({message:"callback is mandatory",driver:!0});if(!e.isNotified()){if(e.s.state==g.CLOSED||e.isDead())return s(t,c.create({message:"Cursor is closed",driver:!0}));e.s.state==g.INIT&&(e.s.state=g.OPEN);var n=null;if(e.bufferedCount()>0){for(;n=S(e,t);)n(e,t);x(e,t)}else e.next(function(n,r){return n?s(t,n):null==r?(e.s.state=g.CLOSED,s(t,null,null)):void(0!=s(t,null,r)&&x(e,t))})}};g.prototype.forEach=function(e,t){this.each(function(n,r){if(n)return t(n),!1;if(null!=r)return e(r),!0;if(null==r&&t){var o=t;return t=null,o(null),!1}})},v.classMethod("forEach",{callback:!0,promise:!1}),g.prototype.setReadPreference=function(e){if(this.s.state!=g.INIT)throw c.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});return e instanceof a?this.s.options.readPreference=new d(e.mode,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}):"string"==typeof e?this.s.options.readPreference=new d(e):e instanceof d&&(this.s.options.readPreference=e),this},v.classMethod("setReadPreference",{callback:!1,promise:!1,returns:[g]}),g.prototype.toArray=function(e){var t=this;if(t.s.options.tailable)throw c.create({message:"Tailable cursor cannot be converted to array",driver:!0});return"function"==typeof e?k(t,e):new this.s.promiseLibrary(function(e,n){k(t,function(t,r){return t?n(t):void e(r)})})};var k=function(e,t){var n=[];e.rewind(),e.s.state=g.INIT;var r=function(){e._next(function(o,i){if(o)return s(t,o);if(null==i)return e.s.state=g.CLOSED,s(t,null,n);if(n.push(i),e.bufferedCount()>0){var a=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&"function"==typeof e.s.transforms.doc&&(a=a.map(e.s.transforms.doc)),y.apply(n,a)}r()})};r()};v.classMethod("toArray",{callback:!0,promise:!0}),g.prototype.count=function(e,t,n){var r=this;if(null==r.s.cmd.query)throw c.create({message:"count can only be used with find command",driver:!0});return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof n?_(r,e,t,n):new this.s.promiseLibrary(function(n,o){_(r,e,t,function(e,t){return e?o(e):void n(t)})})};var _=function(e,t,n,r){"function"==typeof t&&(r=t,t=!0),t&&("number"==typeof e.cursorSkip()&&(n.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(n.limit=e.cursorLimit()));var i=e.s.ns.indexOf("."),s={count:e.s.ns.substr(i+1),query:e.s.cmd.query};"number"==typeof n.maxTimeMS?s.maxTimeMS=n.maxTimeMS:e.s.cmd&&"number"==typeof e.s.cmd.maxTimeMS&&(s.maxTimeMS=e.s.cmd.maxTimeMS),n.skip&&(s.skip=n.skip),n.limit&&(s.limit=n.limit),e.s.options.hint&&(s.hint=e.s.options.hint),e.topology.command(o("%s.$cmd",e.s.ns.substr(0,i)),s,function(e,t){r(e,t?t.result.n:null)})};v.classMethod("count",{callback:!0,promise:!0}),g.prototype.close=function(e){return this.s.state=g.CLOSED,this.kill(),this.emit("close"),"function"==typeof e?s(e,null,this):new this.s.promiseLibrary(function(e){e()})},v.classMethod("close",{callback:!0,promise:!0}),g.prototype.map=function(e){return this.cursorState.transforms={doc:e},this},v.classMethod("map",{callback:!1,promise:!1,returns:[g]}),g.prototype.isClosed=function(){return this.isDead()},v.classMethod("isClosed",{callback:!1,promise:!1,returns:[Boolean]}),g.prototype.destroy=function(e){e&&this.emit("error",e),this.pause(),this.close()},v.classMethod("destroy",{callback:!1,promise:!1}),g.prototype.stream=function(e){return this.s.streamOptions=e||{},this},v.classMethod("stream",{callback:!1,promise:!1,returns:[g]}),g.prototype.explain=function(e){var t=this;return this.s.cmd.explain=!0,this.s.cmd.readConcern&&delete this.s.cmd.readConcern,"function"==typeof e?this._next(e):new this.s.promiseLibrary(function(e,n){t._next(function(t,r){return t?n(t):void e(r)})})},v.classMethod("explain",{callback:!0,promise:!0}),g.prototype._read=function(){var e=this;return e.s.state==g.CLOSED||e.isDead()?e.push(null):void e.nextObject(function(t,n){return t?(e.listeners("error")&&e.listeners("error").length>0&&e.emit("error",t),e.isDead()||e.close(),e.emit("end"),e.emit("finish")):"function"==typeof e.s.streamOptions.transform&&null!=n?e.push(e.s.streamOptions.transform(n)):e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.doc&&null!=n?e.push(e.cursorState.transforms.doc(n)):void e.push(n)})},Object.defineProperty(g.prototype,"readPreference",{enumerable:!0,get:function(){return this&&this.s?this.s.options.readPreference:null}}),Object.defineProperty(g.prototype,"namespace",{enumerable:!0,get:function(){if(!this||!this.s)return null;var e=this.s.ns||"",t=e.indexOf(".");return t<0?{database:this.s.ns,collection:""}:{database:e.substr(0,t),collection:e.substr(t+1)}}}),g.INIT=0,g.OPEN=1,g.CLOSED=2,g.GET_MORE=3,e.exports=g},function(e,t){"use strict";var n=function(e,t,r){return this instanceof n?(this._type="ReadPreference",this.mode=e,this.tags=t,this.options=r,t&&"object"==typeof t&&!Array.isArray(t)&&t.maxStalenessSeconds&&(this.options=t,this.tags=null),void(this.options&&this.options.maxStalenessSeconds&&(this.maxStalenessSeconds=this.options.maxStalenessSeconds))):new n(e,t,r)};n.isValid=function(e){return e==n.PRIMARY||e==n.PRIMARY_PREFERRED||e==n.SECONDARY||e==n.SECONDARY_PREFERRED||e==n.NEAREST||1==e||0==e||null==e},n.prototype.isValid=function(e){var t="string"==typeof e?e:this.mode;return n.isValid(t)},n.prototype.toObject=function(){var e={mode:this.mode};return null!=this.tags&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),e},n.prototype.toJSON=function(){return this.toObject()},n.PRIMARY="primary",n.PRIMARY_PREFERRED="primaryPreferred",n.SECONDARY="secondary",n.SECONDARY_PREFERRED="secondaryPreferred",n.NEAREST="nearest",e.exports=n},function(e,t,n){"use strict";var r=n(1).format,o=n(4),i={},s={},a=null,c=process.pid,u=null,l=function(e,t){return this instanceof l?(t=t||{},this.className=e,t.logger?u=t.logger:null==u&&(u=console.log),t.loggerLevel&&(a=t.loggerLevel||"error"),void(null==s[this.className]&&(i[this.className]=!0))):new l(e,t)};l.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(s).length>0&&s[this.className]||0==Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,e),a={type:"debug",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(s).length>0&&s[this.className]||0==Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","WARN",this.className,c,n,e),a={type:"warn",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(s).length>0&&s[this.className]||0==Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","INFO",this.className,c,n,e),a={type:"info",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.error=function(e,t){if(this.isError()&&(Object.keys(s).length>0&&s[this.className]||0==Object.keys(s).length&&i[this.className])){var n=(new Date).getTime(),o=r("[%s-%s:%s] %s %s","ERROR",this.className,c,n,e),a={type:"error",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),u(o,a)}},l.prototype.isInfo=function(){return"info"==a||"debug"==a},l.prototype.isError=function(){return"error"==a||"info"==a||"debug"==a},l.prototype.isWarn=function(){return"error"==a||"warn"==a||"info"==a||"debug"==a},l.prototype.isDebug=function(){return"debug"==a},l.reset=function(){a="error",s={}},l.currentLogger=function(){return u},l.setCurrentLogger=function(e){if("function"!=typeof e)throw new o("current logger must be a function");u=e},l.filter=function(e,t){"class"==e&&Array.isArray(t)&&(s={},t.forEach(function(e){s[e]=!0}))},l.setLevel=function(e){if("info"!=e&&"error"!=e&&"debug"!=e&&"warn"!=e)throw new Error(r("%s is an illegal logging level",e));a=e},e.exports=l},function(e,t){e.exports=require("stream")},function(e,t){var n=function(e,t,n,r,o){var i,s,a="big"===n,c=8*o-r-1,u=(1<<c)-1,l=u>>1,f=-7,p=a?0:o-1,d=a?1:-1,h=e[t+p];for(p+=d,i=h&(1<<-f)-1,h>>=-f,f+=c;f>0;i=256*i+e[t+p],p+=d,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;f>0;s=256*s+e[t+p],p+=d,f-=8);if(0===i)i=1-l;else{if(i===u)return s?NaN:(h?-1:1)*(1/0);s+=Math.pow(2,r),i-=l}return(h?-1:1)*s*Math.pow(2,i-r)},r=function(e,t,n,r,o,i){var s,a,c,u="big"===r,l=8*i-o-1,f=(1<<l)-1,p=f>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=u?i-1:0,m=u?-1:1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),t+=s+p>=1?d/c:d*Math.pow(2,1-p),t*c>=2&&(s++,c/=2),s+p>=f?(a=0,s=f):s+p>=1?(a=(t*c-1)*Math.pow(2,o),s+=p):(a=t*Math.pow(2,p-1)*Math.pow(2,o),s=0));o>=8;e[n+h]=255&a,h+=m,a/=256,o-=8);for(s=s<<o|a,l+=o;l>0;e[n+h]=255&s,h+=m,s/=256,l-=8);e[n+h-m]|=128*y};t.readIEEE754=n,t.writeIEEE754=r},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";var r=n(1).inherits,o=n(14),i=n(3).MongoError,s=n(16).Readable||n(61).Readable,a=n(8),c=n(13),u=n(3).ReadPreference,l=function(e,t,r,o,i,a){c.apply(this,Array.prototype.slice.call(arguments,0));var u=l.INIT,f={},p=null,d=o.promiseLibrary;d||(d="function"==typeof global.Promise?global.Promise:n(6).Promise),s.call(this,{objectMode:!0}),this.s={maxTimeMS:p,state:u,streamOptions:f,bson:e,ns:t,cmd:r,options:o,topology:i,topologyOptions:a,promiseLibrary:d}};r(l,s);for(var f=["_next","next","each","forEach","toArray","rewind","bufferedCount","readBufferedDocuments","close","isClosed","kill","_find","_getmore","_killcursor","isDead","explain","isNotified","isKilled"],p=0;p<f.length;p++)l.prototype[f[p]]=c.prototype[f[p]];var d=l.define=new a("CommandCursor",l,!0);l.prototype.setReadPreference=function(e){if(this.s.state==l.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if(this.s.state!=l.INIT)throw i.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});return e instanceof o?this.s.options.readPreference=new u(e.mode,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}):"string"==typeof e?this.s.options.readPreference=new u(e):e instanceof u&&(this.s.options.readPreference=e),this},d.classMethod("setReadPreference",{callback:!1,promise:!1,returns:[l]}),l.prototype.batchSize=function(e){if(this.s.state==l.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw i.create({message:"batchSize requires an integer",driver:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},d.classMethod("batchSize",{callback:!1,promise:!1,returns:[l]}),l.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},d.classMethod("maxTimeMS",{callback:!1,promise:!1,returns:[l]}),l.prototype.get=l.prototype.toArray,d.classMethod("get",{callback:!0,promise:!1}),d.classMethod("toArray",{callback:!0,promise:!0}),d.classMethod("each",{callback:!0,promise:!1}),d.classMethod("forEach",{callback:!0,promise:!1}),d.classMethod("next",{callback:!0,promise:!0}),d.classMethod("close",{callback:!0,promise:!0}),d.classMethod("isClosed",{callback:!1,promise:!1,returns:[Boolean]}),d.classMethod("rewind",{callback:!1,promise:!1}),d.classMethod("bufferedCount",{callback:!1,promise:!1,returns:[Number]}),d.classMethod("readBufferedDocuments",{callback:!1,promise:!1,returns:[Array]}),l.INIT=0,l.OPEN=1,l.CLOSED=2,e.exports=l},function(e,t,n){(function(e,t){var r=n(88),o=n(122),i=n(1).format,s=n(198),a=n(199),c=o.existsSync||r.existsSync,u=function(e){for(var t=!1;!t;)if(c(e+"/package.json"))t=e;else{if("/"===e)return!1;e=r.dirname(e)}return e},l=function(r,c){c=c||{},c.strict="boolean"!=typeof c.strict||c.strict;var l=e;t.parent&&(l=t.parent.filename);var l=u(l);if(!l)throw new Error("package.json can not be located");var f=JSON.parse(o.readFileSync(i("%s/package.json",l))),p=r.split(/\//);if(!f.peerOptionalDependencies)throw new Error(i("no optional dependency [%s] defined in peerOptionalDependencies in package.json",p[0]));if(f.peerOptionalDependencies&&!f.peerOptionalDependencies[p[0]])throw new Error(i("no optional dependency [%s] defined in peerOptionalDependencies in package.json",p[0]));var d=f.peerOptionalDependencies[p[0]],h=void 0,m=r;try{h=n(86)(m)}catch(e){try{if(m=s(process.cwd(),r),null==m)return;h=n(86)(m)}catch(e){if("MODULE_NOT_FOUND"===e.code)return}}var l=u(n(86).resolve(m));if(!l)throw new Error("package.json can not be located");var y=JSON.parse(o.readFileSync(i("%s/package.json",l))),g=y.version;if(0==a.satisfies(g,d)&&c.strict){var b=new Error(i("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",p[0],g,d));throw b.code="OPTIONAL_MODULE_NOT_FOUND",b}return h};l.exists=function(e){try{var t=l(e);return void 0!==t}catch(e){return!1}},t.exports=l}).call(t,"/",n(202)(e))},function(e,t){e.exports=require("express")},function(e,t){"use strict";var n={},r=null,o=function(e){if(n&&n[e])return n[e];if(!r)throw new Error("A configuration provider has not been set");return r(e)};o.setProvider=function(e){r=e},o.setValue=function(e,t){n[e]=t},e.exports=o},function(e,t){function n(e,t){return this instanceof n?(this._bsontype="Long",this.low_=0|e,void(this.high_=0|t)):new n(e,t)}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),i=o.multiply(r).subtract(this);return o.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}for(var s=n.fromNumber(Math.pow(t,6)),i=this,a="";;){var c=i.div(s),u=i.subtract(c.multiply(s)).toInt(),l=u.toString(t);if(i=c,i.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high_?t+33:t+1},n.prototype.isZero=function(){return 0==this.high_&&0==this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},n.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,f=0,p=0,d=0;return d+=i+u,p+=d>>>16,d&=65535,p+=o+c,f+=p>>>16,p&=65535,f+=r+a,l+=f>>>16,f&=65535,l+=t+s,l&=65535,n.fromBits(p<<16|d,l<<16|f)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,f=0,p=0,d=0;return d+=i*u,p+=d>>>16,d&=65535,p+=o*u,f+=p>>>16,p&=65535,p+=i*c,f+=p>>>16,p&=65535,f+=r*u,l+=f>>>16,f&=65535,f+=o*c,l+=f>>>16,f&=65535,f+=i*a,l+=f>>>16,f&=65535,l+=t*u+r*c+o*a+i*s,l&=65535,n.fromBits(p<<16|d,l<<16|f)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1),r=t.div(e).shiftLeft(1);if(r.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var o=this.subtract(e.multiply(r)),i=r.add(o.div(e));return i}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(var s=n.ZERO,o=this;o.greaterThanOrEqual(e);){for(var r=Math.max(1,Math.floor(o.toNumber()/e.toNumber())),a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:Math.pow(2,a-48),u=n.fromNumber(r),l=u.multiply(e);l.isNegative()||l.greaterThan(o);)r-=c,u=n.fromNumber(r),l=u.multiply(e);u.isZero()&&(u=n.ONE),s=s.add(u),o=o.subtract(l)}return s},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(e&=63,0==e)return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32==e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0==e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"==e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),i=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));i=i.multiply(u).add(n.fromNumber(c))}else i=i.multiply(o),i=i.add(n.fromNumber(c))}return i},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Long=n},function(e,t,n){var r=n(51);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(52),o=n(98);e.exports=n(40)?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";var r=n(1).inherits,o=n(3).MongoError,i=n(16).Readable||n(61).Readable,s=n(8),a=n(13),c=function(e,t,r,o,s,u){a.apply(this,Array.prototype.slice.call(arguments,0));var l=c.INIT,f={},p=null,d=o.promiseLibrary;d||(d="function"==typeof global.Promise?global.Promise:n(6).Promise),i.call(this,{objectMode:!0}),this.s={maxTimeMS:p,state:l,streamOptions:f,bson:e,ns:t,cmd:r,options:o,topology:s,topologyOptions:u,promiseLibrary:d}};r(c,i);for(var u in a.prototype)c.prototype[u]=a.prototype[u];var l=c.define=new s("AggregationCursor",c,!0);c.prototype.batchSize=function(e){if(this.s.state==c.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw o.create({message:"batchSize requires an integer",drvier:!0});return this.s.cmd.cursor&&(this.s.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this},l.classMethod("batchSize",{callback:!1,promise:!1,returns:[c]}),c.prototype.geoNear=function(e){return this.s.cmd.pipeline.push({$geoNear:e}),this},l.classMethod("geoNear",{callback:!1,promise:!1,returns:[c]}),c.prototype.group=function(e){return this.s.cmd.pipeline.push({$group:e}),this},l.classMethod("group",{callback:!1,promise:!1,returns:[c]}),c.prototype.limit=function(e){return this.s.cmd.pipeline.push({$limit:e}),this},l.classMethod("limit",{callback:!1,promise:!1,returns:[c]}),c.prototype.match=function(e){return this.s.cmd.pipeline.push({$match:e}),this},l.classMethod("match",{callback:!1,promise:!1,returns:[c]}),c.prototype.maxTimeMS=function(e){return this.s.topology.lastIsMaster().minWireVersion>2&&(this.s.cmd.maxTimeMS=e),this},l.classMethod("maxTimeMS",{callback:!1,promise:!1,returns:[c]}),c.prototype.out=function(e){return this.s.cmd.pipeline.push({$out:e}),this},l.classMethod("out",{callback:!1,promise:!1,returns:[c]}),c.prototype.project=function(e){return this.s.cmd.pipeline.push({$project:e}),this},l.classMethod("project",{callback:!1,promise:!1,returns:[c]}),c.prototype.lookup=function(e){return this.s.cmd.pipeline.push({$lookup:e}),this},l.classMethod("lookup",{callback:!1,promise:!1,returns:[c]}),c.prototype.redact=function(e){return this.s.cmd.pipeline.push({$redact:e}),this},l.classMethod("redact",{callback:!1,promise:!1,returns:[c]}),c.prototype.skip=function(e){return this.s.cmd.pipeline.push({$skip:e}),this},l.classMethod("skip",{callback:!1,promise:!1,returns:[c]}),c.prototype.sort=function(e){return this.s.cmd.pipeline.push({$sort:e}),this},l.classMethod("sort",{callback:!1,promise:!1,returns:[c]}),c.prototype.unwind=function(e){return this.s.cmd.pipeline.push({$unwind:e}),this},l.classMethod("unwind",{callback:!1,promise:!1,returns:[c]}),c.prototype.get=c.prototype.toArray,l.classMethod("toArray",{callback:!0,promise:!0}),l.classMethod("each",{callback:!0,promise:!1}),l.classMethod("forEach",{callback:!0,promise:!1}),l.classMethod("next",{callback:!0,promise:!0}),l.classMethod("close",{callback:!0,promise:!0}),l.classMethod("isClosed",{callback:!1,promise:!1,returns:[Boolean]}),l.classMethod("rewind",{callback:!1,promise:!1}),l.classMethod("bufferedCount",{callback:!1,promise:!1,returns:[Number]}),l.classMethod("readBufferedDocuments",{callback:!1,promise:!1,returns:[Array]}),c.INIT=0,c.OPEN=1,c.CLOSED=2,e.exports=c},function(e,t,n){"use strict";var r=n(3).MongoError,o=n(1).format,i=function(e,t){var n=this,r=[];t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:r,storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};i.prototype.add=function(e,t,n,i,s){if(this.s.storeOptions.force)return s(r.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return s(r.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var a=this.s.storedOps.shift();a.c(r.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:t,o:n,op:i,c:s})},i.prototype.addObjectAndMethod=function(e,t,n,i,s){if(this.s.storeOptions.force)return s(r.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return s(r.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var a=this.s.storedOps.shift();a.c(r.create({message:o("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:n,o:t,p:i,c:s})},i.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||r.create({message:o("no connection available for operation"),driver:!0}))};var s=["primary","primaryPreferred","nearest","secondaryPreferred"],a=["secondary","secondaryPreferred"];i.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof e.executePrimary||e.executePrimary,r="boolean"!=typeof e.executeSecondary||e.executeSecondary;t.length>0;){var o=t.shift();"cursor"==o.t?n&&r?o.o[o.m].apply(o.o,o.p):n&&o.o.options&&o.o.options.readPreference&&s.indexOf(o.o.options.readPreference.mode)!=-1?o.o[o.m].apply(o.o,o.p):!n&&r&&o.o.options&&o.o.options.readPreference&&a.indexOf(o.o.options.readPreference.mode)!=-1&&o.o[o.m].apply(o.o,o.p):"auth"==o.t?this.s.topology[o.t].apply(this.s.topology,o.o):n&&r?this.s.topology[o.t](o.n,o.o,o.op,o.c):n&&o.op&&o.op.readPreference&&s.indexOf(o.op.readPreference.mode)!=-1?this.s.topology[o.t](o.n,o.o,o.op,o.c):!n&&r&&o.op&&o.op.readPreference&&a.indexOf(o.op.readPreference.mode)!=-1&&this.s.topology[o.t](o.n,o.o,o.op,o.c)}},i.prototype.all=function(){return this.s.storedOps};var c=function(e){var t=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},n=!1,r=!1,o=!1,i=!1,s=!1,a=!1,c=e.maxWriteBatchSize||1e3,u=!1,l=!1;e.minWireVersion>=0&&(o=!0),e.maxWireVersion>=1&&(n=!0,i=!0),e.maxWireVersion>=2&&(r=!0),e.maxWireVersion>=3&&(s=!0,a=!0),e.maxWireVersion>=5&&(u=!0,l=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",n),t(this,"hasWriteCommands",r),t(this,"hasTextSearch",o),t(this,"hasAuthCommands",i),t(this,"hasListCollectionsCommand",s),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",c),t(this,"commandsTakeWriteConcern",u),t(this,"commandsTakeCollation",l)};t.Store=i,t.ServerCapabilities=c},function(e,t){e.exports=require("crypto")},function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=null==t?i:t,this.position=0),null==e||e instanceof Number)"undefined"!=typeof o?this.buffer=new o(r.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE)):this.buffer=new Array(r.BUFFER_SIZE),this.position=0;else{if("string"==typeof e)if("undefined"!=typeof o)this.buffer=new o(e);else{if("undefined"==typeof Uint8Array&&"[object Array]"!=Object.prototype.toString.call(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=s(e)}else this.buffer=e;this.position=e.length}}if("undefined"!=typeof global)var o=n(44).Buffer;r.prototype.put=function(e){if(null!=e.length&&"number"!=typeof e&&1!=e.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof e&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof e?e.charCodeAt(0):null!=e.length?e[0]:e,this.buffer.length>this.position)this.buffer[this.position++]=t;else if("undefined"!=typeof o&&o.isBuffer(this.buffer)){var n=new o(r.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=t}else{var n=null;n="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE+this.buffer.length)):new Array(r.BUFFER_SIZE+this.buffer.length);for(var i=0;i<this.buffer.length;i++)n[i]=this.buffer[i];this.buffer=n,this.buffer[this.position++]=t}},r.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if("undefined"!=typeof o&&o.isBuffer(this.buffer))n=new o(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"==Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var r=0;r<this.position;r++)n[r]=this.buffer[r]}this.buffer=n}if("undefined"!=typeof o&&o.isBuffer(e)&&o.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if("undefined"!=typeof o&&"string"==typeof e&&o.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if("[object Uint8Array]"==Object.prototype.toString.call(e)||"[object Array]"==Object.prototype.toString.call(e)&&"string"!=typeof e){for(var r=0;r<e.length;r++)this.buffer[t++]=e[r];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(var r=0;r<e.length;r++)this.buffer[t++]=e.charCodeAt(r);this.position=t>this.position?t:this.position}},r.prototype.read=function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),r=0;r<t;r++)n[r]=this.buffer[e++];return n},r.prototype.value=function(e){if(e=null!=e&&e,
e&&"undefined"!=typeof o&&o.isBuffer(this.buffer)&&this.buffer.length==this.position)return this.buffer;if("undefined"!=typeof o&&o.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return a(this.buffer,0,this.position)},r.prototype.length=function(){return this.position},r.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},r.prototype.toString=function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""};var i=0,s=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},a=function(e,t,n){for(var r="",o=t;o<n;o++)r+=String.fromCharCode(e[o]);return r};r.BUFFER_SIZE=256,r.SUBTYPE_DEFAULT=0,r.SUBTYPE_FUNCTION=1,r.SUBTYPE_BYTE_ARRAY=2,r.SUBTYPE_UUID_OLD=3,r.SUBTYPE_UUID=4,r.SUBTYPE_MD5=5,r.SUBTYPE_USER_DEFINED=128,e.exports=r,e.exports.Binary=r},function(e,t){var n=function e(t,n){return this instanceof e?(this._bsontype="Code",this.code=t,void(this.scope=n)):new e(t,n)};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.exports=n,e.exports.Code=n},function(e,t){function n(e,t,r){return this instanceof n?(this._bsontype="DBRef",this.namespace=e,this.oid=t,void(this.db=r)):new n(e,t,r)}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.exports=n,e.exports.DBRef=n},function(e,t,n){"use strict";var r=n(23),o=/^(\+|\-)?(\d+|(\d*\.\d*))?(E|e)?([\-\+])?(\d+)?$/,i=/^(\+|\-)?(Infinity|inf)$/i,s=/^(\+|\-)?NaN$/i,a=6111,c=-6176,u=6176,l=34,f=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),p=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),d=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),h=/^([\-\+])?(\d+)?$/,m=function(e){return!isNaN(parseInt(e,10))},y=function(e){var t=r.fromNumber(1e9),n=r.fromNumber(0),o=0;if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(var o=0;o<=3;o++)n=n.shiftLeft(32),n=n.add(new r(e.parts[o],0)),e.parts[o]=n.div(t).low_,n=n.modulo(t);return{quotient:e,rem:n}},g=function(e,t){if(!e&&!t)return{high:r.fromNumber(0),low:r.fromNumber(0)};var n=e.shiftRightUnsigned(32),o=new r(e.getLowBits(),0),i=t.shiftRightUnsigned(32),s=new r(t.getLowBits(),0),a=n.multiply(i),c=n.multiply(s),u=o.multiply(i),l=o.multiply(s);return a=a.add(c.shiftRightUnsigned(32)),c=new r(c.getLowBits(),0).add(u).add(l.shiftRightUnsigned(32)),a=a.add(c.shiftRightUnsigned(32)),l=c.shiftLeft(32).add(new r(l.getLowBits(),0)),{high:a,low:l}},b=function(e,t){var n=e.high_>>>0,r=t.high_>>>0;if(n<r)return!0;if(n==r){var o=e.low_>>>0,i=t.low_>>>0;if(o<i)return!0}return!1},v=function(e){this._bsontype="Decimal128",this.bytes=e};v.fromString=function(e){var t=!1,n=!1,y=!1,w=0,S=0,x=0,k=0,_=0,O=[0],C=0,E=0,I=0,N=0,A=0,M=0,T=[0,0],B=[0,0],D=0,R=0;e=e.trim();var P=e.match(o),L=e.match(i),j=e.match(s);if(!P&&!L&&!j||0==e.length)throw new Error(""+e+" not a valid Decimal128 string");if(P&&P[4]&&void 0===P[2])throw new Error(""+e+" not a valid Decimal128 string");if("+"!=e[R]&&"-"!=e[R]||(t="-"==e[R++]),!m(e[R])&&"."!=e[R]){if("i"==e[R]||"I"==e[R])return new v(new Buffer(t?p:d));if("N"==e[R])return new v(new Buffer(f))}for(;m(e[R])||"."==e[R];)if("."!=e[R])C<34&&("0"!=e[R]||y)&&(y||(_=S),y=!0,O[E++]=parseInt(e[R],10),C+=1),y&&(x+=1),n&&(k+=1),S+=1,R+=1;else{if(n)return new v(new Buffer(f));n=!0,R+=1}if(n&&!S)throw new Error(""+e+" not a valid Decimal128 string");if("e"==e[R]||"E"==e[R]){var z=e.substr(++R).match(h);if(!z||!z[2])return new v(new Buffer(f));A=parseInt(z[0],10),R+=z[0].length}if(e[R])return new v(new Buffer(f));if(I=0,C){if(N=C-1,w=x,0!=A&&1!=w)for(;"0"==e[_+w-1];)w-=1}else I=0,N=0,O[0]=0,x=1,C=1,w=0;for(A<=k&&k-A>16384?A=c:A-=k;A>a;){if(N+=1,N-I>l){var U=O.join("");if(U.match(/^0+$/)){A=a;break}return new v(new Buffer(t?p:d))}A-=1}for(;A<c||C<x;){if(0==N){A=c,w=0;break}if(C<x?x-=1:N-=1,!(A<a)){var U=O.join("");if(U.match(/^0+$/)){A=a;break}return new v(new Buffer(t?p:d))}A+=1}if(N-I+1<w&&"0"!=e[w]){var q=S;n&&A==c&&(_+=1,q+=1);var F=parseInt(e[_+N+1],10),W=0;if(F>=5&&(W=1,5==F)){W=O[N]%2==1;for(var M=_+N+2;M<q;M++)if(parseInt(e[M],10)){W=1;break}}if(W)for(var V=N;V>=0&&++O[V]>9;V--)if(O[V]=0,0==V){if(!(A<a))return new v(new Buffer(t?p:d));A+=1,O[V]=1}}if(T=r.fromNumber(0),B=r.fromNumber(0),0==w)T=r.fromNumber(0),B=r.fromNumber(0);else if(N-I<17){var V=I;for(B=r.fromNumber(O[V++]),T=new r(0,0);V<=N;V++)B=B.multiply(r.fromNumber(10)),B=B.add(r.fromNumber(O[V]))}else{var V=I;for(T=r.fromNumber(O[V++]);V<=N-17;V++)T=T.multiply(r.fromNumber(10)),T=T.add(r.fromNumber(O[V]));for(B=r.fromNumber(O[V++]);V<=N;V++)B=B.multiply(r.fromNumber(10)),B=B.add(r.fromNumber(O[V]))}var H=g(T,r.fromString("100000000000000000"));H.low=H.low.add(B),b(H.low,B)&&(H.high=H.high.add(r.fromNumber(1)));var D=A+u,G={low:r.fromNumber(0),high:r.fromNumber(0)};H.high.shiftRightUnsigned(49).and(r.fromNumber(1)).equals(r.fromNumber)?(G.high=G.high.or(r.fromNumber(3).shiftLeft(61)),G.high=G.high.or(r.fromNumber(D).and(r.fromNumber(16383).shiftLeft(47))),G.high=G.high.or(H.high.and(r.fromNumber(0x7fffffffffff)))):(G.high=G.high.or(r.fromNumber(16383&D).shiftLeft(49)),G.high=G.high.or(H.high.and(r.fromNumber(562949953421311)))),G.low=H.low,t&&(G.high=G.high.or(r.fromString("9223372036854775808")));var K=new Buffer(16),R=0;return K[R++]=255&G.low.low_,K[R++]=G.low.low_>>8&255,K[R++]=G.low.low_>>16&255,K[R++]=G.low.low_>>24&255,K[R++]=255&G.low.high_,K[R++]=G.low.high_>>8&255,K[R++]=G.low.high_>>16&255,K[R++]=G.low.high_>>24&255,K[R++]=255&G.high.low_,K[R++]=G.high.low_>>8&255,K[R++]=G.high.low_>>16&255,K[R++]=G.high.low_>>24&255,K[R++]=255&G.high.high_,K[R++]=G.high.high_>>8&255,K[R++]=G.high.high_>>16&255,K[R++]=G.high.high_>>24&255,new v(K)};var w=31,S=16383,x=30,k=31,u=6176;v.prototype.toString=function(){for(var e,t,n,o,i,s,a=0,c=new Array(36),l=0;l<c.length;l++)c[l]=0;var f,p,d,l,h,m,g=0,b=!1,v={parts:new Array(4)},_=[],g=0,O=this.bytes;o=O[g++]|O[g++]<<8|O[g++]<<16|O[g++]<<24,n=O[g++]|O[g++]<<8|O[g++]<<16|O[g++]<<24,t=O[g++]|O[g++]<<8|O[g++]<<16|O[g++]<<24,e=O[g++]|O[g++]<<8|O[g++]<<16|O[g++]<<24;var g=0,C={low:new r(o,n),high:new r(t,e)};if(C.high.lessThan(r.ZERO)&&_.push("-"),i=e>>26&w,i>>3==3){if(i==x)return _.join("")+"Infinity";if(i==k)return"NaN";s=e>>15&S,d=8+(e>>14&1)}else d=e>>14&7,s=e>>17&S;if(f=s-u,v.parts[0]=(16383&e)+((15&d)<<14),v.parts[1]=t,v.parts[2]=n,v.parts[3]=o,0==v.parts[0]&&0==v.parts[1]&&0==v.parts[2]&&0==v.parts[3])b=!0;else for(var m=3;m>=0;m--){var E=0,I=y(v);if(v=I.quotient,E=I.rem.low_)for(var h=8;h>=0;h--)c[9*m+h]=E%10,E=Math.floor(E/10)}if(b)a=1,c[g]=0;else{a=36;for(var l=0;!c[g];)l++,a-=1,g+=1}if(p=a-1+f,p>=34||p<=-7||f>0){_.push(c[g++]),a-=1,a&&_.push(".");for(var l=0;l<a;l++)_.push(c[g++]);_.push("E"),p>0?_.push("+"+p):_.push(p)}else if(f>=0)for(var l=0;l<a;l++)_.push(c[g++]);else{var N=a+f;if(N>0)for(var l=0;l<N;l++)_.push(c[g++]);else _.push("0");for(_.push(".");N++<0;)_.push("0");for(var l=0;l<a-Math.max(N-1,0);l++)_.push(c[g++])}return _.join("")},v.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.exports=v,e.exports.Decimal128=v},function(e,t){function n(e){return this instanceof n?(this._bsontype="Double",void(this.value=e)):new n(e)}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Double=n},function(e,t){function n(){return this instanceof n?void(this._bsontype="MaxKey"):new n}e.exports=n,e.exports.MaxKey=n},function(e,t){function n(){return this instanceof n?void(this._bsontype="MinKey"):new n}e.exports=n,e.exports.MinKey=n},function(e,t){for(var n=parseInt(16777215*Math.random(),10),r=new RegExp("^[0-9a-fA-F]{24}$"),o=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);this._bsontype="ObjectID";var n=e.isValid(t);if(!n&&null!=t)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24==t.length)return e.createFromHexString(t);if(null==t||"number"==typeof t)this.id=this.generate(t);else{if(null==t||12!==t.length){if(null!=t&&t.toHexString)return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t}e.cacheHexString&&(this.__id=this.toHexString())},i=[],s=0;s<256;s++)i[s]=(s<=15?"0":"")+s.toString(16);o.prototype.toHexString=function(){if(o.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof c)return e=u(this.id),o.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=i[this.id.charCodeAt(t)];return o.cacheHexString&&(this.__id=e),e},o.prototype.get_inc=function(){return o.index=(o.index+1)%16777215},o.prototype.getInc=function(){return this.get_inc()},o.prototype.generate=function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3));var t=("undefined"==typeof process?Math.floor(1e5*Math.random()):process.pid)%65535,r=this.get_inc(),o=new Buffer(12);return o[3]=255&e,o[2]=e>>8&255,o[1]=e>>16&255,o[0]=e>>24&255,o[6]=255&n,o[5]=n>>8&255,o[4]=n>>16&255,o[8]=255&t,o[7]=t>>8&255,o[11]=255&r,o[10]=r>>8&255,o[9]=r>>16&255,o},o.prototype.toString=function(){return this.toHexString()},o.prototype.inspect=o.prototype.toString,o.prototype.toJSON=function(){return this.toHexString()},o.prototype.equals=function(e){return e instanceof o?this.toString()==e.toString():"string"==typeof e&&o.isValid(e)&&12==e.length&&this.id instanceof c?e===this.id.toString("binary"):"string"==typeof e&&o.isValid(e)&&24==e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&o.isValid(e)&&12==e.length?e===this.id:!(null==e||!(e instanceof o||e.toHexString))&&e.toHexString()===this.toHexString()},o.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(1e3*Math.floor(t)),e},o.index=~~(16777215*Math.random()),o.createPk=function(){return new o},o.createFromTime=function(e){var t=new Buffer([0,0,0,0,0,0,0,0,0,0,0,0]);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,new o(t)};for(var a=("0123456789abcdef".split(""),[]),s=0;s<10;)a[48+s]=s++;for(;s<16;)a[55+s]=a[87+s]=s++;var c=Buffer,u=function(e){return e.toString("hex")};o.createFromHexString=function(e){if("undefined"==typeof e||null!=e&&24!=e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");var t=e.length;if(t>24)throw new Error("Id cannot be longer than 12 bytes");for(var n=t>>1,r=new c(n),i=0,s=0;s<t;)r[i++]=a[e.charCodeAt(s++)]<<4|a[e.charCodeAt(s++)];return new o(r)},o.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12==e.length||24==e.length&&r.test(e):e instanceof o||e instanceof c||!!e.toHexString&&(12==e.id.length||24==e.id.length&&r.test(e.id))))},Object.defineProperty(o.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.exports=o,e.exports.ObjectID=o,e.exports.ObjectId=o},function(e,t){function n(e,t){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var r=0;r<this.options.length;r++)if("i"!=this.options[r]&&"m"!=this.options[r]&&"x"!=this.options[r]&&"l"!=this.options[r]&&"s"!=this.options[r]&&"u"!=this.options[r])throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}e.exports=n,e.exports.BSONRegExp=n},function(e,t){function n(e){return this instanceof n?(this._bsontype="Symbol",void(this.value=e)):new n(e)}n.prototype.valueOf=function(){return this.value},n.prototype.toString=function(){return this.value},n.prototype.inspect=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Symbol=n},function(e,t){function n(e,t){return this instanceof n?(this._bsontype="Timestamp",this.low_=0|e,void(this.high_=0|t)):new n(e,t)}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var r=n.fromNumber(t),o=this.div(r),i=o.multiply(r).subtract(this);return o.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}for(var s=n.fromNumber(Math.pow(t,6)),i=this,a="";;){var c=i.div(s),u=i.subtract(c.multiply(s)).toInt(),l=u.toString(t);if(i=c,i.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high_?t+33:t+1},n.prototype.isZero=function(){return 0==this.high_&&0==this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_==e.high_&&this.low_==e.low_},n.prototype.notEquals=function(e){return this.high_!=e.high_||this.low_!=e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,f=0,p=0,d=0;return d+=i+u,p+=d>>>16,d&=65535,p+=o+c,f+=p>>>16,p&=65535,f+=r+a,l+=f>>>16,f&=65535,l+=t+s,l&=65535,n.fromBits(p<<16|d,l<<16|f)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,r=65535&this.high_,o=this.low_>>>16,i=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,u=65535&e.low_,l=0,f=0,p=0,d=0;return d+=i*u,p+=d>>>16,d&=65535,p+=o*u,f+=p>>>16,p&=65535,p+=i*c,f+=p>>>16,p&=65535,f+=r*u,l+=f>>>16,f&=65535,f+=o*c,l+=f>>>16,f&=65535,f+=i*a,l+=f>>>16,f&=65535,l+=t*u+r*c+o*a+i*s,l&=65535,n.fromBits(p<<16|d,l<<16|f)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1),r=t.div(e).shiftLeft(1);if(r.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var o=this.subtract(e.multiply(r)),i=r.add(o.div(e));return i}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(var s=n.ZERO,o=this;o.greaterThanOrEqual(e);){for(var r=Math.max(1,Math.floor(o.toNumber()/e.toNumber())),a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:Math.pow(2,a-48),u=n.fromNumber(r),l=u.multiply(e);l.isNegative()||l.greaterThan(o);)r-=c,u=n.fromNumber(r),l=u.multiply(e);u.isZero()&&(u=n.ONE),s=s.add(u),o=o.subtract(l)}return s},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(e&=63,0==e)return this;var t=this.low_;if(e<32){var r=this.high_;return n.fromBits(t<<e,r<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(e&=63,0==e)return this;var t=this.high_;if(e<32){var r=this.low_;return n.fromBits(r>>>e|t<<32-e,t>>>e)}return 32==e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var r=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=r),r},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0==e.length)throw Error("number format error: empty string");var r=t||10;if(r<2||36<r)throw Error("radix out of range: "+r);if("-"==e.charAt(0))return n.fromString(e.substring(1),r).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var o=n.fromNumber(Math.pow(r,8)),i=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),r);if(a<8){var u=n.fromNumber(Math.pow(r,a));i=i.multiply(u).add(n.fromNumber(c))}else i=i.multiply(o),i=i.add(n.fromNumber(c))}return i},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Timestamp=n},function(e,t,n){e.exports=!n(72)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports={}},function(e,t,n){try{var r=n(1);if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=n(181)}},function(e,t){"use strict";var n=["primaryPreferred","secondary","secondaryPreferred","nearest"],r=function(e,t,n){this.preference=e,this.tags=t,this.options=n,this.options&&null!=this.options.maxStalenessSeconds?(this.options=n,this.maxStalenessSeconds=this.options.maxStalenessSeconds>=0?this.options.maxStalenessSeconds:null):t&&"object"==typeof t&&(this.options=t,t=null)};r.prototype.slaveOk=function(){return n.indexOf(this.preference)!=-1},r.prototype.equals=function(e){return e.preference==this.preference},r.prototype.toJSON=function(){var e={mode:this.preference};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),e},r.primary=new r("primary"),r.primaryPreferred=new r("primaryPreferred"),r.secondary=new r("secondary"),r.secondaryPreferred=new r("secondaryPreferred"),r.nearest=new r("nearest"),e.exports=r},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("core-util-is")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return new a.default(function(n,r){return c.verify(e,t,function(e,t){return e?r(e):n(t)})})}function i(e,t,n){return new a.default(function(r,o){var i=c.sign(e,t,n);return r(i)})}var s=n(90),a=r(s),c=n(206),u=n(127),l=(n(107).MongoClient,{issue:function(e,t,n,r){var o;return u.connect(r).then(function(t){return o=t,u.find(o,e)}).then(function(t){if(t)throw new Error("JWT already white listed.");return u.save(o,e)}).then(function(r){if(!r)throw new Error("Failed to whitelist JWT.");return i(e,t,n)})},revoke:function(e,t){return u.connect(t).then(function(t){return u.remove(t,e)})},verify:function(e,t,n){var r;return o(e,t).then(function(e){return r=e,u.connect(n)}).then(function(e){return u.find(e,r)}).then(function(e){return new a.default(function(t,n){return e?t(r):n("JWT is not whitelisted.")})})}});e.exports=l},function(e,t){var n=function(e){return this instanceof n?(this._bsontype="Int32",void(this.value=e)):new n(e)};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Int32=n},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(68);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(24),o=n(152),i=n(173),s=Object.defineProperty;t.f=n(40)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";var r=n(1).format,o=n(20),i=n(5).Query,s=n(4),a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var c=null,u=null;try{c=o("kerberos").Kerberos,u=o("kerberos").processes.MongoAuthProcess}catch(e){}var l=function(e){this.bson=e,this.authStore=[]};l.prototype.auth=function(e,t,n,o,i,u,l){var p=this;if(null==c)return l(new Error("Kerberos library is not installed"));var d=u.gssapiServiceName||"mongodb",h=t.length;if(0==h)return l(null,null);for(var y=0,g=null;t.length>0;){var b=function(t){f(p,n,o,i,n,d,e,t,u,function(e,t){h-=1,e?g=e:t.result.$err?g=t.result:t.result.errmsg?g=t.result:y+=1,0==h&&y>0?(m(p.authStore,new a(n,o,i,u)),l(null,!0)):0==h&&(null==g&&(g=new s(r("failed to authenticate using mongocr"))),l(g,!1))})},v=function(e){process.nextTick(function(){b(e)})};v(t.shift())}};var f=function(e,t,n,r,o,i,s,a,c,l){var f=new u(a.host,a.port,i,c);f.init(n,r,function(i){return i?l(i,!1):void f.transition("",function(i,c){return i?l(i,!1):void p(e,f,c,t,n,r,o,s,a,l)})})},p=function(e,t,n,r,o,s,a,c,u,l){var f={saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1};c(u,new i(e.bson,"$external.$cmd",f,{numberToSkip:0,numberToReturn:1}),function(n,i){if(n)return l(n,!1);var f=i.result;t.transition(i.result.payload,function(n,i){return n?l(n,!1):void d(e,t,i,f,r,o,s,a,c,u,l)})})},d=function(e,t,n,r,o,s,a,c,u,l,f){var p={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new i(e.bson,"$external.$cmd",p,{numberToSkip:0,numberToReturn:1}),function(n,r){if(n)return f(n,!1);var i=r.result;t.transition(i.payload,function(n,r){return n?f(n,!1):void h(e,t,r,i,o,s,a,c,u,l,f)})})},h=function(e,t,n,r,o,s,a,c,u,l,f){var p={saslContinue:1,conversationId:r.conversationId,payload:n};u(l,new i(e.bson,"$external.$cmd",p,{numberToSkip:0,numberToReturn:1}),function(e,n){return e?f(e,!1):void t.transition(null,function(e){return e?f(e,null):void f(null,n)})})},m=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};l.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},l.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,r[i].options,function(e){o-=1,0==o&&n(e,null)})},e.exports=l},function(e,t,n){"use strict";var r=n(1).format,o=n(28),i=n(5).Query,s=n(4),a=function(e,t,n){this.db=e,this.username=t,this.password=n};a.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var c=function(e){this.bson=e,this.authStore=[]},u=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};c.prototype.auth=function(e,t,n,c,l,f){var p=this,d=t.length;if(0==d)return f(null,null);for(var h=0,m=null;t.length>0;){var y=function(t){e(t,new i(p.bson,r("%s.$cmd",n),{getnonce:1},{numberToSkip:0,numberToReturn:1}),function(y,g){var b=null,v=null;if(null==y){b=g.result.nonce;var w=o.createHash("md5");w.update(c+":mongo:"+l,"utf8");var S=w.digest("hex");w=o.createHash("md5"),w.update(b+c+S,"utf8"),v=w.digest("hex")}e(t,new i(p.bson,r("%s.$cmd",n),{authenticate:1,user:c,nonce:b,key:v},{numberToSkip:0,numberToReturn:1}),function(e,t){d-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:h+=1,0==d&&h>0?(u(p.authStore,new a(n,c,l)),f(null,!0)):0==d&&(null==m&&(m=new s(r("failed to authenticate using mongocr"))),f(m,!1))})})},g=function(e){process.nextTick(function(){y(e)})};g(t.shift())}},c.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},c.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,function(e){o-=1,0==o&&n(e,null)})},e.exports=c},function(e,t,n){"use strict";var r=n(66),o=n(1).format,i=r.Binary,s=n(7).retrieveBSON,a=n(5).Query,c=n(4),r=s(),u=function(e,t,n){this.db=e,this.username=t,this.password=n};u.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var l=function(e){this.bson=e,this.authStore=[]};l.prototype.auth=function(e,t,n,r,s,l){var p=this,d=t.length;if(0==d)return l(null,null);for(var h=0,m=null;t.length>0;){var y=function(t){var y=new i(o("\0%s\0%s",r,s)),g={saslStart:1,mechanism:"PLAIN",payload:y,autoAuthorize:1};e(t,new a(p.bson,"$external.$cmd",g,{numberToSkip:0,numberToReturn:1}),function(e,t){d-=1,e?m=e:t.result.$err?m=t.result:t.result.errmsg?m=t.result:h+=1,0==d&&h>0?(f(p.authStore,new u(n,r,s)),l(null,!0)):0==d&&(null==m&&(m=new c(o("failed to authenticate using mongocr"))),l(m,!1))})},g=function(e){process.nextTick(function(){y(e)})};g(t.shift())}};var f=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};l.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},l.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,function(e){o-=1,0==o&&n(e,null)})},e.exports=l},function(e,t,n){"use strict";var r=n(1).format,o=n(28),i=n(7).retrieveBSON,s=n(5).Query,a=n(4),c=i(),u=c.Binary,l=function(e,t,n){this.db=e,this.username=t,this.password=n};l.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var f=0,p=function(e){this.bson=e,this.authStore=[],this.id=f++},d=function(e){for(var t={},n=e.split(","),r=0;r<n.length;r++){var o=n[r].split("=");t[o[0]]=o[1]}return t},h=function(e,t){if("string"!=typeof e)throw new a("username must be a string");if("string"!=typeof t)throw new a("password must be a string");if(0==t.length)throw new a("password cannot be empty");var n=o.createHash("md5");return n.update(e+":mongo:"+t,"utf8"),n.digest("hex")},m=function(e,t){Buffer.isBuffer(e)||(e=new Buffer(e)),Buffer.isBuffer(t)||(t=new Buffer(t));var n=[];if(e.length>t.length)for(var r=0;r<t.length;r++)n.push(e[r]^t[r]);else for(r=0;r<e.length;r++)n.push(e[r]^t[r]);return new Buffer(n)},y=function(e,t,n){var r=function(t){var n=o.createHmac("sha1",e);return n.update(t),new Buffer(n.digest("base64"),"base64")};t=Buffer.concat([t,new Buffer("\0\0\0")]);for(var i=r(t),s=i,a=0;a<n-1;a++)s=r(s),i=m(i,s);return i};p.prototype.auth=function(e,t,n,i,c,f){var p=this,b=t.length;if(0==b)return f(null,null);for(var v=0,w=null,S=function(t){i=i.replace("=","=3D").replace(",","=2C");var S=o.randomBytes(24).toString("base64"),x=r("n=%s,r=%s",i,S),k={saslStart:1,mechanism:"SCRAM-SHA-1",payload:new u(r("n,,%s",x)),autoAuthorize:1},_=function(e,t){return e?(v-=1,w=e,!1):t.result.$err?(w=t.result,!1):t.result.errmsg?(w=t.result,!1):(v+=1,!0)},O=function(e,t){return 0==e&&t>0?(g(p.authStore,new l(n,i,c)),f(null,!0)):0==e?(null==w&&(w=new a(r("failed to authenticate using scram"))),f(w,!1)):void 0},C=function(e,t){_(e,t),b-=1,O(b,v)};e(t,new s(p.bson,r("%s.$cmd",n),k,{numberToSkip:0,numberToReturn:1}),function(S,k){if(0!=_(S,k)){var O=d(k.result.payload.value()),E=parseInt(O.i,10),I=O.s,N=O.r,A=r("c=biws,r=%s",N),M=h(i,c),T=y(M,new Buffer(I,"base64"),E),B=o.createHmac("sha1",T);B.update(new Buffer("Client Key"));var D=new Buffer(B.digest("base64"),"base64"),R=o.createHash("sha1");R.update(D);var P=new Buffer(R.digest("base64"),"base64"),L=[x,k.result.payload.value().toString("base64"),A].join(",");B=o.createHmac("sha1",P),B.update(new Buffer(L));var j=new Buffer(B.digest("base64"),"base64"),z=r("p=%s",new Buffer(m(D,j)).toString("base64")),U=[A,z].join(",");B=o.createHmac("sha1",T),B.update(new Buffer("Server Key"));var q=new Buffer(B.digest("base64"),"base64");B=o.createHmac("sha1",q),B.update(new Buffer(L));var F={saslContinue:1,conversationId:k.result.conversationId,payload:new u(new Buffer(U))};e(t,new s(p.bson,r("%s.$cmd",n),F,{numberToSkip:0,numberToReturn:1}),function(o,i){if(i&&0==i.result.done){var a={saslContinue:1,conversationId:i.result.conversationId,payload:new Buffer(0)};e(t,new s(p.bson,r("%s.$cmd",n),a,{numberToSkip:0,numberToReturn:1}),function(e,t){C(e,t)})}else C(o,i)})}else{if(b-=1,0==b&&v>0)return g(p.authStore,new l(n,i,c)),f(null,!0);if(0==b)return null==w&&(w=new a(r("failed to authenticate using scram"))),f(w,!1)}})},x=function(e){process.nextTick(function(){S(e)})};t.length>0;)x(t.shift())};var g=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};p.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},p.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,function(e){o-=1,0==o&&n(e,null)})},e.exports=p},function(e,t,n){"use strict";var r=n(1).format,o=n(5).Query,i=n(4),s=function(e,t,n){this.db=e,this.username=t,this.password=n};s.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var a=function(e){this.bson=e,this.authStore=[]};a.prototype.auth=function(e,t,n,a,u,l){var f=this,p=t.length;if(0==p)return l(null,null);for(var d=0,h=null;t.length>0;){var m=function(t){var m={authenticate:1,mechanism:"MONGODB-X509"};a&&(m.user=a),e(t,new o(f.bson,"$external.$cmd",m,{numberToSkip:0,numberToReturn:1}),function(e,t){p-=1,e?h=e:t.result.$err?h=t.result:t.result.errmsg?h=t.result:d+=1,0==p&&d>0?(c(f.authStore,new s(n,a,u)),
l(null,!0)):0==p&&(null==h&&(h=new i(r("failed to authenticate using mongocr"))),l(h,!1))})},y=function(e){process.nextTick(function(){m(e)})};y(t.shift())}};var c=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};a.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},a.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,function(e){o-=1,0==o&&n(e,null)})},e.exports=a},function(e,t,n){"use strict";var r=n(15),o=n(7).retrieveBSON,i=n(4),s=n(1).format,a=o(),c=a.Long,u=function(e,t,n,o,i,s){o=o||{},this.pool=null,this.server=null,this.disconnectHandler=o.disconnectHandler,this.bson=e,this.ns=t,this.cmd=n,this.options=o,this.topology=i,this.cursorState={cursorId:null,cmd:n,documents:o.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:o.limit||n.limit||0,skip:o.skip||n.skip||0,batchSize:o.batchSize||n.batchSize||1e3,currentLimit:0,transforms:o.transforms},"boolean"==typeof s.promoteLongs?this.cursorState.promoteLongs=s.promoteLongs:"boolean"==typeof o.promoteLongs&&(this.cursorState.promoteLongs=o.promoteLongs),"boolean"==typeof s.promoteValues?this.cursorState.promoteValues=s.promoteValues:"boolean"==typeof o.promoteValues&&(this.cursorState.promoteValues=o.promoteValues),"boolean"==typeof s.promoteBuffers?this.cursorState.promoteBuffers=s.promoteBuffers:"boolean"==typeof o.promoteBuffers&&(this.cursorState.promoteBuffers=o.promoteBuffers),this.logger=r("Cursor",s),"number"==typeof n?(this.cursorState.cursorId=c.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof c&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n)};u.prototype.setCursorBatchSize=function(e){this.cursorState.batchSize=e},u.prototype.cursorBatchSize=function(){return this.cursorState.batchSize},u.prototype.setCursorLimit=function(e){this.cursorState.limit=e},u.prototype.cursorLimit=function(){return this.cursorState.limit},u.prototype.setCursorSkip=function(e){this.cursorState.skip=e},u.prototype.cursorSkip=function(){return this.cursorState.skip};var l=function(e,t,n){try{e(t,n)}catch(e){process.nextTick(function(){throw e})}};u.prototype._find=function(e){var t=this;t.logger.isDebug()&&t.logger.debug(s("issue initial query [%s] with flags [%s]",JSON.stringify(t.cmd),JSON.stringify(t.query)));var n=function(n,r){if(n)return e(n);var o=r.message;if(o.queryFailure)return e(i.create(o.documents[0]),null);if(Array.isArray(o.documents)&&1==o.documents.length&&(!t.cmd.find||t.cmd.find&&0==t.cmd.virtual)&&("string"!=o.documents[0].cursor||o.documents[0].$err||o.documents[0].errmsg||Array.isArray(o.documents[0].result))){if(o.documents[0].$err||o.documents[0].errmsg)return e(i.create(o.documents[0]),null);if(null!=o.documents[0].cursor&&"string"!=typeof o.documents[0].cursor){var s=o.documents[0].cursor.id;return o.documents[0].cursor.ns&&(t.ns=o.documents[0].cursor.ns),t.cursorState.cursorId="number"==typeof s?c.fromNumber(s):s,t.cursorState.lastCursorId=t.cursorState.cursorId,Array.isArray(o.documents[0].cursor.firstBatch)&&(t.cursorState.documents=o.documents[0].cursor.firstBatch),e(null,null)}if(Array.isArray(o.documents[0].result))return t.cursorState.documents=o.documents[0].result,t.cursorState.cursorId=c.ZERO,e(null,null)}t.cursorState.cursorId=o.cursorId,t.cursorState.documents=o.documents,t.cursorState.lastCursorId=o.cursorId,t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.query&&(t.cursorState.documents=t.cursorState.transforms.query(o)),e(null,null)},r={};(t.options.raw||t.cmd.raw)&&(r.raw=t.options.raw||t.cmd.raw),"string"==typeof t.query.documentsReturnedIn&&(r.documentsReturnedIn=t.query.documentsReturnedIn),"boolean"==typeof t.cursorState.promoteLongs&&(r.promoteLongs=t.cursorState.promoteLongs),"boolean"==typeof t.cursorState.promoteValues&&(r.promoteValues=t.cursorState.promoteValues),"boolean"==typeof t.cursorState.promoteBuffers&&(r.promoteBuffers=t.cursorState.promoteBuffers),t.server.s.pool.write(t.query,r,n)},u.prototype._getmore=function(e){this.logger.isDebug()&&this.logger.debug(s("schedule getMore call for query [%s]",JSON.stringify(this.query)));var t=this.options.raw||this.cmd.raw,n=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+n>this.cursorState.limit&&(n=this.cursorState.limit-this.cursorState.currentLimit);var r=this.server.s.pool;this.server.wireProtocolHandler.getMore(this.bson,this.ns,this.cursorState,n,t,r,this.options,e)},u.prototype._killcursor=function(e){if(this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||0==this.cursorState.init)return void(e&&e(null,null));var t=this.server.s.pool;this.server.wireProtocolHandler.killCursor(this.bson,this.ns,this.cursorState.cursorId,t,e)},u.prototype.clone=function(){return this.topology.cursor(this.ns,this.cmd,this.options)},u.prototype.isDead=function(){return 1==this.cursorState.dead},u.prototype.isKilled=function(){return 1==this.cursorState.killed},u.prototype.isNotified=function(){return 1==this.cursorState.notified},u.prototype.bufferedCount=function(){return this.cursorState.documents.length-this.cursorState.cursorIndex},u.prototype.readBufferedDocuments=function(e){var t=this.cursorState.documents.length-this.cursorState.cursorIndex,n=e<t?e:t,r=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(var o=0;o<r.length;o++)r[o]=this.cursorState.transforms.doc(r[o]);return this.cursorState.limit>0&&this.cursorState.currentLimit+r.length>this.cursorState.limit&&(r=r.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+r.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+r.length,r},u.prototype.kill=function(e){this._killcursor(e)},u.prototype.rewind=function(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)};var f=function(e,t){return!(!e.pool||!e.pool.isDestroyed()||(e.cursorState.notified=!0,e.cursorState.killed=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,t(i.create(s("connection to host %s:%s was destroyed",e.pool.host,e.pool.port))),0))},p=function(e,t){return!(!e.cursorState.dead||e.cursorState.killed||(e.cursorState.notified=!0,e.cursorState.killed=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,l(t,null,null),0))},d=function(e,t){return!(!e.cursorState.dead||!e.cursorState.killed||(l(t,i.create("cursor is dead")),0))},h=function(e,t){return!!e.cursorState.killed&&(e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,l(t,null,null),!0)},m=function(e,t){e.cursorState.dead=!0,e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,l(t,null,null)},y=function(e,t){e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,l(t,null,null)},g=function(e,t){if(e.cursorState.notified)return t(new Error("cursor is exhausted"));if(!h(e,t)&&!p(e,t)&&!d(e,t)){if(!e.cursorState.init){if(!e.topology.isConnected(e.options)&&null!=e.disconnectHandler)return e.topology.isDestroyed()?t(new i("Topology was destroyed")):e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t);try{e.server=e.topology.getServer(e.options)}catch(n){return null!=e.disconnectHandler?e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t):t(n)}if(e.cursorState.init=!0,e.cmd&&e.cmd.collation&&e.server.ismaster.maxWireVersion<5)return t(new i(s("server %s does not support collation",e.server.name)));try{e.query=e.server.wireProtocolHandler.command(e.bson,e.ns,e.cmd,e.cursorState,e.topology,e.options)}catch(e){return t(e)}}if(null==e.cursorState.cursorId){if(f(e,t))return;if(e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));e._find(function(n){return n?l(t,n,null):0==e.cursorState.documents.length&&e.cursorState.cursorId&&e.cursorState.cursorId.isZero()&&!e.cmd.tailable&&!e.cmd.awaitData?y(e,t):void g(e,t)})}else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),m(e,t);if(e.cursorState.cursorIndex!=e.cursorState.documents.length||c.ZERO.equals(e.cursorState.cursorId)){if(e.cursorState.documents.length==e.cursorState.cursorIndex&&e.cmd.tailable&&c.ZERO.equals(e.cursorState.cursorId))return l(t,i.create({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}));if(e.cursorState.documents.length==e.cursorState.cursorIndex&&c.ZERO.equals(e.cursorState.cursorId))m(e,t);else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit)return e.kill(),m(e,t);e.cursorState.currentLimit+=1;var n=e.cursorState.documents[e.cursorState.cursorIndex++];if(n.$err)return e.kill(),m(e,function(){l(t,new i(n.$err))});e.cursorState.transforms&&"function"==typeof e.cursorState.transforms.doc&&(n=e.cursorState.transforms.doc(n)),l(t,null,n)}}else{if(e.cursorState.documents=[],e.cursorState.cursorIndex=0,e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));if(f(e,t))return;e._getmore(function(n,r,o){return n?l(t,n):(e.connection=o,0==e.cursorState.documents.length&&e.cmd.tailable&&c.ZERO.equals(e.cursorState.cursorId)?l(t,i.create({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData})):0==e.cursorState.documents.length&&e.cmd.tailable&&!c.ZERO.equals(e.cursorState.cursorId)?g(e,t):e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit?m(e,t):void g(e,t))})}}}};u.prototype.next=function(e){g(this,e)},e.exports=u},function(e,t,n){"use strict";function r(e,t,n){var r=t.s.topology.capabilities();if(r&&r.commandsTakeWriteConcern){var o=me(d(n),t.s.db,t,n);o.writeConcern&&(e.writeConcern=o.writeConcern)}}function o(e,t,n){var r=t.s.topology.capabilities();r&&r.commandsTakeCollation&&n.collation&&"object"==typeof n.collation&&(e.collation=n.collation)}function i(e){if(!h(e)||"ObjectID"==e._bsontype)return e;for(var t,n=Object.keys(e),r=n.length,o={};r--;)t=n[r],"function"==typeof e[t]?o[t]=new u(String(e[t])):o[t]=i(e[t]);return o}var s=n(2).checkCollectionName,a=n(3).BSON.ObjectID,c=n(3).BSON.Long,u=n(3).BSON.Code,l=n(1).format,f=n(26),p=n(3).MongoError,d=n(2).shallowClone,h=n(2).isObject,m=n(2).toError,y=n(2).normalizeHintField,g=n(2).handleCallback,b=n(2).decorateCommand,v=n(2).formattedOrderClause,w=n(14),S=n(3).ReadPreference,x=n(19),k=n(8),_=n(13),O=n(83),C=n(82),E=n(2).assign,I=function(e,t,r,o,i,c){s(o);var u=null,f=null==c||null==c.slaveOk?e.slaveOk:c.slaveOk,p=null==c||null==c.serializeFunctions?e.s.options.serializeFunctions:c.serializeFunctions,d=null==c||null==c.raw?e.s.options.raw:c.raw,h=null==c||null==c.promoteLongs?e.s.options.promoteLongs:c.promoteLongs,m=null==c||null==c.promoteValues?e.s.options.promoteValues:c.promoteValues,y=null==c||null==c.promoteBuffers?e.s.options.promoteBuffers:c.promoteBuffers,g=null,b=null,v=l("%s.%s",r,o),w=c.promiseLibrary;w||(w="function"==typeof global.Promise?global.Promise:n(6).Promise),c&&c.readPreference?g=c.readPreference:e.options.readPreference&&(g=e.options.readPreference),i=null==i?a:i,this.s={pkFactory:i,db:e,topology:t,dbName:r,options:c,namespace:v,readPreference:g,slaveOk:f,serializeFunctions:p,raw:d,promoteLongs:h,promoteValues:m,promoteBuffers:y,internalHint:u,collectionHint:b,name:o,promiseLibrary:w,readConcern:c.readConcern}},N=I.define=new k("Collection",I,!1);Object.defineProperty(I.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.name}}),Object.defineProperty(I.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace}}),Object.defineProperty(I.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern||{level:"local"}}}),Object.defineProperty(I.prototype,"writeConcern",{enumerable:!0,get:function(){var e={};return null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e}}),Object.defineProperty(I.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=y(e)}}),I.prototype.find=function(){var e,t=Array.prototype.slice.call(arguments,0),n="function"==typeof t[t.length-1],r="function"==typeof t[0],i=n?t.pop():r?t.shift():null,s=t.length,a=s>=1?t[0]:{},c=s>=2?t[1]:void 0;if(1===s&&r&&(a={},e=t[0]),2!==s||void 0===c||Array.isArray(c)){if(2===s&&Array.isArray(c)&&!Array.isArray(c[0])){var u={};for(d=0;d<c.length;d++)u[c[d]]=1;c=u}}else{for(var l=Object.keys(c),f=!1,d=0;d<l.length;d++)if(null!=ge[l[d]]){f=!0;break}f?(e=c,c=void 0):e={}}3===s&&(e=t[2]),a=null==a?{}:a;var h=a;if(Buffer.isBuffer(h)){var m=h[0]|h[1]<<8|h[2]<<16|h[3]<<24;if(m!=h.length){var b=new Error("query selector raw message size does not match message header size ["+h.length+"] != ["+m+"]");throw b.name="MongoError",b}}if(h=c,Buffer.isBuffer(h)&&(m=h[0]|h[1]<<8|h[2]<<16|h[3]<<24,m!=h.length))throw b=new Error("query fields raw message size does not match message header size ["+h.length+"] != ["+m+"]"),b.name="MongoError",b;if(null!=a&&"ObjectID"==a._bsontype&&(a={_id:a}),e&&e.fields&&!Buffer.isBuffer(e.fields))if(c={},Array.isArray(e.fields))if(e.fields.length){var w=e.fields.length;for(d=0;d<w;d++)c[e.fields[d]]=1}else c._id=1;else c=e.fields;e||(e={});var S={};for(var x in e)S[x]=e[x];if(S.skip=s>3?t[2]:e.skip?e.skip:0,S.limit=s>3?t[3]:e.limit?e.limit:0,S.raw=null!=e.raw&&"boolean"==typeof e.raw?e.raw:this.s.raw,S.hint=null!=e.hint?y(e.hint):this.s.collectionHint,S.timeout=5==s?t[4]:"undefined"==typeof e.timeout?void 0:e.timeout,S.slaveOk=null!=e.slaveOk?e.slaveOk:this.s.db.slaveOk,S=ye(this,S,this.s.db,this),null==S.readPreference||"primary"==S.readPreference&&"primary"==S.readPreference.mode||(S.slaveOk=!0),null!=a&&"object"!=typeof a)throw p.create({message:"query selector must be an object",driver:!0});var k={find:this.s.namespace,limit:S.limit,skip:S.skip,query:a};"boolean"==typeof S.awaitdata&&(S.awaitData=S.awaitdata),"boolean"==typeof S.timeout&&(S.noCursorTimeout=S.timeout);for(var _ in S)null!=S[_]&&(k[_]=S[_]);var O=function(e){var t={};if(Array.isArray(e))for(var n=0;n<e.length;n++)Array.isArray(e[n])?t[e[n][0]]=e[n][1]:t[e[n][0]]=1;else t=e;return t};return c&&(k.fields=O(c)),S.db=this.s.db,S.promiseLibrary=this.s.promiseLibrary,null==S.raw&&"boolean"==typeof this.s.raw&&(S.raw=this.s.raw),null==S.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(S.promoteLongs=this.s.promoteLongs),null==S.promoteValues&&"boolean"==typeof this.s.promoteValues&&(S.promoteValues=this.s.promoteValues),null==S.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(S.promoteBuffers=this.s.promoteBuffers),k.sort&&(k.sort=v(k.sort)),this.s.readConcern&&(k.readConcern=this.s.readConcern),o(k,this,e),"function"==typeof i?g(i,null,this.s.topology.cursor(this.s.namespace,k,S)):this.s.topology.cursor(this.s.namespace,k,S)},N.classMethod("find",{callback:!1,promise:!1,returns:[_]}),I.prototype.insertOne=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&"function"==typeof n?n(p.create({message:"doc parameter must be an object",driver:!0})):Array.isArray(e)?new this.s.promiseLibrary(function(e,t){t(p.create({message:"doc parameter must be an object",driver:!0}))}):(this.s.options.ignoreUndefined&&(t=d(t),t.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof n?A(r,e,t,n):new this.s.promiseLibrary(function(n,o){A(r,e,t,function(e,t){return e?o(e):void n(t)})}))};var A=function(e,t,n,r){B(e,[t],n,function(e,n){if(null!=r){if(e&&r)return r(e);if(null==n)return r(null,{result:{ok:1}});n.insertedCount=n.result.n,n.insertedId=t._id,r&&r(null,n)}})},M=function(e,t){for(var n=t.getInsertedIds(),r=Object.keys(n),o=new Array(r.length),i=0;i<r.length;i++)n[r[i]]._id&&(o[n[r[i]].index]=n[r[i]]._id);var s={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:o};return t.getLastOp()&&(s.result.opTime=t.getLastOp()),s};N.classMethod("insertOne",{callback:!0,promise:!0}),I.prototype.insertMany=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e)&&"function"==typeof n)return n(p.create({message:"docs parameter must be an array of documents",driver:!0}));if(!Array.isArray(e))return new this.s.promiseLibrary(function(e,t){t(p.create({message:"docs parameter must be an array of documents",driver:!0}))});"boolean"!=typeof t.checkKeys&&(t.checkKeys=!0),t.serializeFunctions=t.serializeFunctions||r.s.serializeFunctions;var o="boolean"==typeof t.forceServerObjectId?t.forceServerObjectId:r.s.db.options.forceServerObjectId;if(o!==!0)for(var i=0;i<e.length;i++)null==e[i]._id&&(e[i]._id=r.s.pkFactory.createPk());var s=[{insertMany:e}];return"function"==typeof n?T(r,s,t,function(t,r){return t?n(t,r):void n(null,M(e,r))}):new this.s.promiseLibrary(function(n,o){T(r,s,t,function(t,r){return t?o(t):void n(M(e,r))})})},N.classMethod("insertMany",{callback:!0,promise:!0}),I.prototype.bulkWrite=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw p.create({message:"operations must be an array of documents",driver:!0});return"function"==typeof n?T(r,e,t,n):new this.s.promiseLibrary(function(n,o){T(r,e,t,function(e,t){return e&&null==t?o(e):void n(t)})})};var T=function(e,t,n,r){e.s.options.ignoreUndefined&&(n=d(n),n.ignoreUndefined=e.s.options.ignoreUndefined);var o=1==n.ordered||null==n.ordered?e.initializeOrderedBulkOp(n):e.initializeUnorderedBulkOp(n),i=!1;try{for(var s=0;s<t.length;s++){var a=Object.keys(t[s])[0];t[s][a].collation&&(i=!0),o.raw(t[s])}}catch(e){return r(e,null)}var c=me(d(n),e.s.db,e,n),u=c.writeConcern?c.writeConcern:{},f=e.s.topology.capabilities();return i&&f&&!f.commandsTakeCollation?r(new p(l("server/primary/mongos does not support collation"))):void o.execute(u,function(e,t){if(!t&&e)return r(e,null);if(t&&t.hasWriteErrors()&&1==t.getWriteErrorCount())return r(m(t.getWriteErrorAt(0)),t);t.insertedCount=t.nInserted,t.matchedCount=t.nMatched,t.modifiedCount=t.nModified||0,t.deletedCount=t.nRemoved,t.upsertedCount=t.getUpsertedIds().length,t.upsertedIds={},t.insertedIds={},t.n=t.insertedCount;for(var n=t.getInsertedIds(),o=0;o<n.length;o++)t.insertedIds[n[o].index]=n[o]._id;var i=t.getUpsertedIds();for(o=0;o<i.length;o++)t.upsertedIds[i[o].index]=i[o]._id;if(t.hasWriteErrors()){var s=t.getWriteErrors();return r(m({message:"write operation failed",code:s[0].code,writeErrors:s}),t)}return t.getWriteConcernError()?r(m(t.getWriteConcernError()),t):void r(null,t)})},B=function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},t=Array.isArray(t)?t:[t];var o=me(d(n),e.s.db,e,n);"boolean"!=typeof o.checkKeys&&(o.checkKeys=!0),1==o.keepGoing&&(o.ordered=!1),o.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions;var i="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:e.s.db.options.forceServerObjectId;if(i!==!0)for(var s=0;s<t.length;s++)null==t[s]._id&&(t[s]._id=e.s.pkFactory.createPk());e.s.topology.insert(e.s.namespace,t,o,function(e,n){if(null!=r){if(e)return g(r,e);if(null==n)return g(r,null,null);if(n.result.code)return g(r,m(n.result));if(n.result.writeErrors)return g(r,m(n.result.writeErrors[0]));n.ops=t,g(r,null,n)}})};N.classMethod("bulkWrite",{callback:!0,promise:!0}),I.prototype.insert=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],1==t.keepGoing&&(t.ordered=!1),this.insertMany(e,t,n)},N.classMethod("insert",{callback:!0,promise:!0}),I.prototype.updateOne=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=d(n),this.s.options.ignoreUndefined&&(n=d(n),n.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof r?D(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){D(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var D=function(e,t,n,r,o){r.multi=!1,L(e,t,n,r,function(e,t){if(null!=o){if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,o&&o(null,t)}})};N.classMethod("updateOne",{callback:!0,promise:!0}),I.prototype.replaceOne=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=d(n),this.s.options.ignoreUndefined&&(n=d(n),n.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof r?R(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){R(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var R=function(e,t,n,r,o){r.multi=!1,L(e,t,n,r,function(e,t){if(null!=o){if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[n],o&&o(null,t)}})};N.classMethod("replaceOne",{callback:!0,promise:!0}),I.prototype.updateMany=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=d(n),this.s.options.ignoreUndefined&&(n=d(n),n.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof r?P(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){P(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var P=function(e,t,n,r,o){r.multi=!0,L(e,t,n,r,function(e,t){if(null!=o){if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,o&&o(null,t)}})};N.classMethod("updateMany",{callback:!0,promise:!0});var L=function(e,t,n,r,i){if("function"==typeof r&&(i=r,r=null),null==r&&(r={}),"function"!=typeof i&&(i=null),null==t||"object"!=typeof t)return i(m("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return i(m("document must be a valid JavaScript object"));var s=me(d(r),e.s.db,e,r);s.serializeFunctions=r.serializeFunctions||e.s.serializeFunctions;var a={q:t,u:n};a.upsert="boolean"==typeof r.upsert&&r.upsert,a.multi="boolean"==typeof r.multi&&r.multi,o(s,e,r),e.s.topology.update(e.s.namespace,[a],s,function(e,t){if(null!=i)return e?g(i,e,null):null==t?g(i,null,null):t.result.code?g(i,m(t.result)):t.result.writeErrors?g(i,m(t.result.writeErrors[0])):void g(i,null,t)})};I.prototype.update=function(e,t,n,r){var o=this;return this.s.options.ignoreUndefined&&(n=d(n),n.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof r?L(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){L(o,e,t,n,function(e,t){return e?i(e):void r(t)})})},N.classMethod("update",{callback:!0,promise:!0}),I.prototype.deleteOne=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=d(t),this.s.options.ignoreUndefined&&(t=d(t),t.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof n?j(r,e,t,n):new this.s.promiseLibrary(function(n,o){j(r,e,t,function(e,t){return e?o(e):void n(t)})})};var j=function(e,t,n,r){n.single=!0,U(e,t,n,function(e,t){if(null!=r){if(e&&r)return r(e);if(null==t)return r(null,{result:{ok:1}});t.deletedCount=t.result.n,r&&r(null,t)}})};N.classMethod("deleteOne",{callback:!0,promise:!0}),I.prototype.removeOne=I.prototype.deleteOne,N.classMethod("removeOne",{callback:!0,promise:!0}),I.prototype.deleteMany=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=d(t),this.s.options.ignoreUndefined&&(t=d(t),t.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof n?z(r,e,t,n):new this.s.promiseLibrary(function(n,o){z(r,e,t,function(e,t){return e?o(e):void n(t)})})};var z=function(e,t,n,r){n.single=!1,U(e,t,n,function(e,t){if(null!=r){if(e&&r)return r(e);if(null==t)return r(null,{result:{ok:1}});t.deletedCount=t.result.n,r&&r(null,t)}})},U=function(e,t,n,r){"function"==typeof n?(r=n,n={}):"function"==typeof t&&(r=t,n={},t={}),n=n||{};var i=me(d(n),e.s.db,e,n);null==t&&(t={});var s={q:t,limit:0};n.single&&(s.limit=1),o(i,e,n),e.s.topology.remove(e.s.namespace,[s],i,function(e,t){if(null!=r)return e?g(r,e,null):null==t?g(r,null,null):t.result.code?g(r,m(t.result)):t.result.writeErrors?g(r,m(t.result.writeErrors[0])):void g(r,null,t)})};N.classMethod("deleteMany",{callback:!0,promise:!0}),I.prototype.removeMany=I.prototype.deleteMany,N.classMethod("removeMany",{callback:!0,promise:!0}),I.prototype.remove=function(e,t,n){var r=this;return this.s.options.ignoreUndefined&&(t=d(t),t.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof n?U(r,e,t,n):new this.s.promiseLibrary(function(n,o){U(r,e,t,function(e,t){return e?o(e):void n(t)})})},N.classMethod("remove",{callback:!0,promise:!0}),I.prototype.save=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&(t=d(t),t.ignoreUndefined=this.s.options.ignoreUndefined),"function"==typeof n?q(r,e,t,n):new this.s.promiseLibrary(function(n,o){q(r,e,t,function(e,t){return e?o(e):void n(t)})})};var q=function(e,t,n,r){var o=me(d(n),e.s.db,e,n);return null!=t._id?(o.upsert=!0,L(e,{_id:t._id},t,o,r)):void B(e,[t],n,function(e,n){if(null!=r)return null==t?g(r,null,null):e?g(r,e,null):void g(r,null,n)})};N.classMethod("save",{callback:!0,promise:!0}),I.prototype.findOne=function(){var e=this,t=Array.prototype.slice.call(arguments,0),n=t.pop();return"function"!=typeof n&&t.push(n),"function"==typeof n?F(e,t,n):new this.s.promiseLibrary(function(n,r){F(e,t,function(e,t){return e?r(e):void n(t)})})};var F=function(e,t,n){var r=e.find.apply(e,t).limit(-1).batchSize(1);r.next(function(e,t){return null!=e?g(n,m(e),null):void g(n,null,t)})};N.classMethod("findOne",{callback:!0,promise:!0}),I.prototype.rename=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=E({},t,{readPreference:w.PRIMARY}),"function"==typeof n?W(r,e,t,n):new this.s.promiseLibrary(function(n,o){W(r,e,t,function(e,t){return e?o(e):void n(t)})})};var W=function(e,t,n,o){s(t);var i=l("%s.%s",e.s.dbName,e.s.name),a=l("%s.%s",e.s.dbName,t),c="boolean"==typeof n.dropTarget&&n.dropTarget,u={renameCollection:i,to:a,dropTarget:c};r(u,e,n),e.s.db.admin().command(u,n,function(n,r){if(n)return g(o,n,null);if(r.errmsg)return g(o,m(r),null);try{return g(o,null,new I(e.s.db,e.s.topology,e.s.dbName,t,e.s.pkFactory,e.s.options))}catch(e){return g(o,m(e),null)}})};N.classMethod("rename",{callback:!0,promise:!0}),I.prototype.drop=function(e,t){var n=this;return"function"==typeof e&&(t=e,e={}),e=e||{},"function"==typeof t?n.s.db.dropCollection(n.s.name,e,t):new this.s.promiseLibrary(function(t,r){n.s.db.dropCollection(n.s.name,e,function(e,n){return e?r(e):void t(n)})})},N.classMethod("drop",{callback:!0,promise:!0}),I.prototype.options=function(e){var t=this;return"function"==typeof e?V(t,e):new this.s.promiseLibrary(function(e,n){V(t,function(t,r){return t?n(t):void e(r)})})};var V=function(e,t){e.s.db.listCollections({name:e.s.name}).toArray(function(n,r){return n?g(t,n):0==r.length?g(t,p.create({message:l("collection %s not found",e.s.namespace),driver:!0})):void g(t,n,r[0].options||null)})};N.classMethod("options",{callback:!0,promise:!0}),I.prototype.isCapped=function(e){var t=this;return"function"==typeof e?H(t,e):new this.s.promiseLibrary(function(e,n){H(t,function(t,r){return t?n(t):void e(r)})})};var H=function(e,t){e.options(function(e,n){return e?g(t,e):void g(t,null,n&&n.capped)})};N.classMethod("isCapped",{callback:!0,promise:!0}),I.prototype.createIndex=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift()||{}:{},t="function"==typeof n?t:n,t=null==t?{}:t,"function"==typeof n?G(r,e,t,n):new this.s.promiseLibrary(function(n,o){G(r,e,t,function(e,t){return e?o(e):void n(t)})})};var G=function(e,t,n,r){e.s.db.createIndex(e.s.name,t,n,r)};N.classMethod("createIndex",{callback:!0,promise:!0}),I.prototype.createIndexes=function(e,t){var n=this;return"function"==typeof t?K(n,e,t):new this.s.promiseLibrary(function(t,r){K(n,e,function(e,n){return e?r(e):void t(n)})})};var K=function(e,t,n){for(var r=e.s.topology.capabilities(),o=0;o<t.length;o++)if(null==t[o].name){var i=[];if(t[o].collation&&r&&!r.commandsTakeCollation)return n(new p(l("server/primary/mongos does not support collation")));for(var s in t[o].key)i.push(l("%s_%s",s,t[o].key[s]));t[o].name=i.join("_")}e.s.db.command({createIndexes:e.s.name,indexes:t},{readPreference:w.PRIMARY},n)};N.classMethod("createIndexes",{callback:!0,promise:!0}),I.prototype.dropIndex=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift()||{}:{},t.readPreference=w.PRIMARY,"function"==typeof n?Y(r,e,t,n):new this.s.promiseLibrary(function(n,o){Y(r,e,t,function(e,t){return e?o(e):void n(t)})})};var Y=function(e,t,n,o){var i={dropIndexes:e.s.name,index:t};r(i,e,n),e.s.db.command(i,n,function(e,t){if("function"==typeof o)return e?g(o,e,null):void g(o,null,t)})};N.classMethod("dropIndex",{callback:!0,promise:!0}),I.prototype.dropIndexes=function(e,t){var n=this;return"function"==typeof e&&(t=e,e={}),e=e||{},"function"==typeof t?Z(n,e,t):new this.s.promiseLibrary(function(e,t){Z(n,function(n,r){return n?t(n):void e(r)})})};var Z=function(e,t,n){e.dropIndex("*",t,function(e){return e?g(n,e,!1):void g(n,null,!0)})};N.classMethod("dropIndexes",{callback:!0,promise:!0}),I.prototype.dropAllIndexes=I.prototype.dropIndexes,N.classMethod("dropAllIndexes",{callback:!0,promise:!0}),I.prototype.reIndex=function(e,t){var n=this;return"function"==typeof e&&(t=e,e={}),e=e||{},"function"==typeof t?J(n,e,t):new this.s.promiseLibrary(function(t,r){J(n,e,function(e,n){return e?r(e):void t(n)})})};var J=function(e,t,n){var o={reIndex:e.s.name};r(o,e,t),e.s.db.command(o,t,function(e,t){if(null!=n)return e?g(n,e,null):void g(n,null,!!t.ok)})};N.classMethod("reIndex",{callback:!0,promise:!0}),I.prototype.listIndexes=function(e){if(e=e||{},e=d(e),e=ye(this,e,this.s.db,this),e.cursorFactory=x,e.promiseLibrary=this.s.promiseLibrary,!this.s.topology.capabilities())throw new p("cannot connect to server");if(this.s.topology.capabilities().hasListIndexesCommand){var t=e.batchSize?{batchSize:e.batchSize}:{},n={listIndexes:this.s.name,cursor:t};return t=this.s.topology.cursor(l("%s.$cmd",this.s.dbName),n,e),e.readPreference&&t.setReadPreference(e.readPreference),t}var r=l("%s.system.indexes",this.s.dbName);return t=this.s.topology.cursor(r,{find:r,query:{ns:this.s.namespace}},e),e.readPreference&&t.setReadPreference(e.readPreference),e.batchSize&&(t=t.batchSize(e.batchSize)),t},N.classMethod("listIndexes",{callback:!1,promise:!1,returns:[x]}),I.prototype.ensureIndex=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof n?X(r,e,t,n):new this.s.promiseLibrary(function(n,o){
X(r,e,t,function(e,t){return e?o(e):void n(t)})})};var X=function(e,t,n,r){e.s.db.ensureIndex(e.s.name,t,n,r)};N.classMethod("ensureIndex",{callback:!0,promise:!0}),I.prototype.indexExists=function(e,t){var n=this;return"function"==typeof t?Q(n,e,t):new this.s.promiseLibrary(function(t,r){Q(n,e,function(e,n){return e?r(e):void t(n)})})};var Q=function(e,t,n){e.indexInformation(function(e,r){if(null!=e)return g(n,e,null);if(!Array.isArray(t))return g(n,null,null!=r[t]);for(var o=0;o<t.length;o++)if(null==r[t[o]])return g(n,null,!1);return g(n,null,!0)})};N.classMethod("indexExists",{callback:!0,promise:!0}),I.prototype.indexInformation=function(e,t){var n=this,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),"function"!=typeof t&&r.push(t),e=r.length?r.shift()||{}:{},"function"==typeof t?$(n,e,t):new this.s.promiseLibrary(function(t,r){$(n,e,function(e,n){return e?r(e):void t(n)})})};var $=function(e,t,n){e.s.db.indexInformation(e.s.name,t,n)};N.classMethod("indexInformation",{callback:!0,promise:!0}),I.prototype.count=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);n=o.pop(),"function"!=typeof n&&o.push(n);var i=o.length?o.shift()||{}:{},s=o.length?o.shift()||{}:{};return"function"==typeof n?ee(r,i,s,n):(e=e||{},t=t||{},new this.s.promiseLibrary(function(n,o){ee(r,e,t,function(e,t){return e?o(e):void n(t)})}))};var ee=function(e,t,n,r){var i=n.skip,s=n.limit,a=n.hint,c=n.maxTimeMS,u={count:e.s.name,query:t};"number"==typeof i&&(u.skip=i),"number"==typeof s&&(u.limit=s),"number"==typeof c&&(u.maxTimeMS=c),a&&(n.hint=a),n=d(n),n=ye(e,n,e.s.db,e),e.s.readConcern&&(u.readConcern=e.s.readConcern),o(u,e,n),e.s.db.command(u,n,function(e,t){return e?g(r,e):void g(r,null,t.n)})};N.classMethod("count",{callback:!0,promise:!0}),I.prototype.distinct=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,1);r=i.pop(),"function"!=typeof r&&i.push(r);var s=i.length?i.shift()||{}:{},a=i.length?i.shift()||{}:{};return"function"==typeof r?te(o,e,s,a,r):(t=t||{},n=n||{},new this.s.promiseLibrary(function(r,i){te(o,e,t,n,function(e,t){return e?i(e):void r(t)})}))};var te=function(e,t,n,r,i){var s=r.maxTimeMS,a={distinct:e.s.name,key:t,query:n};r=d(r),r=ye(e,r,e.s.db,e),"number"==typeof s&&(a.maxTimeMS=s),e.s.readConcern&&(a.readConcern=e.s.readConcern),o(a,e,r),e.s.db.command(a,r,function(e,t){return e?g(i,e):void g(i,null,t.values)})};N.classMethod("distinct",{callback:!0,promise:!0}),I.prototype.indexes=function(e){var t=this;return"function"==typeof e?ne(t,e):new this.s.promiseLibrary(function(e,n){ne(t,function(t,r){return t?n(t):void e(r)})})};var ne=function(e,t){e.s.db.indexInformation(e.s.name,{full:!0},t)};N.classMethod("indexes",{callback:!0,promise:!0}),I.prototype.stats=function(e,t){var n=this,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),"function"!=typeof t&&r.push(t),e=r.length?r.shift()||{}:{},"function"==typeof t?re(n,e,t):new this.s.promiseLibrary(function(t,r){re(n,e,function(e,n){return e?r(e):void t(n)})})};var re=function(e,t,n){var r={collStats:e.s.name};null!=t.scale&&(r.scale=t.scale),t=d(t),t=ye(e,t,e.s.db,e),e.s.db.command(r,t,n)};N.classMethod("stats",{callback:!0,promise:!0}),I.prototype.findOneAndDelete=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={}),t=t||{},null==e||"object"!=typeof e)throw m("filter parameter must be an object");return"function"==typeof n?oe(r,e,t,n):new this.s.promiseLibrary(function(n,o){t=t||{},oe(r,e,t,function(e,t){return e?o(e):void n(t)})})};var oe=function(e,t,n,r){var o=d(n);o.fields=n.projection,o.remove=!0,e.findAndModify(t,n.sort,null,o,r)};N.classMethod("findOneAndDelete",{callback:!0,promise:!0}),I.prototype.findOneAndReplace=function(e,t,n,r){var o=this;if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw m("filter parameter must be an object");if(null==t||"object"!=typeof t)throw m("replacement parameter must be an object");return"function"==typeof r?ie(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){n=n||{},ie(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var ie=function(e,t,n,r,o){var i=d(r);i.fields=r.projection,i.update=!0,i.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,i.upsert="boolean"==typeof r.upsert&&r.upsert,e.findAndModify(t,r.sort,n,i,o)};N.classMethod("findOneAndReplace",{callback:!0,promise:!0}),I.prototype.findOneAndUpdate=function(e,t,n,r){var o=this;if("function"==typeof n&&(r=n,n={}),n=n||{},null==e||"object"!=typeof e)throw m("filter parameter must be an object");if(null==t||"object"!=typeof t)throw m("update parameter must be an object");return"function"==typeof r?se(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){n=n||{},se(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var se=function(e,t,n,r,o){var i=d(r);i.fields=r.projection,i.update=!0,i.new="boolean"==typeof r.returnOriginal&&!r.returnOriginal,i.upsert="boolean"==typeof r.upsert&&r.upsert,e.findAndModify(t,r.sort,n,i,o)};N.classMethod("findOneAndUpdate",{callback:!0,promise:!0}),I.prototype.findAndModify=function(e,t,n,r,o){var i=this,s=Array.prototype.slice.call(arguments,1);return o=s.pop(),"function"!=typeof o&&s.push(o),t=s.length?s.shift()||[]:[],n=s.length?s.shift():null,r=s.length?s.shift()||{}:{},r=d(r),r.readPreference=w.PRIMARY,"function"==typeof o?ae(i,e,t,n,r,o):new this.s.promiseLibrary(function(o,s){r=r||{},ae(i,e,t,n,r,function(e,t){return e?s(e):void o(t)})})};var ae=function(e,t,n,r,i,s){var a={findandmodify:e.s.name,query:t};n=v(n),n&&(a.sort=n),a.new=!!i.new,a.remove=!!i.remove,a.upsert=!!i.upsert,i.fields&&(a.fields=i.fields),r&&!i.remove&&(a.update=r),i.maxTimeMS&&(a.maxTimeMS=i.maxTimeMS),null!=i.serializeFunctions?i.serializeFunctions=i.serializeFunctions:i.serializeFunctions=e.s.serializeFunctions,i.checkKeys=!1;var c=me(i,e.s.db,e,i);c.writeConcern&&(a.writeConcern=c.writeConcern),"boolean"==typeof c.bypassDocumentValidation&&(a.bypassDocumentValidation=c.bypassDocumentValidation),o(a,e,i),e.s.db.command(a,i,function(e,t){return e?g(s,e,null):g(s,null,t)})};N.classMethod("findAndModify",{callback:!0,promise:!0}),I.prototype.findAndRemove=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,1);return r=i.pop(),"function"!=typeof r&&i.push(r),t=i.length?i.shift()||[]:[],n=i.length?i.shift()||{}:{},"function"==typeof r?ce(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){ce(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var ce=function(e,t,n,r,o){r.remove=!0,e.findAndModify(t,n,null,r,o)};N.classMethod("findAndRemove",{callback:!0,promise:!0}),I.prototype.aggregate=function(e,t,n){var i=this;if(Array.isArray(e))"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});else{var s=Array.prototype.slice.call(arguments,0);n=s.pop();var a=s[s.length-1];t=a&&(a.readPreference||a.explain||a.cursor||a.out||a.maxTimeMS||a.allowDiskUse)?s.pop():{},e=s}var c=!1,u={aggregate:this.s.name,pipeline:e};if("string"==typeof t.out?(e.push({$out:t.out}),c=!0):e.length>0&&e[e.length-1].$out&&(c=!0),e.length>0&&e[e.length-1].$out&&r(u,i,t),o(u,i,t),"boolean"==typeof t.bypassDocumentValidation&&(u.bypassDocumentValidation=t.bypassDocumentValidation),!c&&this.s.readConcern&&(u.readConcern=this.s.readConcern),t.allowDiskUse&&(u.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(u.maxTimeMS=t.maxTimeMS),t=d(t),t=ye(this,t,this.s.db,this),t.explain&&(u.explain=t.explain),null!=t.cursor&&"object"!=typeof t.cursor)throw m("cursor options must be an object");if(t.promiseLibrary=this.s.promiseLibrary,t.cursorFactory=f,"function"!=typeof n){if(!this.s.topology.capabilities())throw new p("cannot connect to server");return this.s.topology.capabilities().hasAggregationCursor&&(t.cursor=t.cursor||{batchSize:1e3},u.cursor=t.cursor),"boolean"==typeof t.allowDiskUse&&(u.allowDiskUse=t.allowDiskUse),"number"==typeof t.maxTimeMS&&(u.maxTimeMS=t.maxTimeMS),this.s.topology.cursor(this.s.namespace,u,t)}return t.cursor?this.s.topology.cursor(this.s.namespace,u,t):void this.s.db.command(u,t,function(e,t){e?g(n,e):t.err||t.errmsg?g(n,m(t)):"object"==typeof t&&t.serverPipeline?g(n,null,t.serverPipeline):"object"==typeof t&&t.stages?g(n,null,t.stages):g(n,null,t.result)})},N.classMethod("aggregate",{callback:!0,promise:!1}),I.prototype.parallelCollectionScan=function(e,t){var n=this;return"function"==typeof e&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,e=d(e),e=ye(this,e,this.s.db,this),e.promiseLibrary=this.s.promiseLibrary,"function"==typeof t?ue(n,e,t):new this.s.promiseLibrary(function(t,r){ue(n,e,function(e,n){return e?r(e):void t(n)})})};var ue=function(e,t,n){var r={parallelCollectionScan:e.s.name,numCursors:t.numCursors};e.s.readConcern&&(r.readConcern=e.s.readConcern);var o=t.raw;delete t.raw,e.s.db.command(r,t,function(r,i){if(r)return g(n,r,null);if(null==i)return g(n,new Error("no result returned for parallelCollectionScan"),null);var s=[];o&&(t.raw=o);for(var a=0;a<i.cursors.length;a++){var u=i.cursors[a].cursor.id,l="number"==typeof u?c.fromNumber(u):u;s.push(e.s.topology.cursor(e.s.namespace,l,t))}g(n,null,s)})};N.classMethod("parallelCollectionScan",{callback:!0,promise:!0}),I.prototype.geoNear=function(e,t,n,r){var o=this,i="object"==typeof e&&e,s=Array.prototype.slice.call(arguments,i?1:2);return r=s.pop(),"function"!=typeof r&&s.push(r),n=s.length?s.shift()||{}:{},"function"==typeof r?le(o,e,t,i,n,r):new this.s.promiseLibrary(function(r,s){le(o,e,t,i,n,function(e,t){return e?s(e):void r(t)})})};var le=function(e,t,n,r,i,s){var a={geoNear:e.s.name,near:r||[t,n]};i=d(i),i=ye(e,i,e.s.db,e);var c={readPreference:!0,geoNear:!0,near:!0};a=b(a,i,c),e.s.readConcern&&(a.readConcern=e.s.readConcern),o(a,e,i),e.s.db.command(a,i,function(e,t){return e?g(s,e):t.err||t.errmsg?g(s,m(t)):void g(s,null,t)})};N.classMethod("geoNear",{callback:!0,promise:!0}),I.prototype.geoHaystackSearch=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,2);return r=i.pop(),"function"!=typeof r&&i.push(r),n=i.length?i.shift()||{}:{},"function"==typeof r?fe(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){fe(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var fe=function(e,t,n,r,o){var i={geoSearch:e.s.name,near:[t,n]};i=b(i,r,{readPreference:!0}),r=d(r),r=ye(e,r,e.s.db,e),e.s.readConcern&&(i.readConcern=e.s.readConcern),e.s.db.command(i,r,function(e,t){return e?g(o,e):((t.err||t.errmsg)&&g(o,m(t)),void g(o,null,t))})};N.classMethod("geoHaystackSearch",{callback:!0,promise:!0});var pe='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';I.prototype.group=function(e,t,n,r,o,i,s,a){var c=this,u=Array.prototype.slice.call(arguments,3);return a=u.pop(),"function"!=typeof a&&u.push(a),r=u.length?u.shift():null,o=u.length?u.shift():null,i=u.length?u.shift():null,s=u.length?u.shift()||{}:{},"function"!=typeof o&&(i=o,o=null),!Array.isArray(e)&&e instanceof Object&&"function"!=typeof e&&"Code"!=e._bsontype&&(e=Object.keys(e)),"function"==typeof r&&(r=r.toString()),"function"==typeof o&&(o=o.toString()),i=null==i||i,"function"==typeof a?de(c,e,t,n,r,o,i,s,a):new this.s.promiseLibrary(function(a,u){de(c,e,t,n,r,o,i,s,function(e,t){return e?u(e):void a(t)})})};var de=function(e,t,n,r,i,s,a,c,l){if(a){var f=i&&"Code"==i._bsontype?i:new u(i),p={group:{ns:e.s.name,$reduce:f,cond:n,initial:r,out:"inline"}};if(null!=s&&(p.group.finalize=s),"function"==typeof t||t&&"Code"==t._bsontype)p.group.$keyf=t&&"Code"==t._bsontype?t:new u(t);else{var h={};t.forEach(function(e){h[e]=1}),p.group.key=h}c=d(c),c=ye(e,c,e.s.db,e),e.s.readConcern&&(p.readConcern=e.s.readConcern),o(p,e,c),e.s.db.command(p,c,function(e,t){return e?g(l,e,null):void g(l,null,t.retval)})}else{var m=null!=i&&"Code"==i._bsontype?i.scope:{};m.ns=e.s.name,m.keys=t,m.condition=n,m.initial=r;var y=pe.replace(/ reduce;/,i.toString()+";");e.s.db.eval(new u(y,m),function(e,t){return e?g(l,e,null):void g(l,null,t.result||t)})}};N.classMethod("group",{callback:!0,promise:!0}),I.prototype.mapReduce=function(e,t,n,r){var o=this;if("function"==typeof n&&(r=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");return"function"==typeof e&&(e=e.toString()),"function"==typeof t&&(t=t.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString()),"function"==typeof r?he(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){he(o,e,t,n,function(e,t,n){return e?i(e):n?void r({results:t,stats:n}):r(t)})})};var he=function(e,t,n,s,a){var c={mapreduce:e.s.name,map:t,reduce:n};for(var u in s)"scope"==u?c[u]=i(s[u]):c[u]=s[u];s=d(s),s=ye(e,s,e.s.db,e),0!=s.readPreference&&"primary"!=s.readPreference&&s.out&&1!=s.out.inline&&"inline"!=s.out?(s.readPreference="primary",r(c,e,s)):e.s.readConcern&&(c.readConcern=e.s.readConcern),"boolean"==typeof s.bypassDocumentValidation&&(c.bypassDocumentValidation=s.bypassDocumentValidation),o(c,e,s),e.s.db.command(c,{readPreference:s.readPreference},function(t,n){if(t)return g(a,t);if(1!=n.ok||n.err||n.errmsg)return g(a,m(n));var r={};if(n.timeMillis&&(r.processtime=n.timeMillis),n.counts&&(r.counts=n.counts),n.timing&&(r.timing=n.timing),n.results)return null!=s.verbose&&s.verbose?g(a,null,n.results,r):g(a,null,n.results);var o=null;if(null!=n.result&&"object"==typeof n.result){var i=n.result;o=e.s.db.db(i.db).collection(i.collection)}else o=e.s.db.collection(n.result);return null!=s.verbose&&s.verbose?void g(a,t,o,r):g(a,t,o)})};N.classMethod("mapReduce",{callback:!0,promise:!0}),I.prototype.initializeUnorderedBulkOp=function(e){return e=e||{},e.promiseLibrary=this.s.promiseLibrary,O(this.s.topology,this,e)},N.classMethod("initializeUnorderedBulkOp",{callback:!1,promise:!1,returns:[C.UnorderedBulkOperation]}),I.prototype.initializeOrderedBulkOp=function(e){return e=e||{},e.promiseLibrary=this.s.promiseLibrary,C(this.s.topology,this,e)},N.classMethod("initializeOrderedBulkOp",{callback:!1,promise:!1,returns:[C.OrderedBulkOperation]});var me=function(e,t,n,r){if(null!=r.w||null!=r.j||null!=r.fsync){var o={};null!=r.w&&(o.w=r.w),null!=r.wtimeout&&(o.wtimeout=r.wtimeout),null!=r.j&&(o.j=r.j),null!=r.fsync&&(o.fsync=r.fsync),e.writeConcern=o}else null!=n.writeConcern.w||null!=n.writeConcern.j||null!=n.writeConcern.fsync?e.writeConcern=n.writeConcern:null==t.writeConcern.w&&null==t.writeConcern.j&&null==t.writeConcern.fsync||(e.writeConcern=t.writeConcern);return e},ye=function(e,t,n){var r=null;if(t.readPreference?r=t.readPreference:e.s.readPreference?r=e.s.readPreference:n.s.readPreference&&(r=n.s.readPreference),r instanceof w)t.readPreference=new S(r.mode,r.tags,{maxStalenessSeconds:r.maxStalenessSeconds});else if("string"==typeof r)t.readPreference=new S(r);else if(r&&!(r instanceof w)&&"object"==typeof r){var o=r.mode||r.preference;o&&"string"==typeof o&&(t.readPreference=new S(o,r.tags,{maxStalenessSeconds:r.maxStalenessSeconds}))}return t},ge={limit:1,sort:1,fields:1,skip:1,hint:1,explain:1,snapshot:1,timeout:1,tailable:1,tailableRetryInterval:1,numberOfRetries:1,awaitdata:1,awaitData:1,exhaust:1,batchSize:1,returnKey:1,maxScan:1,min:1,max:1,showDiskLoc:1,comment:1,raw:1,readPreference:1,partial:1,read:1,dbName:1,oplogReplay:1,connection:1,maxTimeMS:1,transforms:1,collation:1};e.exports=I},function(e,t,n){"use strict";var r=n(9).EventEmitter,o=n(1).inherits,i=n(3).Server,s=n(13),a=n(26),c=n(19),u=n(1).format,l=n(27).ServerCapabilities,f=n(27).Store,p=n(8),d=n(3).MongoError,h=n(2).MAX_JS_INT,m=n(2).translateOptions,y=n(2).filterOptions,g=n(2).mergeOptions,b=n(64),v=n(77).version,w=u("Node.js %s, %s",process.version,b.endianness()),S=b.type(),x=process.platform,k=process.arch,_=b.release(),O=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers"],C=function(e,t,n){if(n=n||{},!(this instanceof C))return new C(e,t,n);r.call(this);var o=this;n=y(n,O);var a={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:h},c=n.store||new f(o,a);if(e.indexOf("/")!=-1)null!=t&&"object"==typeof t&&(n=t,t=null);else if(null==t)throw d.create({message:"port must be specified",driver:!0});var u="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;u="boolean"==typeof n.autoReconnect?n.autoReconnect:u;var l=g({},{host:e,port:t,disconnectHandler:c,cursorFactory:s,reconnect:u,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5});l=m(l,n);var p=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;l=m(l,p),"number"==typeof l.keepAlive&&(l.keepAliveInitialDelay=l.keepAlive,l.keepAlive=l.keepAlive>0),this.clientInfo={driver:{name:"nodejs",version:v},os:{type:S,name:x,architecture:k,version:_},platform:w},l.clientInfo=this.clientInfo,n.appname&&(l.clientInfo.application={name:n.appname});var b=new i(l);this.s={server:b,sCapabilities:null,clonedOptions:l,reconnect:l.reconnect,emitError:l.emitError,poolSize:l.size,storeOptions:a,store:c,host:e,port:t,options:n}};o(C,r);var E=C.define=new p("Server",C,!1);Object.defineProperty(C.prototype,"bson",{enumerable:!0,get:function(){return this.s.server.s.bson}}),Object.defineProperty(C.prototype,"isMasterDoc",{enumerable:!0,get:function(){return this.s.server.lastIsMaster()}}),Object.defineProperty(C.prototype,"parserType",{enumerable:!0,get:function(){return this.s.server.parserType}}),Object.defineProperty(C.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.server.connections().length}}),Object.defineProperty(C.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(C.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(C.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),C.prototype.connect=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),null==t&&(t={}),"function"!=typeof n&&(n=null),r.s.options=t,r.s.storeOptions.bufferMaxEntries=e.bufferMaxEntries;var o=function(){return function(e){var t=["timeout","error","close"];t.forEach(function(e){r.s.server.removeListener(e,l[e])}),r.s.server.removeListener("connect",o);try{n(e)}catch(e){process.nextTick(function(){throw e})}}},i=function(e){return function(t){"error"!=e&&r.emit(e,t)}},s=function(){r.emit("reconnect",r),r.s.store.execute()},a=function(e){r.emit("reconnectFailed",e),r.s.store.flush(e)},c=function(){r.s.store.flush()},u=function(){["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged"].forEach(function(e){r.s.server.removeAllListeners(e)}),r.s.server.on("timeout",i("timeout")),r.s.server.once("error",i("error")),r.s.server.on("close",i("close")),r.s.server.on("destroy",c);var e=function(e){return function(t,n){r.emit(e,t,n)}};r.s.server.on("serverDescriptionChanged",e("serverDescriptionChanged")),r.s.server.on("serverHeartbeatStarted",e("serverHeartbeatStarted")),r.s.server.on("serverHeartbeatSucceeded",e("serverHeartbeatSucceeded")),r.s.server.on("serverHeartbeatFailed",e("serverHeartbeatFailed")),r.s.server.on("serverOpening",e("serverOpening")),r.s.server.on("serverClosed",e("serverClosed")),r.s.server.on("topologyOpening",e("topologyOpening")),r.s.server.on("topologyClosed",e("topologyClosed")),r.s.server.on("topologyDescriptionChanged",e("topologyDescriptionChanged")),r.s.server.on("attemptReconnect",e("attemptReconnect")),r.s.server.on("monitoring",e("monitoring")),r.emit("open",null,r);try{n(null,r)}catch(e){console.log(e.stack),process.nextTick(function(){throw e})}},l={timeout:o("timeout"),error:o("error"),close:o("close")};r.s.server.once("timeout",l.timeout),r.s.server.once("error",l.error),r.s.server.once("close",l.close),r.s.server.once("connect",u),r.s.server.on("reconnect",s),r.s.server.on("reconnectFailed",a),r.s.server.connect(t)},C.prototype.capabilities=function(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.server.lastIsMaster()?null:(this.s.sCapabilities=new l(this.s.server.lastIsMaster()),this.s.sCapabilities)},E.classMethod("capabilities",{callback:!1,promise:!1,returns:[l]}),C.prototype.command=function(e,t,n,r){this.s.server.command(e,t,n,r)},E.classMethod("command",{callback:!0,promise:!1}),C.prototype.insert=function(e,t,n,r){this.s.server.insert(e,t,n,r)},E.classMethod("insert",{callback:!0,promise:!1}),C.prototype.update=function(e,t,n,r){this.s.server.update(e,t,n,r)},E.classMethod("update",{callback:!0,promise:!1}),C.prototype.remove=function(e,t,n,r){this.s.server.remove(e,t,n,r)},E.classMethod("remove",{callback:!0,promise:!1}),C.prototype.isConnected=function(){return this.s.server.isConnected()},C.prototype.isDestroyed=function(){return this.s.server.isDestroyed()},E.classMethod("isConnected",{callback:!1,promise:!1,returns:[Boolean]}),C.prototype.cursor=function(e,t,n){return n.disconnectHandler=this.s.store,this.s.server.cursor(e,t,n)},E.classMethod("cursor",{callback:!1,promise:!1,returns:[s,a,c]}),C.prototype.lastIsMaster=function(){return this.s.server.lastIsMaster()},C.prototype.unref=function(){this.s.server.unref()},C.prototype.close=function(e){this.s.server.destroy(),1==e&&(this.s.storeOptions.force=e,this.s.store.flush())},E.classMethod("close",{callback:!1,promise:!1}),C.prototype.auth=function(){var e=Array.prototype.slice.call(arguments,0);this.s.server.auth.apply(this.s.server,e)},E.classMethod("auth",{callback:!0,promise:!1}),C.prototype.logout=function(){var e=Array.prototype.slice.call(arguments,0);this.s.server.logout.apply(this.s.server,e)},E.classMethod("logout",{callback:!0,promise:!1}),C.prototype.connections=function(){return this.s.server.connections()},E.classMethod("connections",{callback:!1,promise:!1,returns:[Array]}),e.exports=C},function(e,t,n){t=e.exports=n(115),t.Readable=t,t.Writable=n(117),t.Duplex=n(85),t.Transform=n(116),t.PassThrough=n(197)},function(e,t){e.exports=require("auth0-extension-express-tools@1.0.1")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";var r=n(214);r.emitErrs=!0;var o=new r.Logger({transports:[new r.transports.Console({timestamp:!0,level:"debug",handleExceptions:!0,json:!1,colorize:!0})],exitOnError:!1});e.exports=o,e.exports.stream={write:function(e){o.info(e.replace(/\n$/,""))}}},function(e,t,n){var r=n(141),o=n(29),i=n(30),s=n(31),a=n(32),c=n(33),u=n(47),l=n(23),f=n(67),p=n(34),d=n(35),h=n(36),m=n(37),y=n(38),g=n(39);r.BSON_INT32_MAX=2147483647,r.BSON_INT32_MIN=-2147483648,r.BSON_INT64_MAX=Math.pow(2,63)-1,r.BSON_INT64_MIN=-Math.pow(2,63),r.JS_INT_MAX=9007199254740992,r.JS_INT_MIN=-9007199254740992,r.Binary=o,r.Code=i,r.DBRef=s,r.Decimal128=a,r.Double=c,r.Int32=u,r.Long=l,r.Map=f,r.MaxKey=p,r.MinKey=d,r.ObjectId=h,r.ObjectID=h,r.BSONRegExp=m,r.Symbol=y,r.Timestamp=g,e.exports=r},function(e,t){"use strict";if("undefined"!=typeof global.Map)e.exports=global.Map,e.exports.Map=global.Map;else{var n=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],o=n[1];this._keys.push(r),this._values[r]={v:o,i:this._keys.length-1}}};n.prototype.clear=function(){this._keys=[],this._values={}},n.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},n.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},n.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},n.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},n.prototype.has=function(e){return null!=this._values[e]},n.prototype.keys=function(e){var t=this,n=0;return{next:function(){var e=t._keys[n++];return{value:void 0!==e?e:void 0,done:void 0===e}}}},n.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},n.prototype.values=function(e,t){var n=this,r=0;return{next:function(){var e=n._keys[r++];return{value:void 0!==e?n._values[e].v:void 0,done:void 0===e}}}},Object.defineProperty(n.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=n,e.exports.Map=n}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(51),o=n(11).document,i=r(o)&&r(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,n){var r=n(11),o=n(18),i=n(49),s=n(25),a="prototype",c=function(e,t,n){var u,l,f,p=e&c.F,d=e&c.G,h=e&c.S,m=e&c.P,y=e&c.B,g=e&c.W,b=d?o:o[t]||(o[t]={}),v=b[a],w=d?r:h?r[t]:(r[t]||{})[a];d&&(n=t);for(u in n)l=!p&&w&&void 0!==w[u],l&&u in b||(f=l?w[u]:n[u],b[u]=d&&"function"!=typeof w[u]?n[u]:y&&l?i(f,r):g&&w[u]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(f):m&&"function"==typeof f?i(Function.call,f):f,m&&((b.virtual||(b.virtual={}))[u]=f,e&c.R&&v&&!v[u]&&s(v,u,f)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(52).f,o=n(50),i=n(10)("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},function(e,t,n){var r=n(99)("keys"),o=n(103);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(94),o=n(69);e.exports=function(e){return r(o(e))}},function(e,t){e.exports={_args:[[{raw:"mongodb",scope:null,escapedName:"mongodb",name:"mongodb",rawSpec:"",spec:"latest",type:"tag"},"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/server/views"]],_from:"mongodb@latest",_id:"mongodb@2.2.16",_inCache:!0,_location:"/mongodb",_nodeVersion:"6.9.1",_npmOperationalInternal:{host:"packages-18-east.internal.npmjs.com",tmp:"tmp/mongodb-2.2.16.tgz_1481656381868_0.36485050874762237"},_npmUser:{name:"christkv",email:"christkv@gmail.com"},_npmVersion:"3.10.8",_phantomChildren:{"buffer-shims":"1.0.0","core-util-is":"1.0.2",inherits:"2.0.3","process-nextick-args":"1.0.7",string_decoder:"0.10.31","util-deprecate":"1.0.2"},_requested:{raw:"mongodb",scope:null,escapedName:"mongodb",name:"mongodb",rawSpec:"",spec:"latest",type:"tag"},_requiredBy:["#USER","/"],_resolved:"https://registry.npmjs.org/mongodb/-/mongodb-2.2.16.tgz",_shasum:"e32ba91cf9e29f371fb38ba0c4a71c3b1f5fae77",_shrinkwrap:null,_spec:"mongodb",_where:"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/server/views",author:{name:"Christian Kvalheim"},bugs:{url:"https://github.com/mongodb/node-mongodb-native/issues"},dependencies:{"es6-promise":"3.2.1","mongodb-core":"2.1.2","readable-stream":"2.1.5"},description:"The official MongoDB driver for Node.js",devDependencies:{JSONStream:"^1.0.7",betterbenchmarks:"^0.1.0",bluebird:"3.4.6",bson:"1.0.0","cli-table":"^0.3.1",co:"4.6.0",colors:"^1.1.2",coveralls:"^2.11.6",eslint:"^3.8.1","event-stream":"^3.3.2",gleak:"0.5.0",integra:"0.1.8",jsdoc:"3.4.0","ldjson-stream":"^1.2.1","mongodb-extended-json":"1.7.1","mongodb-topology-manager":"1.0.x","mongodb-version-manager":"github:christkv/mongodb-version-manager#master",nyc:"^8.1.0",optimist:"0.6.1",rimraf:"2.5.4",semver:"5.3.0","worker-farm":"^1.3.1"},directories:{},dist:{shasum:"e32ba91cf9e29f371fb38ba0c4a71c3b1f5fae77",tarball:"https://registry.npmjs.org/mongodb/-/mongodb-2.2.16.tgz"},engines:{node:">=0.10.3"},gitHead:"28da548dc2a1729a23e07418134dea88bf1e1c68",homepage:"https://github.com/mongodb/node-mongodb-native",keywords:["mongodb","driver","official"],license:"Apache-2.0",main:"index.js",maintainers:[{name:"christkv",email:"christkv@gmail.com"}],name:"mongodb",nyc:{include:["lib/**/*.js"]},optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},scripts:{coverage:"nyc node test/runner.js -t functional && node_modules/.bin/nyc report --reporter=text-lcov | node_modules/.bin/coveralls",lint:"eslint lib",test:"node test/runner.js -t functional -l"},version:"2.2.16"}},function(e,t,n){"use strict";var r=n(1).format,o=n(20),i=n(5).Query,s=n(4),a=function(e,t,n,r){this.db=e,this.username=t,this.password=n,this.options=r};a.prototype.equal=function(e){return e.db==this.db&&e.username==this.username&&e.password==this.password};var c=null,u=null;try{c=o("kerberos").Kerberos,u=o("kerberos").processes.MongoAuthProcess}catch(e){}var l=function(e){this.bson=e,this.authStore=[]};l.prototype.auth=function(e,t,n,o,i,u,l){var d=this;if(null==c)return l(new Error("Kerberos library is not installed"));var h=u.gssapiServiceName||"mongodb",m=t.length;if(0==m)return l(null,null);for(var y=0,g=null;t.length>0;){var b=function(t){f(d,o,i,h,e,t,u,function(e,t){m-=1,e?g=e:t&&"object"==typeof t&&t.result.$err?g=t.result:t&&"object"==typeof t&&t.result.errmsg?g=t.result:y+=1,0==m&&y>0?(p(d.authStore,new a(n,o,i,u)),l(null,!0)):0==m&&(null==g&&(g=new s(r("failed to authenticate using mongocr"))),l(g,!1))})},v=function(e){process.nextTick(function(){b(e)})};v(t.shift())}};var f=function(e,t,n,r,o,s,a,c){var l={saslStart:1,mechanism:"GSSAPI",payload:"",autoAuthorize:1},f=new u(s.host,s.port,r,a);o(s,new i(e.bson,"$external.$cmd",l,{numberToSkip:0,numberToReturn:1}),function(r,a){if(r)return c(r,!1);var u=a.result;f.init(t,n,function(t){return t?c(t):void f.transition(u.payload,function(t,n){if(t)return c(t);var r={saslContinue:1,conversationId:u.conversationId,payload:n};o(s,new i(e.bson,"$external.$cmd",r,{numberToSkip:0,numberToReturn:1}),function(t,n){if(t)return c(t,!1);var r=n.result;f.transition(r.payload,function(t,n){if(t)return c(t);var a={saslContinue:1,conversationId:r.conversationId,payload:n};o(s,new i(e.bson,"$external.$cmd",a,{numberToSkip:0,numberToReturn:1}),function(t,n){if(t)return c(t,!1);var r=n.result;f.transition(r.payload,function(t,n){var a={saslContinue:1,conversationId:r.conversationId,payload:n};o(s,new i(e.bson,"$external.$cmd",a,{numberToSkip:0,numberToReturn:1}),function(e,t){if(e)return c(e,!1);var n=t.result;return n.done?c(null,!0):void c(new Error("Authentication failed"),!1)})})})})})})})})},p=function(e,t){for(var n=!1,r=0;r<e.length;r++)if(e[r].equal(t)){n=!0;break}n||e.push(t)};l.prototype.logout=function(e){this.authStore=this.authStore.filter(function(t){return t.db!=e})},l.prototype.reauthenticate=function(e,t,n){var r=this.authStore.slice(0),o=r.length;if(0==o)return n(null,null);for(var i=0;i<r.length;i++)this.auth(e,t,r[i].db,r[i].username,r[i].password,r[i].options,function(e){o-=1,0==o&&n(e,null)})},e.exports=l},function(e,t,n){"use strict";function r(e,t){return t.maxWireVersion>=4?new w(new v):t.maxWireVersion>=2?new v:new b}function o(e,t,n,r,o,i){return e.s.pool.isConnected()||null==e.s.disconnectHandler||o.monitoring?e.s.pool.isConnected()?void 0:(i(g.create(u("no connection available to server %s",e.name))),
!0):(e.s.disconnectHandler.add(t,n,r,o,i),!0)}function i(e){return function(){if(!e.s.pool.isDestroyed()){e.emit("monitoring",e);var t={numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0},n=new y(e.s.bson,"admin.$cmd",{ismaster:!0},t),r=(new Date).getTime();e.s.pool.write(n,{socketTimeout:e.s.options.connectionTimeout||2e3},function(t,n){e.lastIsMasterMS=(new Date).getTime()-r,e.s.pool.isDestroyed()||(n&&(e.ismaster=n.result),e.monitoringProcessId=setTimeout(i(e),e.s.monitoringInterval))})}}}function s(e){return e.s.pool?e.s.pool.isDestroyed()?g.create("server instance pool was destroyed"):void 0:g.create("server instance is not connected")}function a(e,t){if(s(e,t),t.readPreference&&!(t.readPreference instanceof f))throw new Error("readPreference must be an instance of ReadPreference")}var c=n(1).inherits,u=(n(20),n(1).format),l=n(9).EventEmitter,f=n(43),p=n(15),d=n(7).debugOptions,h=n(7).retrieveBSON,m=n(185),y=n(5).Query,g=n(4),b=n(189),v=n(190),w=n(191),S=n(58),x=n(12),k=n(12).assign,_=n(12).createClientInfo,O=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","singleBufferSerializtion","ssl","ca","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],C=0,E=!1,I={},N=h(),A=function(e){e=e||{},l.call(this),this.id=C++,this.s={options:e,logger:p("Server",e),Cursor:e.cursorFactory||S,bson:e.bson||new N([N.Binary,N.Code,N.DBRef,N.Decimal128,N.Double,N.Int32,N.Long,N.Map,N.MaxKey,N.MinKey,N.ObjectId,N.BSONRegExp,N.Symbol,N.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:"boolean"!=typeof e.monitoring||e.monitoring,inTopology:"boolean"==typeof e.inTopology&&e.inTopology,monitoringInterval:"number"==typeof e.monitoringInterval?e.monitoringInterval:5e3,topologyId:-1},this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initalConnect=!0,this.wireProtocolHandler=new b,this._type="server",this.clientInfo=_(e),this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};c(A,l),Object.defineProperty(A.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(A.prototype,"parserType",{enumerable:!0,get:function(){return N.native?"c++":"js"}}),A.enableServerAccounting=function(){E=!0,I={}},A.disableServerAccounting=function(){E=!1},A.servers=function(){return I},Object.defineProperty(A.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var M=function(e,t){return function(n){if(e.s.logger.isInfo()){var o=n instanceof g?JSON.stringify(n):{};e.s.logger.info(u("server %s fired event %s out with message %s",e.name,t,o))}if("connect"==t){var s={numberToSkip:0,numberToReturn:-1,checkKeys:!1,slaveOk:!0},a=new y(e.s.bson,"admin.$cmd",{ismaster:!0,client:e.clientInfo},s),c=(new Date).getTime();e.s.pool.write(a,{socketTimeout:e.s.options.connectionTimeout||2e3},function(t,n){return e.lastIsMasterMS=(new Date).getTime()-c,t?(e.destroy(),void(e.listeners("error").length>0&&e.emit("error",t))):(e.initalConnect=!1,e.ismaster=n.result,"isdbgrid"==e.ismaster.msg&&(e._type="mongos"),e.wireProtocolHandler=r(e,e.ismaster),e.s.monitoring&&(e.monitoringProcessId=setTimeout(i(e),e.s.monitoringInterval)),x.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?x.getTopologyType(e):"Standalone"}),x.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Standalone"}]}),e.s.logger.isInfo()&&e.s.logger.info(u("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),void e.emit("connect",e))})}else{if(E&&["close","timeout","error","parseError","reconnectFailed"].indexOf(t)!=-1&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete I[e.id]),"reconnectFailed"==t)return e.emit("reconnectFailed",n),void(e.listeners("error").length>0&&e.emit("error",n));if("disconnected"==e.s.pool.state&&e.initalConnect&&["close","timeout","error","parseError"].indexOf(t)!=-1)return e.initalConnect=!1,e.emit("error",new g(u("failed to connect to server [%s] on first connect",e.name)));if("reconnect"==t)return e.emit(t,e);e.emit(t,n)}}};A.prototype.connect=function(e){var t=this;if(e=e||{},E&&(I[this.id]=this),t.s.pool&&!t.s.pool.isDisconnected()&&!t.s.pool.isDestroyed())throw g.create(u("server instance in invalid state %s",t.s.state));t.s.pool=new m(k(t.s.options,e,{bson:this.s.bson})),t.s.pool.on("close",M(t,"close")),t.s.pool.on("error",M(t,"error")),t.s.pool.on("timeout",M(t,"timeout")),t.s.pool.on("parseError",M(t,"parseError")),t.s.pool.on("connect",M(t,"connect")),t.s.pool.on("reconnect",M(t,"reconnect")),t.s.pool.on("reconnectFailed",M(t,"reconnectFailed")),t.s.inTopology||this.emit("topologyOpening",{topologyId:t.id}),t.emit("serverOpening",{topologyId:t.s.topologyId!=-1?t.s.topologyId:t.id,address:t.name}),e.auth?t.s.pool.connect.apply(t.s.pool,e.auth):t.s.pool.connect()},A.prototype.getDescription=function(){var e=this.ismaster||{},t={type:x.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t},A.prototype.lastIsMaster=function(){return this.ismaster},A.prototype.unref=function(){this.s.pool.unref()},A.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},A.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},A.prototype.command=function(e,t,n,r){var i=this;"function"==typeof n&&(r=n,n={},n=n||{});var s=a(i,n);if(s)return r(s);if(i.s.logger.isDebug()&&i.s.logger.debug(u("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:d(O,n)}),i.name)),!o(i,"command",e,t,n,r)){if(this.ismaster&&this.ismaster.maxWireVersion<5&&t.collation)return r(new g(u("server %s does not support collation",this.name)));var c={numberToSkip:0,numberToReturn:-1,checkKeys:"boolean"==typeof n.checkKeys&&n.checkKeys,serializeFunctions:"boolean"==typeof n.serializeFunctions&&n.serializeFunctions,ignoreUndefined:"boolean"==typeof n.ignoreUndefined&&n.ignoreUndefined},l=new y(i.s.bson,e,t,c);l.slaveOk=!!n.readPreference&&n.readPreference.slaveOk();var f={raw:"boolean"==typeof n.raw&&n.raw,promoteLongs:"boolean"!=typeof n.promoteLongs||n.promoteLongs,promoteValues:"boolean"!=typeof n.promoteValues||n.promoteValues,promoteBuffers:"boolean"==typeof n.promoteBuffers&&n.promoteBuffers,command:!0,monitoring:"boolean"==typeof n.monitoring&&n.monitoring,fullResult:"boolean"==typeof n.fullResult&&n.fullResult,requestId:l.requestId,socketTimeout:"number"==typeof n.socketTimeout?n.socketTimeout:null};i.s.pool.write(l,f,r)}},A.prototype.insert=function(e,t,n,r){var i=this;"function"==typeof n&&(r=n,n={},n=n||{});var a=s(i,n);return a?r(a):o(i,"insert",e,t,n,r)?void 0:(t=Array.isArray(t)?t:[t],i.wireProtocolHandler.insert(i.s.pool,i.ismaster,e,i.s.bson,t,n,r))},A.prototype.update=function(e,t,n,r){var i=this;"function"==typeof n&&(r=n,n={},n=n||{});var a=s(i,n);return a?r(a):o(i,"update",e,t,n,r)?void 0:this.ismaster&&this.ismaster.maxWireVersion<5&&n.collation?r(new g(u("server %s does not support collation",this.name))):(t=Array.isArray(t)?t:[t],i.wireProtocolHandler.update(i.s.pool,i.ismaster,e,i.s.bson,t,n,r))},A.prototype.remove=function(e,t,n,r){var i=this;"function"==typeof n&&(r=n,n={},n=n||{});var a=s(i,n);return a?r(a):o(i,"remove",e,t,n,r)?void 0:this.ismaster&&this.ismaster.maxWireVersion<5&&n.collation?r(new g(u("server %s does not support collation",this.name))):(t=Array.isArray(t)?t:[t],i.wireProtocolHandler.remove(i.s.pool,i.ismaster,e,i.s.bson,t,n,r))},A.prototype.cursor=function(e,t,n){var r=this.s;n=n||{};var o=n.cursorFactory||r.Cursor;return new o(r.bson,e,t,n,this,r.options)},A.prototype.logout=function(e,t){this.s.pool.logout(e,t)},A.prototype.auth=function(e,t){var n=this;"default"==e&&n.ismaster&&n.ismaster.maxWireVersion>=3?e="scram-sha-1":"default"==e&&(e="mongocr");var r=Array.prototype.slice.call(arguments,0);r[0]=e;var i=r[r.length-1];if(!o(n,"auth",t,r,{},i))return this.lastIsMaster()&&this.lastIsMaster().arbiterOnly?i(null,!0):void n.s.pool.auth.apply(n.s.pool,r)},A.prototype.equals=function(e){return"string"==typeof e?this.name==e:!!e.name&&this.name==e.name},A.prototype.connections=function(){return this.s.pool.allConnections()},A.prototype.getServer=function(){return this},A.prototype.getConnection=function(){return this.s.pool.get()};var T=["close","error","timeout","parseError","connect"];A.prototype.destroy=function(e){e=e||{};var t=this;E&&delete I[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),e.emitClose&&t.emit("close",t),e.emitDestroy&&t.emit("destroy",t),T.forEach(function(e){t.s.pool.removeAllListeners(e)}),t.listeners("serverClosed").length>0&&t.emit("serverClosed",{topologyId:t.s.topologyId!=-1?t.s.topologyId:t.id,address:t.name}),t.listeners("topologyClosed").length>0&&!t.s.inTopology&&t.emit("topologyClosed",{topologyId:t.id}),t.s.logger.isDebug()&&t.s.logger.debug(u("destroy called on server %s",t.name)),this.s.pool.destroy(e.force)},e.exports=A},function(e,t,n){"use strict";var r=n(4),o=2001,i=2002,s=2006,a=function(e,t,n,o,i,s){if(null==o)throw new r("ns must be specified for query");if(!Array.isArray(i)||0==i.length)throw new r("documents array must contain at least one document to insert");if(~o.indexOf("\0"))throw new r("namespace cannot contain a null character");this.requestId=e,this.bson=n,this.ns=o,this.documents=i,this.ismaster=t,s=s||{},this.serializeFunctions="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,this.ignoreUndefined="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined,this.checkKeys="boolean"!=typeof s.checkKeys||s.checkKeys,this.continueOnError="boolean"==typeof s.continueOnError&&s.continueOnError,this.flags=this.continueOnError?1:0};a.prototype.toBin=function(){var e=[],t=new Buffer(20+Buffer.byteLength(this.ns)+1);e.push(t);for(var n=t.length,o=0;o<this.documents.length;o++){var s=this.bson.serialize(this.documents[o],{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});if(s.length>this.ismaster.maxBsonObjectSize)throw new r("Document exceeds maximum allowed bson size of "+this.ismaster.maxBsonObjectSize+" bytes");n+=s.length,e.push(s)}if(n>this.ismaster.maxMessageSizeBytes)throw new r("Command exceeds maximum message size of "+this.ismaster.maxMessageSizeBytes+" bytes");var a=0;return t[a+3]=n>>24&255,t[a+2]=n>>16&255,t[a+1]=n>>8&255,t[a]=255&n,a+=4,t[a+3]=this.requestId>>24&255,t[a+2]=this.requestId>>16&255,t[a+1]=this.requestId>>8&255,t[a]=255&this.requestId,a+=4,t[a+3]=0,t[a+2]=0,t[a+1]=0,t[a]=0,a+=4,t[a+3]=i>>24&255,t[a+2]=i>>16&255,t[a+1]=i>>8&255,t[a]=255&i,a+=4,t[a+3]=this.flags>>24&255,t[a+2]=this.flags>>16&255,t[a+1]=this.flags>>8&255,t[a]=255&this.flags,a+=4,a=a+t.write(this.ns,a,"utf8")+1,t[a-1]=0,e};var c=function(e,t,n,o,i,s){if(null==o)throw new r("ns must be specified for query");s=s||{},this.requestId=e,this.bson=n,this.ns=o,this.ismaster=t,this.serializeFunctions="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,this.ignoreUndefined="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined,this.checkKeys="boolean"==typeof s.checkKeys&&s.checkKeys,this.upsert="boolean"==typeof i[0].upsert&&i[0].upsert,this.multi="boolean"==typeof i[0].multi&&i[0].multi,this.q=i[0].q,this.u=i[0].u,this.flags=this.upsert?1:0,this.flags=this.multi?2|this.flags:this.flags};c.prototype.toBin=function(){var e=[],t=new Buffer(20+Buffer.byteLength(this.ns)+1+4);e.push(t);var n=t.length,r=this.bson.serialize(this.q,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(r),n+=r.length;var i=this.bson.serialize(this.u,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(i),n+=i.length;var s=0;return t[s+3]=n>>24&255,t[s+2]=n>>16&255,t[s+1]=n>>8&255,t[s]=255&n,s+=4,t[s+3]=this.requestId>>24&255,t[s+2]=this.requestId>>16&255,t[s+1]=this.requestId>>8&255,t[s]=255&this.requestId,s+=4,t[s+3]=0,t[s+2]=0,t[s+1]=0,t[s]=0,s+=4,t[s+3]=o>>24&255,t[s+2]=o>>16&255,t[s+1]=o>>8&255,t[s]=255&o,s+=4,t[s+3]=0,t[s+2]=0,t[s+1]=0,t[s]=0,s+=4,s=s+t.write(this.ns,s,"utf8")+1,t[s-1]=0,t[s+3]=this.flags>>24&255,t[s+2]=this.flags>>16&255,t[s+1]=this.flags>>8&255,t[s]=255&this.flags,s+=4,e};var u=function(e,t,n,o,i,s){if(null==o)throw new r("ns must be specified for query");s=s||{},this.requestId=e,this.bson=n,this.ns=o,this.ismaster=t,this.serializeFunctions="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,this.ignoreUndefined="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined,this.checkKeys="boolean"==typeof s.checkKeys&&s.checkKeys,this.limit="number"==typeof i[0].limit?i[0].limit:1,this.q=i[0].q,this.flags=1==this.limit?1:0};u.prototype.toBin=function(){var e=[],t=new Buffer(20+Buffer.byteLength(this.ns)+1+4);e.push(t);var n=t.length,r=this.bson.serialize(this.q,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(r),n+=r.length;var o=0;return t[o+3]=n>>24&255,t[o+2]=n>>16&255,t[o+1]=n>>8&255,t[o]=255&n,o+=4,t[o+3]=this.requestId>>24&255,t[o+2]=this.requestId>>16&255,t[o+1]=this.requestId>>8&255,t[o]=255&this.requestId,o+=4,t[o+3]=0,t[o+2]=0,t[o+1]=0,t[o]=0,o+=4,t[o+3]=s>>24&255,t[o+2]=s>>16&255,t[o+1]=s>>8&255,t[o]=255&s,o+=4,t[o+3]=0,t[o+2]=0,t[o+1]=0,t[o]=0,o+=4,o=o+t.write(this.ns,o,"utf8")+1,t[o-1]=0,t[o+3]=this.flags>>24&255,t[o+2]=this.flags>>16&255,t[o+1]=this.flags>>8&255,t[o]=255&this.flags,o+=4,e},e.exports={Insert:a,Update:c,Remove:u}},function(e,t,n){"use strict";var r=n(43),o=n(4),i=function(e,t){var n=e.readPreference||new r("primary");if(t.readPreference&&(n=t.readPreference),"string"==typeof n&&(n=new r(n)),!(n instanceof r))throw new o("readPreference must be a ReadPreference instance");return n};e.exports={getReadPreference:i}},function(e,t,n){"use strict";function r(e,t,r){r=null==r?{}:r;var i=!1,s=null,a=e.bson,u=t.collectionName,l=e.isMasterDoc&&e.isMasterDoc.maxBsonObjectSize?e.isMasterDoc.maxBsonObjectSize:16793600,f=e.isMasterDoc&&e.isMasterDoc.maxWriteBatchSize?e.isMasterDoc.maxWriteBatchSize:1e3,p=o.writeConcern(c(r),t,r),d=r.promiseLibrary;d||(d="function"==typeof global.Promise?global.Promise:n(6).Promise);var h={ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]};this.s={bulkResult:h,currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,batches:[],writeConcern:p,maxBatchSizeBytes:l,maxWriteBatchSize:f,namespace:u,bson:a,topology:e,options:r,currentOp:s,executed:i,collection:t,promiseLibrary:d,err:null,bypassDocumentValidation:"boolean"==typeof r.bypassDocumentValidation&&r.bypassDocumentValidation}}var o=n(109),i=n(2),s=n(2).toError,a=n(2).handleCallback,c=i.shallowClone,u=o.BulkWriteResult,l=n(3).BSON.ObjectID,f=n(8),p=n(3).BSON,d=o.Batch,h=o.mergeBatchResults,m=new p([p.Binary,p.Code,p.DBRef,p.Decimal128,p.Double,p.Int32,p.Long,p.Map,p.MaxKey,p.MinKey,p.ObjectId,p.BSONRegExp,p.Symbol,p.Timestamp]),y=function(e){this.s=e.s};y.prototype.update=function(e){var t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return this.s.currentOp=null,g(this,o.UPDATE,n)},y.prototype.updateOne=function(e){var t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};return this.s.currentOp=null,g(this,o.UPDATE,n)},y.prototype.replaceOne=function(e){this.updateOne(e)},y.prototype.upsert=function(){return this.s.currentOp.upsert=!0,this},y.prototype.deleteOne=function(){var e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,g(this,o.REMOVE,e)},y.prototype.removeOne=y.prototype.deleteOne,y.prototype.delete=function(){var e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,g(this,o.REMOVE,e)},y.prototype.remove=y.prototype.delete;var g=function(e,t,n){var r=m.calculateObjectSize(n,{checkKeys:!1});if(r>=e.s.maxBatchSizeBytes)throw s("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(null==e.s.currentBatch&&(e.s.currentBatch=new d(t,e.s.currentIndex)),e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSizeBytes+e.s.currentBatchSizeBytes>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!=t?(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new d(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0):(e.s.currentBatchSize=e.s.currentBatchSize+1,e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+r),t==o.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id}),Array.isArray(n))throw s("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(n),e.s.currentBatchSizeBytes=e.s.currentBatchSizeBytes+r,e.s.currentIndex=e.s.currentIndex+1,e},b=r.define=new f("OrderedBulkOperation",r,!1);r.prototype.raw=function(e){var t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,g(this,o.UPDATE,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){var r=!e.updateOne&&!e.replaceOne,i={q:e[t].filter,u:e[t].update||e[t].replacement,multi:r};return i.upsert=!!e[t].upsert,e.collation&&(i.collation=e.collation),g(this,o.UPDATE,i)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,g(this,o.REMOVE,e[t]);if(e.deleteOne||e.deleteMany){var a=e.deleteOne?1:0;return i={q:e[t].filter,limit:a},e.collation&&(i.collation=e.collation),g(this,o.REMOVE,i)}if(e.insertOne&&null==e.insertOne.document)return n!==!0&&null==e.insertOne._id&&(e.insertOne._id=new l),g(this,o.INSERT,e.insertOne);if(e.insertOne&&e.insertOne.document)return n!==!0&&null==e.insertOne.document._id&&(e.insertOne.document._id=new l),g(this,o.INSERT,e.insertOne.document);if(!e.insertMany)throw s("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(var c=0;c<e.insertMany.length;c++)n!==!0&&null==e.insertMany[c]._id&&(e.insertMany[c]._id=new l),g(this,o.INSERT,e.insertMany[c])},r.prototype.insert=function(e){return this.s.collection.s.db.options.forceServerObjectId!==!0&&null==e._id&&(e._id=new l),g(this,o.INSERT,e)},r.prototype.find=function(e){if(!e)throw s("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new y(this)},Object.defineProperty(r.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}});var v=function(e,t){if(0==e.s.batches.length)return a(t,null,new u(e.s.bulkResult));var n=e.s.batches.shift(),r=function(r,o){if(r&&r.driver||r&&r.message)return a(t,r);r&&(r.ok=0);var i=h(!0,n,e.s.bulkResult,r,o);return null!=i?a(t,null,new u(e.s.bulkResult)):e.s.bulkResult.writeErrors.length>0?a(t,s(e.s.bulkResult.writeErrors[0]),new u(e.s.bulkResult)):void v(e,t)},i={ordered:!0};null!=e.s.writeConcern&&(i.writeConcern=e.s.writeConcern),e.operationId&&(r.operationId=e.operationId),e.s.options.serializeFunctions&&(i.serializeFunctions=!0),e.s.options.ignoreUndefined&&(i.ignoreUndefined=!0),1==e.s.bypassDocumentValidation&&(i.bypassDocumentValidation=!0);try{n.batchType==o.INSERT?e.s.topology.insert(e.s.collection.namespace,n.operations,i,r):n.batchType==o.UPDATE?e.s.topology.update(e.s.collection.namespace,n.operations,i,r):n.batchType==o.REMOVE&&e.s.topology.remove(e.s.collection.namespace,n.operations,i,r)}catch(r){r.ok=0,a(t,null,h(!1,n,e.s.bulkResult,r,null))}};r.prototype.execute=function(e,t){var n=this;if(this.s.executed)throw new s("batch cannot be re-executed");if("function"==typeof e?t=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.s.currentBatch&&this.s.batches.push(this.s.currentBatch),0==this.s.batches.length)throw s("Invalid Operation, No operations in bulk");return"function"==typeof t?v(this,t):new this.s.promiseLibrary(function(e,t){v(n,function(n,r){return n?t(n):void e(r)})})},b.classMethod("execute",{callback:!0,promise:!1});var w=function(e,t,n){return new r(e,t,n)};w.OrderedBulkOperation=r,e.exports=w,e.exports.Bulk=r},function(e,t,n){"use strict";var r=n(109),o=n(2),i=n(2).toError,s=n(2).handleCallback,a=o.shallowClone,c=r.BulkWriteResult,u=n(3).BSON.ObjectID,l=n(3).BSON,f=n(8),p=r.Batch,d=r.mergeBatchResults,h=new l([l.Binary,l.Code,l.DBRef,l.Decimal128,l.Double,l.Int32,l.Long,l.Map,l.MaxKey,l.MinKey,l.ObjectId,l.BSONRegExp,l.Symbol,l.Timestamp]),m=function(e){this.s=e.s};m.prototype.update=function(e){var t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return this.s.currentOp=null,y(this,r.UPDATE,n)},m.prototype.updateOne=function(e){var t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};return this.s.currentOp=null,y(this,r.UPDATE,n)},m.prototype.replaceOne=function(e){this.updateOne(e)},m.prototype.upsert=function(){return this.s.currentOp.upsert=!0,this},m.prototype.removeOne=function(){var e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,y(this,r.REMOVE,e)},m.prototype.remove=function(){var e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,y(this,r.REMOVE,e)};var y=function(e,t,n){var o=h.calculateObjectSize(n,{checkKeys:!1});if(o>=e.s.maxBatchSizeBytes)throw i("document is larger than the maximum size "+e.s.maxBatchSizeBytes);if(e.s.currentBatch=null,t==r.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t==r.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t==r.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch),null==e.s.currentBatch&&(e.s.currentBatch=new p(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.sizeBytes+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!=t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new p(t,e.s.currentIndex)),Array.isArray(n))throw i("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(n),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t==r.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id})):t==r.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t==r.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size=e.s.currentBatch.size+1,e.s.currentBatch.sizeBytes=e.s.currentBatch.sizeBytes+o,e},g=function(e,t,o){o=null==o?{}:o;var i=t.collectionName,s=!1,c=null,u=e.bson,l=e.isMasterDoc&&e.isMasterDoc.maxBsonObjectSize?e.isMasterDoc.maxBsonObjectSize:16793600,f=e.isMasterDoc&&e.isMasterDoc.maxWriteBatchSize?e.isMasterDoc.maxWriteBatchSize:1e3,p=r.writeConcern(a(o),t,o),d=o.promiseLibrary;d||(d="function"==typeof global.Promise?global.Promise:n(6).Promise);var h={ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]};this.s={bulkResult:h,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,currentBatch:null,currentIndex:0,batches:[],writeConcern:p,maxBatchSizeBytes:l,maxWriteBatchSize:f,namespace:i,bson:u,topology:e,options:o,currentOp:c,executed:s,collection:t,promiseLibrary:d,bypassDocumentValidation:"boolean"==typeof o.bypassDocumentValidation&&o.bypassDocumentValidation}},b=g.define=new f("UnorderedBulkOperation",g,!1);g.prototype.insert=function(e){return this.s.collection.s.db.options.forceServerObjectId!==!0&&null==e._id&&(e._id=new u),y(this,r.INSERT,e)},g.prototype.find=function(e){if(!e)throw i("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new m(this)},Object.defineProperty(g.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),g.prototype.raw=function(e){var t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,y(this,r.UPDATE,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){var o=!e.updateOne&&!e.replaceOne,s={q:e[t].filter,u:e[t].update||e[t].replacement,multi:o};return e[t].upsert&&(s.upsert=!0),y(this,r.UPDATE,s)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,y(this,r.REMOVE,e[t]);if(e.deleteOne||e.deleteMany){var a=e.deleteOne?1:0;return s={q:e[t].filter,limit:a},y(this,r.REMOVE,s)}if(e.insertOne&&null==e.insertOne.document)return n!==!0&&null==e.insertOne._id&&(e.insertOne._id=new u),y(this,r.INSERT,e.insertOne);if(e.insertOne&&e.insertOne.document)return n!==!0&&null==e.insertOne.document._id&&(e.insertOne.document._id=new u),y(this,r.INSERT,e.insertOne.document);if(!e.insertMany)throw i("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(var c=0;c<e.insertMany.length;c++)n!==!0&&null==e.insertMany[c]._id&&(e.insertMany[c]._id=new u),y(this,r.INSERT,e.insertMany[c])};var v=function(e,t,n){var o={ordered:!1};null!=e.s.writeConcern&&(o.writeConcern=e.s.writeConcern);var i=function(r,o){return r&&r.driver||r&&r.message?s(n,r):(r&&(r.ok=0),void s(n,null,d(!1,t,e.s.bulkResult,r,o)))};e.operationId&&(i.operationId=e.operationId),e.s.options.serializeFunctions&&(o.serializeFunctions=!0),1==e.s.bypassDocumentValidation&&(o.bypassDocumentValidation=!0);try{t.batchType==r.INSERT?e.s.topology.insert(e.s.collection.namespace,t.operations,o,i):t.batchType==r.UPDATE?e.s.topology.update(e.s.collection.namespace,t.operations,o,i):t.batchType==r.REMOVE&&e.s.topology.remove(e.s.collection.namespace,t.operations,o,i)}catch(r){r.ok=0,s(n,null,d(!1,t,e.s.bulkResult,r,null))}},w=function(e,t){for(var n=e.s.batches.length,r=0;r<e.s.batches.length;r++)v(e,e.s.batches[r],function(r){if(r&&(o=r),n-=1,0==n){if(o)return s(t,o);var o=e.s.bulkResult.writeErrors.length>0?i(e.s.bulkResult.writeErrors[0]):null;s(t,o,new c(e.s.bulkResult))}})};g.prototype.execute=function(e,t){var n=this;if(this.s.executed)throw i("batch cannot be re-executed");if("function"==typeof e?t=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch),0==this.s.batches.length)throw i("Invalid Operation, No operations in bulk");return"function"==typeof t?w(this,t):new this.s.promiseLibrary(function(e,t){w(n,function(n,r){return n?t(n):void e(r)})})},b.classMethod("execute",{callback:!0,promise:!1});var S=function(e,t,n){return new g(e,t,n)};S.UnorderedBulkOperation=g,e.exports=S,e.exports.Bulk=g},function(e,t,n){"use strict";function r(e,t,n){if(t.s.topology.capabilities().commandsTakeWriteConcern){var r=Z(a(n),t,n);r.writeConcern&&(e.writeConcern=r.writeConcern)}}var o=n(9).EventEmitter,i=n(1).inherits,s=n(2).getSingleProperty,a=n(2).shallowClone,c=n(2).parseIndexOptions,u=n(2).debugOptions,l=n(19),f=n(2).handleCallback,p=n(2).filterOptions,d=n(2).toError,h=n(14),m=n(1).format,y=n(108),g=n(3).BSON.Code,b=n(3).ReadPreference,v=n(3).MongoError,w=n(3).ObjectID,S=n(8),x=n(3).Logger,k=n(59),_=n(28),O=n(2).assign,C=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"],E=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference"],I=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues"],N=function(e,t,r){if(r=r||{},!(this instanceof N))return new N(e,t,r);o.call(this);var i=this,a=r.promiseLibrary;a||(a="function"==typeof global.Promise?global.Promise:n(6).Promise),r=p(r,I),r.promiseLibrary=a,this.s={databaseName:e,dbCache:{},children:[],topology:t,options:r,logger:x("Db",r),bson:t?t.bson:null,authSource:r.authSource,readPreference:r.readPreference,bufferMaxEntries:"number"==typeof r.bufferMaxEntries?r.bufferMaxEntries:-1,parentDb:r.parentDb||null,pkFactory:r.pkFactory||w,nativeParser:r.nativeParser||r.native_parser,promiseLibrary:a,noListener:"boolean"==typeof r.noListener&&r.noListener,readConcern:r.readConcern},Y(i.s.databaseName),s(this,"serverConfig",i.s.topology),s(this,"bufferMaxEntries",i.s.bufferMaxEntries),s(this,"databaseName",i.s.databaseName),r.parentDb||this.s.noListener||(t.on("error",J(i,"error",i)),t.on("timeout",J(i,"timeout",i)),t.on("close",J(i,"close",i)),t.on("parseError",J(i,"parseError",i)),t.once("open",J(i,"open",i)),t.once("fullsetup",J(i,"fullsetup",i)),t.once("all",J(i,"all",i)),t.on("reconnect",J(i,"reconnect",i)))};i(N,o);var A=N.define=new S("Db",N,!1);Object.defineProperty(N.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty(N.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty(N.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!=this.s.options.readPreference||"primary"!=this.s.options.readPreference.mode)}}),Object.defineProperty(N.prototype,"writeConcern",{enumerable:!0,get:function(){var e={};return null!=this.s.options.w&&(e.w=this.s.options.w),null!=this.s.options.j&&(e.j=this.s.options.j),null!=this.s.options.fsync&&(e.fsync=this.s.options.fsync),null!=this.s.options.wtimeout&&(e.wtimeout=this.s.options.wtimeout),e}});var M=function(e,t){e.s.topology.connect(e,e.s.options,function(n){if(null!=t){var r=t;return n?(e.close(),r(n)):void r(null,e)}})};N.prototype.open=function(e){var t=this;return"function"==typeof e?M(t,e):new t.s.promiseLibrary(function(e,n){M(t,function(t,r){return t?n(t):void e(r)})})},A.classMethod("open",{callback:!0,promise:!0});var T=function(e){if(e&&"string"==typeof e)return new b(e);if(e instanceof h)return new b(e.mode,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds});if(e&&"object"==typeof e){var t=e.mode||e.preference;t&&"string"==typeof t&&(e=new b(t,e.tags,{maxStalenessSeconds:e.maxStalenessSeconds}))}return e},B=function(e,t,n,r){if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new v("topology was destroyed"));var o=n.dbName||n.authdb||e.s.databaseName;null==n.readPreference&&e.s.readPreference&&(n.readPreference=e.s.readPreference),n.readPreference?n.readPreference=T(n.readPreference):n.readPreference=b.primary,e.s.logger.isDebug()&&e.s.logger.debug(m("executing command %s against %s with options [%s]",JSON.stringify(t),m("%s.$cmd",o),JSON.stringify(u(C,n)))),e.s.topology.command(m("%s.$cmd",o),t,n,function(e,t){return e?f(r,e):n.full?f(r,null,t):void f(r,null,t.result)})};N.prototype.command=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=a(t),"function"==typeof n?B(r,e,t,n):new this.s.promiseLibrary(function(n,o){B(r,e,t,function(e,t){return e?o(e):void n(t)})})},A.classMethod("command",{callback:!0,promise:!0}),N.prototype.close=function(e,t){"function"==typeof e&&(t=e,
e=!1),this.s.topology.close(e);var n=this;if(this.listeners("close").length>0){if(this.emit("close"),null==this.parentDb)for(var r=0;r<this.s.children.length;r++)this.s.children[r].emit("close");n.removeAllListeners("close")}return this.s.parentDb&&this.s.parentDb.close(),"function"==typeof t?process.nextTick(function(){f(t,null)}):new this.s.promiseLibrary(function(e){e()})},A.classMethod("close",{callback:!0,promise:!0}),N.prototype.admin=function(){return new y(this,this.s.topology,this.s.promiseLibrary)},A.classMethod("admin",{callback:!1,promise:!1,returns:[y]}),N.prototype.collection=function(e,t,n){var r=this;if("function"==typeof t&&(n=t,t={}),t=t||{},t=a(t),t.promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern||this.s.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),null==t||!t.strict)try{var o=new k(this,this.s.topology,this.s.databaseName,e,this.s.pkFactory,t);return n&&n(null,o),o}catch(e){if(n)return n(e);throw e}if("function"!=typeof n)throw d(m("A callback is required in strict mode. While getting collection %s.",e));return r.serverConfig&&r.serverConfig.isDestroyed()?n(new v("topology was destroyed")):void this.listCollections({name:e}).toArray(function(o,i){if(null!=o)return f(n,o,null);if(0==i.length)return f(n,d(m("Collection %s does not exist. Currently in strict mode.",e)),null);try{return f(n,null,new k(r,r.s.topology,r.s.databaseName,e,r.s.pkFactory,t))}catch(e){return f(n,e,null)}})},A.classMethod("collection",{callback:!0,promise:!1,returns:[k]});var D=function(e,t,n,o){var i=Z(a(n),e,n);return e.serverConfig&&e.serverConfig.isDestroyed()?o(new v("topology was destroyed")):void e.listCollections({name:t}).setReadPreference(h.PRIMARY).toArray(function(s,a){if(null!=s)return f(o,s,null);if(a.length>0&&i.strict)return f(o,v.create({message:m("Collection %s already exists. Currently in strict mode.",t),driver:!0}),null);if(a.length>0)try{return f(o,null,new k(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,n))}catch(e){return f(o,e)}var c={create:t};r(c,e,n);for(var u in n)null!=n[u]&&"function"!=typeof n[u]&&E.indexOf(u)==-1&&(c[u]=n[u]);i.readPreference=h.PRIMARY,e.command(c,i,function(r){return r?f(o,r):void f(o,null,new k(e,e.s.topology,e.s.databaseName,t,e.s.pkFactory,n))})})};N.prototype.createCollection=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);return n=o.pop(),"function"!=typeof n&&o.push(n),e=o.length?o.shift():null,t=o.length?o.shift()||{}:{},t.promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,"string"==typeof n&&(e=n),"function"==typeof n?D(r,e,t,n):new this.s.promiseLibrary(function(n,o){D(r,e,t,function(e,t){return e?o(e):void n(t)})})},A.classMethod("createCollection",{callback:!0,promise:!0}),N.prototype.stats=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};var n={dbStats:!0};return null!=e.scale&&(n.scale=e.scale),null==e.readPreference&&this.s.readPreference&&(e.readPreference=this.s.readPreference),this.command(n,e,t)},A.classMethod("stats",{callback:!0,promise:!0});var R=function(e){var t=m("%s.",e);return{doc:function(e){var n=e.name.indexOf(t);return e.name&&0==n&&(e.name=e.name.substr(n+t.length)),e}}};N.prototype.listCollections=function(e,t){if(e=e||{},t=t||{},t=a(t),t.promiseLibrary=this.s.promiseLibrary,t.readPreference&&(t.readPreference=T(t.readPreference)),this.serverConfig.capabilities().hasListCollectionsCommand){var n=t.batchSize?{batchSize:t.batchSize}:{},r={listCollections:!0,filter:e,cursor:n};return t.cursorFactory=l,n=this.s.topology.cursor(m("%s.$cmd",this.s.databaseName),r,t),t.readPreference&&n.setReadPreference(t.readPreference),n}this.serverConfig.capabilities().hasListCollectionsCommand||"string"!=typeof e.name||new RegExp("^"+this.databaseName+"\\.").test(e.name)||(e=a(e),e.name=m("%s.%s",this.s.databaseName,e.name)),null==e&&(e.name=m("/%s/",this.s.databaseName)),e=e.name?{$and:[{name:e.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};var o={transforms:R(this.s.databaseName)};return n=this.collection(N.SYSTEM_NAMESPACE_COLLECTION).find(e,o),t.readPreference&&n.setReadPreference(t.readPreference),t.batchSize&&(n=n.batchSize(t.batchSize)),n},A.classMethod("listCollections",{callback:!1,promise:!1,returns:[l]});var P=function(e,t,n,r,o){var i=t,s=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return o(new v("topology was destroyed"));i&&"Code"==i._bsontype||(i=new g(i)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(s=n):s=[n];var a={$eval:i,args:s};r.nolock&&(a.nolock=r.nolock),r.readPreference=new b(h.PRIMARY),e.command(a,r,function(e,t){return e?f(o,e,null):t&&1==t.ok?f(o,null,t.retval):t?f(o,v.create({message:m("eval failed: %s",t.errmsg),driver:!0}),null):void f(o,e,t)})};N.prototype.eval=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,1);return r=i.pop(),"function"!=typeof r&&i.push(r),t=i.length?i.shift():t,n=i.length?i.shift()||{}:{},"function"==typeof r?P(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){P(o,e,t,n,function(e,t){return e?i(e):void r(t)})})},A.classMethod("eval",{callback:!0,promise:!0}),N.prototype.renameCollection=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=n||{},n.new_collection=!0,"function"==typeof r?this.collection(e).rename(t,n,r):new this.s.promiseLibrary(function(r,i){o.collection(e).rename(t,n,function(e,t){return e?i(e):void r(t)})})},A.classMethod("renameCollection",{callback:!0,promise:!0}),N.prototype.dropCollection=function(e,t,n){var o=this;"function"==typeof t&&(n=t,t={}),t=t||{};var i={drop:e};return r(i,o,t),t=O({},this.s.options,{readPreference:h.PRIMARY}),"function"==typeof n?this.command(i,t,function(e,t){return o.serverConfig&&o.serverConfig.isDestroyed()?n(new v("topology was destroyed")):e?f(n,e):t.ok?f(n,null,!0):void f(n,null,!1)}):(t=a(o.s.options),t.readPreference=h.PRIMARY,new this.s.promiseLibrary(function(e,n){o.command(i,t,function(t,r){return o.serverConfig&&o.serverConfig.isDestroyed()?n(new v("topology was destroyed")):t?n(t):r.ok?e(!0):void e(!1)})}))},A.classMethod("dropCollection",{callback:!0,promise:!0}),N.prototype.dropDatabase=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),e=e||{};var o={dropDatabase:1};return r(o,n,e),e=O({},this.s.options,{readPreference:h.PRIMARY}),"function"==typeof t?this.command(o,e,function(e,r){return n.serverConfig&&n.serverConfig.isDestroyed()?t(new v("topology was destroyed")):null!=t?e?f(t,e,null):void f(t,null,!!r.ok):void 0}):new this.s.promiseLibrary(function(t,r){n.command(o,e,function(e,o){return n.serverConfig&&n.serverConfig.isDestroyed()?r(new v("topology was destroyed")):e?r(e):o.ok?t(!0):void t(!1)})})},A.classMethod("dropDatabase",{callback:!0,promise:!0});var L=function(e,t){e.listCollections().toArray(function(n,r){return null!=n?f(t,n,null):(r=r.filter(function(e){return e.name.indexOf("$")==-1}),void f(t,null,r.map(function(t){return new k(e,e.s.topology,e.s.databaseName,t.name.replace(e.s.databaseName+".",""),e.s.pkFactory,e.s.options)})))})};N.prototype.collections=function(e){var t=this;return"function"==typeof e?L(t,e):new t.s.promiseLibrary(function(e,n){L(t,function(t,r){return t?n(t):void e(r)})})},A.classMethod("collections",{callback:!0,promise:!0}),N.prototype.executeDbAdminCommand=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof n?(t.readPreference&&(t.readPreference=T(t.readPreference)),r.s.topology.command("admin.$cmd",e,t,function(e,t){return r.serverConfig&&r.serverConfig.isDestroyed()?n(new v("topology was destroyed")):e?f(n,e):void f(n,null,t.result)})):new r.s.promiseLibrary(function(n,o){r.s.topology.command("admin.$cmd",e,t,function(e,t){return r.serverConfig&&r.serverConfig.isDestroyed()?o(new v("topology was destroyed")):e?o(e):void n(t.result)})})},A.classMethod("executeDbAdminCommand",{callback:!0,promise:!0}),N.prototype.createIndex=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,2);return r=i.pop(),"function"!=typeof r&&i.push(r),n=i.length?i.shift()||{}:{},n="function"==typeof r?n:r,n=null==n?{}:n,n=a(n),n.readPreference=h.PRIMARY,"function"==typeof r?j(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){j(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var j=function(e,t,n,r,o){var i=Z({},e,r);if(i.writeConcern&&"function"!=typeof o)throw v.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});return e.serverConfig&&e.serverConfig.isDestroyed()?o(new v("topology was destroyed")):void K(e,t,n,r,function(s,a){if(null==s)return f(o,s,a);if(67===s.code||11e3==s.code||85===s.code)return f(o,s,a);var c=G(e,t,n,r);i.checkKeys=!1,e.s.topology.insert(m("%s.%s",e.s.databaseName,N.SYSTEM_INDEX_COLLECTION),c,i,function(e,t){if(null!=o)return e?f(o,e):null==t?f(o,null,null):t.result.writeErrors?f(o,v.create(t.result.writeErrors[0]),null):void f(o,null,c.name)})})};A.classMethod("createIndex",{callback:!0,promise:!0}),N.prototype.ensureIndex=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=n||{},"function"==typeof r?z(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){z(o,e,t,n,function(e,t){return e?i(e):void r(t)})})};var z=function(e,t,n,r,o){var i=Z({},e,r),s=G(e,t,n,r),a=s.name;return e.serverConfig&&e.serverConfig.isDestroyed()?o(new v("topology was destroyed")):void e.indexInformation(t,i,function(i,s){if(null!=i&&26!=i.code)return f(o,i,null);if(null!=s&&s[a]){if("function"==typeof o)return f(o,null,a)}else e.createIndex(t,n,r,o)})};A.classMethod("ensureIndex",{callback:!0,promise:!0}),N.prototype.addChild=function(e){return this.s.parentDb?this.s.parentDb.addChild(e):void this.s.children.push(e)},N.prototype.db=function(e,t){t=t||{};var n=O({},this.options,t);if(this.s.dbCache[e]&&n.returnNonCachedInstance!==!0)return this.s.dbCache[e];null!=n.noListener&&0!=n.noListener||(n.parentDb=this),n.promiseLibrary=this.s.promiseLibrary;var r=new N(e,this.s.topology,n);return null!=n.noListener&&0!=n.noListener||this.addChild(r),this.s.dbCache[e]=r,r},A.classMethod("db",{callback:!1,promise:!1,returns:[N]});var U=function(e,t,n,r,o){if("string"==typeof t&&null!=n&&"object"==typeof n&&(r=n,n=null),"function"==typeof r&&(o=r,r={}),null!=r.digestPassword)throw d("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option.");var i=null!=r.customData?r.customData:{},s=Array.isArray(r.roles)?r.roles:[],a="number"==typeof r.maxTimeMS?r.maxTimeMS:null;0==s.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6");var c={writeCommand:!0};r.dbName&&(c.dbName=r.dbName),null!=a&&(c.maxTimeMS=a),"admin"!=e.databaseName.toLowerCase()&&"admin"!=r.dbName||Array.isArray(r.roles)?Array.isArray(r.roles)||(s=["dbOwner"]):s=["root"];var u={createUser:t,customData:i,roles:s,digestPassword:!1};u=Z(u,e,r);var l=_.createHash("md5");l.update(t+":mongo:"+n);var p=l.digest("hex");"string"==typeof n&&(u.pwd=p),c.readPreference=h.primary,e.command(u,c,function(e,n){return e&&0==e.ok&&void 0==e.code?f(o,{code:-5e3},null):e?f(o,e,null):void f(o,n.ok?null:d(n),n.ok?[{user:t,pwd:""}]:null)})},q=function(e,t,n,r,o){return e.serverConfig&&e.serverConfig.isDestroyed()?o(new v("topology was destroyed")):void U(e,t,n,r,function(i,s){if(i&&i.code==-5e3){var c=Z(a(r),e,r),u=_.createHash("md5");u.update(t+":mongo:"+n);var l=u.digest("hex"),p=r.dbName?e.db(r.dbName):e,d=p.collection(N.SYSTEM_USER_COLLECTION);return void d.count({},function(e,n){return null!=e?f(o,e,null):void d.find({user:t},{dbName:r.dbName}).toArray(function(e){return null!=e?f(o,e,null):(c.upsert=!0,void d.update({user:t},{$set:{user:t,pwd:l}},c,function(e){return 0==n&&e?f(o,null,[{user:t,pwd:l}]):e?f(o,e,null):void f(o,null,[{user:t,pwd:l}])}))})})}return i?f(o,i):void f(o,i,s)})};N.prototype.addUser=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,2);return r=i.pop(),"function"!=typeof r&&i.push(r),n=i.length?i.shift()||{}:{},"function"==typeof r?q(o,e,t,n,r):new this.s.promiseLibrary(function(r,i){q(o,e,t,n,function(e,t){return e?i(e):void r(t)})})},A.classMethod("addUser",{callback:!0,promise:!0});var F=function(e,t,n,r){if("function"==typeof n&&(r=n,n={}),e.serverConfig&&e.serverConfig.isDestroyed())return r(new v("topology was destroyed"));var o={writeCommand:!0};n.dbName&&(o.dbName=n.dbName);var i="number"==typeof n.maxTimeMS?n.maxTimeMS:null;null!=i&&(o.maxTimeMS=i);var s={dropUser:t};s=Z(s,e,n),o.readPreference=h.primary,e.command(s,o,function(e,t){return e&&!e.ok&&void 0==e.code?f(r,{code:-5e3}):e?f(r,e,null):void f(r,null,!!t.ok)})},W=function(e,t,n,r){F(e,t,n,function(o,i){if(o&&o.code==-5e3){var s=Z(a(n),e,n),c=n.dbName?e.db(n.dbName):e,u=c.collection(N.SYSTEM_USER_COLLECTION);return void u.findOne({user:t},{},function(e,n){return null==n?f(r,e,!1):void u.remove({user:t},s,function(e){f(r,e,!0)})})}return o?f(r,o):void f(r,o,i)})};A.classMethod("removeUser",{callback:!0,promise:!0}),N.prototype.removeUser=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift()||{}:{},"function"==typeof n?W(r,e,t,n):new this.s.promiseLibrary(function(n,o){W(r,e,t,function(e,t){return e?o(e):void n(t)})})};var V=function(e,t,n,r,o){if(e.serverConfig&&e.serverConfig.isDestroyed())return o(new v("topology was destroyed"));var i=r.dbName?r.dbName:e.databaseName;i=e.authSource?e.authSource:i,i=r.authdb?r.authdb:i,i=r.authSource?r.authSource:i;var s=function(t,n){e.listeners("authenticated").length>0&&e.emit("authenticated",t,n),f(o,t,n)},a=r.authMechanism||"";a=a.toUpperCase(),"MONGODB-CR"==a?e.s.topology.auth("mongocr",i,t,n,function(e){return e?f(o,e,!1):void s(null,!0)}):"PLAIN"==a?e.s.topology.auth("plain",i,t,n,function(e){return e?f(o,e,!1):void s(null,!0)}):"MONGODB-X509"==a?e.s.topology.auth("x509",i,t,n,function(e){return e?f(o,e,!1):void s(null,!0)}):"SCRAM-SHA-1"==a?e.s.topology.auth("scram-sha-1",i,t,n,function(e){return e?f(o,e,!1):void s(null,!0)}):"GSSAPI"==a?"win32"==process.platform?e.s.topology.auth("sspi",i,t,n,r,function(e){return e?f(o,e,!1):void s(null,!0)}):e.s.topology.auth("gssapi",i,t,n,r,function(e){return e?f(o,e,!1):void s(null,!0)}):"DEFAULT"==a?e.s.topology.auth("default",i,t,n,function(e){return e?f(o,e,!1):void s(null,!0)}):f(o,v.create({message:m("authentication mechanism %s not supported",r.authMechanism),driver:!0}))};N.prototype.authenticate=function(e,t,n,r){"function"==typeof n&&(r=n,n={});var o=this;if(n=a(n),n.authMechanism){if("GSSAPI"!=n.authMechanism&&"DEFAULT"!=n.authMechanism&&"MONGODB-CR"!=n.authMechanism&&"MONGODB-X509"!=n.authMechanism&&"SCRAM-SHA-1"!=n.authMechanism&&"PLAIN"!=n.authMechanism)return f(r,v.create({message:"only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, SCRAM-SHA-1 or MONGODB-CR is supported by authMechanism",driver:!0}))}else n.authMechanism="DEFAULT";return"function"==typeof r?V(o,e,t,n,function(e,t){return e&&e.message&&e.message.indexOf("saslStart")!=-1&&(e.code=59),e?r(e,t):void r(null,t)}):new this.s.promiseLibrary(function(r,i){V(o,e,t,n,function(e,t){return e&&e.message&&e.message.indexOf("saslStart")!=-1&&(e.code=59),e?i(e):void r(t)})})},A.classMethod("authenticate",{callback:!0,promise:!0}),N.prototype.logout=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),e=e||{};var r=this.s.authSource?this.s.authSource:this.s.databaseName;return r=e.dbName?e.dbName:r,"function"==typeof t?n.s.topology.logout(r,function(e){return e?t(e):void t(null,!0)}):new this.s.promiseLibrary(function(e,t){n.s.topology.logout(r,function(n){return n?t(n):void e(!0)})})},A.classMethod("logout",{callback:!0,promise:!0}),N.prototype.indexInformation=function(e,t,n){var r=this;return"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof n?H(r,e,t,n):new this.s.promiseLibrary(function(n,o){H(r,e,t,function(e,t){return e?o(e):void n(t)})})};var H=function(e,t,n,r){var o=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new v("topology was destroyed"));var i=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];t[r.name]=[];for(var o in r.key)t[r.name].push([o,r.key[o]])}return t};e.collection(t).listIndexes().toArray(function(e,t){return e?r(d(e)):Array.isArray(t)?o?f(r,null,t):void f(r,null,i(t)):f(r,null,[])})};A.classMethod("indexInformation",{callback:!0,promise:!0});var G=function(e,t,n,r){var o=c(n),i=o.fieldHash,s="string"==typeof r.name?r.name:o.name,a={ns:e.databaseName+"."+t,key:i,name:s},u=null!=r&&"object"!=typeof r&&r;r=null==r||"boolean"==typeof r?{}:r;var l=Object.keys(a);for(var f in r)l.indexOf(f)==-1&&(a[f]=r[f]);null==a.unique&&(a.unique=u);for(var p=["w","wtimeout","j","fsync","readPreference"],d=0;d<p.length;d++)delete a[p[d]];return a},K=function(e,t,n,o,i){var s=c(n),a="string"==typeof o.name?o.name:s.name,u=[{name:a,key:s.fieldHash}],l=Object.keys(u[0]);for(var p in o){l.indexOf(p)==-1&&(u[0][p]=o[p]);for(var y=["w","wtimeout","j","fsync","readPreference"],g=0;g<y.length;g++)delete u[0][y[g]]}var b=e.s.topology.capabilities();if(u[0].collation&&b&&!b.commandsTakeCollation){var w=new v(m("server/primary/mongos does not support collation"));return w.code=67,i(w)}var S=Z({createIndexes:t,indexes:u},e,o);r(S,e,o),o.readPreference=h.PRIMARY,e.command(S,o,function(e,t){return e?f(i,e,null):0==t.ok?f(i,d(t),null):void f(i,null,a)})},Y=function(e){if("string"!=typeof e)throw v.create({message:"database name must be a string",driver:!0});if(0===e.length)throw v.create({message:"database name cannot be the empty string",driver:!0});if("$external"!=e)for(var t=[" ",".","$","/","\\"],n=0;n<t.length;n++)if(e.indexOf(t[n])!=-1)throw v.create({message:"database names cannot contain the character '"+t[n]+"'",driver:!0})},Z=function(e,t,n){if(null!=n.w||null!=n.j||null!=n.fsync){var r={};n.w&&(r.w=n.w),n.wtimeout&&(r.wtimeout=n.wtimeout),n.j&&(r.j=n.j),n.fsync&&(r.fsync=n.fsync),e.writeConcern=r}else null==t.writeConcern.w&&null==t.writeConcern.j&&null==t.writeConcern.fsync||(e.writeConcern=t.writeConcern);return e},J=function(e,t,n){var r=function(r){if(n.listeners(t).length>0){n.emit(t,r,e);for(var o=0;o<e.s.children.length;o++)e.s.children[o].emit(t,r,e.s.children[o])}};return r};N.prototype.unref=function(){this.s.topology.unref()},N.SYSTEM_NAMESPACE_COLLECTION="system.namespaces",N.SYSTEM_INDEX_COLLECTION="system.indexes",N.SYSTEM_PROFILE_COLLECTION="system.profile",N.SYSTEM_USER_COLLECTION="system.users",N.SYSTEM_COMMAND_COLLECTION="$cmd",N.SYSTEM_JS_COLLECTION="system.js",e.exports=N},function(e,t,n){function r(e){return this instanceof r?(c.call(this,e),u.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",o)):new r(e)}function o(){this.allowHalfOpen||this._writableState.ended||process.nextTick(this.end.bind(this))}function i(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}e.exports=r;var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},a=n(45);a.inherits=n(42);var c=n(115),u=n(117);a.inherits(r,c),i(s(u.prototype),function(e){r.prototype[e]||(r.prototype[e]=u.prototype[e])})},function(e,t,n){function r(e){return n(o(e))}function o(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./index":20,"./index.js":20,"./package":104,"./package.json":104,"./test/require_optional_tests":118,"./test/require_optional_tests.js":118};r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id=86},function(e,t,n){var r=n(200),o=n(201),i=o;i.v1=r,i.v4=o,e.exports=i},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("url")},function(e,t,n){e.exports={default:n(147),__esModule:!0}},function(e,t,n){var r=n(48),o=n(10)("toStringTag"),i="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),o))?n:i?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){e.exports=n(11).document&&document.documentElement},function(e,t,n){var r=n(48);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";var r=n(96),o=n(71),i=n(168),s=n(25),a=n(50),c=n(41),u=n(156),l=n(73),f=n(164),p=n(10)("iterator"),d=!([].keys&&"next"in[].keys()),h="@@iterator",m="keys",y="values",g=function(){return this};e.exports=function(e,t,n,b,v,w,S){u(n,t,b);var x,k,_,O=function(e){if(!d&&e in N)return N[e];switch(e){case m:return function(){return new n(this,e)};case y:return function(){return new n(this,e)}}return function(){return new n(this,e)}},C=t+" Iterator",E=v==y,I=!1,N=e.prototype,A=N[p]||N[h]||v&&N[v],M=A||O(v),T=v?E?O("entries"):M:void 0,B="Array"==t?N.entries||A:A;if(B&&(_=f(B.call(new e)),_!==Object.prototype&&(l(_,C,!0),r||a(_,p)||s(_,p,g))),E&&A&&A.name!==y&&(I=!0,M=function(){return A.call(this)}),r&&!S||!d&&!I&&N[p]||s(N,p,M),c[t]=M,c[C]=g,v)if(x={values:E?M:O(y),keys:w?M:O(m),entries:T},S)for(k in x)k in N||i(N,k,x[k]);else o(o.P+o.F*(d||I),t,x);return x}},function(e,t){e.exports=!0},function(e,t,n){var r=n(165),o=n(92);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(11),o="__core-js_shared__",i=r[o]||(r[o]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t,n){var r,o,i,s=n(49),a=n(153),c=n(93),u=n(70),l=n(11),f=l.process,p=l.setImmediate,d=l.clearImmediate,h=l.MessageChannel,m=0,y={},g="onreadystatechange",b=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},v=function(e){b.call(e.data)};p&&d||(p=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},d=function(e){delete y[e]},"process"==n(48)(f)?r=function(e){f.nextTick(s(b,e,1))}:h?(o=new h,i=o.port2,o.port1.onmessage=v,r=s(i.postMessage,i,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",v,!1)):r=g in u("script")?function(e){c.appendChild(u("script"))[g]=function(){c.removeChild(this),b.call(e)}}:function(e){setTimeout(s(b,e,1),0)}),e.exports={set:p,clear:d}},function(e,t,n){var r=n(75),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,n){var r=n(69);e.exports=function(e){return Object(r(e))}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports={_args:[[{raw:"require_optional@~1.0.0",scope:null,escapedName:"require_optional",name:"require_optional",rawSpec:"~1.0.0",spec:">=1.0.0 <1.1.0",type:"range"},"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/node_modules/mongodb-core"]],_from:"require_optional@>=1.0.0 <1.1.0",_id:"require_optional@1.0.0",_inCache:!0,_location:"/require_optional",_nodeVersion:"4.2.4",_npmOperationalInternal:{host:"packages-5-east.internal.npmjs.com",tmp:"tmp/require_optional-1.0.0.tgz_1454503936164_0.7571216486394405"},_npmUser:{name:"christkv",email:"christkv@gmail.com"},_npmVersion:"2.14.12",_phantomChildren:{},_requested:{raw:"require_optional@~1.0.0",scope:null,escapedName:"require_optional",name:"require_optional",rawSpec:"~1.0.0",spec:">=1.0.0 <1.1.0",type:"range"},_requiredBy:["/mongodb-core"],_resolved:"https://registry.npmjs.org/require_optional/-/require_optional-1.0.0.tgz",_shasum:"52a86137a849728eb60a55533617f8f914f59abf",_shrinkwrap:null,_spec:"require_optional@~1.0.0",_where:"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/node_modules/mongodb-core",author:{name:"Christian Kvalheim Amor"},bugs:{url:"https://github.com/christkv/require_optional/issues"},dependencies:{"resolve-from":"^2.0.0",semver:"^5.1.0"},description:"Allows you declare optionalPeerDependencies that can be satisfied by the top level module but ignored if they are not.",devDependencies:{bson:"0.4.21",co:"4.6.0","es6-promise":"^3.0.2",mocha:"^2.4.5"},directories:{},dist:{shasum:"52a86137a849728eb60a55533617f8f914f59abf",tarball:"https://registry.npmjs.org/require_optional/-/require_optional-1.0.0.tgz"},gitHead:"8eac964c8e31166a8fb483d0d56025b185cee03f",homepage:"https://github.com/christkv/require_optional",keywords:["optional","require","optionalPeerDependencies"],license:"Apache-2.0",main:"index.js",maintainers:[{name:"christkv",email:"christkv@gmail.com"}],name:"require_optional",optionalDependencies:{},peerOptionalDependencies:{co:">=5.6.0","es6-promise":"^3.0.2","es6-promise2":"^4.0.2",bson:"0.4.21"},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+https://github.com/christkv/require_optional.git"},scripts:{test:"mocha"},version:"1.0.0"}},function(e,t){"use strict";var n=function(e,t,n){this.result=e,this.connection=t,this.message=n};n.prototype.toJSON=function(){return this.result},n.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.exports=n},function(e,t,n){"use strict";function r(e){delete v[e]}function o(e,t){v[e]=t}function i(e,t){for(var n in t)null!=t[n]&&O.indexOf(n)!=-1&&(e[n]=t[n])}var s=n(1).inherits,a=n(9).EventEmitter,c=n(210),u=n(213),l=n(28),f=n(1).format,p=n(7).debugOptions,d=n(5).Response,h=n(4),m=n(15),y=0,g=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","singleBufferSerializtion","ssl","ca","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"],b=!1,v={},w=function(e,t){if(a.call(this),this.options=t||{},this.id=y++,this.logger=m("Connection",t),!t.bson)throw new Error("must pass in valid bson parser");this.bson=t.bson,this.tag=t.tag,this.messageHandler=e,this.maxBsonMessageSize=t.maxBsonMessageSize||67108864,this.logger.isDebug()&&this.logger.debug(f("creating connection %s with options [%s]",this.id,JSON.stringify(p(g,t)))),this.port=t.port||27017,this.host=t.host||"localhost",this.keepAlive="boolean"!=typeof t.keepAlive||t.keepAlive,this.keepAliveInitialDelay=t.keepAliveInitialDelay||0,this.noDelay="boolean"!=typeof t.noDelay||t.noDelay,this.connectionTimeout=t.connectionTimeout||0,this.socketTimeout=t.socketTimeout||0,this.destroyed=!1,this.domainSocket=this.host.indexOf("/")!=-1,this.singleBufferSerializtion="boolean"!=typeof t.singleBufferSerializtion||t.singleBufferSerializtion,this.serializationFunction=this.singleBufferSerializtion?"toBinUnified":"toBin",this.ca=t.ca||null,this.cert=t.cert||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.ssl="boolean"==typeof t.ssl&&t.ssl,this.rejectUnauthorized="boolean"!=typeof t.rejectUnauthorized||t.rejectUnauthorized,this.checkServerIdentity="boolean"!=typeof t.checkServerIdentity&&"function"!=typeof t.checkServerIdentity||t.checkServerIdentity,this.ssl||(this.rejectUnauthorized=!1),this.responseOptions={promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers},this.flushing=!1,this.queue=[],this.connection=null,this.writeStream=null;var n=l.createHash("sha1");n.update(f("%s:%s",this.host,this.port)),this.hashedName=n.digest("hex"),this.workItems=[]};s(w,a),w.prototype.setSocketTimeout=function(e){this.connection&&this.connection.setTimeout(e)},w.prototype.resetSocketTimeout=function(){this.connection&&this.connection.setTimeout(this.socketTimeout)},w.enableConnectionAccounting=function(){b=!0,v={}},w.disableConnectionAccounting=function(){b=!1},w.connections=function(){return v};var S=function(e){return function(t){b&&r(e.id),e.logger.isDebug()&&e.logger.debug(f("connection %s for [%s:%s] errored out with [%s]",e.id,e.host,e.port,JSON.stringify(t))),e.listeners("error").length>0&&e.emit("error",h.create(t),e)}},x=function(e){return function(){b&&r(e.id),e.logger.isDebug()&&e.logger.debug(f("connection %s for [%s:%s] timed out",e.id,e.host,e.port)),e.emit("timeout",h.create(f("connection %s to %s:%s timed out",e.id,e.host,e.port)),e)}},k=function(e){return function(t){b&&r(e.id),e.logger.isDebug()&&e.logger.debug(f("connection %s with for [%s:%s] closed",e.id,e.host,e.port)),t||e.emit("close",h.create(f("connection %s to %s:%s closed",e.id,e.host,e.port)),e)}},_=function(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){var n=e.sizeOfMessage-e.bytesRead;if(n>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=new Buffer(0);else{t.copy(e.buffer,e.bytesRead,0,n),t=t.slice(n);try{var r=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,e.messageHandler(new d(e.bson,r,e.responseOptions),e)}catch(t){var o={err:"socketHandler",trace:t,bin:e.buffer,parseState:{sizeOfMessage:e.sizeOfMessage,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};e.emit("parseError",o,e)}}}else if(null!=e.stubBuffer&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){var i=new Buffer(e.stubBuffer.length+t.length);e.stubBuffer.copy(i,0),t.copy(i,e.stubBuffer.length),t=i,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{var s=new Buffer(e.stubBuffer.length+t.length);e.stubBuffer.copy(s,0),t.copy(s,e.stubBuffer.length),t=new Buffer(0)}else if(t.length>4){var a=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(a<0||a>e.maxBsonMessageSize)return o={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:a,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}},void e.emit("parseError",o,e);if(a>4&&a<e.maxBsonMessageSize&&a>t.length)e.buffer=new Buffer(a),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=a,e.stubBuffer=null,t=new Buffer(0);else if(a>4&&a<e.maxBsonMessageSize&&a==t.length)try{r=t,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=new Buffer(0),e.messageHandler(new d(e.bson,r,e.responseOptions),e)}catch(t){e.emit("parseError",t,e)}else a<=4||a>e.maxBsonMessageSize?(o={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:a,bytesRead:0,buffer:null,stubBuffer:null}},e.emit("parseError",o,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=new Buffer(0)):(r=t.slice(0,a),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(a),e.messageHandler(new d(e.bson,r,e.responseOptions),e))}else e.stubBuffer=new Buffer(t.length),t.copy(e.stubBuffer,0),t=new Buffer(0)}},O=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","secureProtocol","secureContext","session","minDHSize"];w.prototype.connect=function(e){var t=this;if(e=e||{},b&&o(this.id,this),"boolean"==typeof e.promoteLongs&&(t.responseOptions.promoteLongs=e.promoteLongs,t.responseOptions.promoteValues=e.promoteValues,t.responseOptions.promoteBuffers=e.promoteBuffers),t.connection=t.domainSocket?c.createConnection(t.host):c.createConnection(t.port,t.host),t.connection.setKeepAlive(t.keepAlive,t.keepAliveInitialDelay),t.connection.setTimeout(t.connectionTimeout),t.connection.setNoDelay(t.noDelay),t.ssl){var n={socket:t.connection,rejectUnauthorized:t.rejectUnauthorized};i(n,this.options),i(n,e),t.ca&&(n.ca=t.ca),t.cert&&(n.cert=t.cert),t.key&&(n.key=t.key),t.passphrase&&(n.passphrase=t.passphrase),0==t.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof t.checkServerIdentity&&(n.checkServerIdentity=t.checkServerIdentity),null==n.servername&&(n.servername=t.host),t.connection=u.connect(t.port,t.host,n,function(){return t.connection.authorizationError&&t.rejectUnauthorized?t.emit("error",t.connection.authorizationError,t,{ssl:!0}):(t.connection.setTimeout(t.socketTimeout),void t.emit("connect",t))}),t.connection.setTimeout(t.connectionTimeout)}else t.connection.on("connect",function(){
t.connection.setTimeout(t.socketTimeout),t.emit("connect",t)});t.connection.once("error",S(t)),t.connection.once("timeout",x(t)),t.connection.once("close",k(t)),t.connection.on("data",_(t))},w.prototype.unref=function(){if(this.connection)this.connection.unref();else{var e=this;this.once("connect",function(){e.connection.unref()})}},w.prototype.destroy=function(){b&&r(this.id),this.connection&&(this.connection.end(),this.connection.destroy()),this.destroyed=!0},w.prototype.write=function(e){var t;if(this.logger.isDebug())if(Array.isArray(e))for(t=0;t<e.length;t++)this.logger.debug(f("writing buffer [%s] to %s:%s",e[t].toString("hex"),this.host,this.port));else this.logger.debug(f("writing buffer [%s] to %s:%s",e.toString("hex"),this.host,this.port));if(!Array.isArray(e))return this.connection.write(e,"binary");for(t=0;t<e.length;t++)this.connection.write(e[t],"binary")},w.prototype.toString=function(){return""+this.id},w.prototype.toJSON=function(){return{id:this.id,host:this.host,port:this.port}},w.prototype.isConnected=function(){return!this.destroyed&&!this.connection.destroyed&&this.connection.writable},e.exports=w},function(e,t,n){var r=n(3),o=n(192),i=n(112).connect;i.MongoError=r.MongoError,i.Admin=n(108),i.MongoClient=n(112),i.Db=n(84),i.Collection=n(59),i.Server=n(60),i.ReplSet=n(114),i.Mongos=n(113),i.ReadPreference=n(14),i.GridStore=n(111),i.Chunk=n(110),i.Logger=r.Logger,i.Cursor=n(13),i.GridFSBucket=n(194),i.CoreServer=n(3).Server,i.CoreConnection=n(3).Connection,i.Binary=r.BSON.Binary,i.Code=r.BSON.Code,i.Map=r.BSON.Map,i.DBRef=r.BSON.DBRef,i.Double=r.BSON.Double,i.Int32=r.BSON.Int32,i.Long=r.BSON.Long,i.MinKey=r.BSON.MinKey,i.MaxKey=r.BSON.MaxKey,i.ObjectID=r.BSON.ObjectID,i.ObjectId=r.BSON.ObjectID,i.Symbol=r.BSON.Symbol,i.Timestamp=r.BSON.Timestamp,i.Decimal128=r.BSON.Decimal128,i.connect=i,i.instrument=function(e,t){return"function"==typeof e&&(t=e,e={}),new o(r,e,t)},e.exports=i},function(e,t,n){"use strict";var r=n(2).toError,o=n(8),i=n(2).shallowClone,s=function(e,t,n){return this instanceof s?void(this.s={db:e,topology:t,promiseLibrary:n}):new s(e,t)},a=s.define=new o("Admin",s,!1);s.prototype.command=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift():{},"function"==typeof n?this.s.db.executeDbAdminCommand(e,t,function(e,t){return null!=n?n(e,t):null}):new this.s.promiseLibrary(function(n,o){r.s.db.executeDbAdminCommand(e,t,function(e,t){return e?o(e):void n(t)})})},a.classMethod("command",{callback:!0,promise:!0}),s.prototype.buildInfo=function(e){var t=this;return"function"==typeof e?this.serverInfo(e):new this.s.promiseLibrary(function(e,n){t.serverInfo(function(t,r){return t?n(t):void e(r)})})},a.classMethod("buildInfo",{callback:!0,promise:!0}),s.prototype.serverInfo=function(e){var t=this;return"function"==typeof e?this.s.db.executeDbAdminCommand({buildinfo:1},function(t,n){return null!=t?e(t,null):void e(null,n)}):new this.s.promiseLibrary(function(e,n){t.s.db.executeDbAdminCommand({buildinfo:1},function(t,r){return t?n(t):void e(r)})})},a.classMethod("serverInfo",{callback:!0,promise:!0}),s.prototype.serverStatus=function(e){var t=this;return"function"==typeof e?c(t,e):new this.s.promiseLibrary(function(e,n){c(t,function(t,r){return t?n(t):void e(r)})})};var c=function(e,t){e.s.db.executeDbAdminCommand({serverStatus:1},function(e,n){return null!=e||1!==n.ok?e?t(e,!1):t(r(n),!1):void t(null,n)})};a.classMethod("serverStatus",{callback:!0,promise:!0}),s.prototype.profilingLevel=function(e){var t=this;return"function"==typeof e?u(t,e):new this.s.promiseLibrary(function(e,n){u(t,function(t,r){return t?n(t):void e(r)})})};var u=function(e,t){e.s.db.executeDbAdminCommand({profile:-1},function(e,n){if(null==e&&1===n.ok){var r=n.was;return 0==r?t(null,"off"):1==r?t(null,"slow_only"):2==r?t(null,"all"):t(new Error("Error: illegal profiling level value "+r),null)}null!=e?t(e,null):t(new Error("Error with profile command"),null)})};a.classMethod("profilingLevel",{callback:!0,promise:!0}),s.prototype.ping=function(e,t){var n=this,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),"function"!=typeof t&&r.push(t),"function"==typeof t?this.s.db.executeDbAdminCommand({ping:1},t):new this.s.promiseLibrary(function(e,t){n.s.db.executeDbAdminCommand({ping:1},function(n,r){return n?t(n):void e(r)})})},a.classMethod("ping",{callback:!0,promise:!0}),s.prototype.authenticate=function(e,t,n,r){var o=this;return"function"==typeof n&&(r=n,n={}),n=i(n),n.authdb="admin","function"==typeof r?this.s.db.authenticate(e,t,n,r):new this.s.promiseLibrary(function(r,i){o.s.db.authenticate(e,t,n,function(e,t){return e?i(e):void r(t)})})},a.classMethod("authenticate",{callback:!0,promise:!0}),s.prototype.logout=function(e){var t=this;return"function"==typeof e?this.s.db.logout({dbName:"admin"},e):new this.s.promiseLibrary(function(e,n){t.s.db.logout({dbName:"admin"},function(t){return t?n(t):void e(!0)})})},a.classMethod("logout",{callback:!0,promise:!0});var l=function(e,t){return e=i(e),e.w||e.wtimeout||e.j||e.fsync?e:(t.writeConcern&&(e.w&&(e.w=t.writeConcern.w),e.wtimeout&&(e.wtimeout=t.writeConcern.wtimeout),e.j&&(e.j=t.writeConcern.j),e.fsync&&(e.fsync=t.writeConcern.fsync)),e)};s.prototype.addUser=function(e,t,n,r){var o=this,i=Array.prototype.slice.call(arguments,2);return r=i.pop(),"function"!=typeof r&&i.push(r),n=i.length?i.shift():{},n=n||{},n=l(n,o.s.db),n.dbName="admin","function"==typeof r?o.s.db.addUser(e,t,n,r):new this.s.promiseLibrary(function(r,i){o.s.db.addUser(e,t,n,function(e,t){return e?i(e):void r(t)})})},a.classMethod("addUser",{callback:!0,promise:!0}),s.prototype.removeUser=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift():{},t=t||{},t=l(t,r.s.db),t.dbName="admin","function"==typeof n?r.s.db.removeUser(e,t,n):new this.s.promiseLibrary(function(n,o){r.s.db.removeUser(e,t,function(e,t){return e?o(e):void n(t)})})},a.classMethod("removeUser",{callback:!0,promise:!0}),s.prototype.setProfilingLevel=function(e,t){var n=this;return"function"==typeof t?f(n,e,t):new this.s.promiseLibrary(function(t,r){f(n,e,function(e,n){return e?r(e):void t(n)})})};var f=function(e,t,n){var r={},o=0;if("off"==t)o=0;else if("slow_only"==t)o=1;else{if("all"!=t)return n(new Error("Error: illegal profiling level value "+t));o=2}r.profile=o,e.s.db.executeDbAdminCommand(r,function(e,r){return null==e&&1===r.ok?n(null,t):null!=e?n(e,null):n(new Error("Error with profile command"),null)})};a.classMethod("setProfilingLevel",{callback:!0,promise:!0}),s.prototype.profilingInfo=function(e){var t=this;return"function"==typeof e?p(t,e):new this.s.promiseLibrary(function(e,n){p(t,function(t,r){return t?n(t):void e(r)})})};var p=function(e,t){try{e.s.topology.cursor("admin.system.profile",{find:"system.profile",query:{}},{}).toArray(t)}catch(e){return t(e,null)}};a.classMethod("profilingLevel",{callback:!0,promise:!0}),s.prototype.validateCollection=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift():{},t=t||{},"function"==typeof n?d(r,e,t,n):new this.s.promiseLibrary(function(n,o){d(r,e,t,function(e,t){return e?o(e):void n(t)})})};var d=function(e,t,n,r){for(var o={validate:t},i=Object.keys(n),s=0;s<i.length;s++)n.hasOwnProperty(i[s])&&(o[i[s]]=n[i[s]]);e.s.db.command(o,function(e,n){return null!=e?r(e,null):0===n.ok?r(new Error("Error with validate command"),null):null!=n.result&&n.result.constructor!=String?r(new Error("Error with validation data"),null):null!=n.result&&null!=n.result.match(/exception|corrupt/)?r(new Error("Error: invalid collection "+t),null):null==n.valid||n.valid?r(null,n):r(new Error("Error: invalid collection "+t),null)})};a.classMethod("validateCollection",{callback:!0,promise:!0}),s.prototype.listDatabases=function(e){var t=this;return"function"==typeof e?t.s.db.executeDbAdminCommand({listDatabases:1},{},e):new this.s.promiseLibrary(function(e,n){t.s.db.executeDbAdminCommand({listDatabases:1},{},function(t,r){return t?n(t):void e(r)})})},a.classMethod("listDatabases",{callback:!0,promise:!0}),s.prototype.replSetGetStatus=function(e){var t=this;return"function"==typeof e?h(t,e):new this.s.promiseLibrary(function(e,n){h(t,function(t,r){return t?n(t):void e(r)})})};var h=function(e,t){e.s.db.executeDbAdminCommand({replSetGetStatus:1},function(e,n){return null==e&&1===n.ok?t(null,n):e?t(e,!1):void t(r(n),!1)})};a.classMethod("replSetGetStatus",{callback:!0,promise:!0}),e.exports=s},function(e,t,n){"use strict";var r=n(3).BSON.Long,o=(n(3).BSON.Timestamp,8),i=22,s=64,a=65,c=1,u=2,l=3,f=function(e,t,n){var r={};return t.writeConcern&&null!=t.writeConcern.w&&(r.w=t.writeConcern.w),t.writeConcern&&null!=t.writeConcern.j&&(r.j=t.writeConcern.j),t.writeConcern&&null!=t.writeConcern.fsync&&(r.fsync=t.writeConcern.fsync),t.writeConcern&&null!=t.writeConcern.wtimeout&&(r.wtimeout=t.writeConcern.wtimeout),n&&null!=n.w&&(r.w=n.w),n&&null!=n.wtimeout&&(r.wtimeout=n.wtimeout),n&&null!=n.j&&(r.j=n.j),n&&null!=n.fsync&&(r.fsync=n.fsync),r},p=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},d=function(e,t){this.originalZeroIndex=t,this.currentIndex=0,this.originalIndexes=[],this.batchType=e,this.operations=[],this.size=0,this.sizeBytes=0},h=function(e,t,n){this.batchType=e,this.index=n,this.operation=t},m=function(e){p(this,"ok",e.ok),p(this,"nInserted",e.nInserted),p(this,"nUpserted",e.nUpserted),p(this,"nMatched",e.nMatched),p(this,"nModified",e.nModified),p(this,"nRemoved",e.nRemoved),this.getInsertedIds=function(){return e.insertedIds},this.getUpsertedIds=function(){return e.upserted},this.getUpsertedIdAt=function(t){return e.upserted[t]},this.getRawResponse=function(){return e},this.hasWriteErrors=function(){return e.writeErrors.length>0},this.getWriteErrorCount=function(){return e.writeErrors.length},this.getWriteErrorAt=function(t){return t<e.writeErrors.length?e.writeErrors[t]:null},this.getWriteErrors=function(){return e.writeErrors},this.getLastOp=function(){return e.lastOp},this.getWriteConcernError=function(){if(0==e.writeConcernErrors.length)return null;if(1==e.writeConcernErrors.length)return e.writeConcernErrors[0];for(var t="",n=0;n<e.writeConcernErrors.length;n++){var r=e.writeConcernErrors[n];t+=r.errmsg,0==n&&(t+=" and ")}return new y({errmsg:t,code:s})},this.toJSON=function(){return e},this.toString=function(){return"BulkWriteResult("+this.toJSON(e)+")"},this.isOk=function(){return 1==e.ok}},y=function(e){return this instanceof y?(p(this,"code",e.code),p(this,"errmsg",e.errmsg),this.toJSON=function(){return{code:e.code,errmsg:e.errmsg}},void(this.toString=function(){return"WriteConcernError("+e.errmsg+")"})):new y(e)},g=function(e){return this instanceof g?(p(this,"code",e.code),p(this,"index",e.index),p(this,"errmsg",e.errmsg),this.getOperation=function(){return e.op},this.toJSON=function(){return{code:e.code,index:e.index,errmsg:e.errmsg,op:e.op}},void(this.toString=function(){return"WriteError("+JSON.stringify(this.toJSON())+")"})):new g(e)},b=function(e,t,n,o,i){if(o)i=o;else if(i&&i.result)i=i.result;else if(null==i)return;if(0==i.ok&&1==n.ok){n.ok=0;var s={index:0,code:i.code||0,errmsg:i.message,op:t.operations[0]};return void n.writeErrors.push(new g(s))}if(0!=i.ok||0!=n.ok){if(i.opTime||i.lastOp){var a=i.lastOp||i.opTime,f=null,p=null;if(a&&"Timestamp"==a._bsontype)null==n.lastOp?n.lastOp=a:a.greaterThan(n.lastOp)&&(n.lastOp=a);else{n.lastOp&&(f="number"==typeof n.lastOp.ts?r.fromNumber(n.lastOp.ts):n.lastOp.ts,p="number"==typeof n.lastOp.t?r.fromNumber(n.lastOp.t):n.lastOp.t);var d="number"==typeof a.ts?r.fromNumber(a.ts):a.ts,h="number"==typeof a.t?r.fromNumber(a.t):a.t;null==n.lastOp?n.lastOp=a:d.greaterThan(f)?n.lastOp=a:d.equals(f)&&h.greaterThan(p)&&(n.lastOp=a)}}t.batchType==c&&i.n&&(n.nInserted=n.nInserted+i.n),t.batchType==l&&i.n&&(n.nRemoved=n.nRemoved+i.n);var m=0;if(Array.isArray(i.upserted)){m=i.upserted.length;for(var b=0;b<i.upserted.length;b++)n.upserted.push({index:i.upserted[b].index+t.originalZeroIndex,_id:i.upserted[b]._id})}else i.upserted&&(m=1,n.upserted.push({index:t.originalZeroIndex,_id:i.upserted}));if(t.batchType==u&&i.n){var v=i.nModified;n.nUpserted=n.nUpserted+m,n.nMatched=n.nMatched+(i.n-m),"number"==typeof v?n.nModified=n.nModified+v:n.nModified=null}if(Array.isArray(i.writeErrors))for(b=0;b<i.writeErrors.length;b++)s={index:t.originalZeroIndex+i.writeErrors[b].index,code:i.writeErrors[b].code,errmsg:i.writeErrors[b].errmsg,op:t.operations[i.writeErrors[b].index]},n.writeErrors.push(new g(s));i.writeConcernError&&n.writeConcernErrors.push(new y(i.writeConcernError))}},v=function(e){for(var t={},n=Object.keys(e),r=0;r<n.length;r++)t[n[r]]=e[n[r]];return t};t.BulkWriteResult=m,t.WriteError=g,t.Batch=d,t.LegacyOp=h,t.mergeBatchResults=b,t.cloneOptions=v,t.writeConcern=f,t.INVALID_BSON_ERROR=i,t.WRITE_CONCERN_ERROR=s,t.MULTIPLE_ERROR=a,t.UNKNOWN_ERROR=o,t.INSERT=c,t.UPDATE=u,t.REMOVE=l},function(e,t,n){"use strict";var r=n(3).BSON.Binary,o=n(3).BSON.ObjectID,i=function(e,t,n){if(!(this instanceof i))return new i(e,t);this.file=e;var s=null==t?{}:t;if(this.writeConcern=n||{w:1},this.objectId=null==s._id?new o:s._id,this.chunkNumber=null==s.n?0:s.n,this.data=new r,"string"==typeof s.data){var a=new Buffer(s.data.length);a.write(s.data,0,s.data.length,"binary"),this.data=new r(a)}else if(Array.isArray(s.data)){a=new Buffer(s.data.length);var c=s.data.join("");a.write(c,0,c.length,"binary"),this.data=new r(a)}else if(s.data&&"Binary"===s.data._bsontype)this.data=s.data;else if(!Buffer.isBuffer(s.data)&&null!=s.data)throw Error("Illegal chunk format");this.internalPosition=0};i.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),null!=t?t(null,this):this},i.prototype.read=function(e){if(e=null==e||0==e?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}return""},i.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return null!=this.data.buffer?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=new Buffer(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}return null},i.prototype.eof=function(){return this.internalPosition==this.length()},i.prototype.getc=function(){return this.read(1)},i.prototype.rewind=function(){this.internalPosition=0,this.data=new r},i.prototype.save=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),n.file.chunkCollection(function(r,o){if(r)return t(r);var i={upsert:!0};for(var s in e)i[s]=e[s];for(s in n.writeConcern)i[s]=n.writeConcern[s];n.data.length()>0?n.buildMongoObject(function(e){var r={forceServerObjectId:!0};for(var s in n.writeConcern)r[s]=n.writeConcern[s];o.replaceOne({_id:n.objectId},e,i,function(e){t(e,n)})}):t(null,n)})},i.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(t._id=this.objectId),e(t)},i.prototype.length=function(){return this.data.length()},Object.defineProperty(i.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}}),i.DEFAULT_CHUNK_SIZE=261120,e.exports=i},function(e,t,n){"use strict";var r=n(110),o=n(3).BSON.ObjectID,i=n(14),s=n(44).Buffer,a=n(59),c=n(122),u=n(1).format,l=n(1),f=n(8),p=n(3).MongoError,d=l.inherits,h=n(16).Duplex||n(61).Duplex,m=n(2).shallowClone,y=0,g=1,b=function e(t,s,a,c,u){if(!(this instanceof e))return new e(t,s,a,c,u);this.db=t,"undefined"==typeof u&&(u={}),"undefined"==typeof c?(c=a,a=void 0):"object"==typeof c&&(u=c,c=a,a=void 0),s&&"ObjectID"==s._bsontype?(this.referenceBy=g,this.fileId=s,this.filename=a):"undefined"==typeof a?(this.referenceBy=y,this.filename=s,null!=c.indexOf("w")&&(this.fileId=new o)):(this.referenceBy=g,this.fileId=s,this.filename=a),this.mode=null==c?"r":c,this.options=u||{},this.isOpen=!1,this.root=null==this.options.root?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||i.PRIMARY,this.writeConcern=F(t,this.options),this.internalChunkSize=null==this.options.chunkSize?r.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var l=this.options.promiseLibrary;l||(l="function"==typeof global.Promise?global.Promise:n(6).Promise),this.promiseLibrary=l,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(e){"w"!=this.mode[0]||0!=this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=e}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})},v=b.define=new f("Gridstore",b,!0);b.prototype.open=function(e){var t=this;if("w"!=this.mode&&"w+"!=this.mode&&"r"!=this.mode)throw p.create({message:"Illegal mode "+this.mode,driver:!0});return"function"==typeof e?w(t,e):new t.promiseLibrary(function(e,n){w(t,function(t,r){return t?n(t):void e(r)})})};var w=function(e,t){var n=F(e.db,e.options);if("w"==e.mode||"w+"==e.mode){var r=e.collection();r.ensureIndex([["filename",1]],n,function(){var r=e.chunkCollection(),o=m(n);o.unique=!0,r.ensureIndex([["files_id",1],["n",1]],o,function(){N(e,n,function(n,r){return n?t(n):(e.isOpen=!0,void t(n,r))})})})}else N(e,n,function(n,r){return n?t(n):(e.isOpen=!0,void t(n,r))})};v.classMethod("open",{callback:!0,promise:!0}),b.prototype.eof=function(){return this.position==this.length},v.classMethod("eof",{callback:!1,promise:!1,returns:[Boolean]}),b.prototype.getc=function(e){var t=this;return"function"==typeof e?S(t,e):new t.promiseLibrary(function(e,n){S(t,function(t,r){return t?n(t):void e(r)})})};var S=function(e,t){e.eof()?t(null,null):e.currentChunk.eof()?T(e,e.currentChunk.chunkNumber+1,function(n,r){e.currentChunk=r,e.position=e.position+1,t(n,e.currentChunk.getc())}):(e.position=e.position+1,t(null,e.currentChunk.getc()))};v.classMethod("getc",{callback:!0,promise:!0}),b.prototype.puts=function(e,t){var n=this,r=null==e.match(/\n$/)?e+"\n":e;return"function"==typeof t?this.write(r,t):new n.promiseLibrary(function(e,t){n.write(r,function(n,r){return n?t(n):void e(r)})})},v.classMethod("puts",{callback:!0,promise:!0}),b.prototype.stream=function(){return new W(this)},v.classMethod("stream",{callback:!1,promise:!1,returns:[W]}),b.prototype.write=function(e,t,n){var r=this;return"function"==typeof n?U(this,e,t,n):new r.promiseLibrary(function(n,o){U(r,e,t,function(e,t){return e?o(e):void n(t)})})},v.classMethod("write",{callback:!0,promise:!0}),b.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},v.classMethod("destroy",{callback:!1,promise:!1}),b.prototype.writeFile=function(e,t){var n=this;return"function"==typeof t?x(n,e,t):new n.promiseLibrary(function(t,r){x(n,e,function(e,n){return e?r(e):void t(n)})})};var x=function(e,t,n){return"string"==typeof t?void c.open(t,"r",function(t,r){return t?n(t):void e.writeFile(r,n)}):void e.open(function(e,o){return e?n(e,o):void c.fstat(t,function(e,i){if(e)return n(e,o);var s=0,a=0,u=function(){c.read(t,o.chunkSize,s,"binary",function(e,l,f){if(e)return n(e,o);s+=f;var p=new r(o,{n:a++},o.writeConcern);p.write(l,function(e,r){return e?n(e,o):void r.save({},function(e){return e?n(e,o):(o.position=o.position+l.length,o.currentChunk=r,s>=i.size?(c.close(t),void o.close(function(e){return e?n(e,o):n(null,o)})):process.nextTick(u))})})})};process.nextTick(u)})})};v.classMethod("writeFile",{callback:!0,promise:!0}),b.prototype.close=function(e){var t=this;return"function"==typeof e?k(t,e):new t.promiseLibrary(function(e,n){k(t,function(t,r){return t?n(t):void e(r)})})};var k=function(e,t){if("w"==e.mode[0]){var n=e.writeConcern;null!=e.currentChunk&&e.currentChunk.position>0?e.currentChunk.save({},function(r){return r&&"function"==typeof t?t(r):void e.collection(function(r,o){return r&&"function"==typeof t?t(r):void(null!=e.uploadDate?M(e,function(e,r){if(e){if("function"==typeof t)return t(e);throw e}o.save(r,n,function(e){"function"==typeof t&&t(e,r)})}):(e.uploadDate=new Date,M(e,function(e,r){if(e){if("function"==typeof t)return t(e);throw e}o.save(r,n,function(e){"function"==typeof t&&t(e,r)})})))})}):e.collection(function(r,o){return r&&"function"==typeof t?t(r):(e.uploadDate=new Date,void M(e,function(e,r){if(e){if("function"==typeof t)return t(e);throw e}o.save(r,n,function(e){"function"==typeof t&&t(e,r)})}))})}else"r"==e.mode[0]?"function"==typeof t&&t(null,null):"function"==typeof t&&t(p.create({message:u("Illegal mode %s",e.mode),driver:!0}))};v.classMethod("close",{callback:!0,promise:!0}),b.prototype.chunkCollection=function(e){return"function"==typeof e?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")},v.classMethod("chunkCollection",{callback:!0,promise:!1,returns:[a]}),b.prototype.unlink=function(e){var t=this;return"function"==typeof e?_(t,e):new t.promiseLibrary(function(e,n){_(t,function(t,r){return t?n(t):void e(r)})})};var _=function(e,t){D(e,function(n){return null!==n?(n.message="at deleteChunks: "+n.message,t(n)):void e.collection(function(n,r){return null!==n?(n.message="at collection: "+n.message,t(n)):void r.remove({_id:e.fileId},e.writeConcern,function(n){t(n,e)})})})};v.classMethod("unlink",{callback:!0,promise:!0}),b.prototype.collection=function(e){return"function"==typeof e&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")},v.classMethod("collection",{callback:!0,promise:!1,returns:[a]}),b.prototype.readlines=function(e,t){var n=this,r=Array.prototype.slice.call(arguments,0);return t=r.pop(),"function"!=typeof t&&r.push(t),e=r.length?r.shift():"\n",e=e||"\n","function"==typeof t?O(n,e,t):new n.promiseLibrary(function(t,r){O(n,e,function(e,n){return e?r(e):void t(n)})})};var O=function(e,t,n){e.read(function(e,r){if(e)return n(e);var o=r.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var i=0;i<o.length;i++)o[i]=o[i]+t;n(null,o)})};v.classMethod("readlines",{callback:!0,promise:!0}),b.prototype.rewind=function(e){var t=this;return"function"==typeof e?C(t,e):new t.promiseLibrary(function(e,n){C(t,function(t,r){return t?n(t):void e(r)})})};var C=function(e,t){0!=e.currentChunk.chunkNumber?"w"==e.mode[0]?D(e,function(n){return n?t(n):(e.currentChunk=new r(e,{n:0},e.writeConcern),e.position=0,void t(null,e))}):e.currentChunk(0,function(n,r){return n?t(n):(e.currentChunk=r,e.currentChunk.rewind(),e.position=0,void t(null,e))}):(e.currentChunk.rewind(),e.position=0,t(null,e))};v.classMethod("rewind",{callback:!0,promise:!0}),b.prototype.read=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);return n=o.pop(),"function"!=typeof n&&o.push(n),e=o.length?o.shift():null,t=o.length?o.shift():null,"function"==typeof n?E(r,e,t,n):new r.promiseLibrary(function(n,o){E(r,e,t,function(e,t){return e?o(e):void n(t)})})};var E=function(e,t,n,r){var o=null==t?e.length-e.position:t,i=null==n?new s(o):n;if(i._index=null!=n&&null!=n._index?n._index:0,e.currentChunk.length()-e.currentChunk.position+i._index>=o){var a=e.currentChunk.readSlice(o-i._index);return a.copy(i,i._index),e.position=e.position+i.length,0==o&&0==i.length?r(p.create({message:"File does not exist",driver:!0}),null):r(null,i)}a=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position),a.copy(i,i._index),i._index+=a.length,T(e,e.currentChunk.chunkNumber+1,function(n,o){return n?r(n):void(o.length()>0?(e.currentChunk=o,e.read(t,i,r)):i._index>0?r(null,i):r(p.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null))})};v.classMethod("read",{callback:!0,promise:!0}),b.prototype.tell=function(e){var t=this;return"function"==typeof e?e(null,this.position):new t.promiseLibrary(function(e){e(t.position)})},v.classMethod("tell",{callback:!0,promise:!0}),b.prototype.seek=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,1);return n=o.pop(),"function"!=typeof n&&o.push(n),t=o.length?o.shift():null,"function"==typeof n?I(r,e,t,n):new r.promiseLibrary(function(n,o){I(r,e,t,function(e,t){return e?o(e):void n(t)})})};var I=function(e,t,n,r){if("r"!=e.mode)return r(p.create({message:"seek is only supported for mode r",driver:!0}));var o=null==n?b.IO_SEEK_SET:n,i=t,s=0;s=o==b.IO_SEEK_CUR?e.position+i:o==b.IO_SEEK_END?e.length+i:i;var a=Math.floor(s/e.chunkSize),c=function(){T(e,a,function(t,n){return t?r(t,null):null==n?r(new Error("no chunk found")):(e.currentChunk=n,e.position=s,e.currentChunk.position=e.position%e.chunkSize,void r(t,e))})};c()};v.classMethod("seek",{callback:!0,promise:!0});var N=function(e,t,n){function i(e){i.err||n(i.err=e)}var s=e.collection(),a=e.referenceBy==g?{_id:e.fileId}:{filename:e.filename};a=null==e.fileId&&null==e.filename?null:a,t.readPreference=e.readPreference,null!=a?s.findOne(a,t,function(s,a){if(s)return i(s);if(null!=a)e.fileId=a._id,e.filename="r"==e.mode||void 0==e.filename?a.filename:e.filename,e.contentType=a.contentType,e.internalChunkSize=a.chunkSize,e.uploadDate=a.uploadDate,e.aliases=a.aliases,e.length=a.length,e.metadata=a.metadata,e.internalMd5=a.md5;else{if("r"==e.mode){e.length=0;var c="ObjectID"==e.fileId._bsontype?e.fileId.toHexString():e.fileId;return i(p.create({message:u("file with id %s not opened for writing",e.referenceBy==g?c:e.filename),driver:!0}),e)}e.fileId=null==e.fileId?new o:e.fileId,e.contentType=b.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0}"r"==e.mode?T(e,0,t,function(t,r){return t?i(t):(e.currentChunk=r,e.position=0,void n(null,e))}):"w"==e.mode&&a?D(e,t,function(t){return t?i(t):(e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,void n(null,e))}):"w"==e.mode?(e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)):"w+"==e.mode&&T(e,B(e),t,function(t,o){return t?i(t):(e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,void n(null,e))})}):(e.fileId=null==e.fileId?new o:e.fileId,e.contentType=b.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?r.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,"w"==e.mode?D(e,t,function(t){return t?i(t):(e.currentChunk=new r(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,void n(null,e))}):"w+"==e.mode&&T(e,B(e),t,function(t,o){return t?i(t):(e.currentChunk=null==o?new r(e,{n:0},e.writeConcern):o,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,void n(null,e))}))},A=function(e,t,n,o){"function"==typeof n&&(o=n,n=null);var i="boolean"==typeof n&&n;if("w"!=e.mode)o(p.create({message:u("file with id %s not opened for writing",e.referenceBy==g?e.referenceBy:e.filename),driver:!0}),null);else{if(!(e.currentChunk.position+t.length>=e.chunkSize))return e.position=e.position+t.length,e.currentChunk.write(t),i?e.close(function(t){o(t,e)}):o(null,e);for(var s=e.currentChunk.chunkNumber,a=e.chunkSize-e.currentChunk.position,c=t.slice(0,a),l=t.slice(a),f=[e.currentChunk.write(c)];l.length>=e.chunkSize;){var d=new r(e,{n:s+1},e.writeConcern);c=l.slice(0,e.chunkSize),l=l.slice(e.chunkSize),s+=1,d.write(c),f.push(d)}e.currentChunk=new r(e,{n:s+1},e.writeConcern),l.length>0&&e.currentChunk.write(l),e.position=e.position+t.length;for(var h=f.length,m=0;m<f.length;m++)f[m].save({},function(t){return t?o(t):(h-=1,h<=0?i?e.close(function(t){o(t,e)}):o(null,e):void 0)})}},M=function(e,t){var n={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},r={filemd5:e.fileId,root:e.root};e.db.command(r,function(e,r){return e?t(e):(n.md5=r.md5,void t(null,n))})},T=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=n||e.writeConcern,n.readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},n,function(t,n){if(t)return o(t);var i=null==n?{}:n;o(null,new r(e,i,e.writeConcern))})},B=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},D=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||e.writeConcern,null!=e.fileId?e.chunkCollection().remove({files_id:e.fileId},t,function(e){return e?n(e,!1):void n(null,!0)}):n(null,!0)};b.DEFAULT_ROOT_COLLECTION="fs",b.DEFAULT_CONTENT_TYPE="binary/octet-stream",b.IO_SEEK_SET=0,b.IO_SEEK_CUR=1,b.IO_SEEK_END=2,b.exist=function(e,t,r,o,i){var s=Array.prototype.slice.call(arguments,2);i=s.pop(),"function"!=typeof i&&s.push(i),r=s.length?s.shift():null,o=s.length?s.shift():{},o=o||{};var a=o.promiseLibrary;return a||(a="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"==typeof i?R(e,t,r,o,i):new a(function(n,i){R(e,t,r,o,function(e,t){return e?i(e):void n(t)})})};var R=function(e,t,n,r,o){var s=r.readPreference||i.PRIMARY,a=null!=n?n:b.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",function(e,n){if(e)return o(e);var r="string"==typeof t||"[object RegExp]"==Object.prototype.toString.call(t)?{filename:t}:{_id:t};null!=t&&"object"==typeof t&&"[object RegExp]"!=Object.prototype.toString.call(t)&&(r=t),n.findOne(r,{readPreference:s},function(e,t){return e?o(e):void o(null,null!=t)})})};v.staticMethod("exist",{callback:!0,promise:!0}),b.list=function(e,t,r,o){var i=Array.prototype.slice.call(arguments,1);o=i.pop(),"function"!=typeof o&&i.push(o),t=i.length?i.shift():null,r=i.length?i.shift():{},r=r||{};var s=r.promiseLibrary;return s||(s="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"==typeof o?P(e,t,r,o):new s(function(n,o){P(e,t,r,function(e,t){return e?o(e):void n(t)})})};var P=function(e,t,n,r){null!=t&&"object"==typeof t&&(n=t,t=null);var o=n.readPreference||i.PRIMARY,s=null!=n.id&&n.id,a=null!=t?t:b.DEFAULT_ROOT_COLLECTION,c=[];e.collection(a+".files",function(e,t){return e?r(e):void t.find({},{readPreference:o},function(e,t){return e?r(e):void t.each(function(e,t){null!=t?c.push(s?t._id:t.filename):r(e,c)})})})};v.staticMethod("list",{callback:!0,promise:!0}),b.read=function(e,t,r,o,i,s){var a=Array.prototype.slice.call(arguments,2);s=a.pop(),"function"!=typeof s&&a.push(s),r=a.length?a.shift():null,o=a.length?a.shift():null,i=a.length?a.shift():null,i=i||{};var c=i?i.promiseLibrary:null;return c||(c="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"==typeof s?L(e,t,r,o,i,s):new c(function(n,s){L(e,t,r,o,i,function(e,t){
return e?s(e):void n(t)})})};var L=function(e,t,n,r,o,i){new b(e,t,"r",o).open(function(e,t){return e?i(e):r&&r>=t.length?i("offset larger than size of file",null):n&&n>t.length?i("length is larger than the size of the file",null):r&&n&&r+n>t.length?i("offset and length is larger than the size of the file",null):void(null!=r?t.seek(r,function(e,t){return e?i(e):void t.read(n,i)}):t.read(n,i))})};v.staticMethod("read",{callback:!0,promise:!0}),b.readlines=function(e,t,r,o,i){var s=Array.prototype.slice.call(arguments,2);i=s.pop(),"function"!=typeof i&&s.push(i),r=s.length?s.shift():null,o=s.length?s.shift():null,o=o||{};var a=o?o.promiseLibrary:null;return a||(a="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"==typeof i?j(e,t,r,o,i):new a(function(n,i){j(e,t,r,o,function(e,t){return e?i(e):void n(t)})})};var j=function(e,t,n,r,o){var i=null==n?"\n":n;new b(e,t,"r",r).open(function(e,t){return e?o(e):void t.readlines(i,o)})};v.staticMethod("readlines",{callback:!0,promise:!0}),b.unlink=function(e,t,r,o){var i=this,s=Array.prototype.slice.call(arguments,2);o=s.pop(),"function"!=typeof o&&s.push(o),r=s.length?s.shift():{},r=r||{};var a=r.promiseLibrary;return a||(a="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"==typeof o?z(i,e,t,r,o):new a(function(n,o){z(i,e,t,r,function(e,t){return e?o(e):void n(t)})})};var z=function(e,t,n,r,o){var i=F(t,r);if(n.constructor==Array)for(var s=0,a=0;a<n.length;a++)++s,b.unlink(t,n[a],r,function(){0==--s&&o(null,e)});else new b(t,n,"w",r).open(function(t,n){return t?o(t):void D(n,function(t){return t?o(t):void n.collection(function(t,r){return t?o(t):void r.remove({_id:n.fileId},i,function(t){o(t,e)})})})})};v.staticMethod("unlink",{callback:!0,promise:!0});var U=function(e,t,n,r){return s.isBuffer(t)?A(e,t,n,r):A(e,new s(t,"binary"),n,r)},q=function(e){var t={};return null!=e.w&&(t.w=e.w),1==e.journal&&(t.j=e.journal),1==e.j&&(t.j=e.j),1==e.fsync&&(t.fsync=e.fsync),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),t},F=function(e,t){var n={w:1};if(t=t||{},null!=t.w||"boolean"==typeof t.j||"boolean"==typeof t.journal||"boolean"==typeof t.fsync?n=q(t):null!=t.safe&&"object"==typeof t.safe?n=q(t.safe):"boolean"==typeof t.safe?n={w:t.safe?1:0}:null!=e.options.w||"boolean"==typeof e.options.j||"boolean"==typeof e.options.journal||"boolean"==typeof e.options.fsync?n=q(e.options):!e.safe||null==e.safe.w&&"boolean"!=typeof e.safe.j&&"boolean"!=typeof e.safe.journal&&"boolean"!=typeof e.safe.fsync?"boolean"==typeof e.safe&&(n={w:e.safe?1:0}):n=q(e.safe),n.w<1&&(1==n.journal||1==n.j||1==n.fsync))throw p.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},W=function(e){h.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};d(W,h),W.prototype._pipe=W.prototype.pipe,W.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open(function(n){return n?t.emit("error",n):(t.totalBytesToRead=t.gs.length-t.gs.position,void t._pipe.apply(t,[e]))}),e},W.prototype._read=function(){var e=this,t=function(){e.gs.read(n,function(t,n){return t&&!e.endCalled?e.emit("error",t):e.endCalled||null==n?e.push(null):(n.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-n.length,e.push(n)):n.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-n._index,e.push(n.slice(0,n._index))),void(e.totalBytesToRead<=0&&(e.endCalled=!0)))})},n=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open(function(n){return e.totalBytesToRead=e.gs.length-e.gs.position,n?e.emit("error",n):void t()})},W.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},W.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",p.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,function(){t.emit("drain")}),!0):(t.gs.open(function(){t.gs.isOpen=!0,t.gs.write(e,function(){process.nextTick(function(){t.emit("drain")})})}),!1)},W.prototype.end=function(e,t,n){var r=this,o=Array.prototype.slice.call(arguments,0);n=o.pop(),"function"!=typeof n&&o.push(n),e=o.length?o.shift():null,t=o.length?o.shift():null,r.endCalled=!0,e&&r.gs.write(e,function(){r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})}),r.gs.close(function(){"function"==typeof n&&n(),r.emit("end")})},e.exports=b},function(e,t,n){"use strict";function r(){this.connect=r.connect}function o(e){return"string"!=typeof e.readPreference&&"string"!=typeof e.read_preference||(e.readPreference=new h(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),null==e.socketTimeoutMS&&(e.socketTimeoutMS=3e4),null==e.connectTimeoutMS&&(e.connectTimeoutMS=3e4),e.servers.map(function(t){return t.domain_socket?new l(t.domain_socket,27017,e):new l(t.host,t.port,e)})}function i(e,t){var n=o(e);new g(e.dbName,new p(n,e),e).open(t)}function s(e,t){var n=o(e);new g(e.dbName,new f(n,e),e).open(t)}function a(e,t){var n=o(e);new g(e.dbName,n[0],e).open(function(n,r){if(n)return t(n);var o=r.serverConfig.lastIsMaster();return o&&"isdbgrid"==o.msg?(r.close(),s(e,t)):void t(n,r)})}function c(e,t){return function(n,r){if(n)return process.nextTick(function(){try{t(n,null)}catch(e){throw r&&r.close(),e}});if(!e.auth)return process.nextTick(function(){try{t(n,r)}catch(e){throw r&&r.close(),e}});var o=r;e.authSource&&(o=r.db(e.authSource)),o.authenticate(e.user,e.password,e,function(n,o){o?process.nextTick(function(){try{t(null,r)}catch(e){throw r&&r.close(),e}}):(r&&r.close(),process.nextTick(function(){try{t(n?n:new Error("Could not authenticate user "+e.auth[0]),null)}catch(e){throw r&&r.close(),e}}))})}}var u=n(196),l=n(60),f=n(113),p=n(114),d=n(8),h=n(14),m=n(3).Logger,y=n(3).MongoError,g=n(84),b=n(1).format,v=n(2).shallowClone,w=r.define=new d("MongoClient",r,!1);r.connect=function(e,t,r){var o=Array.prototype.slice.call(arguments,1);r="function"==typeof o[o.length-1]?o.pop():null,t=o.length?o.shift():null,t=t||{};var i=t.promiseLibrary;return i||(i="function"==typeof global.Promise?global.Promise:n(6).Promise),"function"!=typeof r?new i(function(n,r){k(e,t,function(e,t){return e?r(e):void n(t)})}):void k(e,t,r)},w.staticMethod("connect",{callback:!0,promise:!0});var S=function(e,t,n){for(var r in t)t[r]&&"object"==typeof t[r]&&n?e=S(e,t[r],n):e[r]=t[r];return e},x=function(e,t){var n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],r=[];for(var o in t)r.indexOf(o.toLowerCase())!=-1?e[o]=t[o]:n.indexOf(o.toLowerCase())!=-1?e=S(e,t[o],!1):!t[o]||"object"!=typeof t[o]||Buffer.isBuffer(t[o])||Array.isArray(t[o])?e[o]=t[o]:e=S(e,t[o],!0);return e},k=function(e,t,n){function r(e,t){return e&&"no mongos proxies found in seed list"==e.message?(o.isWarn()&&o.warn(b("seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name")),n(new y("seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name"))):void n(e,t)}if(t=t||{},t=v(t),null==n)throw new Error("no callback function provided");var o=m("MongoClient",t),l=u(e,t),f=x({},l);if(f=S(f,l,!1),f=x(f,t),null==f.socketTimeoutMS&&(f.socketTimeoutMS=3e4),null==f.connectTimeoutMS&&(f.connectTimeoutMS=3e4),0==l.servers.length)throw new Error("connection string must contain at least one seed host");return f.replicaSet||f.rs_name?i(f,c(f,r)):l.servers.length>1?s(f,c(f,r)):a(f,c(f,r))};e.exports=r},function(e,t,n){"use strict";var r=n(9).EventEmitter,o=n(1).inherits,i=n(1).format,s=n(27).ServerCapabilities,a=n(3).MongoError,c=n(3).Mongos,u=n(13),l=n(26),f=n(19),p=n(8),d=n(60),h=n(27).Store,m=n(2).MAX_JS_INT,y=n(2).translateOptions,g=n(2).filterOptions,b=n(2).mergeOptions,v=n(64),w=n(77).version,S=i("Node.js %s, %s",process.version,v.endianness()),x=v.type(),k=process.platform,_=process.arch,O=v.release(),C=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers"],E=function(e,t){if(!(this instanceof E))return new E(e,t);t=t||{};var n=this;t=g(t,C);for(var o=0;o<e.length;o++)if(!(e[o]instanceof d))throw a.create({message:"all seed list instances must be of the Server type",driver:!0});var i={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:m},s=t.store||new h(n,i);r.call(this);var l=e.map(function(e){return{host:e.host,port:e.port}}),f="boolean"!=typeof t.auto_reconnect||t.auto_reconnect;f="boolean"==typeof t.autoReconnect?t.autoReconnect:f;var p=b({},{disconnectHandler:s,cursorFactory:u,reconnect:f,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5});p=y(p,t);var v=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;p=y(p,v),"number"==typeof p.keepAlive&&(p.keepAliveInitialDelay=p.keepAlive,p.keepAlive=p.keepAlive>0),this.clientInfo={driver:{name:"nodejs",version:w},os:{type:x,name:k,architecture:_,version:O},platform:S},p.clientInfo=this.clientInfo,t.appname&&(p.clientInfo.application={name:t.appname});var I=new c(l,p),N=null;this.s={mongos:I,sCapabilities:N,debug:p.debug,storeOptions:i,clonedOptions:p,store:s,options:t}},I=E.define=new p("Mongos",E,!1);o(E,r),Object.defineProperty(E.prototype,"isMasterDoc",{enumerable:!0,get:function(){return this.s.mongos.lastIsMaster()}}),Object.defineProperty(E.prototype,"parserType",{enumerable:!0,get:function(){return this.s.mongos.parserType}}),Object.defineProperty(E.prototype,"bson",{enumerable:!0,get:function(){return this.s.mongos.s.bson}}),Object.defineProperty(E.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.mongos.s.haInterval}}),E.prototype.connect=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),null==t&&(t={}),"function"!=typeof n&&(n=null),r.s.options=t,r.s.storeOptions.bufferMaxEntries=e.bufferMaxEntries;var o=function(){return function(e){var t=["timeout","error","close"];t.forEach(function(e){r.removeListener(e,o)}),r.s.mongos.removeListener("connect",o);try{n(e)}catch(e){process.nextTick(function(){throw e})}}},i=function(e){return function(t){"error"!=e&&r.emit(e,t)}},s=function(){r.emit("reconnect"),r.s.store.execute()},a=function(e){return function(t,n){r.emit(e,t,n)}},c=function(){["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged"].forEach(function(e){r.s.mongos.removeAllListeners(e)}),r.s.mongos.once("timeout",i("timeout")),r.s.mongos.once("error",i("error")),r.s.mongos.once("close",i("close")),r.s.mongos.on("serverDescriptionChanged",a("serverDescriptionChanged")),r.s.mongos.on("serverHeartbeatStarted",a("serverHeartbeatStarted")),r.s.mongos.on("serverHeartbeatSucceeded",a("serverHeartbeatSucceeded")),r.s.mongos.on("serverHeartbeatFailed",a("serverHeartbeatFailed")),r.s.mongos.on("serverOpening",a("serverOpening")),r.s.mongos.on("serverClosed",a("serverClosed")),r.s.mongos.on("topologyOpening",a("topologyOpening")),r.s.mongos.on("topologyClosed",a("topologyClosed")),r.s.mongos.on("topologyDescriptionChanged",a("topologyDescriptionChanged")),r.s.mongos.on("fullsetup",a("fullsetup")),r.emit("open",null,r);try{n(null,r)}catch(e){process.nextTick(function(){throw e})}};r.s.mongos.once("timeout",o("timeout")),r.s.mongos.once("error",o("error")),r.s.mongos.once("close",o("close")),r.s.mongos.once("connect",c),r.s.mongos.on("joined",a("joined")),r.s.mongos.on("left",a("left")),r.s.mongos.on("reconnect",s),r.s.mongos.connect(t)},E.prototype.capabilities=function(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.mongos.lastIsMaster()?null:(this.s.sCapabilities=new s(this.s.mongos.lastIsMaster()),this.s.sCapabilities)},I.classMethod("capabilities",{callback:!1,promise:!1,returns:[s]}),E.prototype.command=function(e,t,n,r){this.s.mongos.command(e,t,n,r)},I.classMethod("command",{callback:!0,promise:!1}),E.prototype.insert=function(e,t,n,r){this.s.mongos.insert(e,t,n,function(e,t){r(e,t)})},I.classMethod("insert",{callback:!0,promise:!1}),E.prototype.update=function(e,t,n,r){this.s.mongos.update(e,t,n,r)},I.classMethod("update",{callback:!0,promise:!1}),E.prototype.remove=function(e,t,n,r){this.s.mongos.remove(e,t,n,r)},I.classMethod("remove",{callback:!0,promise:!1}),E.prototype.isDestroyed=function(){return this.s.mongos.isDestroyed()},E.prototype.isConnected=function(){return this.s.mongos.isConnected()},I.classMethod("isConnected",{callback:!1,promise:!1,returns:[Boolean]}),E.prototype.cursor=function(e,t,n){return n.disconnectHandler=this.s.store,this.s.mongos.cursor(e,t,n)},I.classMethod("cursor",{callback:!1,promise:!1,returns:[u,l,f]}),E.prototype.lastIsMaster=function(){return this.s.mongos.lastIsMaster()},E.prototype.close=function(e){this.s.mongos.destroy(),1==e&&(this.s.storeOptions.force=e,this.s.store.flush())},I.classMethod("close",{callback:!1,promise:!1}),E.prototype.auth=function(){var e=Array.prototype.slice.call(arguments,0);this.s.mongos.auth.apply(this.s.mongos,e)},I.classMethod("auth",{callback:!0,promise:!1}),E.prototype.logout=function(){var e=Array.prototype.slice.call(arguments,0);this.s.mongos.logout.apply(this.s.mongos,e)},I.classMethod("logout",{callback:!0,promise:!1}),E.prototype.connections=function(){return this.s.mongos.connections()},I.classMethod("connections",{callback:!1,promise:!1,returns:[Array]}),e.exports=E},function(e,t,n){"use strict";var r=n(9).EventEmitter,o=n(1).inherits,i=n(1).format,s=n(60),a=n(13),c=n(26),u=n(19),l=n(14),f=n(3).MongoError,p=n(27).ServerCapabilities,d=n(27).Store,h=n(8),m=n(3).ReplSet,y=n(3).ReadPreference,g=n(2).MAX_JS_INT,b=n(2).translateOptions,v=n(2).filterOptions,w=n(2).mergeOptions,S=n(64),x=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers"],k=n(77).version,_=i("Node.js %s, %s",process.version,S.endianness()),O=S.type(),C=process.platform,E=process.arch,I=S.release(),N=function(e,t){if(!(this instanceof N))return new N(e,t);t=t||{};var n=this;r.call(this),t=v(t,x);for(var o=0;o<e.length;o++)if(!(e[o]instanceof s))throw f.create({message:"all seed list instances must be of the Server type",driver:!0});var i={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:g},c=t.store||new d(n,i),u=e.map(function(e){return{host:e.host,port:e.port}}),l=w({},{disconnectHandler:c,cursorFactory:a,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5});l=b(l,t);var p=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;l=b(l,p),"number"==typeof l.keepAlive&&(l.keepAliveInitialDelay=l.keepAlive,l.keepAlive=l.keepAlive>0),this.clientInfo={driver:{name:"nodejs",version:k},os:{type:O,name:C,architecture:E,version:I},platform:_},l.clientInfo=this.clientInfo,t.appname&&(l.clientInfo.application={name:t.appname});var h=new m(u,l);h.on("reconnect",function(){n.emit("reconnect"),c.execute()}),this.s={replset:h,sCapabilities:null,tag:t.tag,storeOptions:i,clonedOptions:l,store:c,options:t},l.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return h}})};o(N,r),Object.defineProperty(N.prototype,"isMasterDoc",{enumerable:!0,get:function(){return this.s.replset.lastIsMaster()}}),Object.defineProperty(N.prototype,"parserType",{enumerable:!0,get:function(){return this.s.replset.parserType}}),Object.defineProperty(N.prototype,"bson",{enumerable:!0,get:function(){return this.s.replset.s.bson}}),Object.defineProperty(N.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.replset.s.haInterval}});var A=N.define=new h("ReplSet",N,!1),M=function(e){return"string"==typeof e.readPreference?e.readPreference=new y(e.readPreference):e.readPreference instanceof l&&(e.readPreference=new y(e.readPreference.mode,e.readPreference.tags,{maxStalenessSeconds:e.readPreference.maxStalenessSeconds})),e};N.prototype.connect=function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),null==t&&(t={}),"function"!=typeof n&&(n=null),r.s.options=t,r.s.storeOptions.bufferMaxEntries=e.bufferMaxEntries;var o=function(e){return function(t){"error"!=e&&r.emit(e,t)}},i=function(){["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged"].forEach(function(e){r.s.replset.removeAllListeners(e)}),r.s.replset.once("timeout",o("timeout")),r.s.replset.once("error",o("error")),r.s.replset.once("close",o("close"));var e=function(e){return function(t,n){r.emit(e,t,n)}},t=function(e){return function(t,n){r.emit(e,t,n.lastIsMaster(),n)}},i=function(e,t){r.emit("ha",e,t),"start"==e?r.emit("ha_connect",e,t):"end"==e&&r.emit("ha_ismaster",e,t)};r.s.replset.on("joined",t("joined")),r.s.replset.on("left",e("left")),r.s.replset.on("ping",e("ping")),r.s.replset.on("ha",i),r.s.replset.on("serverDescriptionChanged",e("serverDescriptionChanged")),r.s.replset.on("serverHeartbeatStarted",e("serverHeartbeatStarted")),r.s.replset.on("serverHeartbeatSucceeded",e("serverHeartbeatSucceeded")),r.s.replset.on("serverHeartbeatFailed",e("serverHeartbeatFailed")),r.s.replset.on("serverOpening",e("serverOpening")),r.s.replset.on("serverClosed",e("serverClosed")),r.s.replset.on("topologyOpening",e("topologyOpening")),r.s.replset.on("topologyClosed",e("topologyClosed")),r.s.replset.on("topologyDescriptionChanged",e("topologyDescriptionChanged")),r.s.replset.on("fullsetup",function(){r.emit("fullsetup",null,r)}),r.s.replset.on("all",function(){r.emit("all",null,r)}),r.emit("open",null,r);try{n(null,r)}catch(e){process.nextTick(function(){throw e})}},s=function(){return function(e){["timeout","error","close"].forEach(function(e){r.s.replset.removeListener(e,s)}),r.s.replset.removeListener("connect",s),r.s.replset.destroy();try{n(e)}catch(e){r.s.replset.isConnected()||process.nextTick(function(){throw e})}}};r.s.replset.once("timeout",s("timeout")),r.s.replset.once("error",s("error")),r.s.replset.once("close",s("close")),r.s.replset.once("connect",i),r.s.replset.connect(t)},N.prototype.capabilities=function(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.replset.lastIsMaster()?null:(this.s.sCapabilities=new p(this.s.replset.lastIsMaster()),this.s.sCapabilities)},A.classMethod("capabilities",{callback:!1,promise:!1,returns:[p]}),N.prototype.command=function(e,t,n,r){n=M(n),this.s.replset.command(e,t,n,r)},A.classMethod("command",{callback:!0,promise:!1}),N.prototype.insert=function(e,t,n,r){this.s.replset.insert(e,t,n,r)},A.classMethod("insert",{callback:!0,promise:!1}),N.prototype.update=function(e,t,n,r){this.s.replset.update(e,t,n,r)},A.classMethod("update",{callback:!0,promise:!1}),N.prototype.remove=function(e,t,n,r){this.s.replset.remove(e,t,n,r)},A.classMethod("remove",{callback:!0,promise:!1}),N.prototype.isDestroyed=function(){return this.s.replset.isDestroyed()},N.prototype.isConnected=function(e){return e=e||{},e.readPreference&&(e.readPreference=M(e.readPreference)),this.s.replset.isConnected(e)},A.classMethod("isConnected",{callback:!1,promise:!1,returns:[Boolean]}),N.prototype.cursor=function(e,t,n){return n=M(n),n.disconnectHandler=this.s.store,this.s.replset.cursor(e,t,n)},A.classMethod("cursor",{callback:!1,promise:!1,returns:[a,c,u]}),N.prototype.lastIsMaster=function(){return this.s.replset.lastIsMaster()},N.prototype.close=function(e){var t=this;this.s.replset.destroy(),1==e&&(this.s.storeOptions.force=e,this.s.store.flush());var n=["timeout","error","close","joined","left"];n.forEach(function(e){t.removeAllListeners(e)})},A.classMethod("close",{callback:!1,promise:!1}),N.prototype.auth=function(){var e=Array.prototype.slice.call(arguments,0);this.s.replset.auth.apply(this.s.replset,e)},A.classMethod("auth",{callback:!0,promise:!1}),N.prototype.logout=function(){var e=Array.prototype.slice.call(arguments,0);this.s.replset.logout.apply(this.s.replset,e)},A.classMethod("logout",{callback:!0,promise:!1}),N.prototype.connections=function(){return this.s.replset.connections()},A.classMethod("connections",{callback:!1,promise:!1,returns:[Array]}),e.exports=N},function(e,t,n){function r(e,t){e=e||{};var r=e.highWaterMark;this.highWaterMark=r||0===r?r:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(I||(I=n(119).StringDecoder),this.decoder=new I(e.encoding),this.encoding=e.encoding)}function o(e){return this instanceof o?(this._readableState=new r(e,this),this.readable=!0,void C.call(this)):new o(e)}function i(e,t,n,r,o){var i=u(t,n);if(i)e.emit("error",i);else if(null===n||void 0===n)t.reading=!1,t.ended||l(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!o){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&o){var a=new Error("stream.unshift() after end event");e.emit("error",a)}else!t.decoder||o||r||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,o?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&f(e),d(e,t);else o||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function a(e){if(e>=N)e=N;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}function c(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||null===e?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=a(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function u(e,t){var n=null;return _.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||n||(n=new TypeError("Invalid non-string/buffer chunk")),n}function l(e,t){if(t.decoder&&!t.ended){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.length>0?f(e):w(e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?process.nextTick(function(){p(e)}):p(e))}function p(e){e.emit("readable")}function d(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(function(){h(e,t)}))}function h(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function m(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&y(e)}}function y(e){function t(e,t,o){var i=e.write(n);!1===i&&r.awaitDrain++}var n,r=e._readableState;for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes,0,null):S(r.pipes,t),e.emit("data",n),r.awaitDrain>0)return;return 0===r.pipesCount?(r.flowing=!1,void(O.listenerCount(e,"data")>0&&b(e))):void(r.ranOut=!0)}function g(){this._readableState.ranOut&&(this._readableState.ranOut=!1,y(this))}function b(e,t){var n=e._readableState;if(n.flowing)throw new Error("Cannot switch to old mode now.");var r=t||!1,o=!1;e.readable=!0,e.pipe=C.prototype.pipe,e.on=e.addListener=C.prototype.on,e.on("readable",function(){o=!0;for(var t;!r&&null!==(t=e.read());)e.emit("data",t);null===t&&(o=!1,e._readableState.needReadable=!0)}),e.pause=function(){r=!0,this.emit("pause")},e.resume=function(){r=!1,o?process.nextTick(function(){e.emit("readable")}):this.read(0),this.emit("resume")},e.emit("readable")}function v(e,t){var n,r=t.buffer,o=t.length,i=!!t.decoder,s=!!t.objectMode;if(0===r.length)return null;if(0===o)n=null;else if(s)n=r.shift();else if(!e||e>=o)n=i?r.join(""):_.concat(r,o),r.length=0;else if(e<r[0].length){var a=r[0];n=a.slice(0,e),r[0]=a.slice(e)}else if(e===r[0].length)n=r.shift();else{n=i?"":new _(e);for(var c=0,u=0,l=r.length;u<l&&c<e;u++){var a=r[0],f=Math.min(e-c,a.length);i?n+=a.slice(0,f):a.copy(n,c,0,f),f<a.length?r[0]=a.slice(f):r.shift(),c+=f}}return n}function w(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,process.nextTick(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function S(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function x(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=o;var k=n(182),_=n(44).Buffer;o.ReadableState=r;var O=n(9).EventEmitter;O.listenerCount||(O.listenerCount=function(e,t){return e.listeners(t).length});var C=n(16),E=n(45);E.inherits=n(42);var I;E.inherits(o,C),o.prototype.push=function(e,t){var n=this._readableState;return"string"!=typeof e||n.objectMode||(t=t||n.defaultEncoding,t!==n.encoding&&(e=new _(e,t),t="")),i(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return i(this,t,e,"",!0)},o.prototype.setEncoding=function(e){I||(I=n(119).StringDecoder),this._readableState.decoder=new I(e),this._readableState.encoding=e};var N=8388608;o.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(e=c(e,t),0===e&&t.ended)return 0===t.length&&w(this),null;var r=t.needReadable;t.length-e<=t.highWaterMark&&(r=!0),(t.ended||t.reading)&&(r=!1),r&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=c(n,t));var o;return o=e>0?v(e,t):null,null===o&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&w(this),o},o.prototype._read=function(e){this.emit("error",new Error("not implemented"))},o.prototype.pipe=function(e,t){function n(e){e===u&&o()}function r(){e.end()}function o(){e.removeListener("close",s),e.removeListener("finish",a),e.removeListener("drain",d),e.removeListener("error",i),e.removeListener("unpipe",n),u.removeListener("end",r),u.removeListener("end",o),e._writableState&&!e._writableState.needDrain||d()}function i(t){c(),e.removeListener("error",i),0===O.listenerCount(e,"error")&&e.emit("error",t)}function s(){e.removeListener("finish",a),c()}function a(){e.removeListener("close",s),c()}function c(){u.unpipe(e)}var u=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=e;break;case 1:l.pipes=[l.pipes,e];break;default:l.pipes.push(e)}l.pipesCount+=1;var f=(!t||t.end!==!1)&&e!==process.stdout&&e!==process.stderr,p=f?r:o;l.endEmitted?process.nextTick(p):u.once("end",p),e.on("unpipe",n);var d=m(u);return e.on("drain",d),e._events&&e._events.error?k(e._events.error)?e._events.error.unshift(i):e._events.error=[i,e._events.error]:e.on("error",i),e.once("close",s),e.once("finish",a),e.emit("pipe",u),l.flowing||(this.on("readable",g),l.flowing=!0,process.nextTick(function(){y(u)})),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",g),t.flowing=!1;for(var o=0;o<r;o++)n[o].emit("unpipe",this);return this}var o=x(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=C.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||b(this),"readable"===e&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&f(this,r):this.read(0))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){b(this),this.read(0),this.emit("resume")},o.prototype.pause=function(){b(this,!0),this.emit("pause")},o.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(o){if(t.decoder&&(o=t.decoder.write(o)),o&&(t.objectMode||o.length)){var i=r.push(o);i||(n=!0,e.pause())}});for(var o in e)"function"==typeof e[o]&&"undefined"==typeof this[o]&&(this[o]=function(t){return function(){return e[t].apply(e,arguments)}}(o));var i=["error","close","destroy","pause","resume"];return S(i,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){n&&(n=!1,e.resume())},r},o._fromList=v},function(e,t,n){function r(e,t){this.afterTransform=function(e,n){return o(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(e,t,n){var r=e._transformState;r.transforming=!1;var o=r.writecb;if(!o)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),o&&o(t);var i=e._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&e._read(i.highWaterMark)}function i(e){if(!(this instanceof i))return new i(e);a.call(this,e);var t=(this._transformState=new r(e,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var n=e._writableState,r=(e._readableState,e._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}e.exports=i;var a=n(85),c=n(45);c.inherits=n(42),c.inherits(i,a),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var o=this._readableState;(r.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){function r(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function o(e,t){e=e||{};var n=e.highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=e.decodeStrings===!1;this.decodeStrings=!r,
this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){d(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function i(e){var t=n(85);return this instanceof i||this instanceof t?(this._writableState=new o(e,this),this.writable=!0,void x.call(this)):new i(e)}function s(e,t,n){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){n(r)})}function a(e,t,n,r){var o=!0;if(!w.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var i=new TypeError("Invalid non-string/buffer chunk");e.emit("error",i),process.nextTick(function(){r(i)}),o=!1}return o}function c(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new w(t,n)),t}function u(e,t,n,o,i){n=c(t,n,o),w.isBuffer(n)&&(o="buffer");var s=t.objectMode?1:n.length;t.length+=s;var a=t.length<t.highWaterMark;return a||(t.needDrain=!0),t.writing?t.buffer.push(new r(n,o,i)):l(e,t,s,n,o,i),a}function l(e,t,n,r,o,i){t.writelen=n,t.writecb=i,t.writing=!0,t.sync=!0,e._write(r,o,t.onwrite),t.sync=!1}function f(e,t,n,r,o){n?process.nextTick(function(){o(r)}):o(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function d(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if(p(n),t)f(e,n,r,t,o);else{var i=g(e,n);i||n.bufferProcessing||!n.buffer.length||y(e,n),r?process.nextTick(function(){h(e,n,i,o)}):h(e,n,i,o)}}function h(e,t,n,r){n||m(e,t),r(),n&&b(e,t)}function m(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function y(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var r=t.buffer[n],o=r.chunk,i=r.encoding,s=r.callback,a=t.objectMode?1:o.length;if(l(e,t,a,o,i,s),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}function g(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function b(e,t){var n=g(e,t);return n&&(t.finished=!0,e.emit("finish")),n}function v(e,t,n){t.ending=!0,b(e,t),n&&(t.finished?process.nextTick(n):e.once("finish",n)),t.ended=!0}e.exports=i;var w=n(44).Buffer;i.WritableState=o;var S=n(45);S.inherits=n(42);var x=n(16);S.inherits(i,x),i.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},i.prototype.write=function(e,t,n){var r=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),w.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=function(){}),r.ended?s(this,r,n):a(this,r,e,n)&&(o=u(this,r,e,t,n)),o},i.prototype._write=function(e,t,n){n(new Error("not implemented"))},i.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),r.ending||r.finished||v(this,r,n)}},function(e,t,n){var r=n(203),o=n(20);describe("Require Optional",function(){describe("top level require",function(){it("should correctly require co library",function(){var e=o("es6-promise");r.ok(e)}),it("should fail to require es6-promise library",function(){try{o("co")}catch(e){return void r.equal("OPTIONAL_MODULE_NOT_FOUND",e.code)}r.ok(!1)}),it("should ignore optional library not defined",function(){r.equal(void 0,o("es6-promise2"))})}),describe("internal module file require",function(){it("should correctly require co library",function(){var e=o("bson/lib/bson/long.js");r.ok(e)})}),describe("top level resolve",function(){it("should correctly use exists method",function(){r.equal(!1,o.exists("co")),r.equal(!0,o.exists("es6-promise")),r.equal(!0,o.exists("bson/lib/bson/long.js")),r.equal(!1,o.exists("es6-promise2"))})})})},function(e,t,n){function r(e){if(e&&!c(e))throw new Error("Unknown encoding: "+e)}function o(e){return e.toString(this.encoding)}function i(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function s(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var a=n(44).Buffer,c=a.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},u=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=i;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=o)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};u.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var o=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,o),o-=this.charReceived),t+=e.toString(this.encoding,0,o);var o=t.length-1,r=t.charCodeAt(o);if(r>=55296&&r<=56319){var i=this.surrogateSize;return this.charLength+=i,this.charReceived+=i,this.charBuffer.copy(this.charBuffer,i,0,i),e.copy(this.charBuffer,0,0,i),t.substring(0,o)}return t},u.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},u.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,o=this.encoding;t+=r.slice(0,n).toString(o)}return t}},function(e,t){function n(e,t){var n=t||0,o=r;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);e.exports=n},function(e,t,n){function r(){return o(16)}var o=n(28).randomBytes;e.exports=r},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(88),i=(r(o),n(209)),s=r(i),a=n(21),c=r(a),u=n(205),l=r(u),f=n(62),p=n(65),d=r(p),h=n(22),m=r(h),y=n(132),g=r(y),b=n(131),v=r(b);e.exports=function(e){m.default.setProvider(e);var t=new c.default;t.use((0,s.default)(":method :url :status :response-time ms - :res[content-length]",{stream:d.default.stream}));var r=[n(129),n(130),n(133),n(134)];return t.use(l.default.json()),t.use(l.default.urlencoded({extended:!1})),t.use("/meta",(0,g.default)()),t.use("/.extensions",(0,v.default)()),t.use("/",r),t.use(f.middlewares.errorHandler(d.default.error)),t}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(63),i=r(o),s=n(22),a=r(s),c=n(125),u=r(c);t.default=function(){return i.default.render(u.default,{extensionUrl:(0,a.default)("PUBLIC_WT_URL").replace(/\/$/g,""),apiKey:(0,a.default)("EXTENSION_SECRET"),updateTime:function(){return(new Date).toISOString()},SLACK_API_TOKEN:(0,a.default)("SLACK_API_TOKEN"),SIGINING_SECRET:(0,a.default)("SIGNING_SECRET"),MONGO_CONNECTION_STRINGT:(0,a.default)("MONGO_CONNECTION_STRING")})}},function(e,t){"use strict";e.exports="/*\n*  This rule been automatically generated by the auth0-slack-mfa extension on <%= updateTime() %>\n*/\nfunction (user, context, callback) {\n  var jwt = require('jsonwebtoken');\n  var MongoClient = require('mongodb');\n  var CLIENTS_WITH_MFA = ['ZxbatHjRgBj9xFZ1SyygKZDhkb4r17Vk'];\n\n  // run only for the specified clients\n  if (CLIENTS_WITH_MFA.indexOf(context.clientID) === -1) {\n    return callback(null,user,context);\n  }\n\n  // returning from MFA validation\n  if(context.protocol === 'redirect-callback') {\n    var decoded = jwt.verify(context.request.query.token, new Buffer(configuration.slack_mfa_secret, 'base64'));\n    if (!decoded || decoded.iss !== 'urn:sgmeyer:slack:mfacallback') return callback(new Error('Invalid Token'));\n\n    MongoClient = require('mongodb').MongoClient;\n    MongoClient.connect(configuration.mongo_connection, function(err, db) {\n      var collection = db.collection('Token');\n\n      var filter = { \"jti\": decoded.jti };\n      collection.findOne(filter, function (err, whitelist) {\n        if (!whitelist) return callback(new Error('Invalid JWT ID'));\n\n        collection.remove(filter, function (err) {\n          if (err) throw new Error('Failed to revoke token');\n          return callback(null,user,context);\n        });\n      });\n    });\n\n    return callback(null,user,context);\n  } else {\n\n    var uuid = require('uuid');\n    var token_payload = {\n      sub: user.user_id,\n      aud: context.clientID,\n      jti: uuid.v4(),\n      iat: new Date().getTime() / 1000,\n      iss: 'urn:sgmeyer:slack:mfa'\n    };\n\n    if (user.user_metadata) {\n      token_payload.slack_username = user.user_metadata.slack_mfa_username;\n      token_payload.slack_enrolled = user.user_metadata.slack_mfa_enrolled;\n    }\n\n    var token = jwt.sign(token_payload,\n      new Buffer(configuration.slack_mfa_secret, 'base64'),\n      {\n        subject: user.user_id,\n        expiresInMinutes: 5,\n        audience: context.clientID,\n        issuer: 'urn:sgmeyer:slack:mfa',\n        iat: new Date().getTime() / 1000\n      });\n\n    MongoClient = require('mongodb').MongoClient;\n    MongoClient.connect(configuration.mongo_connection, function (err, db) {\n      var tokenRecord = {\n        jti: token_payload.jti,\n        sub: token_payload.sub,\n        iss: token_payload.iss,\n        issued: new Date(token_payload.iat * 1000)\n      };\n\n      var upsertFilter = { 'sub': token_payload.sub, 'iss': token_payload.iss };\n      return db.collection('Token').update(upsertFilter, tokenRecord, { upsert: true }, function (err, record) {\n        if (err) { throw new Error('Failed to whitelist JWT.'); }\n\n      var route = user.user_metadata && user.user_metadata.slack_mfa_username ? \"/mfa\" : \"/enroll\";\n        context.redirect = { url: configuration.slack_mfa_url + route + '?token=' + token };\n        return callback(null, user, context);\n      });\n    });\n  }\n}"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(138),i=r(o),s=n(204),a=s.promisify(n(212)),c={sendDM:function(e){var t=(0,i.default)([{fallback:"Follow this link to complete login: <"+e.verifyUrl+" | Complete Login>.",title:"You have attempted to log into a remote site.  Please click the link below to continue.",text:"<"+e.verifyUrl+" | Complete Login>\n\n<"+e.cancelUrl+" | That's not me>",color:"#3AA3E3"}]),r="https://slack.com/api/chat.postMessage?token="+e.token+"&channel=%40"+e.username+"&attachments="+n(211).escape(t)+"&pretty=1&as_user=true&unfurl_links=false&unfurl_media=false";return a({method:"GET",url:r})}};e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return new u.default(function(t,n){return l.connect(e,function(e,r){return e?n(e):t(r)})})}function i(e,t){return new u.default(function(n,r){return e.collection("Token").findOne({jti:t.jti},function(e,t){return e?r(e):n(t)})})}function s(e,t){return new u.default(function(n,r){return e.collection("Token").remove({jti:t.jti},function(e,t){return e?reject(e):n(!0)})})}function a(e,t){return new u.default(function(n,r){if(!t.jti)return r("The jwt must have a jti.");if(!t.iat||isNaN(t.iat))return r("The jwt must have a valid iat.");var o=new Date(1e3*t.iat),i={jti:t.jti,sub:t.sub,iss:t.iss,issued:o},s=e.collection("Token"),a={sub:t.sub,iss:t.iss};return s.update(a,i,{upsert:!0},function(e,t){return e?r(e):n(t)})})}var c=n(90),u=r(c),l=n(107).MongoClient,f={connect:o,find:i,remove:s,save:a};e.exports=f},function(e,t,n){"use strict";function r(e){if(!e.container)return null;var t=e.container.replace(c,"\\$&"),n=e.jtn?e.jtn.replace(c,"\\$&"):"";if(e.url_format===a)return new RegExp("^/api/run/"+t+"/(?:"+n+"/?)?");if(e.url_format===s)return new RegExp("^/"+t+"/(?:"+n+"/?)?");if(e.url_format===i)return new RegExp("^/(?:"+n+"/?)?");throw new Error("Unsupported webtask URL format.")}var o=n(89),i=3,s=2,a=1,c=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports.getUrl=function(e){var t=r(e.x_wt),n=e.url,i=e.url.replace(t,"/"),s=o.parse(i||"").pathname,a=o.parse(n||"").pathname||"",c=o.format({protocol:"https",host:e.headers.host,pathname:a.replace(s,"").replace(/\/$/g,"")});return e.x_wt&&(0===c.indexOf("https://sandbox.it.auth0.com")?c=c.replace("https://sandbox.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".us.webtask.io/"):0===c.indexOf("https://sandbox-eu.it.auth0.com")?c=c.replace("https://sandbox-eu.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".eu.webtask.io/"):0===c.indexOf("https://sandbox-au.it.auth0.com")&&(c=c.replace("https://sandbox-au.it.auth0.com/api/run/"+e.x_wt.container+"/","https://"+e.x_wt.container+".au.webtask.io/"))),c}},function(e,t,n){"use strict";function r(e,t){var r=config("SIGNING_SECRET"),o=config("MONGO_CONNECTION_STRING"),a=new Buffer(r,"base64");i.verify(e.query.token,a,o).then(function(e){return i.revoke(e,o)}).then(function(){t.end(n(63).render(s())),t.end()}).catch(function(e){t.status(500).send("Error.").end()})}var o=n(21),i=n(46),s=n(135),a=o();a.get("/cancel",r),e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r,o=(0,c.default)("SIGNING_SECRET"),i=(0,c.default)("MONGO_CONNECTION_STRING"),a=new Buffer(o,"base64");f.verify(e.query.token,a,i).then(function(e){return r=e,f.revoke(r,i)}).then(function(){return s(a,r.sub,r.aud,r.slack_username,i)}).then(function(o){t.end(n(63).render(p(),{state:e.query.state,token:o,slack_username:r.slack_username}))}).catch(function(e){console.log(e),t.status(500).send("Error.").end()})}function i(e,t){var n,r=(0,c.default)("SIGNING_SECRET"),o=(0,c.default)("MONGO_CONNECTION_STRING"),i=new Buffer(r,"base64");f.verify(e.body.token,i,o).then(function(e){if(e.slack_enrolled)throw new Error("The user has already enrolled.");return n=e,f.revoke(n,o)}).then(function(){var t=n.sub,r={user_metadata:{slack_mfa_username:options.slack_username,slack_mfa_enrolled:!1}};return e.auth0.users.update({id:t},r)}).then(function(){return s(i,n.sub,n.aud,e.body.slack_username,o)}).then(function(n){t.writeHead(302,{Location:"mfa?token="+n+"&state="+e.body.state}),t.end()}).catch(function(e){console.log(e+"\r\n"+e.stack),t.status(500).send("Error.").end()})}function s(e,t,n,r,o){var i={expiresIn:"5m"},s={sub:t,aud:n,jti:l.v4(),iat:(new Date).getTime()/1e3,issuer:"urn:sgmeyer:slack:mfa",slack_username:r,slack_enrolled:!1};return f.issue(s,e,i,o)}var a=n(22),c=r(a),u=n(21),l=n(87),f=n(46),p=n(136),d=u();d.get("/enroll",o),d.post("/enroll",i),e.exports=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(140),i=r(o),s=n(207),a=r(s),c=n(21),u=n(62),l=n(22),f=r(l),p=n(65),d=r(p),h=n(124),m=r(h);t.default=function(){var e=(0,c.Router)(),t=u.middlewares.validateHookToken((0,f.default)("AUTH0_DOMAIN"),(0,f.default)("WT_URL"),(0,f.default)("EXTENSION_SECRET"));return e.use("/on-install",t("/.extensions/on-install")),e.use("/on-uninstall",t("/.extensions/on-uninstall")),e.use(u.middlewares.managementApiClient({domain:(0,f.default)("AUTH0_DOMAIN"),clientId:(0,f.default)("AUTH0_CLIENT_ID"),clientSecret:(0,f.default)("AUTH0_CLIENT_SECRET")})),e.post("/on-install",function(e,t){d.default.debug("Starting installation."),d.default.debug("Installing rule");var n="auth0-slack-mfa";e.auth0.rules.getAll().then(function(t){var r={name:n,script:(0,m.default)(f.default,n)},o=a.default.find(t,{name:n});return o?e.auth0.rules.update({id:o.id},r):e.auth0.rules.create((0,i.default)({stage:"login_success"},r))}).then(function(){d.default.debug("Slack MFA rule deployed."),t.sendStatus(204)}).catch(function(e){d.default.debug("Error deploying Slack MFA rule."),d.default.error(e),t.sendStatus(400)})}),e.delete("/on-uninstall",function(e,t){e.auth0.rules.getAll().then(function(t){var n=a.default.find(t,{name:ruleName});n&&e.auth0.rules.delete({id:n.id})}).then(function(){d.default.debug("Slack MFA rule deleted."),t.sendStatus(204)}).catch(function(e){d.default.debug("Error deleting Slack MFA rule."),d.default.error(e),t.sendStatus(204)})}),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(21),i=r(o),s=n(184),a=r(s);t.default=function(){var e=i.default.Router();return e.get("/",function(e,t){t.status(200).send(a.default)}),e}},function(e,t,n){"use strict";function r(e,t){var r,i,a=config("SLACK_API_TOKEN"),l=config("SIGNING_SECRET"),f=config("MONGO_CONNECTION_STRING"),p=new Buffer(l,"base64");s.verify(e.query.token,p,f).then(function(e){if(!e.slack_username)throw new Error("JWT does not contain a slack_mfa_username");return r=e,s.revoke(e,f)}).then(function(){return o(p,r.sub,r.aud,f)}).then(function(t){i=t;var n={NODE_ENV:"production",CLIENT_VERSION:"1.0.1"}.URL||"https://"+e.x_wt.container+".us.webtask.io/"+e.x_wt.jtn,o={verifyUrl:n+"/verify?token="+i+"&state="+e.query.state,cancelUrl:n+"/cancel?token="+i,username:r.slack_username.toLowerCase().trim(),token:a};return c.sendDM(o)}).then(function(){t.end(n(63).render(u(),{token:i,slack_username:r.slack_username,slack_enrolled:r.slack_enrolled}))}).catch(function(e){console.log(e+"\r\n"+e.stack),t.status(500).send("Error.").end()})}function o(e,t,n,r){var o={expiresIn:"5m"},i={sub:t,aud:n,jti:a.v4(),iat:(new Date).getTime()/1e3,iss:"urn:sgmeyer:slack:mfaverify"};return s.issue(i,e,o,r)}var i=n(21),s=n(46),a=n(87),c=n(126),u=n(137),l=i();l.get("/mfa",r),e.exports=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n,r=(0,c.default)("SIGNING_SECRET"),o=(0,c.default)("MONGO_CONNECTION_STRING"),s=new Buffer(r,"base64");f.verify(e.query.token,s,o).then(function(e){if("urn:sgmeyer:slack:mfaverify"!==e.iss)throw new Error("Invalid issuer.");return n=e,f.revoke(n,o)}).then(function(){var t=n.sub;return e.auth0.users.update({id:t},{user_metadata:{slack_mfa_enrolled:!0}})}).then(function(){return i(s,n.sub,n.aud,o)}).then(function(n){var r=(0,c.default)("AUTH0_DOMAIN");t.writeHead(302,{Location:"https://"+r+"/continue?token="+n+"&state="+e.query.state}),t.end()}).catch(function(e){return console.log(e),t.status(500).send("Error.").end()})}function i(e,t,n,r){var o={expiresIn:"1m"},i={sub:t,aud:n,jti:l.v4(),iat:(new Date).getTime()/1e3,iss:"urn:sgmeyer:slack:mfacallback"};return f.issue(i,e,o,r)}var s=n(62),a=n(22),c=r(a),u=n(21),l=n(87),f=n(46),p=u();p.use(s.middlewares.managementApiClient({domain:(0,c.default)("AUTH0_DOMAIN"),clientId:(0,c.default)("AUTH0_CLIENT_ID"),clientSecret:(0,c.default)("AUTH0_CLIENT_SECRET")})),p.get("/verify",o),e.exports=p},function(e,t){"use strict";function n(){return'<html>\n    <head>\n      <meta charset="utf-8">\n      <link href="https://cdn.auth0.com/styleguide/latest/index.min.css" rel="stylesheet" />\n      <link rel="stylesheet" href="https://cdn.auth0.com/backend-templates/main.css">\n      <meta name="viewport" content="width=device-width, initial-scale=1">\n      <title>Auth0 - Slack Multifactor Authentication</title>\n    </head>\n    <body>\n      <div class="unhandled-error-cont tenant-error-cont ">\n        <div class="error-header">\n          <span class="error-icon">\n            <span class="error-face">\n              <span class="error-face-eye left-eye eye-blink"></span>\n              <span class="error-face-eye right-eye eye-blink"></span>\n              <span class="error-mouth"></span>\n            </span>\n          </span>\n          <h3 class="error-title">How embarrassing!</h3>\n          <h3 class="error-subtitle">Thank you for letting us know.</h3>\n        </div>\n        <div class="error-body">\n          <p class="error-message">\n            We have deactivated the link.  Thank you for letting us know.\n          </p>\n        </div>\n        <div class="error-footer">\n            <span class="footer-group">\n              <h4 class="footer-group-title">SUPPORT</h4>\n                <p class="footer-group-detail">Please contact the systems administrator.</p>\n            </span>\n          </div>\n        </div>\n      </div>\n      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>\n      <script src="https://cdn.auth0.com/backend-templates/main.js"></script>\n    </body>\n  </html>'}e.exports=n},function(e,t){"use strict";function n(){return'<!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="icon" href="https://cdn.auth0.com/styleguide/1.0.0/img/badge.png">\n    <meta charset="UTF-8">\n    <title>Auth0 - Slack Multifactor Authentication</title>\n    <style>.hide{display: none}.modal .body input,body,html{font-family:avenir-next-web,Avenir,"Helvetica Neue",Hevetica,sans-serif;width:100%}.validation-error{border-color: red !important;}.validation-error-message{color:red;font-size: 13px;line-height: 1.8;}.modal .body .auth0-lock-input-wrap .auth0-lock-input:focus,a,a:active,a:hover,a:visited,button,button:active,button:hover,button:visited{outline:0}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}@import url(http://fast.fonts.net/t/1.css?apiType=css&projectid=857b99c8-12c9-4d60-85ee-16ebd935d187);@font-face{font-family:avenir-next-web_n2;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/174d458a-81e0-4174-9473-35e3bf0a613c.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/57a79aa3-9b06-4ba7-a9a4-2b766d826ecf.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/733cb7bd-50e1-4dee-893a-0b40ef382b02.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/594135c6-6c4f-4880-a0d2-ba923b5ef38e.svg#594135c6-6c4f-4880-a0d2-ba923b5ef38e) format("svg");font-weight:200;font-style:normal}@font-face{font-family:avenir-next-web_i2;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/69a545eb-cdd0-4c00-9035-0029d8cede28.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/642cb581-067a-4f15-9df9-55c49c6b5446.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/972d8132-0f21-4d94-b42d-8f4022e6aa17.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/670d40f3-affd-4e16-8ad8-055f11470e24.svg#670d40f3-affd-4e16-8ad8-055f11470e24) format("svg");font-weight:200;font-style:italic}@font-face{font-family:avenir-next-web_n4;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/7db1f672-3a8f-4d19-9c49-7f61aed450b5.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/4ab86b35-c0c2-42b5-98ad-4b6eba66b197.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/276b3566-1c3b-4bc1-8915-15314f091f29.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5d02f5f4-46e7-453a-aef9-3e7106d7bb68.svg#5d02f5f4-46e7-453a-aef9-3e7106d7bb68) format("svg");font-weight:400;font-style:normal}@font-face{font-family:avenir-next-web_i4;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/b17468ea-cf53-4635-984b-4d930a68ed4d.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/4d1d0d0d-9ea6-4117-901f-8b32ca1ab936.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/66b50093-e606-427c-a42a-a44b2f9ff219.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78695677-7ebb-4ef8-8996-eff09dc64f26.svg#78695677-7ebb-4ef8-8996-eff09dc64f26) format("svg");font-weight:400;font-style:italic}@font-face{font-family:avenir-next-web_n5;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/b0b84e4d-2164-45c7-a674-1662f19f3ba6.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/e91d1bbf-3fea-45e2-b003-a22b12ce6e5f.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/ead8b64b-1abd-4d5b-a642-a21dfe2f463b.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/e536e1c2-92a4-4db4-8a41-1c55354d11b7.svg#e536e1c2-92a4-4db4-8a41-1c55354d11b7) format("svg");font-weight:700;font-style:normal}@font-face{font-family:avenir-next-web_i5;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/349e5647-5161-46bb-a19f-8a609ae235e4.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/cc0a88c2-524b-4c90-b6f0-a80570222c30.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/03aefdc0-0198-4662-a9c7-640a4734063e.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/132a539d-37fa-48fb-92ec-1f4591f98ee1.svg#132a539d-37fa-48fb-92ec-1f4591f98ee1) format("svg");font-weight:700;font-style:italic}@font-face{font-family:budicon-font;src:url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.eot);src:url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.eot?#iefix) format("embedded-opentype"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.woff) format("woff"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.ttf) format("truetype"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.svg#budicon-font) format("svg");font-weight:400;font-style:normal}body,html{height:100%;margin:0;padding:0;font-size:62.5%;min-height:100%;background-color:#222228;z-index:1}.modal .body input{border:none;font-size:13px;outline:0}.modal-wrapper{width:100%;height:100%;display:table;background-color:rgba(0,0,0,.15);z-index:2;-webkit-animation:fadein 1s;-moz-animation:fadein 1s;-ms-animation:fadein 1s;-o-animation:fadein 1s;animation:fadein 1s}.modal-centrix{padding:0;vertical-align:middle;display:table-cell;margin:0}.modal{width:100%;max-width:300px;z-index:3;border-radius:0;box-shadow:0 2px 4px rgba(0,0,0,.5);margin:auto}.modal .head{background:#efefef;background:-moz-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-webkit-gradient(linear,left top,right top,color-stop(0,#efefef),color-stop(50%,#fefefe),color-stop(100%,#efefef));background:-webkit-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-o-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-ms-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:linear-gradient(to right,#efefef 0,#fefefe 50%,#efefef 100%);text-align:center;height:132px}.modal .head .logo{display:inline-block;margin:14px auto 0;width:53px}.modal .head .first-line{display:block;line-height:30px;height:30px;margin:15px 0 0;font-size:22px;color:#333}@media (min-width:414px){.modal{border-radius:5px;top:calc(50% + 40px)}.modal .head{border-radius:5px 5px 0 0}.modal .head .first-line{margin:9px 0 0}}.modal .head .second-line{display:block;line-height:16px;height:16px;margin:3px 0 21px;font-size:12px;color:#333;text-transform:uppercase}.modal .errors{text-align:center;background-color:#f04848;color:#fff;line-height:1.6;font-size:12px;padding:10px}.modal .errors p{margin:0}.modal .errors.hidden{display:none}.modal .body{background-color:#fff;padding:30px;overflow:hidden}.modal .body .description{display:block;max-width:290px;font-size:13px;line-height:1.8;color:rgba(0,0,0,.56);text-align:center;margin-bottom:20px}[class*=" icon-"]:before,[class^=icon-]:before,[data-icon]:before{font-family:budicon-font!important;font-style:normal!important;font-weight:400!important;font-variant:normal!important;text-transform:none!important;speak:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.modal .body .auth0-lock-input-wrap,.modal .body .auth0-lock.auth0-lock .auth0-lock-input-wrap{border-radius:3px;border:1px solid #f1f1f1;position:relative;background:#f1f1f1;padding-left:40px;-webkit-transition:border-color .8s;transition:border-color .8s}.modal .body .auth0-lock-input-wrap .auth0-lock-icon.auth0-lock-icon-box{width:12px;height:14px;top:13px;left:14px;position:absolute;font-size:12px}.modal .body .auth0-lock-input-wrap .auth0-lock-input{border:0;padding:0 14px;right:0;height:40px;font-size:13px;width:100%;border-radius:0 2px 2px 0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;color:#727578}.modal .ok-cancel{display:block;width:100%;overflow:hidden}.modal .ok-cancel button{height:70px;vertical-align:middle;width:50%;float:left;border:0;text-align:center;cursor:pointer;padding:0}.modal .ok-cancel button.ok{background-color:#ea5323}.modal .ok-cancel button.ok:hover{background-color:#ac3610;-webkit-transition:background .3s ease;transition:background .3s ease}.modal .ok-cancel button.ok.full-width{width:100%}.modal .ok-cancel button.cancel{background-color:#5c666f}@media (min-width:414px){.modal .body .description{max-width:348px}.modal .ok-cancel button.ok{border-radius:0 0 5px}.modal .ok-cancel button.ok.full-width{border-radius:0 0 5px 5px}.modal .ok-cancel button.cancel{border-radius:0 0 0 5px}}[data-icon]:before{content:attr(data-icon)}.icon-budicon-377:before{content:""}.icon-budicon-509:before{content:""}.icon-budicon-460:before{content:""}.custom-select{display:inline-block;vertical-align:top;position:relative;border-radius:3px;height:32px;line-height:32px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:1.6rem;padding-right:28px}.custom-select:hover{color:#333}.custom-select i{font-size:12px;position:absolute;top:3px;right:9px;opacity:.7;animation:none}.custom-select span{color:#000;border-bottom:1px solid #6b6b6b;padding-bottom:1px;text-transform:uppercase}.custom-select select{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0}@-ms-keyframes fadein{from{opacity:0}to{opacity:1}}.auth0-spinner{position:relative}.auth0-spinner:before{content:"";background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJgAAACoCAYAAAAcuCeMAAAAAXNSR0IArs4c6QAAFNpJREFUeAHtnQv0HUV9xwlgJCLBEBAJBREKRB4CBWKgoBAoVUh4CT0+ihiMllOqPX14rFg9tNiXpy21VXssLaVSgYNAiKAEODySIEoJIFCqqUgCJr4wCeWlkGj6+V7u/v979+7u3cfMzsze/Z3zu7s7O/P7fX+/+d2Z3dnZ2SlbWaAtW7Z8EbEnWxDtWuTjAHgJnu0aiAX9X5syZcp7TcudYlogwTUNmU/B25uW7YG8vwXDi/DHPcBiGsILCNyFINPWGG1tTNKkoLez28bgkoXX9Vn7baNXYZDqzijZCLB3GEXoj7C1QLmXf/iDbNf4A8soEuN1ZzTA6B6nYu58oyb7I+x6gmtLH861/sAyimQ+dfhKkxKNBhjAToKnmwTokSx1jxHF96O0Nmx3wIjfMGmI6QAz3sSaNLaGrB9T9u5Y+XvZ/0HsuE27RuvQWIDRtG6Llxe0ydMxW26ge/xldNzvKtvaip3Wr8vI3FpbYwEGiuPhmbXQ+Fs47ZqrrQE2g2qYZ6oqTAaY0abVlIEG5GxAxl0pctRlaryvjWSsLo0EGE2q5JzeRk9j0xK6xM1J20j7BWnXJ9Nbcnx6v05rm2MkwEBxDLxrbTR+CsjrCvPO+WlNMVSvJduxxbLm5zIVYMaa1Hy4jZ99Bo235Wi9i3Mbc86HfOosE+BrBxhNqZ5nnmECjIcybqIr1MPtVOLcJk4sST0ZfuIZ/bqtZUntAEP7m+E9aqHwt3Da3WMSbVu7yd0xdG7S2LLHJgKsrd3j8zhzaQGHqgt9tkC+ELPUrlsTAXZmiJ4rgPlmusCfjcpHHk3fuWlUvkDPuw0w+ujDcNzegTpvFOwyXV+RrnSUPh/P70UdH14HWN0WrHaE1wFvsaxapa+WkK+u1OhEvRK6bWetVcd1A6yt3eMtdH3PFq058iq4bi6aP7B8bgKMpvMAHPXGwJxVFG6Z7jGSWaVMVNbn7X7U9UFVAdZpwYwMxFUFbrGcxrZurCBfXaq61jZS5VasToBVVup5DdxBl1d6dJ4yo0b9PTc7F17luq4UYDSZ+wDnTbmQwj1Zp6urU9Znjx1Mne9XBWClAENRW7tHzZC4oYoj+2W+wnZo5kUNeT4VrdSKVQ2wSsp88lYGluV0dZXneFFWc8fuyJAdenKlOi8dYDSVeu54ZOjeysBvooszISMDntPkw6n7vcoiKB1gKKgUyWWBOcivV9IWG9Cr2RUT8/cNyPNJROlxzy7AJqvvG3Rxtd8UQobeQFoxKbZVe6WvvUsFGE3k63DX0a1y2aQxJrs2k7ImEbrfm0sMzCoDo1SAIVhNZNkyZfC4zGsyKNTVRm+Bu7TJtG5NLi3VTZYNlrZef62ka3vCVG0gq7eOhSl5nskpFQOFA4ymcSaGvtUzY03BMdl6RZhsyIxku9weSyzsUhRA4QBDoF5L26ao4MDy2QgGGzJ9cKtioPA7GGUCrFTT6IMnCmJ4hC7tuwXzFs6GzNVkfqBwgbAyFo6FQgFGk7gj9p8Qlg8Ko7U5G7WtrdjxxMSMIh4uFGAIWgBPLSIwwDw2g8CmbJeufgXKTy0CoGiAlR5gK6Lcgzyr6MoetYUD2auQbU2+LdwF5RbqJkcGGE2h1ls9qaDS0LI10cI0ocOF308iNnYYpXhkgCHgFHjaKEGBnm+i8pvQ4cL9Wmpz/ijFRQKsUFM4SpGH51fThVm/y0PHw9j+mIf2m4A0MjZyA4wmcDtQtPGDCnJuky2LzTtVE4FSVcbbiREtf55JuQFGqd+EX51ZOuwTTQZYk7qarBUF19vyFI4KsJFNYJ5wj8+tA5sW8m2E6CZXoujJRpQ1ryQ3RjIDjKZPYx0LmsfbiMb4mveNKERJW1ux3LX1MwMMh5wIv6Yp7zesx0Vlu9DZhFunoyRzbf28AMtt+ppAbknHT5DrYsbpPej9oSWbXIvNjJXUAKN71BPz01yjtqR/MddEjc+ZR6epOf+W3FJL7KnEjL6TMESpAUYuzfvaeSh3OxJcdlUuddusvZ0Qru8kDFFWgGU2eUMSwkrYANw7HUJehu6fOtRvU3Xq8+qhAKOp07zrwhPKbCK2IPsrdFXO3rxGd903xy24xJjI1LX10/rNOajcAX7OmGp/BH3ZAyga1X+nBzhMQ9Cg61Hw13MF04JdDP9ubqbuZOeBhAeImQ/An04kDx+SaRUsWgLPHM7RpXQemPQAMTIDvhYWrZk8k7JHBq1mF6e1HKTeHaQU75LGzAPEht4weiIeMOy/KdMNnPxQIrMOfwH/OZx2vZYpqzvRXg8QC9vAn4A3w0n640zLyXlDMnfs+Ovsvz6zcHdiLDxADOwBL4/FRXI3fTFkcm0Nb0zmThw/zfFvjYUnOyOHPEDdnwlvSMRE8vA5EoZ7OxK1TGJR+hcy6ra0ozHwAHU9Df5c0eAg3+FDbiFxUQkByvpt+JAhQV1CqzxAHR8E/zdchi6InBAfyZ8bJRbczibfvWj9cMH8XbbAPEDdajz0PvjAktD1Bb5BQtjKMiGayHsjx219OD7oqDE4oi53ghcn6rjM4UMDbqKkLvBfKCMhJe860uYNCO4OgvMAdfgW+Psp9Vsm6UUya0b0y8TBvmVK5+TVmNlfwsN3EZGybuulB6gzjW39Gaw6NEEHTBiKtFNMSIzJ+Ab7b5hQ0O147QHqak94Raz+TOyeKqOji/y9DXtANwzfAmUbZw0YdpVbcdSR5v7pmukYw0j2kTxbASbZ0+GrMOAyeHsldOSPB6iTV8FfAJGmD9l4uafXg0UBpg+A26KFCL4fYw6zpaCTW84D1MXBlNDwwwfLlSyVezfljgJs11JFy2fenyLfxLDfh6eUL96VMOUB/K+xrf+CJy/CTQkflNNogEm1FrD7B/gmjCy8iKwKdlTfA/h8JrwESZ+DteaIbXqtFEQt2Azb2mLyT2b/IYw9MZbW7Vr0AL4+DvG6kO/d2VlUFRfdu66LAkxz8JskNZ+3YvhfwZMDck0iGANd+HZb+GJMvR22eZ2d5k2t67vVFADoJVtnb9qgW9cD7+KNm8fZdmTIA9Sr5u5dCbv89M8r1IJppTqXpLeYHsQh73YJok268eXZ2KMu0WVwyaW9AIu6SSW4Io2ZfQnHXA6/2hWI0PXiO41tXYod18C9LsqxTb0AUxfpC50LkAdw0vCENV8QeooDn2lu3v3wIo8gTlHr5fL6K80X+5J4Dw77Q7gbM0vzUCINP32IJC2opzl6PtEmXeRr5sMmn1DFsCxl/1xuAH4SS+t2+x6g7jQH79/h+Z46ZWqvhQCoWjGfusq4v/QF2fcSZLfGE8d9nzqbhw+ugGd56ovN1FnvGkz4/s9TkIKlx1hLcein4bEfM8MHGtv6C3xyG+xrcAHt5ZiK7iA3KsVjUkv7EVjXZr/qMU6r0LD9DShYAV8IR3VnVWcN4c+obARyQw1BTRY9AmW6y/ztJpX6oAubNbfuQVhz7UKg3nVzFGA/CAFxH6Mea12Bw78IN/2Iq3E3YeP28GUovgr2YWyrqA9+pIxRgK0rWsqjfOeARa2ZWrVWErYdhmEa21oYoIG9BY+jAPt+gAYIsq7H3hMo9iKwZZvm0oVIawQ6CrDHQrSgj/m6gLGPgh6ybb3JC1GA/e8oSz09r37+Hk+xmYD1TYSEdH0ct7nXaEUBpoPG146Po6m472TN+4pYSxdjoHILha4vXdB9AcXSdwSjF2AY8gL731VCYBRyF1LU1SHa+D1i6mcyMGrBtP8t/QRE68G6LCC8VaFqYPWpqoUdldNHWHsUD7AHosRAtkv4l2wOBGtlmNgY4tr6mqXco3iAhXaxHGLXEfm97DY0Wye+xalnfD1iUG87dvTQe+rLKV7/6jnXLvy7X/IapSFw1I0e8uvRi403sA2hnBCzib0Z1M3zSplowUj4Ocd62zcE0idhxiK4VBnYqkpbEkLFgPG+KLiEdyLA+uBv629934TWZZjwZyg23xk3NsQA05DKLXEjxmRff/7nArD11jjGZIDp4mx9PIOH+1+lCe6NsXiIzRokbNYlzE3WFJgR/DRiBm4WBwIMI3RL7LsRoXQVZqpsUIrvti8lhgaGjgYCrG/L4kGbvDrSv/hrXiFqFszNqPO59R76A6QF2FKM8HWO/q38Q55ttk790YbtuvVX/fhIwjb05x8KMIx4kYxDkeiJRVqNb9zJVx/cSOzoBmyAhgKsf/Y/B3L5caCxoBv9gOIUha6RfRwDvDzNK1kBdheZv5dWwGHa7fxDdJcy1oQP9BTDt/HKtVmYUgMMIzQP6VLPatJ5t61HNrDr1YhULc59kYiNy4iZ1PmEE88iEwW2wpG7kPYkrGeUrknDJ7thhLNpK/hD8/+vhreB3wmWVWydEFhmovhH8LZOAAwq1aXL6/FH7yWPwVPDj4omzvcr80sTCW53ljsOrnMwX+8katWfQ2Gtmn0eWyeEL9aj+C4nyoeVXpcVXMNZEyk48UDYB7ogAa2RQwzfAdY7mFl0NSecvKuI3vOzQDWcfkStygDskoYBJ9X9koRZtYyoUBidR8KPJcGkHK8mbW4FFbWKoPN1sKnvCiGqEtW/2UDtEZVUmyt0d62aKFkY2FrS6iPwSyVM2ETeC+HUm6aSEApnR1/et7NLwK+c9fjCYPMyol7fg3RFf5CHzeQ5DFSrcFsNQ++gbGOtLbo+XANr3aK3G/M9SN4I61/qgvYyZkiOIAx7G/xjAwY+hYwFOaqMnULPHrAuIVyQ2csCLPisAyusz7DFpqnw38GmK+ofkWl9zAwd+kRP02T+XU0s2Bl+umFL/sTY3z1FELboQ6wacrBF+qTh7BTVxpKQr+vFJklfs93HmAFxQQj+oyYtQde+cf0m95F9LvwsbJueR8Eik9jjspC9t20DEvL/Jq7f6D6K1J2sSii0dTjx8qZJIwA7Hb7SFugcuddwzspbQcjVhyyaoCdQsn2Z+ih1W82IrZ7iawQ79blTGcUF8hp/3oZz5qBXI/LvKqDfdJazEagu82jTgpFn3FcZGC8gBjTvyy7hJF0U26YDTVkBUI1tfRR2dScc95Uw/Clc6s+d5wtk6S7fNuk5bDOEJdvB37FokbEHyWDcDa4ztmXLzDsRvLupGkPWo7aAIveH8E5VsFb6F9FM/hxl74M1y8EGGZm1iVNOAdxD8Ik2QNaUeRzl9d3M02rKiYrb7CYXUefNLxSNcy6GbdCvRV6rsgWQbkYusQHMkkyNMW5XxdaoDOUPsYTtkkhH41sM2hq+xbBhq+sYApb94abuqkya/jDCDqhpe5GH82Uw30fmWmuVVOoiIyfQbOpuUndka6I0A9vKTT3OWIj++2HN2QqNDgbwSmz4YA3glX2XonM9aWdTxxo5cEs45VD4BdgEHVXWGpTuCF9lQrknMq4FR+kxM8rMMYRfd7rzytaD1fwAOseAcWuRkTmNO80A8s+FV8NtIw1q/nqazVlp5NdwzJMGHPF7WTrKptfqIuPKaEqv4PiieFqF/euRoxdORhJO1PXfx8i4At5rZIHwMuwJ5GXY+EnZWgR+33d1u8m/R85ni+hzkgdn/BNcld5aBDTCZ8G3V1USYDkF2q8U9M0xNezT46xSPUgRTEbzCCCs72+XJc3F2mYUGPLMhzXnatxoPQafXsA/atk1MFqWbqZArTvGNGyFmt60gllp/Wb6fZwfWqcgq0w//QbKZg7cYvwr4c+QV2937zxCVhtPayR9MT74PJw5ZoYPdWe/uKQDlpH/TMq6v2MsChwnTIOXwkXppCzZCJgN60FxRy974BE2mc9qOXdCCUfdQd5SMySy6qnxdIDrTeirCxi7QXnTAJL+flhzqjoa9ICGhc7P8Jm+ivvTweypRxokn5YmI5g0DNA1wT+nmjeZeHnSIE69BtZFZ0f5HriO0zNS/Pdv+cV6f3zj11xJHI0dY+yncgxeEAdCvqPhNTn5u1ODHtDY17EJH548mGXg6BKO/L5bjBtTdB+jfgd+ccDULVue4bj3cgRbtXaaK7UZ7qicB+Szi+DenThbPfB/Go6TRugvKFpfQebDwKPgdTGrr5QhHO8O3xlL73areWA5xfbo+zS+7IGGOU5oOmicNJMYuiuGXgO/BT4L1gotl8FaNaaj+h7YiAi9aBINWaxkXw+u17BtlJwEmCwkyLZl89ewxncWwh2Z98B/IFLB9lFXY1zOAizyJYH2DvYvhYfuhKI83baSBzQDVTNRyw66VlKWVch5gAkYQbYnG61FdoyOO6rtgeVIeA/Btba2pJoCjD8qqoIHRzxJuePgi+HMx0Wc6yjfA/LdRfA8H4JLUL1owQQkIlozjeeoNevdCUXp3XakB/QnVat198icDWbwogWL24uDVnB8COz02iGOKYB9zQE71Lfgkt+8CzCBwlEb4TPZ1aCgz59OEVyXJN+cj6/Oks9cAsnS7V0XmQRKl6lZA1fDByXPjfnxI9iv1a7/x2c/eNmCxR2GAx/l+Ej4C/H0Md//PPbP8T24VEfet2DxQKI1O4Pjf4U1ODuOpLGt8wisJaEYH1SAyakEmeam6y5Tj5nGiZZhrO4S14VktPddZNKZOFiDh/Pgi+BxGDOTjZ+ENbYVVHCBOawuUoDjRGumkX+1ZnoS0EZ6AqPeTWDdE6pxwbVgcUfjeA0qapmAuu8CxsX6sv9l2RZycPniSCM4aM00mdHU8gWIckZ6/+ADRpzigZDgLvLzfEbFaHUajZkdnJfP43MPg01jW9/2GGMpaEF3kUlLqRgNOs6BNU4UGul1fY1ttSa4QquAUnhpzU6Fi7y6RTanJIwDL72UMrTL7M4DVJzv8/z10ussdx7qNNf2ABWoN5U+AeuNGl9IWD4Ot+oSpXZlhSyAyvTlXcvVYCm9yF7Ivh8b7FSs67fFtYzCjmPj8HE1lEpeBDe53oV0vX9c/T2WdlPhTa3YoxWvZ4+lk8fdaCpea47pu4626DMItv7NyHGvR+/tJwhMr5qoFRhP8d7wDmBzHiAgTK37qrVjd2sOeacpGA8QGBozuxCuMmamMh+TjGAM7oC68QBBorX3H4eLkvK+2Q3aTmuQHiBgin495CryTg/SyA60ew8QPOfBz8FJUtpC9wg7BMF7gEDaH34gFmHa3y94wzoD/PEAARV9g1Lrm071B5nfSP4fIoP7HP4WgKMAAAAASUVORK5CYII=) center center no-repeat;height:15px;width:15px;background-size:contain;display:inline-block;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);position:absolute}.auth0-spinner .icon{display:none}.auth0-spinner .spinner{margin:0 auto;top:0;position:relative;text-indent:-9999em;border-width:2px;border-style:solid;border-color:rgba(255,255,255,.4) rgba(255,255,255,.4) rgba(255,255,255,.2) rgba(255,255,255,.2);-webkit-animation:loaderAnim .8s infinite linear;animation:loaderAnim .8s infinite linear}.auth0-spinner .spinner,.auth0-spinner .spinner:after{border-radius:50%;width:40px;height:40px}@-moz-keyframes fadein{from{opacity:0}to{opacity:1}}@-webkit-keyframes fadein{from{opacity:0}to{opacity:1}}@-o-keyframes fadein{from{opacity:0}to{opacity:1}}@keyframes fadein{from{opacity:0}to{opacity:1}}@-moz-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-o-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}.footer{border-radius: 0 0 5px 5px;}</style>\n  </head>\n  <body>\n    <div class="modal-wrapper">\n      <div class="modal-centrix">\n        <div class="modal">\n          <form onsubmit="return validateForm();" action="" method="POST" enctype="application/x-www-form-urlencoded">\n            <input type="hidden" name="token" value="<%- token %>" />\n            <input type="hidden" name="state" value="<%- state %>" />\n            <div class="head"><img src="https://cdn.auth0.com/styleguide/2.0.9/lib/logos/img/badge.png" class="logo auth0"><span class="first-line">Auth0</span></div>\n            <div class="body"><span class="description">Please register your Slack username.</span>\n              <div id="errors" class="validation-error-message hide">Enter valid usename excluding @.</div>\n              <div class="auth0-lock-input-wrap"><span>\n                <svg width="43px" height="43px" viewBox="0 0 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid" class="auth0-lock-icon auth0-lock-icon-box"><g><path d="M165.963541,15.8384262 C162.07318,3.86308197 149.212328,-2.69009836 137.239082,1.20236066 C125.263738,5.09272131 118.710557,17.9535738 122.603016,29.9268197 L181.550164,211.292328 C185.597902,222.478689 197.682361,228.765377 209.282098,225.426885 C221.381246,221.943607 228.756984,209.093246 224.896,197.21023 C224.749115,196.756984 165.963541,15.8384262 165.963541,15.8384262" fill="#DFA22F"></path><path d="M74.6260984,45.515541 C70.7336393,33.5422951 57.8727869,26.9891148 45.899541,30.8794754 C33.9241967,34.7698361 27.3710164,47.6306885 31.2634754,59.6060328 L90.210623,240.971541 C94.2583607,252.157902 106.34282,258.44459 117.942557,255.104 C130.041705,251.62282 137.417443,238.772459 133.556459,226.887344 C133.409574,226.436197 74.6260984,45.515541 74.6260984,45.515541" fill="#3CB187"></path><path d="M240.161574,166.045377 C252.136918,162.155016 258.688,149.294164 254.797639,137.31882 C250.907279,125.345574 238.046426,118.792393 226.07318,122.682754 L44.7076721,181.632 C33.5213115,185.677639 27.234623,197.762098 30.5731148,209.361836 C34.0563934,221.460984 46.9067541,228.836721 58.7897705,224.975738 C59.2430164,224.828852 240.161574,166.045377 240.161574,166.045377" fill="#CE1E5B"></path><path d="M82.507541,217.270557 C94.312918,213.434754 109.528131,208.491016 125.855475,203.186361 C122.019672,191.380984 117.075934,176.163672 111.76918,159.83423 L68.4191475,173.924721 L82.507541,217.270557" fill="#392538"></path><path d="M173.847082,187.591344 C190.235279,182.267803 205.467279,177.31777 217.195016,173.507148 C213.359213,161.70177 208.413377,146.480262 203.106623,130.146623 L159.75659,144.237115 L173.847082,187.591344" fill="#BB242A"></path><path d="M210.484459,74.7058361 C222.457705,70.8154754 229.010885,57.954623 225.120525,45.9792787 C221.230164,34.0060328 208.369311,27.4528525 196.393967,31.3432131 L15.028459,90.292459 C3.84209836,94.3380984 -2.44459016,106.422557 0.896,118.022295 C4.37718033,130.121443 17.227541,137.49718 29.1126557,133.636197 C29.5638033,133.489311 210.484459,74.7058361 210.484459,74.7058361" fill="#72C5CD"></path><path d="M52.8220328,125.933115 C64.6274098,122.097311 79.8468197,117.151475 96.1762623,111.84682 C90.8527213,95.4565246 85.9026885,80.2245246 82.0920656,68.4946885 L38.731541,82.5872787 L52.8220328,125.933115" fill="#248C73"></path><path d="M144.159475,96.256 C160.551869,90.9303607 175.785967,85.9803279 187.515803,82.1676066 C182.190164,65.7752131 177.240131,50.5390164 173.42741,38.807082 L130.068984,52.8996721 L144.159475,96.256" fill="#62803A"></path></g></svg></span>\n                <input type="text" name="slack_username" onkeypress="preventInvalidCharacterInput(event)" autocomplete="off" autocapitalize="off" value="<%= slack_username %>" placeholder="Your slack username" tabindex="101" class="auth0-lock-input auth0-lock-input-code">\n              </div>\n            </div>\n            <div id="ok-button" class="ok-cancel">\n              <button class="ok full-width">\n                <span class="icon"><svg width="43px" height="42px" viewBox="0 0 43 42" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><g id="Lock" sketch:type="MSArtboardGroup" transform="translate(-280.000000, -3592.000000)"><g id="Slack" sketch:type="MSLayerGroup" transform="translate(153.000000, 3207.000000)"><g id="Group" sketch:type="MSShapeGroup"><g id="Login" transform="translate(0.000000, 369.000000)"><g id="Btn"><g id="Oval-302-+-Shape" transform="translate(128.000000, 17.000000)"><circle id="Oval-302" stroke="#FFFFFF" stroke-width="2" cx="20.5" cy="20" r="20"></circle><path d="M17.8,15.4 L19.2,14 L25.2,20 L19.2,26 L17.8,24.6 L22.4,20 L17.8,15.4 Z" id="Shape" fill="#FFFFFF"></path></g></g></g></g></g></g></g></svg></span>\n                <div class="spinner"></div>\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n      <script>\n        function preventInvalidCharacterInput(e) {\n          e = e || window.event;\n\n          var charCode = (typeof e.which == "undefined") ? e.keyCode : e.which;\n          var char = String.fromCharCode(charCode);\n\n          // Slack restricts usernames to lowercase.  This will allow uppercasing,\n          // however we\'ll handle toLowerCase() on submission.\n          if (!(/^[a-zA-Z0-9._-]*$/.test(char))) {\n            e.preventDefault();\n          }\n        }\n\n        function validateForm() {\n          var username_input = document.forms[0]["slack_username"];\n          var slack_username = username_input.value.toLowerCase();\n          var isValid = /^[a-zA-Z]*[a-zA-Z0-9._-]*$/.test(slack_username);\n\n          showSpinner();\n          hideErrorsFor(username_input.parentElement);\n\n          if(!isValid) {\n            hideSpinner();\n            showErrorsFor(username_input.parentElement);\n          }\n\n          return isValid;\n        }\n\n        function showSpinner() {\n          addClass(document.getElementById(\'ok-button\'), \'auth0-spinner\');\n        }\n\n        function hideSpinner() {\n          var elm = document.getElementById(\'ok-button\');\n          removeClass(elm, \'auth0-spinner\');\n        }\n\n        function showErrorsFor(srcElmContainer) {\n          var elm = document.getElementById(\'errors\');\n          removeClass(elm, \'hide\');\n          addClass(srcElmContainer, \'validation-error\');\n        }\n\n        function hideErrorsFor(srcElmContainer) {\n          var elm = document.getElementById(\'errors\');\n          addClass(elm, \'hide\')\n          removeClass(srcElmContainer, \'validation-error\');\n        }\n\n        function removeClass(elm, className) {\n          elm.className = elm.className.replace(\' \' + className, \'\').replace(className + \' \', \'\').replace(className, \'\');\n        }\n\n        function addClass(elm, className) {\n          removeClass(elm, className);\n          elm.className += \' \' + className;\n        }\n      </script>\n    </div>\n  </body>\n  </html>';
}e.exports=n},function(e,t){"use strict";function n(){return'<!DOCTYPE html>\n  <html lang="en">\n  <head>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link rel="icon" href="https://cdn.auth0.com/styleguide/1.0.0/img/badge.png">\n    <meta charset="UTF-8">\n    <title>Auth0 - Slack Multifactor Authentication</title>\n    <style>.modal .body input,body,html{font-family:avenir-next-web,Avenir,"Helvetica Neue",Hevetica,sans-serif;width:100%}.modal .wrong-username{font-size: 13px;margin-top: 20px;font-weight: 400;text-align:center;color: rgba(0,0,0,.86);cursor: pointer;}.modal .body .auth0-lock-input-wrap .auth0-lock-input:focus,a,a:active,a:hover,a:visited,button,button:active,button:hover,button:visited{outline:0}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}@import url(http://fast.fonts.net/t/1.css?apiType=css&projectid=857b99c8-12c9-4d60-85ee-16ebd935d187);@font-face{font-family:avenir-next-web_n2;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5db267f9-3612-485c-ae18-5698d2692816.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/174d458a-81e0-4174-9473-35e3bf0a613c.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/57a79aa3-9b06-4ba7-a9a4-2b766d826ecf.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/733cb7bd-50e1-4dee-893a-0b40ef382b02.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/594135c6-6c4f-4880-a0d2-ba923b5ef38e.svg#594135c6-6c4f-4880-a0d2-ba923b5ef38e) format("svg");font-weight:200;font-style:normal}@font-face{font-family:avenir-next-web_i2;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/9e4f77ac-2ea3-4f4e-b592-290f5c4af932.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/69a545eb-cdd0-4c00-9035-0029d8cede28.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/642cb581-067a-4f15-9df9-55c49c6b5446.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/972d8132-0f21-4d94-b42d-8f4022e6aa17.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/670d40f3-affd-4e16-8ad8-055f11470e24.svg#670d40f3-affd-4e16-8ad8-055f11470e24) format("svg");font-weight:200;font-style:italic}@font-face{font-family:avenir-next-web_n4;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/069faa0e-9913-48c4-9ef7-89a4bc080b65.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/7db1f672-3a8f-4d19-9c49-7f61aed450b5.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/4ab86b35-c0c2-42b5-98ad-4b6eba66b197.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/276b3566-1c3b-4bc1-8915-15314f091f29.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/5d02f5f4-46e7-453a-aef9-3e7106d7bb68.svg#5d02f5f4-46e7-453a-aef9-3e7106d7bb68) format("svg");font-weight:400;font-style:normal}@font-face{font-family:avenir-next-web_i4;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78f55966-cc8e-4f4c-bf8b-8fe59be9fe96.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/b17468ea-cf53-4635-984b-4d930a68ed4d.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/4d1d0d0d-9ea6-4117-901f-8b32ca1ab936.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/66b50093-e606-427c-a42a-a44b2f9ff219.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/78695677-7ebb-4ef8-8996-eff09dc64f26.svg#78695677-7ebb-4ef8-8996-eff09dc64f26) format("svg");font-weight:400;font-style:italic}@font-face{font-family:avenir-next-web_n5;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/c6970a14-8b0f-4629-9072-71c7e123908f.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/b0b84e4d-2164-45c7-a674-1662f19f3ba6.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/e91d1bbf-3fea-45e2-b003-a22b12ce6e5f.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/ead8b64b-1abd-4d5b-a642-a21dfe2f463b.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/e536e1c2-92a4-4db4-8a41-1c55354d11b7.svg#e536e1c2-92a4-4db4-8a41-1c55354d11b7) format("svg");font-weight:700;font-style:normal}@font-face{font-family:avenir-next-web_i5;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix) format("eot")}@font-face{font-family:avenir-next-web;src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix);src:url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/1f022c78-180e-4c6b-b5ee-e1573f17e4b6.eot?#iefix) format("eot"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/349e5647-5161-46bb-a19f-8a609ae235e4.woff2) format("woff2"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/cc0a88c2-524b-4c90-b6f0-a80570222c30.woff) format("woff"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/03aefdc0-0198-4662-a9c7-640a4734063e.ttf) format("truetype"),url(https://cdn.auth0.com/styleguide/latest/lib/font/avenir-next/fonts/132a539d-37fa-48fb-92ec-1f4591f98ee1.svg#132a539d-37fa-48fb-92ec-1f4591f98ee1) format("svg");font-weight:700;font-style:italic}@font-face{font-family:budicon-font;src:url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.eot);src:url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.eot?#iefix) format("embedded-opentype"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.woff) format("woff"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.ttf) format("truetype"),url(https://cdn.auth0.com/fonts/budicons/fonts/budicon-font.svg#budicon-font) format("svg");font-weight:400;font-style:normal}body,html{height:100%;margin:0;padding:0;font-size:62.5%;min-height:100%;background-color:#222228;z-index:1}.modal .body input{border:none;font-size:13px;outline:0}.modal-wrapper{width:100%;height:100%;display:table;background-color:rgba(0,0,0,.15);z-index:2;-webkit-animation:fadein 1s;-moz-animation:fadein 1s;-ms-animation:fadein 1s;-o-animation:fadein 1s;animation:fadein 1s}.modal-centrix{padding:0;vertical-align:middle;display:table-cell;margin:0}.modal{width:100%;max-width:300px;z-index:3;border-radius:0;box-shadow:0 2px 4px rgba(0,0,0,.5);margin:auto}.modal .head{background:#efefef;background:-moz-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-webkit-gradient(linear,left top,right top,color-stop(0,#efefef),color-stop(50%,#fefefe),color-stop(100%,#efefef));background:-webkit-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-o-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:-ms-linear-gradient(left,#efefef 0,#fefefe 50%,#efefef 100%);background:linear-gradient(to right,#efefef 0,#fefefe 50%,#efefef 100%);text-align:center;height:132px}.modal .head .logo{display:inline-block;margin:14px auto 0;width:53px}.modal .head .first-line{display:block;line-height:30px;height:30px;margin:15px 0 0;font-size:22px;color:#333}@media (min-width:414px){.modal{border-radius:5px;top:calc(50% + 40px)}.modal .head{border-radius:5px 5px 0 0}.modal .head .first-line{margin:9px 0 0}}.modal .head .second-line{display:block;line-height:16px;height:16px;margin:3px 0 21px;font-size:12px;color:#333;text-transform:uppercase}.modal .errors{text-align:center;background-color:#f04848;color:#fff;line-height:1.6;font-size:12px;padding:10px}.modal .errors p{margin:0}.modal .errors.hidden{display:none}.modal .body{background-color:#fff;padding:30px;overflow:hidden;border-radius: 0 0 5px 5px;}.modal .body .description{display:block;max-width:290px;font-size:13px;line-height:1.8;color:rgba(0,0,0,.56);text-align:center;margin-bottom:20px}[class*=" icon-"]:before,[class^=icon-]:before,[data-icon]:before{font-family:budicon-font!important;font-style:normal!important;font-weight:400!important;font-variant:normal!important;text-transform:none!important;speak:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.modal .body .auth0-lock-input-wrap,.modal .body .auth0-lock.auth0-lock .auth0-lock-input-wrap{border-radius:3px;border:1px solid #f1f1f1;position:relative;background:#f1f1f1;padding-left:40px;-webkit-transition:border-color .8s;transition:border-color .8s}.modal .body .auth0-lock-input-wrap .auth0-lock-icon.auth0-lock-icon-box{width:12px;height:14px;top:13px;left:14px;position:absolute;font-size:12px}.modal .body .auth0-lock-input-wrap .auth0-lock-input{border:0;padding:0 14px;right:0;height:40px;font-size:13px;width:100%;border-radius:0 2px 2px 0;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;color:#727578}.modal .ok-cancel{display:block;width:100%;overflow:hidden}.modal .ok-cancel button{height:70px;vertical-align:middle;width:50%;float:left;border:0;text-align:center;cursor:pointer;padding:0}.modal .ok-cancel button.ok{background-color:#ea5323}.modal .ok-cancel button.ok:hover{background-color:#ac3610;-webkit-transition:background .3s ease;transition:background .3s ease}.modal .ok-cancel button.ok.full-width{width:100%}.modal .ok-cancel button.cancel{background-color:#5c666f}@media (min-width:414px){.modal .body .description{max-width:348px}.modal .ok-cancel button.ok{border-radius:0 0 5px}.modal .ok-cancel button.ok.full-width{border-radius:0 0 5px 5px}.modal .ok-cancel button.cancel{border-radius:0 0 0 5px}}[data-icon]:before{content:attr(data-icon)}.icon-budicon-377:before{content:""}.icon-budicon-509:before{content:""}.icon-budicon-460:before{content:""}.custom-select{display:inline-block;vertical-align:top;position:relative;border-radius:3px;height:32px;line-height:32px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:1.6rem;padding-right:28px}.custom-select:hover{color:#333}.custom-select i{font-size:12px;position:absolute;top:3px;right:9px;opacity:.7;animation:none}.custom-select span{color:#000;border-bottom:1px solid #6b6b6b;padding-bottom:1px;text-transform:uppercase}.custom-select select{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0}@-ms-keyframes fadein{from{opacity:0}to{opacity:1}}.auth0-spinner{position:relative}.auth0-spinner:before{content:"";background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJgAAACoCAYAAAAcuCeMAAAAAXNSR0IArs4c6QAAFNpJREFUeAHtnQv0HUV9xwlgJCLBEBAJBREKRB4CBWKgoBAoVUh4CT0+ihiMllOqPX14rFg9tNiXpy21VXssLaVSgYNAiKAEODySIEoJIFCqqUgCJr4wCeWlkGj6+V7u/v979+7u3cfMzsze/Z3zu7s7O/P7fX+/+d2Z3dnZ2SlbWaAtW7Z8EbEnWxDtWuTjAHgJnu0aiAX9X5syZcp7TcudYlogwTUNmU/B25uW7YG8vwXDi/DHPcBiGsILCNyFINPWGG1tTNKkoLez28bgkoXX9Vn7baNXYZDqzijZCLB3GEXoj7C1QLmXf/iDbNf4A8soEuN1ZzTA6B6nYu58oyb7I+x6gmtLH861/sAyimQ+dfhKkxKNBhjAToKnmwTokSx1jxHF96O0Nmx3wIjfMGmI6QAz3sSaNLaGrB9T9u5Y+XvZ/0HsuE27RuvQWIDRtG6Llxe0ydMxW26ge/xldNzvKtvaip3Wr8vI3FpbYwEGiuPhmbXQ+Fs47ZqrrQE2g2qYZ6oqTAaY0abVlIEG5GxAxl0pctRlaryvjWSsLo0EGE2q5JzeRk9j0xK6xM1J20j7BWnXJ9Nbcnx6v05rm2MkwEBxDLxrbTR+CsjrCvPO+WlNMVSvJduxxbLm5zIVYMaa1Hy4jZ99Bo235Wi9i3Mbc86HfOosE+BrBxhNqZ5nnmECjIcybqIr1MPtVOLcJk4sST0ZfuIZ/bqtZUntAEP7m+E9aqHwt3Da3WMSbVu7yd0xdG7S2LLHJgKsrd3j8zhzaQGHqgt9tkC+ELPUrlsTAXZmiJ4rgPlmusCfjcpHHk3fuWlUvkDPuw0w+ujDcNzegTpvFOwyXV+RrnSUPh/P70UdH14HWN0WrHaE1wFvsaxapa+WkK+u1OhEvRK6bWetVcd1A6yt3eMtdH3PFq058iq4bi6aP7B8bgKMpvMAHPXGwJxVFG6Z7jGSWaVMVNbn7X7U9UFVAdZpwYwMxFUFbrGcxrZurCBfXaq61jZS5VasToBVVup5DdxBl1d6dJ4yo0b9PTc7F17luq4UYDSZ+wDnTbmQwj1Zp6urU9Znjx1Mne9XBWClAENRW7tHzZC4oYoj+2W+wnZo5kUNeT4VrdSKVQ2wSsp88lYGluV0dZXneFFWc8fuyJAdenKlOi8dYDSVeu54ZOjeysBvooszISMDntPkw6n7vcoiKB1gKKgUyWWBOcivV9IWG9Cr2RUT8/cNyPNJROlxzy7AJqvvG3Rxtd8UQobeQFoxKbZVe6WvvUsFGE3k63DX0a1y2aQxJrs2k7ImEbrfm0sMzCoDo1SAIVhNZNkyZfC4zGsyKNTVRm+Bu7TJtG5NLi3VTZYNlrZef62ka3vCVG0gq7eOhSl5nskpFQOFA4ymcSaGvtUzY03BMdl6RZhsyIxku9weSyzsUhRA4QBDoF5L26ao4MDy2QgGGzJ9cKtioPA7GGUCrFTT6IMnCmJ4hC7tuwXzFs6GzNVkfqBwgbAyFo6FQgFGk7gj9p8Qlg8Ko7U5G7WtrdjxxMSMIh4uFGAIWgBPLSIwwDw2g8CmbJeufgXKTy0CoGiAlR5gK6Lcgzyr6MoetYUD2auQbU2+LdwF5RbqJkcGGE2h1ls9qaDS0LI10cI0ocOF308iNnYYpXhkgCHgFHjaKEGBnm+i8pvQ4cL9Wmpz/ijFRQKsUFM4SpGH51fThVm/y0PHw9j+mIf2m4A0MjZyA4wmcDtQtPGDCnJuky2LzTtVE4FSVcbbiREtf55JuQFGqd+EX51ZOuwTTQZYk7qarBUF19vyFI4KsJFNYJ5wj8+tA5sW8m2E6CZXoujJRpQ1ryQ3RjIDjKZPYx0LmsfbiMb4mveNKERJW1ux3LX1MwMMh5wIv6Yp7zesx0Vlu9DZhFunoyRzbf28AMtt+ppAbknHT5DrYsbpPej9oSWbXIvNjJXUAKN71BPz01yjtqR/MddEjc+ZR6epOf+W3FJL7KnEjL6TMESpAUYuzfvaeSh3OxJcdlUuddusvZ0Qru8kDFFWgGU2eUMSwkrYANw7HUJehu6fOtRvU3Xq8+qhAKOp07zrwhPKbCK2IPsrdFXO3rxGd903xy24xJjI1LX10/rNOajcAX7OmGp/BH3ZAyga1X+nBzhMQ9Cg61Hw13MF04JdDP9ubqbuZOeBhAeImQ/An04kDx+SaRUsWgLPHM7RpXQemPQAMTIDvhYWrZk8k7JHBq1mF6e1HKTeHaQU75LGzAPEht4weiIeMOy/KdMNnPxQIrMOfwH/OZx2vZYpqzvRXg8QC9vAn4A3w0n640zLyXlDMnfs+Ovsvz6zcHdiLDxADOwBL4/FRXI3fTFkcm0Nb0zmThw/zfFvjYUnOyOHPEDdnwlvSMRE8vA5EoZ7OxK1TGJR+hcy6ra0ozHwAHU9Df5c0eAg3+FDbiFxUQkByvpt+JAhQV1CqzxAHR8E/zdchi6InBAfyZ8bJRbczibfvWj9cMH8XbbAPEDdajz0PvjAktD1Bb5BQtjKMiGayHsjx219OD7oqDE4oi53ghcn6rjM4UMDbqKkLvBfKCMhJe860uYNCO4OgvMAdfgW+Psp9Vsm6UUya0b0y8TBvmVK5+TVmNlfwsN3EZGybuulB6gzjW39Gaw6NEEHTBiKtFNMSIzJ+Ab7b5hQ0O147QHqak94Raz+TOyeKqOji/y9DXtANwzfAmUbZw0YdpVbcdSR5v7pmukYw0j2kTxbASbZ0+GrMOAyeHsldOSPB6iTV8FfAJGmD9l4uafXg0UBpg+A26KFCL4fYw6zpaCTW84D1MXBlNDwwwfLlSyVezfljgJs11JFy2fenyLfxLDfh6eUL96VMOUB/K+xrf+CJy/CTQkflNNogEm1FrD7B/gmjCy8iKwKdlTfA/h8JrwESZ+DteaIbXqtFEQt2Azb2mLyT2b/IYw9MZbW7Vr0AL4+DvG6kO/d2VlUFRfdu66LAkxz8JskNZ+3YvhfwZMDck0iGANd+HZb+GJMvR22eZ2d5k2t67vVFADoJVtnb9qgW9cD7+KNm8fZdmTIA9Sr5u5dCbv89M8r1IJppTqXpLeYHsQh73YJok268eXZ2KMu0WVwyaW9AIu6SSW4Io2ZfQnHXA6/2hWI0PXiO41tXYod18C9LsqxTb0AUxfpC50LkAdw0vCENV8QeooDn2lu3v3wIo8gTlHr5fL6K80X+5J4Dw77Q7gbM0vzUCINP32IJC2opzl6PtEmXeRr5sMmn1DFsCxl/1xuAH4SS+t2+x6g7jQH79/h+Z46ZWqvhQCoWjGfusq4v/QF2fcSZLfGE8d9nzqbhw+ugGd56ovN1FnvGkz4/s9TkIKlx1hLcein4bEfM8MHGtv6C3xyG+xrcAHt5ZiK7iA3KsVjUkv7EVjXZr/qMU6r0LD9DShYAV8IR3VnVWcN4c+obARyQw1BTRY9AmW6y/ztJpX6oAubNbfuQVhz7UKg3nVzFGA/CAFxH6Mea12Bw78IN/2Iq3E3YeP28GUovgr2YWyrqA9+pIxRgK0rWsqjfOeARa2ZWrVWErYdhmEa21oYoIG9BY+jAPt+gAYIsq7H3hMo9iKwZZvm0oVIawQ6CrDHQrSgj/m6gLGPgh6ybb3JC1GA/e8oSz09r37+Hk+xmYD1TYSEdH0ct7nXaEUBpoPG146Po6m472TN+4pYSxdjoHILha4vXdB9AcXSdwSjF2AY8gL731VCYBRyF1LU1SHa+D1i6mcyMGrBtP8t/QRE68G6LCC8VaFqYPWpqoUdldNHWHsUD7AHosRAtkv4l2wOBGtlmNgY4tr6mqXco3iAhXaxHGLXEfm97DY0Wye+xalnfD1iUG87dvTQe+rLKV7/6jnXLvy7X/IapSFw1I0e8uvRi403sA2hnBCzib0Z1M3zSplowUj4Ocd62zcE0idhxiK4VBnYqkpbEkLFgPG+KLiEdyLA+uBv629934TWZZjwZyg23xk3NsQA05DKLXEjxmRff/7nArD11jjGZIDp4mx9PIOH+1+lCe6NsXiIzRokbNYlzE3WFJgR/DRiBm4WBwIMI3RL7LsRoXQVZqpsUIrvti8lhgaGjgYCrG/L4kGbvDrSv/hrXiFqFszNqPO59R76A6QF2FKM8HWO/q38Q55ttk790YbtuvVX/fhIwjb05x8KMIx4kYxDkeiJRVqNb9zJVx/cSOzoBmyAhgKsf/Y/B3L5caCxoBv9gOIUha6RfRwDvDzNK1kBdheZv5dWwGHa7fxDdJcy1oQP9BTDt/HKtVmYUgMMIzQP6VLPatJ5t61HNrDr1YhULc59kYiNy4iZ1PmEE88iEwW2wpG7kPYkrGeUrknDJ7thhLNpK/hD8/+vhreB3wmWVWydEFhmovhH8LZOAAwq1aXL6/FH7yWPwVPDj4omzvcr80sTCW53ljsOrnMwX+8katWfQ2Gtmn0eWyeEL9aj+C4nyoeVXpcVXMNZEyk48UDYB7ogAa2RQwzfAdY7mFl0NSecvKuI3vOzQDWcfkStygDskoYBJ9X9koRZtYyoUBidR8KPJcGkHK8mbW4FFbWKoPN1sKnvCiGqEtW/2UDtEZVUmyt0d62aKFkY2FrS6iPwSyVM2ETeC+HUm6aSEApnR1/et7NLwK+c9fjCYPMyol7fg3RFf5CHzeQ5DFSrcFsNQ++gbGOtLbo+XANr3aK3G/M9SN4I61/qgvYyZkiOIAx7G/xjAwY+hYwFOaqMnULPHrAuIVyQ2csCLPisAyusz7DFpqnw38GmK+ofkWl9zAwd+kRP02T+XU0s2Bl+umFL/sTY3z1FELboQ6wacrBF+qTh7BTVxpKQr+vFJklfs93HmAFxQQj+oyYtQde+cf0m95F9LvwsbJueR8Eik9jjspC9t20DEvL/Jq7f6D6K1J2sSii0dTjx8qZJIwA7Hb7SFugcuddwzspbQcjVhyyaoCdQsn2Z+ih1W82IrZ7iawQ79blTGcUF8hp/3oZz5qBXI/LvKqDfdJazEagu82jTgpFn3FcZGC8gBjTvyy7hJF0U26YDTVkBUI1tfRR2dScc95Uw/Clc6s+d5wtk6S7fNuk5bDOEJdvB37FokbEHyWDcDa4ztmXLzDsRvLupGkPWo7aAIveH8E5VsFb6F9FM/hxl74M1y8EGGZm1iVNOAdxD8Ik2QNaUeRzl9d3M02rKiYrb7CYXUefNLxSNcy6GbdCvRV6rsgWQbkYusQHMkkyNMW5XxdaoDOUPsYTtkkhH41sM2hq+xbBhq+sYApb94abuqkya/jDCDqhpe5GH82Uw30fmWmuVVOoiIyfQbOpuUndka6I0A9vKTT3OWIj++2HN2QqNDgbwSmz4YA3glX2XonM9aWdTxxo5cEs45VD4BdgEHVXWGpTuCF9lQrknMq4FR+kxM8rMMYRfd7rzytaD1fwAOseAcWuRkTmNO80A8s+FV8NtIw1q/nqazVlp5NdwzJMGHPF7WTrKptfqIuPKaEqv4PiieFqF/euRoxdORhJO1PXfx8i4At5rZIHwMuwJ5GXY+EnZWgR+33d1u8m/R85ni+hzkgdn/BNcld5aBDTCZ8G3V1USYDkF2q8U9M0xNezT46xSPUgRTEbzCCCs72+XJc3F2mYUGPLMhzXnatxoPQafXsA/atk1MFqWbqZArTvGNGyFmt60gllp/Wb6fZwfWqcgq0w//QbKZg7cYvwr4c+QV2937zxCVhtPayR9MT74PJw5ZoYPdWe/uKQDlpH/TMq6v2MsChwnTIOXwkXppCzZCJgN60FxRy974BE2mc9qOXdCCUfdQd5SMySy6qnxdIDrTeirCxi7QXnTAJL+flhzqjoa9ICGhc7P8Jm+ivvTweypRxokn5YmI5g0DNA1wT+nmjeZeHnSIE69BtZFZ0f5HriO0zNS/Pdv+cV6f3zj11xJHI0dY+yncgxeEAdCvqPhNTn5u1ODHtDY17EJH548mGXg6BKO/L5bjBtTdB+jfgd+ccDULVue4bj3cgRbtXaaK7UZ7qicB+Szi+DenThbPfB/Go6TRugvKFpfQebDwKPgdTGrr5QhHO8O3xlL73areWA5xfbo+zS+7IGGOU5oOmicNJMYuiuGXgO/BT4L1gotl8FaNaaj+h7YiAi9aBINWaxkXw+u17BtlJwEmCwkyLZl89ewxncWwh2Z98B/IFLB9lFXY1zOAizyJYH2DvYvhYfuhKI83baSBzQDVTNRyw66VlKWVch5gAkYQbYnG61FdoyOO6rtgeVIeA/Btba2pJoCjD8qqoIHRzxJuePgi+HMx0Wc6yjfA/LdRfA8H4JLUL1owQQkIlozjeeoNevdCUXp3XakB/QnVat198icDWbwogWL24uDVnB8COz02iGOKYB9zQE71Lfgkt+8CzCBwlEb4TPZ1aCgz59OEVyXJN+cj6/Oks9cAsnS7V0XmQRKl6lZA1fDByXPjfnxI9iv1a7/x2c/eNmCxR2GAx/l+Ej4C/H0Md//PPbP8T24VEfet2DxQKI1O4Pjf4U1ODuOpLGt8wisJaEYH1SAyakEmeam6y5Tj5nGiZZhrO4S14VktPddZNKZOFiDh/Pgi+BxGDOTjZ+ENbYVVHCBOawuUoDjRGumkX+1ZnoS0EZ6AqPeTWDdE6pxwbVgcUfjeA0qapmAuu8CxsX6sv9l2RZycPniSCM4aM00mdHU8gWIckZ6/+ADRpzigZDgLvLzfEbFaHUajZkdnJfP43MPg01jW9/2GGMpaEF3kUlLqRgNOs6BNU4UGul1fY1ttSa4QquAUnhpzU6Fi7y6RTanJIwDL72UMrTL7M4DVJzv8/z10ussdx7qNNf2ABWoN5U+AeuNGl9IWD4Ot+oSpXZlhSyAyvTlXcvVYCm9yF7Ivh8b7FSs67fFtYzCjmPj8HE1lEpeBDe53oV0vX9c/T2WdlPhTa3YoxWvZ4+lk8fdaCpea47pu4626DMItv7NyHGvR+/tJwhMr5qoFRhP8d7wDmBzHiAgTK37qrVjd2sOeacpGA8QGBozuxCuMmamMh+TjGAM7oC68QBBorX3H4eLkvK+2Q3aTmuQHiBgin495CryTg/SyA60ew8QPOfBz8FJUtpC9wg7BMF7gEDaH34gFmHa3y94wzoD/PEAARV9g1Lrm071B5nfSP4fIoP7HP4WgKMAAAAASUVORK5CYII=) center center no-repeat;height:15px;width:15px;background-size:contain;display:inline-block;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);position:absolute}.auth0-spinner .icon{display:none}.auth0-spinner .spinner{margin:0 auto;top:0;position:relative;text-indent:-9999em;border-width:2px;border-style:solid;border-color:rgba(255,255,255,.4) rgba(255,255,255,.4) rgba(255,255,255,.2) rgba(255,255,255,.2);-webkit-animation:loaderAnim .8s infinite linear;animation:loaderAnim .8s infinite linear}.auth0-spinner .spinner,.auth0-spinner .spinner:after{border-radius:50%;width:40px;height:40px}@-moz-keyframes fadein{from{opacity:0}to{opacity:1}}@-webkit-keyframes fadein{from{opacity:0}to{opacity:1}}@-o-keyframes fadein{from{opacity:0}to{opacity:1}}@keyframes fadein{from{opacity:0}to{opacity:1}}@-moz-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loaderAnim{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-o-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}</style>\n  </head>\n  <body>\n    <div class="modal-wrapper">\n      <div class="modal-centrix">\n        <div class="modal">\n          <div class="head"><img src="https://cdn.auth0.com/styleguide/2.0.9/lib/logos/img/badge.png" class="logo auth0"><span class="first-line">Auth0</span></div>\n          <div class="body">\n            <span class="description">We have sent a DM to @<%= slack_username %>.  Click the link in the DM to complete your login request.</span>\n            <% if (!slack_enrolled) { %>\n            <p class="wrong-username">\n              <a href="enroll?token=<%- token%>">Wrong Slack username?</a>\n            </p>\n            <% } %>\n          </div>\n        </div>\n      </div>\n    </div>\n  </body>\n  </html>'}e.exports=n},function(e,t,n){e.exports={default:n(145),__esModule:!0}},function(e,t,n){e.exports={default:n(146),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var o=n(139),i=r(o);t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){"use strict";var r=(n(17).writeIEEE754,n(17).readIEEE754,n(67)),o=n(23),i=n(33),s=n(39),a=n(36),c=n(37),u=n(38),l=n(47),f=n(30),p=n(32),d=n(35),h=n(34),m=n(31),y=n(29),g=n(143),b=n(144),v=n(142),w=17825792,S=new Buffer(w),x=function(){};x.prototype.serialize=function(e,t){t=t||{};var n="boolean"==typeof t.checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,o="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,i=b(S,e,n,0,0,r,o,[]),s=new Buffer(i);return S.copy(s,0,0,s.length),s},x.prototype.serializeWithBufferAndIndex=function(e,t,n){n=n||{};var r="boolean"==typeof n.checkKeys&&n.checkKeys,o="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,i="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0,a=b(S,e,r,s||0,0,o,i);return S.copy(t,s,0,a),a-1},x.prototype.deserialize=function(e,t){return g(e,t)},x.prototype.calculateObjectSize=function(e,t){t=t||{};var n="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,r="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return v(e,n,r)},x.prototype.deserializeStream=function(e,t,n,r,o,i){i=null!=i?i:{};for(var s=t,a=0;a<n;a++){var c=e[s]|e[s+1]<<8|e[s+2]<<16|e[s+3]<<24;i.index=s,r[o+a]=this.deserialize(e,i),s+=c}return s},x.BSON_INT32_MAX=2147483647,x.BSON_INT32_MIN=-2147483648,x.BSON_INT64_MAX=Math.pow(2,63)-1,x.BSON_INT64_MIN=-Math.pow(2,63),x.JS_INT_MAX=9007199254740992,x.JS_INT_MIN=-9007199254740992,o.fromNumber(9007199254740992),o.fromNumber(-9007199254740992),x.BSON_DATA_NUMBER=1,x.BSON_DATA_STRING=2,x.BSON_DATA_OBJECT=3,x.BSON_DATA_ARRAY=4,x.BSON_DATA_BINARY=5,x.BSON_DATA_OID=7,x.BSON_DATA_BOOLEAN=8,x.BSON_DATA_DATE=9,x.BSON_DATA_NULL=10,x.BSON_DATA_REGEXP=11,x.BSON_DATA_CODE=13,x.BSON_DATA_SYMBOL=14,x.BSON_DATA_CODE_W_SCOPE=15,x.BSON_DATA_INT=16,x.BSON_DATA_TIMESTAMP=17,x.BSON_DATA_LONG=18,x.BSON_DATA_MIN_KEY=255,x.BSON_DATA_MAX_KEY=127,x.BSON_BINARY_SUBTYPE_DEFAULT=0,x.BSON_BINARY_SUBTYPE_FUNCTION=1,x.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,x.BSON_BINARY_SUBTYPE_UUID=3,x.BSON_BINARY_SUBTYPE_MD5=4,x.BSON_BINARY_SUBTYPE_USER_DEFINED=128,e.exports=x,e.exports.Code=f,e.exports.Map=r,e.exports.Symbol=u,e.exports.BSON=x,e.exports.DBRef=m,e.exports.Binary=y,e.exports.ObjectID=a,e.exports.Long=o,e.exports.Timestamp=s,e.exports.Double=i,e.exports.Int32=l,e.exports.MinKey=d,e.exports.MaxKey=h,e.exports.BSONRegExp=c,e.exports.Decimal128=p},function(e,t,n){"use strict";function r(e,t,n,r,v){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=b.JS_INT_MIN&&t<=b.JS_INT_MAX&&t>=b.BSON_INT32_MIN&&t<=b.BSON_INT32_MAX?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return r||!v?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||t instanceof p||t instanceof d||"MinKey"==t._bsontype||"MaxKey"==t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof a||"ObjectID"==t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||y(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+6+t.length;if(t instanceof o||t instanceof i||t instanceof s||"Long"==t._bsontype||"Double"==t._bsontype||"Timestamp"==t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if(t instanceof f||"Decimal128"==t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+17;if(t instanceof l||"Code"==t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+g(t.scope,n,v):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof m||"Binary"==t._bsontype)return t.sub_type==m.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof c||"Symbol"==t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof h||"DBRef"==t._bsontype){var w={$ref:t.namespace,$id:t.oid};return null!=t.db&&(w.$db=t.db),(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+g(w,n,v)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof u||"BSONRegExp"==t._bsontype?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+g(t,n,v)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"==String.call(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.toString(),"utf8")+1+g(t.scope,n,v);if(n)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.toString(),"utf8")+1}return 0}var o=(n(17).writeIEEE754,n(17).readIEEE754,n(23).Long),i=n(33).Double,s=n(39).Timestamp,a=n(36).ObjectID,c=n(38).Symbol,u=n(37).BSONRegExp,l=n(30).Code,f=n(32),p=n(35).MinKey,d=n(34).MaxKey,h=n(31).DBRef,m=n(29).Binary,y=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},g=function(e,t,n){var o=5;if(Array.isArray(e))for(var i=0;i<e.length;i++)o+=r(i.toString(),e[i],t,!0,n);else{e.toBSON&&(e=e.toBSON());for(var s in e)o+=r(s,e[s],t,!1,n)}return o},b={};b.BSON_INT32_MAX=2147483647,b.BSON_INT32_MIN=-2147483648,b.JS_INT_MAX=9007199254740992,b.JS_INT_MIN=-9007199254740992,e.exports=g},function(module,exports,__webpack_require__){"use strict";var readIEEE754=__webpack_require__(17).readIEEE754,f=__webpack_require__(1).format,Long=__webpack_require__(23).Long,Double=__webpack_require__(33).Double,Timestamp=__webpack_require__(39).Timestamp,ObjectID=__webpack_require__(36).ObjectID,Symbol=__webpack_require__(38).Symbol,Code=__webpack_require__(30).Code,MinKey=__webpack_require__(35).MinKey,MaxKey=__webpack_require__(34).MaxKey,Decimal128=__webpack_require__(32),Int32=__webpack_require__(47),DBRef=__webpack_require__(31).DBRef,BSONRegExp=__webpack_require__(37).BSONRegExp,Binary=__webpack_require__(29).Binary,deserialize=function(e,t,n){t=null==t?{}:t;var r=t&&t.index?t.index:0,o=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(o<5||e.length<o||o+r>e.length)throw new Error("corrupt bson message");if(0!=e[r+o-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,r,t,n)},deserializeObject=function(e,t,n,r){var o=null!=n.evalFunctions&&n.evalFunctions,i=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32,a=null==n.fieldsAsRaw?null:n.fieldsAsRaw,c=null!=n.raw&&n.raw,u="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,l=null!=n.promoteBuffers&&n.promoteBuffers,f=null==n.promoteLongs||n.promoteLongs,p=null==n.promoteValues||n.promoteValues,d=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var h=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(h<5||h>e.length)throw new Error("corrupt bson message");for(var m=r?[]:{},y=0;;){var g=e[t++];if(0==g)break;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var v=r?y++:e.toString("utf8",t,b);if(t=b+1,g==BSON.BSON_DATA_STRING){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!=e[t+w-1])throw new Error("bad string length in bson");m[v]=e.toString("utf8",t,t+w-1),t+=w}else if(g==BSON.BSON_DATA_OID){var S=new Buffer(12);e.copy(S,0,t,t+12),m[v]=new ObjectID(S),t+=12}else if(g==BSON.BSON_DATA_INT&&0==p)m[v]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(g==BSON.BSON_DATA_INT)m[v]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(g==BSON.BSON_DATA_NUMBER&&0==p)m[v]=new Double(e.readDoubleLE(t)),t+=8;else if(g==BSON.BSON_DATA_NUMBER)m[v]=e.readDoubleLE(t),t+=8;else if(g==BSON.BSON_DATA_DATE){var x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;m[v]=new Date(new Long(x,k).toNumber())}else if(g==BSON.BSON_DATA_BOOLEAN){if(0!=e[t]&&1!=e[t])throw new Error("illegal boolean type value");m[v]=1==e[t++]}else if(g==BSON.BSON_DATA_OBJECT){var _=t,O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(O<=0||O>e.length-t)throw new Error("bad embedded document length in bson");c?m[v]=e.slice(t,t+O):m[v]=deserializeObject(e,_,n,!1),t+=O}else if(g==BSON.BSON_DATA_ARRAY){var _=t,O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,C=n,E=t+O;if(a&&a[v]){C={};for(var I in n)C[I]=n[I];C.raw=!0}if(m[v]=deserializeObject(e,_,C,!0),t+=O,0!=e[t-1])throw new Error("invalid array terminator byte");if(t!=E)throw new Error("corrupted array bson")}else if(g==BSON.BSON_DATA_UNDEFINED)m[v]=void 0;else if(g==BSON.BSON_DATA_NULL)m[v]=null;else if(g==BSON.BSON_DATA_LONG){var x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,N=new Long(x,k);f&&1==p?m[v]=N.lessThanOrEqual(JS_INT_MAX_LONG)&&N.greaterThanOrEqual(JS_INT_MIN_LONG)?N.toNumber():N:m[v]=N}else if(g==BSON.BSON_DATA_DECIMAL128){var A=new Buffer(16);e.copy(A,0,t,t+16),t+=16;var M=new Decimal128(A);m[v]=M.toObject?M.toObject():M}else if(g==BSON.BSON_DATA_BINARY){
var T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,B=T,D=e[t++];if(T<0)throw new Error("Negative binary type element size found");if(T>e.length)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(D==Binary.SUBTYPE_BYTE_ARRAY){if(T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T<0)throw new Error("Negative binary type element size found for subtype 0x02");if(T>B-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(T<B-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}l&&p?m[v]=e.slice(t,t+T):m[v]=new Binary(e.slice(t,t+T),D)}else{var R="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(T)):new Array(T);if(D==Binary.SUBTYPE_BYTE_ARRAY){if(T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T<0)throw new Error("Negative binary type element size found for subtype 0x02");if(T>B-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(T<B-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(var b=0;b<T;b++)R[b]=e[t+b];l&&p?m[v]=R:m[v]=new Binary(R,D)}t+=T}else if(g==BSON.BSON_DATA_REGEXP&&0==u){for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var P=e.toString("utf8",t,b);t=b+1;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var L=e.toString("utf8",t,b);t=b+1;for(var j=new Array(L.length),b=0;b<L.length;b++)switch(L[b]){case"m":j[b]="m";break;case"s":j[b]="g";break;case"i":j[b]="i"}m[v]=new RegExp(P,j.join(""))}else if(g==BSON.BSON_DATA_REGEXP&&1==u){for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var P=e.toString("utf8",t,b);t=b+1;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var L=e.toString("utf8",t,b);t=b+1,m[v]=new BSONRegExp(P,L)}else if(g==BSON.BSON_DATA_SYMBOL){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!=e[t+w-1])throw new Error("bad string length in bson");m[v]=new Symbol(e.toString("utf8",t,t+w-1)),t+=w}else if(g==BSON.BSON_DATA_TIMESTAMP){var x=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,k=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;m[v]=new Timestamp(x,k)}else if(g==BSON.BSON_DATA_MIN_KEY)m[v]=new MinKey;else if(g==BSON.BSON_DATA_MAX_KEY)m[v]=new MaxKey;else if(g==BSON.BSON_DATA_CODE){var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!=e[t+w-1])throw new Error("bad string length in bson");var z=e.toString("utf8",t,t+w-1);if(o)if(i){var U=s?crc32(z):z;m[v]=isolateEvalWithHash(functionCache,U,z,m)}else m[v]=isolateEval(z);else m[v]=new Code(z);t+=w}else if(g==BSON.BSON_DATA_CODE_W_SCOPE){var q=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(q<13)throw new Error("code_w_scope total size shorter minimum expected length");var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!=e[t+w-1])throw new Error("bad string length in bson");var z=e.toString("utf8",t,t+w-1);t+=w;var _=t,O=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,F=deserializeObject(e,_,n,!1);if(t+=O,q<8+O+w)throw new Error("code_w_scope total size is to short, truncating scope");if(q>8+O+w)throw new Error("code_w_scope total size is to long, clips outer document");if(o){if(i){var U=s?crc32(z):z;m[v]=isolateEvalWithHash(functionCache,U,z,m)}else m[v]=isolateEval(z);m[v].scope=F}else m[v]=new Code(z,F)}else{if(g!=BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+g.toString(16)+' for fieldname "'+v+'", are you using the latest BSON parser');var w=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(w<=0||w>e.length-t||0!=e[t+w-1])throw new Error("bad string length in bson");var W=e.toString("utf8",t,t+w-1);t+=w;var V=new Buffer(12);e.copy(V,0,t,t+12);var S=new ObjectID(V);t+=12;var H=W.split("."),G=H.shift(),K=H.join(".");m[v]=new DBRef(K,S,G)}}if(h!=t-d){if(r)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=m.$id&&(m=new DBRef(m.$ref,m.$id,m.$db)),m},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(e,t,n){"use strict";var r=n(17).writeIEEE754,o=(n(17).readIEEE754,n(23).Long),i=n(67),s=(n(33).Double,n(39).Timestamp,n(36).ObjectID,n(38).Symbol,n(30).Code,n(37).BSONRegExp,n(47).Int32,n(35).MinKey),a=(n(34).MaxKey,n(32),n(31).DBRef,n(29).Binary);try{Uint8Array}catch(e){Buffer}var c=/\x00/,u=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},l=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},f=function(e,t,n,r,o){e[r++]=T.BSON_DATA_STRING;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");r=r+i+1,e[r-1]=0;var s=e.write(n,r+4,"utf8");return e[r+3]=s+1>>24&255,e[r+2]=s+1>>16&255,e[r+1]=s+1>>8&255,e[r]=s+1&255,r=r+4+s,e[r++]=0,r},p=function(e,t,n,i,s){if(Math.floor(n)===n&&n>=T.JS_INT_MIN&&n<=T.JS_INT_MAX)if(n>=T.BSON_INT32_MIN&&n<=T.BSON_INT32_MAX){e[i++]=T.BSON_DATA_INT;var a=s?e.write(t,i,"ascii"):e.write(t,i,"utf8");i+=a,e[i++]=0,e[i++]=255&n,e[i++]=n>>8&255,e[i++]=n>>16&255,e[i++]=n>>24&255}else if(n>=T.JS_INT_MIN&&n<=T.JS_INT_MAX){e[i++]=T.BSON_DATA_NUMBER;var a=s?e.write(t,i,"ascii"):e.write(t,i,"utf8");i+=a,e[i++]=0,r(e,n,i,"little",52,8),i+=8}else{e[i++]=T.BSON_DATA_LONG;var a=s?e.write(t,i,"ascii"):e.write(t,i,"utf8");i+=a,e[i++]=0;var c=o.fromNumber(n),u=c.getLowBits(),l=c.getHighBits();e[i++]=255&u,e[i++]=u>>8&255,e[i++]=u>>16&255,e[i++]=u>>24&255,e[i++]=255&l,e[i++]=l>>8&255,e[i++]=l>>16&255,e[i++]=l>>24&255}else{e[i++]=T.BSON_DATA_NUMBER;var a=s?e.write(t,i,"ascii"):e.write(t,i,"utf8");i+=a,e[i++]=0,r(e,n,i,"little",52,8),i+=8}return i},d=function(e,t,n,r,o){e[r++]=T.BSON_DATA_NULL;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");return r+=i,e[r++]=0,r},h=function(e,t,n,r,o){e[r++]=T.BSON_DATA_BOOLEAN;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");return r+=i,e[r++]=0,e[r++]=n?1:0,r},m=function(e,t,n,r,i){e[r++]=T.BSON_DATA_DATE;var s=i?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=s,e[r++]=0;var a=o.fromNumber(n.getTime()),c=a.getLowBits(),u=a.getHighBits();return e[r++]=255&c,e[r++]=c>>8&255,e[r++]=c>>16&255,e[r++]=c>>24&255,e[r++]=255&u,e[r++]=u>>8&255,e[r++]=u>>16&255,e[r++]=u>>24&255,r},y=function(e,t,n,r,o){e[r++]=T.BSON_DATA_REGEXP;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");if(r+=i,e[r++]=0,n.source&&null!=n.source.match(c))throw Error("value "+n.source+" must not contain null bytes");return r+=e.write(n.source,r,"utf8"),e[r++]=0,n.global&&(e[r++]=115),n.ignoreCase&&(e[r++]=105),n.multiline&&(e[r++]=109),e[r++]=0,r},g=function(e,t,n,r,o){e[r++]=T.BSON_DATA_REGEXP;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");if(r+=i,e[r++]=0,null!=n.pattern.match(c))throw Error("pattern "+n.pattern+" must not contain null bytes");return r+=e.write(n.pattern,r,"utf8"),e[r++]=0,r+=e.write(n.options.split("").sort().join(""),r,"utf8"),e[r++]=0,r},b=function(e,t,n,r,o){null===n?e[r++]=T.BSON_DATA_NULL:n instanceof s?e[r++]=T.BSON_DATA_MIN_KEY:e[r++]=T.BSON_DATA_MAX_KEY;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");return r+=i,e[r++]=0,r},v=function(e,t,n,r,o){e[r++]=T.BSON_DATA_OID;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");if(r+=i,e[r++]=0,"string"==typeof n.id)e.write(n.id,r,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,r,0,12)}return r+12},w=function(e,t,n,r,o){e[r++]=T.BSON_DATA_BINARY;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=i,e[r++]=0;var s=n.length;return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=T.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,r,0,s),r+=s},S=function(e,t,n,r,o,i,s,a,c,u){for(var l=0;l<u.length;l++)if(u[l]===n)throw new Error("cyclic dependency detected");u.push(n),e[r++]=Array.isArray(n)?T.BSON_DATA_ARRAY:T.BSON_DATA_OBJECT;var f=c?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=f,e[r++]=0;var p=M(e,n,o,r,i+1,s,a,u);return u.pop(),p},x=function(e,t,n,r,o){e[r++]=T.BSON_DATA_DECIMAL128;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");return r+=i,e[r++]=0,n.bytes.copy(e,r,0,16),r+16},k=function(e,t,n,r,o){e[r++]="Long"==n._bsontype?T.BSON_DATA_LONG:T.BSON_DATA_TIMESTAMP;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=i,e[r++]=0;var s=n.getLowBits(),a=n.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&a,e[r++]=a>>8&255,e[r++]=a>>16&255,e[r++]=a>>24&255,r},_=function(e,t,n,r,o){e[r++]=T.BSON_DATA_INT;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");return r+=i,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r},O=function(e,t,n,o,i){e[o++]=T.BSON_DATA_NUMBER;var s=i?e.write(t,o,"ascii"):e.write(t,o,"utf8");return o+=s,e[o++]=0,r(e,n,o,"little",52,8),o+=8},C=function(e,t,n,r,o,i,s){e[r++]=T.BSON_DATA_CODE;var a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=a,e[r++]=0;var c=n.toString(),u=e.write(c,r+4,"utf8")+1;return e[r]=255&u,e[r+1]=u>>8&255,e[r+2]=u>>16&255,e[r+3]=u>>24&255,r=r+4+u-1,e[r++]=0,r},E=function(e,t,n,r,o,i,s,a,c){if(n.scope&&"object"==typeof n.scope){e[r++]=T.BSON_DATA_CODE_W_SCOPE;var u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=u,e[r++]=0;var l=r,f="string"==typeof n.code?n.code:n.code.toString();r+=4;var p=e.write(f,r+4,"utf8")+1;e[r]=255&p,e[r+1]=p>>8&255,e[r+2]=p>>16&255,e[r+3]=p>>24&255,e[r+4+p-1]=0,r=r+p+4;var d=M(e,n.scope,o,r,i+1,s,a);r=d-1;var h=d-l;e[l++]=255&h,e[l++]=h>>8&255,e[l++]=h>>16&255,e[l++]=h>>24&255,e[r++]=0}else{e[r++]=T.BSON_DATA_CODE;var u=c?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=u,e[r++]=0;var f=n.code.toString(),m=e.write(f,r+4,"utf8")+1;e[r]=255&m,e[r+1]=m>>8&255,e[r+2]=m>>16&255,e[r+3]=m>>24&255,r=r+4+m-1,e[r++]=0}return r},I=function(e,t,n,r,o){e[r++]=T.BSON_DATA_BINARY;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=i,e[r++]=0;var s=n.value(!0),c=n.position;return n.sub_type==a.SUBTYPE_BYTE_ARRAY&&(c+=4),e[r++]=255&c,e[r++]=c>>8&255,e[r++]=c>>16&255,e[r++]=c>>24&255,e[r++]=n.sub_type,n.sub_type==a.SUBTYPE_BYTE_ARRAY&&(c-=4,e[r++]=255&c,e[r++]=c>>8&255,e[r++]=c>>16&255,e[r++]=c>>24&255),s.copy(e,r,0,n.position),r+=n.position},N=function(e,t,n,r,o){e[r++]=T.BSON_DATA_SYMBOL;var i=o?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=i,e[r++]=0;var s=e.write(n.value,r+4,"utf8")+1;return e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255,r=r+4+s-1,e[r++]=0,r},A=function(e,t,n,r,o,i,s){e[r++]=T.BSON_DATA_OBJECT;var a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=a,e[r++]=0;var c,u=r;c=null!=n.db?M(e,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,r,o+1,i):M(e,{$ref:n.namespace,$id:n.oid},!1,r,o+1,i);var l=c-u;return e[u++]=255&l,e[u++]=l>>8&255,e[u++]=l>>16&255,e[u++]=l>>24&255,c},M=function(e,t,n,r,o,s,a,M){r=r||0,M=M||[],M.push(t);var T=r+4;if(Array.isArray(t))for(var B=0;B<t.length;B++){var D=""+B,R=t[B];if(R&&R.toBSON){if("function"!=typeof R.toBSON)throw new Error("toBSON is not a function");R=R.toBSON()}var P=typeof R;"string"==P?T=f(e,D,R,T,!0):"number"==P?T=p(e,D,R,T,!0):"boolean"==P?T=h(e,D,R,T,!0):R instanceof Date||u(R)?T=m(e,D,R,T,!0):void 0===R?T=d(e,D,R,T,!0):null===R?T=d(e,D,R,T,!0):"ObjectID"==R._bsontype?T=v(e,D,R,T,!0):Buffer.isBuffer(R)?T=w(e,D,R,T,!0):R instanceof RegExp||l(R)?T=y(e,D,R,T,!0):"object"==P&&null==R._bsontype?T=S(e,D,R,T,n,o,s,a,!0,M):"object"==P&&"Decimal128"==R._bsontype?T=x(e,D,R,T,!0):"Long"==R._bsontype||"Timestamp"==R._bsontype?T=k(e,D,R,T,!0):"Double"==R._bsontype?T=O(e,D,R,T,!0):"function"==typeof R&&s?T=C(e,D,R,T,n,o,s,!0):"Code"==R._bsontype?T=E(e,D,R,T,n,o,s,a,!0):"Binary"==R._bsontype?T=I(e,D,R,T,!0):"Symbol"==R._bsontype?T=N(e,D,R,T,!0):"DBRef"==R._bsontype?T=A(e,D,R,T,o,s,!0):"BSONRegExp"==R._bsontype?T=g(e,D,R,T,!0):"Int32"==R._bsontype?T=_(e,D,R,T,!0):"MinKey"!=R._bsontype&&"MaxKey"!=R._bsontype||(T=b(e,D,R,T,!0))}else if(t instanceof i)for(var L=t.entries(),j=!1;!j;){var z=L.next();if(j=z.done,!j){var D=z.value[0],R=z.value[1],P=typeof R;if("$db"!=D&&"$ref"!=D&&"$id"!=D){if(null!=D.match(c))throw Error("key "+D+" must not contain null bytes");if(n){if("$"==D[0])throw Error("key "+D+" must not start with '$'");if(~D.indexOf("."))throw Error("key "+D+" must not contain '.'")}}"string"==P?T=f(e,D,R,T):"number"==P?T=p(e,D,R,T):"boolean"==P?T=h(e,D,R,T):R instanceof Date||u(R)?T=m(e,D,R,T):void 0===R&&1==a||(null===R||void 0===R?T=d(e,D,R,T):"ObjectID"==R._bsontype?T=v(e,D,R,T):Buffer.isBuffer(R)?T=w(e,D,R,T):R instanceof RegExp||l(R)?T=y(e,D,R,T):"object"==P&&null==R._bsontype?T=S(e,D,R,T,n,o,s,a,!1,M):"object"==P&&"Decimal128"==R._bsontype?T=x(e,D,R,T):"Long"==R._bsontype||"Timestamp"==R._bsontype?T=k(e,D,R,T):"Double"==R._bsontype?T=O(e,D,R,T):"Code"==R._bsontype?T=E(e,D,R,T,n,o,s,a):"function"==typeof R&&s?T=C(e,D,R,T,n,o,s):"Binary"==R._bsontype?T=I(e,D,R,T):"Symbol"==R._bsontype?T=N(e,D,R,T):"DBRef"==R._bsontype?T=A(e,D,R,T,o,s):"BSONRegExp"==R._bsontype?T=g(e,D,R,T):"Int32"==R._bsontype?T=_(e,D,R,T):"MinKey"!=R._bsontype&&"MaxKey"!=R._bsontype||(T=b(e,D,R,T)))}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new Error("toBSON is not a function");if(t=t.toBSON(),null!=t&&"object"!=typeof t)throw new Error("toBSON function did not return an object")}for(var D in t){var R=t[D];if(R&&R.toBSON){if("function"!=typeof R.toBSON)throw new Error("toBSON is not a function");R=R.toBSON()}var P=typeof R;if("$db"!=D&&"$ref"!=D&&"$id"!=D){if(null!=D.match(c))throw Error("key "+D+" must not contain null bytes");if(n){if("$"==D[0])throw Error("key "+D+" must not start with '$'");if(~D.indexOf("."))throw Error("key "+D+" must not contain '.'")}}"string"==P?T=f(e,D,R,T):"number"==P?T=p(e,D,R,T):"boolean"==P?T=h(e,D,R,T):R instanceof Date||u(R)?T=m(e,D,R,T):void 0===R&&1==a||(null===R||void 0===R?T=d(e,D,R,T):"ObjectID"==R._bsontype?T=v(e,D,R,T):Buffer.isBuffer(R)?T=w(e,D,R,T):R instanceof RegExp||l(R)?T=y(e,D,R,T):"object"==P&&null==R._bsontype?T=S(e,D,R,T,n,o,s,a,!1,M):"object"==P&&"Decimal128"==R._bsontype?T=x(e,D,R,T):"Long"==R._bsontype||"Timestamp"==R._bsontype?T=k(e,D,R,T):"Double"==R._bsontype?T=O(e,D,R,T):"Code"==R._bsontype?T=E(e,D,R,T,n,o,s,a):"function"==typeof R&&s?T=C(e,D,R,T,n,o,s):"Binary"==R._bsontype?T=I(e,D,R,T):"Symbol"==R._bsontype?T=N(e,D,R,T):"DBRef"==R._bsontype?T=A(e,D,R,T,o,s):"BSONRegExp"==R._bsontype?T=g(e,D,R,T):"Int32"==R._bsontype?T=_(e,D,R,T):"MinKey"!=R._bsontype&&"MaxKey"!=R._bsontype||(T=b(e,D,R,T)))}}M.pop(),e[T++]=0;var U=T-r;return e[r++]=255&U,e[r++]=U>>8&255,e[r++]=U>>16&255,e[r++]=U>>24&255,T},T={};T.functionCache={},T.BSON_DATA_NUMBER=1,T.BSON_DATA_STRING=2,T.BSON_DATA_OBJECT=3,T.BSON_DATA_ARRAY=4,T.BSON_DATA_BINARY=5,T.BSON_DATA_UNDEFINED=6,T.BSON_DATA_OID=7,T.BSON_DATA_BOOLEAN=8,T.BSON_DATA_DATE=9,T.BSON_DATA_NULL=10,T.BSON_DATA_REGEXP=11,T.BSON_DATA_CODE=13,T.BSON_DATA_SYMBOL=14,T.BSON_DATA_CODE_W_SCOPE=15,T.BSON_DATA_INT=16,T.BSON_DATA_TIMESTAMP=17,T.BSON_DATA_LONG=18,T.BSON_DATA_DECIMAL128=19,T.BSON_DATA_MIN_KEY=255,T.BSON_DATA_MAX_KEY=127,T.BSON_BINARY_SUBTYPE_DEFAULT=0,T.BSON_BINARY_SUBTYPE_FUNCTION=1,T.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,T.BSON_BINARY_SUBTYPE_UUID=3,T.BSON_BINARY_SUBTYPE_MD5=4,T.BSON_BINARY_SUBTYPE_USER_DEFINED=128,T.BSON_INT32_MAX=2147483647,T.BSON_INT32_MIN=-2147483648,T.BSON_INT64_MAX=Math.pow(2,63)-1,T.BSON_INT64_MIN=-Math.pow(2,63),T.JS_INT_MAX=9007199254740992,T.JS_INT_MIN=-9007199254740992,o.fromNumber(9007199254740992),o.fromNumber(-9007199254740992),e.exports=M},function(e,t,n){var r=n(18),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t,n){n(176),e.exports=n(18).Object.assign},function(e,t,n){n(177),n(179),n(180),n(178),e.exports=n(18).Promise},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(76),o=n(101),i=n(172);e.exports=function(e){return function(t,n,s){var a,c=r(t),u=o(c.length),l=i(s,u);if(e&&n!=n){for(;u>l;)if(a=c[l++],a!=a)return!0}else for(;u>l;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(49),o=n(155),i=n(154),s=n(24),a=n(101),c=n(174),u={},l={},t=e.exports=function(e,t,n,f,p){var d,h,m,y,g=p?function(){return e}:c(e),b=r(n,f,t?2:1),v=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(i(g)){for(d=a(e.length);d>v;v++)if(y=t?b(s(h=e[v])[0],h[1]):b(e[v]),y===u||y===l)return y}else for(m=g.call(e);!(h=m.next()).done;)if(y=o(m,b,h.value,t),y===u||y===l)return y};t.BREAK=u,t.RETURN=l},function(e,t,n){e.exports=!n(40)&&!n(72)(function(){return 7!=Object.defineProperty(n(70)("div"),"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(41),o=n(10)("iterator"),i=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||i[o]===e)}},function(e,t,n){var r=n(24);e.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&r(i.call(e)),t}}},function(e,t,n){"use strict";var r=n(161),o=n(98),i=n(73),s={};n(25)(s,n(10)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(s,{next:o(1,n)}),i(e,t+" Iterator")}},function(e,t,n){var r=n(10)("iterator"),o=!1;try{var i=[7][r]();i.return=function(){o=!0},Array.from(i,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i=[7],s=i[r]();s.next=function(){return{done:n=!0}},i[r]=function(){return s},e(i)}catch(e){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(11),o=n(100).set,i=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,c="process"==n(48)(s);e.exports=function(){var e,t,n,u=function(){var r,o;for(c&&(r=s.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){s.nextTick(u)};else if(i){var l=!0,f=document.createTextNode("");new i(u).observe(f,{characterData:!0}),n=function(){f.data=l=!l}}else if(a&&a.resolve){var p=a.resolve();n=function(){p.then(u)}}else n=function(){o.call(r,u)};return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,n()),t=o}}},function(e,t,n){"use strict";var r=n(97),o=n(163),i=n(166),s=n(102),a=n(94),c=Object.assign;e.exports=!c||n(72)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r})?function(e,t){for(var n=s(e),c=arguments.length,u=1,l=o.f,f=i.f;c>u;)for(var p,d=a(arguments[u++]),h=l?r(d).concat(l(d)):r(d),m=h.length,y=0;m>y;)f.call(d,p=h[y++])&&(n[p]=d[p]);return n}:c},function(e,t,n){var r=n(24),o=n(162),i=n(92),s=n(74)("IE_PROTO"),a=function(){},c="prototype",u=function(){var e,t=n(70)("iframe"),r=i.length,o="<",s=">";for(t.style.display="none",n(93).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(o+"script"+s+"document.F=Object"+o+"/script"+s),e.close(),u=e.F;r--;)delete u[c][i[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(a[c]=r(e),n=new a,a[c]=null,n[s]=e):n=u(),void 0===t?n:o(n,t)}},function(e,t,n){var r=n(52),o=n(24),i=n(97);e.exports=n(40)?Object.defineProperties:function(e,t){o(e);for(var n,s=i(t),a=s.length,c=0;a>c;)r.f(e,n=s[c++],t[n]);return e}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(50),o=n(102),i=n(74)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){var r=n(50),o=n(76),i=n(150)(!1),s=n(74)("IE_PROTO");e.exports=function(e,t){var n,a=o(e),c=0,u=[];for(n in a)n!=s&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~i(u,n)||u.push(n));return u}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(25);e.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},function(e,t,n){e.exports=n(25)},function(e,t,n){"use strict";var r=n(11),o=n(18),i=n(52),s=n(40),a=n(10)("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];s&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(24),o=n(68),i=n(10)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[i])?t:o(n)}},function(e,t,n){var r=n(75),o=n(69);e.exports=function(e){return function(t,n){var i,s,a=String(o(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(i=a.charCodeAt(c),i<55296||i>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):i:e?a.slice(c,c+2):(i-55296<<10)+(s-56320)+65536)}}},function(e,t,n){var r=n(75),o=Math.max,i=Math.min;e.exports=function(e,t){return e=r(e),e<0?o(e+t,0):i(e,t)}},function(e,t,n){var r=n(51);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(91),o=n(10)("iterator"),i=n(41);e.exports=n(18).getIteratorMethod=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||i[r(e)]}},function(e,t,n){"use strict";var r=n(148),o=n(158),i=n(41),s=n(76);e.exports=n(95)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,n):"values"==t?o(0,e[n]):o(0,[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var r=n(71);r(r.S+r.F,"Object",{assign:n(160)})},function(e,t){},function(e,t,n){"use strict";var r,o,i,s=n(96),a=n(11),c=n(49),u=n(91),l=n(71),f=n(51),p=n(68),d=n(149),h=n(151),m=n(170),y=n(100).set,g=n(159)(),b="Promise",v=a.TypeError,w=a.process,S=a[b],w=a.process,x="process"==u(w),k=function(){},_=!!function(){try{var e=S.resolve(1),t=(e.constructor={})[n(10)("species")]=function(e){e(k,k)};return(x||"function"==typeof PromiseRejectionEvent)&&e.then(k)instanceof t}catch(e){}}(),O=function(e,t){return e===t||e===S&&t===i},C=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},E=function(e){return O(S,e)?new I(e):new o(e)},I=o=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw v("Bad Promise constructor");t=e,n=r}),this.resolve=p(t),this.reject=p(n)},N=function(e){try{e()}catch(e){return{error:e}}},A=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,o=1==e._s,i=0,s=function(t){var n,i,s=o?t.ok:t.fail,a=t.resolve,c=t.reject,u=t.domain;try{s?(o||(2==e._h&&B(e),e._h=1),s===!0?n=r:(u&&u.enter(),n=s(r),u&&u.exit()),n===t.promise?c(v("Promise-chain cycle")):(i=C(n))?i.call(n,a,c):a(n)):c(r)}catch(e){c(e)}};n.length>i;)s(n[i++]);e._c=[],e._n=!1,t&&!e._h&&M(e)})}},M=function(e){y.call(a,function(){var t,n,r,o=e._v;if(T(e)&&(t=N(function(){x?w.emit("unhandledRejection",o,e):(n=a.onunhandledrejection)?n({promise:e,reason:o}):(r=a.console)&&r.error&&r.error("Unhandled promise rejection",o)}),e._h=x||T(e)?2:1),e._a=void 0,t)throw t.error})},T=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!T(t.promise))return!1;return!0},B=function(e){y.call(a,function(){var t;x?w.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),A(t,!0))},R=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw v("Promise can't be resolved itself");(t=C(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,c(R,r,1),c(D,r,1))}catch(e){D.call(r,e)}}):(n._v=e,n._s=1,A(n,!1))}catch(e){D.call({_w:n,_d:!1},e)}}};_||(S=function(e){d(this,S,b,"_h"),p(e),r.call(this);try{e(c(R,this,1),c(D,this,1))}catch(e){D.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(167)(S.prototype,{then:function(e,t){var n=E(m(this,S));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=x?w.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&A(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),I=function(){var e=new r;this.promise=e,this.resolve=c(R,e,1),this.reject=c(D,e,1)}),l(l.G+l.W+l.F*!_,{Promise:S}),n(73)(S,b),n(169)(b),i=n(18)[b],l(l.S+l.F*!_,b,{reject:function(e){var t=E(this),n=t.reject;return n(e),t.promise}}),l(l.S+l.F*(s||!_),b,{resolve:function(e){if(e instanceof S&&O(e.constructor,this))return e;var t=E(this),n=t.resolve;return n(e),t.promise}}),l(l.S+l.F*!(_&&n(157)(function(e){S.all(e).catch(k)})),b,{all:function(e){var t=this,n=E(t),r=n.resolve,o=n.reject,i=N(function(){var n=[],i=0,s=1;h(e,!1,function(e){var a=i++,c=!1;n.push(void 0),s++,t.resolve(e).then(function(e){c||(c=!0,n[a]=e,--s||r(n))},o)}),--s||r(n)});return i&&o(i.error),n.promise},race:function(e){var t=this,n=E(t),r=n.reject,o=N(function(){h(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return o&&r(o.error),n.promise}})},function(e,t,n){"use strict";var r=n(171)(!0);n(95)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){n(175);for(var r=n(11),o=n(25),i=n(41),s=n(10)("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],c=0;c<5;c++){var u=a[c],l=r[u],f=l&&l.prototype;f&&!f[s]&&o(f,s,u),i[u]=i.Array}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t){e.exports={_args:[[{raw:"mongodb-core@2.1.2",scope:null,escapedName:"mongodb-core",name:"mongodb-core",rawSpec:"2.1.2",spec:"2.1.2",type:"version"},"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/node_modules/mongodb"]],_from:"mongodb-core@2.1.2",_id:"mongodb-core@2.1.2",_inCache:!0,_location:"/mongodb-core",_nodeVersion:"6.9.1",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/mongodb-core-2.1.2.tgz_1481385289831_0.8470144462771714"},_npmUser:{name:"christkv",email:"christkv@gmail.com"},_npmVersion:"3.10.8",_phantomChildren:{},_requested:{raw:"mongodb-core@2.1.2",scope:null,escapedName:"mongodb-core",name:"mongodb-core",rawSpec:"2.1.2",spec:"2.1.2",type:"version"},_requiredBy:["/mongodb"],_resolved:"https://registry.npmjs.org/mongodb-core/-/mongodb-core-2.1.2.tgz",_shasum:"a11db773d34819cbeb97751241827137ab535aab",_shrinkwrap:null,_spec:"mongodb-core@2.1.2",_where:"/Users/sgmeyer/Source/auth0-extensions/auth0-slack-mfa/node_modules/mongodb",author:{name:"Christian Kvalheim"},bugs:{url:"https://github.com/christkv/mongodb-core/issues"},dependencies:{bson:"~1.0.1",require_optional:"~1.0.0"},description:"Core MongoDB driver functionality, no bells and whistles and meant for integration not end applications",devDependencies:{co:"^4.5.4",coveralls:"^2.11.6","es6-promise":"^3.0.2",gleak:"0.5.0",integra:"0.1.8",jsdoc:"3.3.0-alpha8",mkdirp:"0.5.0","mongodb-topology-manager":"1.0.6","mongodb-version-manager":"github:christkv/mongodb-version-manager#master",nyc:"^5.5.0",optimist:"latest",rimraf:"2.2.6",semver:"4.1.0"},directories:{},dist:{shasum:"a11db773d34819cbeb97751241827137ab535aab",tarball:"https://registry.npmjs.org/mongodb-core/-/mongodb-core-2.1.2.tgz"},gitHead:"6783e5ac19a0374dfe0e8becf77ac95ed0ab3b97",homepage:"https://github.com/christkv/mongodb-core",keywords:["mongodb","core"],license:"Apache-2.0",main:"index.js",maintainers:[{name:"christkv",email:"christkv@gmail.com"}],name:"mongodb-core",optionalDependencies:{},peerOptionalDependencies:{kerberos:"~0.0","bson-ext":"1.0.1"},readme:"ERROR: No README data found!",repository:{type:"git",url:"git://github.com/christkv/mongodb-core.git"},scripts:{coverage:"nyc node test/runner.js -t functional -l && node_modules/.bin/nyc report --reporter=text-lcov | node_modules/.bin/coveralls",lint:"eslint lib",test:"node test/runner.js -t functional"},version:"2.1.2"}},function(e,t){e.exports={title:"Slack MFA",name:"auth0-slack-mfa",version:"0.0.1",author:"auth0",description:"This extension gives the ability to add multifactor authentication using Slack.",type:"application",useHashName:!1,initialUrlPath:"/admins/login",uninstallConfirmMessage:"Do you really want to uninstall this extension?",repository:"https://github.com/auth0-extensions/auth0-slack-mfa",keywords:["auth0","extension","slack","mfa"],auth0:{createClient:!0,onInstallPath:"/.extensions/on-install",onUninstallPath:"/.extensions/on-uninstall",scopes:"read:clients delete:clients read:rules create:rules update:rules delete:rules"},secrets:{SLACK_API_TOKEN:{example:"Slack API Token",description:"Your Slack API token.",required:!0},MONGO_CONNECTION_STRING:{example:"Slack API Token",description:"Your MongoDB connection string.",required:!0},SIGNING_SECRET:{example:"mZj2fpwpwbbiepepBofeappfoe9929294949",description:"The secret used to sign the JWT's used by this extension.",required:!0,type:"password"}}}},function(e,t,n){"use strict";function r(e,t){var n={disconnected:[B,R,T],connecting:[B,R,D,T],connected:[D,T,R],destroying:[R,P],destroyed:[P]},r=n[e.state];r&&r.indexOf(t)!=-1?e.state=t:e.logger.error(x("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,r))}function o(e,t,n,r){if(void 0===t[0])return r(null);var o=t[0],s=t[1];if(!e.authProviders[o])throw new w(x("authMechanism %s not supported",o));var a=e.authProviders[o];a.auth.apply(a,[i(e),[n],s].concat(t.slice(2)).concat([r]))}function i(e){return function(t,n,r){return e.state==P||e.state==R?r(new w("pool destroyed")):(t.workItems.push({cb:r,command:!0,requestId:n.requestId}),void t.write(n.toBin()))}}function s(e,t,n){function r(e,t,n,o){if(0==n.length)return o();var s=e.authProviders[n.pop()];s.reauthenticate(i(e),[t],function(i){return i?o(i):void r(e,t,n,o)})}r(e,t,Object.keys(e.authProviders),n)}function a(e,t){return function(n){if(!this._connectionFailHandled){
for(this._connectionFailHandled=!0,this.destroy(),d(e,this);this.workItems.length>0;){var o=this.workItems.shift();o.cb&&o.cb(n)}if("timeout"==t&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);0==e.socketCount()&&(e.state!=P&&e.state!=R&&r(e,T),t="error"==t?"close":t,e.emit(t,n)),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(c(e),e.options.reconnectInterval))}}}function c(e){return function(){function t(e){return function(){this._connectionFailHandled||(this._connectionFailHandled=!0,this.destroy(),e.retriesLeft=e.retriesLeft-1,0==e.retriesLeft?(e.destroy(),e.emit("reconnectFailed",new w(x("failed to reconnect after %s attempts with interval %s ms",e.options.reconnectTries,e.options.reconnectInterval)))):e.reconnectId=setTimeout(c(e),e.options.reconnectInterval))}}function n(e){return function(){var t=this;return e.state==P||e.state==R?t.destroy():(U.forEach(function(e){t.removeAllListeners(e)}),e.reconnectId=null,t.on("error",a(e,"error")),t.on("close",a(e,"close")),t.on("timeout",a(e,"timeout")),t.on("parseError",a(e,"parseError")),void s(e,this,function(){e.retriesLeft=e.options.reconnectTries,e.availableConnections.push(t),e.emit("reconnect",e),y(e)()}))}}if(e.emit("attemptReconnect",e),e.state!=P&&e.state!=R){if(e.isConnected())return void(e.reconnectId=null);var r=new v(l(e),e.options);r.on("close",t(e,"close")),r.on("error",t(e,"error")),r.on("timeout",t(e,"timeout")),r.on("parseError",t(e,"parseError")),r.on("connect",n(e)),r.connect()}}}function u(e,t,n){var r=t.indexOf(e);r!=-1&&(t.splice(r,1),n.push(e))}function l(e){return function(t,n){function r(e,t,n){var r=e.nonAuthenticatedConnections.slice(0),o=e.nonAuthenticatedConnections;if(e.nonAuthenticatedConnections=[],1==t.workItems.length&&(1==t.workItems[0].authenticating||"number"==typeof t.workItems[0].authenticatingTimestamp&&t.workItems[0].authenticatingTimestamp!=e.authenticatingTimestamp)&&r.push(t),0==r.length)return u(t,e.inUseConnections,e.availableConnections),n();for(var i=r.length,a=0;a<i;a++)s(e,r[a],function(){i-=1,0==i&&(e.availableConnections=e.availableConnections.concat(o),u(t,e.inUseConnections,e.availableConnections),n())})}function o(e,t,n,r){return e.options.domainsEnabled?void t(n,r):process.nextTick(function(){return t(n,r)})}for(var i=null,a=0;a<n.workItems.length;a++)n.workItems[a].requestId==t.responseTo&&(i=n.workItems[a],n.workItems.splice(a,1));e.numberOfConsecutiveTimeouts=0,i.socketTimeout&&n.resetSocketTimeout(),e.logger.isDebug()&&e.logger.debug(x("message [%s] received from %s:%s",t.raw.toString("hex"),e.options.host,e.options.port)),r(e,n,function(){if(e.executing||process.nextTick(function(){y(e)()}),!i.immediateRelease){try{t.parse(i)}catch(t){return o(e,i.cb,w.create(t))}if(i.command&&t.documents[0]&&(0==t.documents[0].ok||t.documents[0].$err||t.documents[0].errmsg||t.documents[0].code))return o(e,i.cb,w.create(t.documents[0]));t.hashedName=n.hashedName,o(e,i.cb,null,new _(i.fullResult?t:t.documents[0],n,t))}})}}function f(e,t){t.forEach(function(e){for(var t=0;t<z.length;t++)e.removeAllListeners(z[t]);e.destroy()}),e.inUseConnections=[],e.availableConnections=[],e.nonAuthenticatedConnections=[],e.connectingConnections=[],r(e,P)}function p(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0}function d(e,t){p(t,e.availableConnections)||p(t,e.inUseConnections)||p(t,e.connectingConnections)||p(t,e.nonAuthenticatedConnections)}function h(e){var t=new v(l(e),e.options);e.connectingConnections.push(t);var n=function(t){return function(){t.destroy(),d(e,t),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(c(e),e.options.reconnectInterval))}},r=function(t){return function(){return e.state==P||e.state==R?(d(e,t),t.destroy()):(U.forEach(function(e){t.removeAllListeners(e)}),t.once("close",a(e,"close")),t.once("error",a(e,"error")),t.once("timeout",a(e,"timeout")),t.once("parseError",a(e,"parseError")),void s(e,t,function(n){return e.state==P||e.state==R?t.destroy():(d(e,t),n?t.destroy():void(e.authenticating?e.nonAuthenticatedConnections.push(t):(e.availableConnections.push(t),y(e)())))}))}};t.once("close",n(t)),t.once("error",n(t)),t.once("timeout",n(t)),t.once("parseError",n(t)),t.once("connect",r(t)),t.connect()}function m(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var n=e[t];e.splice(t,1),n.cb(new w({message:"no connection available for monitoring",driver:!0}))}}function y(e){return function(){function t(n){return e.authenticating?void setTimeout(function(){t(n)},1):n()}e.state!=P&&(e.executing||(e.executing=!0,t(function(){for(;;){var t=e.availableConnections.length+e.connectingConnections.length+e.inUseConnections.length;if(0==e.availableConnections.length){m(e.queue);break}if(0==e.queue.length)break;var n=e.availableConnections[e.connectionIndex++%e.availableConnections.length];if(n.isConnected()){var r=e.queue.shift(),o=r.buffer;if(r.authenticating=e.authenticating,r.authenticatingTimestamp=e.authenticatingTimestamp,r.monitoring&&u(n,e.availableConnections,e.inUseConnections),r.noResponse||n.workItems.push(r),r.immediateRelease||"number"!=typeof r.socketTimeout||n.setSocketTimeout(r.socketTimeout),Array.isArray(o))for(var i=0;i<o.length;i++)n.write(o[i]);else n.write(o);r.immediateRelease&&e.authenticating&&e.nonAuthenticatedConnections.push(n),t<e.options.size&&e.queue.length>0&&h(e)}else d(e,n),m(e.queue)}}),e.executing=!1))}}var g=n(1).inherits,b=n(9).EventEmitter,v=n(106),w=n(4),S=n(15),x=n(1).format,k=n(5).Query,_=n(105),O=n(12).assign,C=n(54),E=n(57),I=n(55),N=n(53),A=n(78),M=n(56),T="disconnected",B="connecting",D="connected",R="destroying",P="destroyed",L=0,j=function(e){if(b.call(this),this.options=O({host:"localhost",port:27017,size:5,connectionTimeout:3e4,socketTimeout:3e4,keepAlive:!0,keepAliveInitialDelay:0,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,cert:null,key:null,passPhrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1},e),this.id=L++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,!e.bson||e.bson&&("function"!=typeof e.bson.serialize||"function"!=typeof e.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=S("Pool",e),this.state=T,this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=[],this.executing=!1,this.queue=[],this.authProviders=e.authProviders||{mongocr:new C(e.bson),x509:new E(e.bson),plain:new I(e.bson),gssapi:new N(e.bson),sspi:new A(e.bson),"scram-sha-1":new M(e.bson)},this.authenticating=!1,this.loggingout=!1,this.nonAuthenticatedConnections=[],this.authenticatingTimestamp=null,this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0};g(j,b),Object.defineProperty(j.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(j.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(j.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),j.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},j.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections)},j.prototype.get=function(){return this.allConnections()[0]},j.prototype.isConnected=function(){if(this.state==P||this.state==R)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!(0!=e.length||!this.authenticating)},j.prototype.isDestroyed=function(){return this.state==P||this.state==R},j.prototype.isDisconnected=function(){return this.state==T},j.prototype.connect=function(){if(this.state!=T)throw new w("connection in unlawful state "+this.state);var e=this;r(this,B);var t=Array.prototype.slice.call(arguments,0),n=new v(l(e),this.options);this.connectingConnections.push(n),n.once("connect",function(n){return e.state==P||e.state==R?e.destroy():void s(e,n,function(i){return e.state==P||e.state==R?e.destroy():i?(e.destroy(),e.emit("error",i)):void o(e,t,n,function(t){return e.state==P||e.state==R?e.destroy():t?(e.destroy(),e.emit("error",t)):(r(e,D),u(n,e.connectingConnections,e.availableConnections),void e.emit("connect",e))})})}),n.once("error",a(this,"error")),n.once("close",a(this,"close")),n.once("timeout",a(this,"timeout")),n.once("parseError",a(this,"parseError"));try{n.connect()}catch(t){e.emit("error",t)}},j.prototype.auth=function(e){function t(e,t,n){var r=e.availableConnections;e.availableConnections=[];var i=r.length,a=null;if(0==i)return s(null);for(var c=0;c<r.length;c++)o(e,t,r[c],function(t){if(i-=1,t&&(a=t),0==i){if(e.authenticating=!1,e.availableConnections=e.availableConnections.concat(r),a)return e.logger.isError()&&e.logger.error(x("[%s] failed to authenticate against server %s:%s",e.id,e.options.host,e.options.port)),n(a);n(null)}})}function n(e,t){return e.loggingout?void setTimeout(function(){n(e,t)},1):t()}var r=this,i=Array.prototype.slice.call(arguments,0),s=i.pop();if(null==r.authProviders[e]&&"default"!=e)throw new w(x("auth provider %s does not exist",e));this.authenticating=!0,this.authenticatingTimestamp=(new Date).getTime(),n(r,function(){t(r,i,function(e){r.authenticating=!1,s(e)})})},j.prototype.logout=function(e,t){var n=this;if("string"!=typeof e)throw new w("logout method requires a db name as first argument");if("function"!=typeof t)throw new w("logout method requires a callback");this.loggingout=!0;for(var r=n.availableConnections.concat(n.inUseConnections),o=r.length,s=null,a=0;a<r.length;a++)i(n)(r[a],new k(this.options.bson,x("%s.$cmd",e),{logout:1},{numberToSkip:0,numberToReturn:1}),function(e){o-=1,e&&(s=e),0==o&&(n.loggingout=!1,t(s))})},j.prototype.unref=function(){var e=this.availableConnections.concat(this.inUseConnections).concat(this.connectingConnections);e.forEach(function(e){e.unref()})};var z=["error","close","timeout","parseError","connect"];j.prototype.destroy=function(e){function t(){if(0==n.queue.length){for(var e=n.availableConnections.concat(n.inUseConnections).concat(n.nonAuthenticatedConnections).concat(n.connectingConnections),r=0;r<e.length;r++)if(e[r].workItems.length>0)return setTimeout(t,1);f(n,e)}else setTimeout(t,1)}var n=this;if(this.state!=P&&n.state!=R){if(r(this,R),e){var o=n.availableConnections.concat(n.inUseConnections).concat(n.nonAuthenticatedConnections).concat(n.connectingConnections);return f(n,o)}t()}},j.prototype.write=function(e,t,n){var r=this;if("function"==typeof t&&(n=t),t=t||{},this.state!=P&&this.state!=R){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var o=n;n=process.domain.bind(function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];process.nextTick(function(){o.apply(null,e)})})}var i={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1},s=null;if(Array.isArray(e)){s=[];for(var a=0;a<e.length;a++)s.push(e[a].toBin());i.requestId=e[e.length-1].requestId}else i.requestId=e.requestId,s=e.toBin();if(i.buffer=s,i.promoteLongs="boolean"!=typeof t.promoteLongs||t.promoteLongs,i.promoteValues="boolean"!=typeof t.promoteValues||t.promoteValues,i.promoteBuffers="boolean"==typeof t.promoteBuffers&&t.promoteBuffers,i.raw="boolean"==typeof t.raw&&t.raw,i.immediateRelease="boolean"==typeof t.immediateRelease&&t.immediateRelease,i.documentsReturnedIn=t.documentsReturnedIn,i.command="boolean"==typeof t.command&&t.command,i.fullResult="boolean"==typeof t.fullResult&&t.fullResult,i.noResponse="boolean"==typeof t.noResponse&&t.noResponse,i.socketTimeout=t.socketTimeout,i.monitoring=t.monitoring,t.socketTimeout&&(i.socketTimeout=t.socketTimeout),"function"!=typeof n&&!t.noResponse)throw new w("write method must provide a callback");t.monitoring?this.queue.unshift(i):this.queue.push(i),r.executing||process.nextTick(function(){y(r)()})}else if(n)try{n(new w("pool destroyed"))}catch(e){process.nextTick(function(){throw e})}};var U=["close","message","error","timeout","parseError","connect"];j._execute=y,e.exports=j},function(e,t,n){"use strict";function r(e,t){var n={disconnected:[T,D,M],connecting:[T,D,B,M],connected:[B,M,D],destroyed:[D]},r=n[e.state];r&&r.indexOf(t)!=-1?e.state=t:e.logger.error(h("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,r))}function o(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}function i(e){return function(){e.state!=D&&(u(e.connectedProxies,e.disconnectedProxies,this),e.emit("left","mongos",this))}}function s(e,t){return function(){if(e.state==D)return u(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"==t)if(e.ismaster=this.lastIsMaster(),"isdbgrid"==e.ismaster.msg){for(var n=0;n<e.connectedProxies.length;n++)if(e.connectedProxies[n].name==this.name)return u(e.connectingProxies,e.disconnectedProxies,this),this.destroy(),e.emit("failed",this);for(n=0;n<P.length;n++)this.removeAllListeners(P[n]);this.on("error",i(e,"error")),this.on("close",i(e,"close")),this.on("timeout",i(e,"timeout")),this.on("parseError",i(e,"parseError")),u(e.connectingProxies,e.connectedProxies,this),e.emit("joined","mongos",this)}else{if(e.s.logger.isWarn()){var o="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(o="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(h(o,this.name))}l(e.connectingProxies,this),e.emit("left","server",this),e.emit("failed",this)}else u(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this);if(0==e.connectingProxies.length){if(e.connectedProxies.length>0)r(e,B),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(0==e.disconnectedProxies.length)return e.s.logger.isWarn()&&e.s.logger.warn(h("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new v("no mongos proxies found in seed list"));p(e,{firstConnect:!0})}}}function a(e,t){function n(t,n){setTimeout(function(){t.once("close",s(e,"close")),t.once("timeout",s(e,"timeout")),t.once("parseError",s(e,"parseError")),t.once("error",s(e,"error")),t.once("connect",s(e,"connect")),t.on("serverOpening",function(t){e.emit("serverOpening",t)}),t.on("serverDescriptionChanged",function(t){e.emit("serverDescriptionChanged",t)}),t.on("serverClosed",function(t){e.emit("serverClosed",t)}),t.connect(e.s.connectOptions)},n)}e.connectingProxies=e.connectingProxies.concat(t);for(var r=0;t.length>0;)n(t.shift(),r++)}function c(e){for(var t=e.connectedProxies.slice(0),n=Number.MAX_VALUE,r=0;r<t.length;r++)t[r].lastIsMasterMS<n&&(n=t[r].lastIsMasterMS);if(t=t.filter(function(t){if(t.lastIsMasterMS<=n+e.s.localThresholdMS&&t.isConnected())return!0}),0==t.length)return e.connectedProxies[0];var o=t[e.index%t.length];return e.index=(e.index+1)%t.length,o}function u(e,t,n){for(var r=0;r<e.length;r++)e[r].name==n.name&&e.splice(r,1);for(r=0;r<t.length;r++)t[r].name==n.name&&t.splice(r,1);t.push(n)}function l(e,t){for(var n=0;n<e.length;n++)e[n].name==t.name&&e.splice(n,1)}function f(e,t,n){function r(t,n){setTimeout(function(){if(e.state!=D){var n=new w(S({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10)},{authProviders:e.authProviders,reconnect:!1,monitoring:!1,inTopology:!0},{clientInfo:x(e.s.clientInfo)}));n.once("connect",s(e,"connect")),n.once("close",s(e,"close")),n.once("timeout",s(e,"timeout")),n.once("error",s(e,"error")),n.once("parseError",s(e,"parseError")),n.on("serverOpening",function(t){e.emit("serverOpening",t)}),n.on("serverDescriptionChanged",function(t){e.emit("serverDescriptionChanged",t)}),n.on("serverClosed",function(t){e.emit("serverClosed",t)}),n.connect(e.s.connectOptions)}},n)}var o=t.length,s=function(e,t){return function(){var r=this;if(o-=1,e.state==D)return u(e.connectingProxies,e.disconnectedProxies,r),this.destroy();if("connect"!=t||e.authenticating)"connect"==t&&e.authenticating&&(u(e.connectingProxies,e.disconnectedProxies,r),this.destroy());else{if(e.state==D)return u(e.connectingProxies,e.disconnectedProxies,r),r.destroy();for(var s=0;s<P.length;s++)r.removeAllListeners(P[s]);r.on("error",i(e,"error")),r.on("close",i(e,"close")),r.on("timeout",i(e,"timeout")),r.on("parseError",i(e,"parseError")),u(e.disconnectedProxies,e.connectedProxies,r),e.emit("joined","mongos",r)}0==o&&n()}};if(0==o)return n();for(var a=0;a<t.length;a++)r(t[a],a)}function p(e,t){t=t||{},e.haTimeoutId=setTimeout(function(){function n(t,n,r){var i=(new Date).getTime();o(e,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(t,s){if(e.state==D)return u(e.connectedProxies,e.disconnectedProxies,n),n.destroy(),r(t,s);var a=(new Date).getTime()-i;t?(o(e,"serverHeartbeatFailed",{durationMS:a,failure:t,connectionId:n.name}),u(e.connectedProxies,e.disconnectedProxies,n)):(n.ismaster=s.result,n.lastIsMasterMS=a,o(e,"serverHeartbeatSucceeded",{durationMS:a,reply:s.result,connectionId:n.name})),r(t,s)})}if(e.state!=D){e.isConnected()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute();var r=e.connectedProxies.slice(0),i=r.length;if(0==r.length)return e.listeners("close").length>0&&e.state==T?e.emit("error",new v("no mongos proxy available")):e.emit("close",e),f(e,e.disconnectedProxies,function(){e.state!=D&&(e.state==T&&t.firstConnect?(e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e)):e.isConnected()?e.emit("reconnect",e):!e.isConnected()&&e.listeners("close").length>0&&e.emit("close",e),p(e))});for(var s=0;s<r.length;s++)n(e,r[s],function(){if(i-=1,0==i){if(e.state==D)return;f(e,e.disconnectedProxies,function(){e.state!=D&&p(e)})}})}},e.s.haInterval)}var d=n(1).inherits,h=n(1).format,m=n(9).EventEmitter,y=n(58),g=n(15),b=n(7).retrieveBSON,v=n(4),w=n(79),S=n(12).assign,x=n(12).clone,k=n(12).createClientInfo,_=b(),O=n(54),C=n(57),E=n(55),I=n(53),N=n(78),A=n(56),M="disconnected",T="connecting",B="connected",D="destroyed",R=1,P=["connect","close","error","timeout","parseError"],L=function(e,t){t=t||{},this.id=R++,this.s={options:S({},t),bson:t.bson||new _([_.Binary,_.Code,_.DBRef,_.Decimal128,_.Double,_.Int32,_.Long,_.Map,_.MaxKey,_.MinKey,_.ObjectId,_.BSONRegExp,_.Symbol,_.Timestamp]),Cursor:t.cursorFactory||y,logger:g("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,localThresholdMS:t.localThresholdMS||15,clientInfo:k(t)},this.s.options.clientInfo=k(t),this.s.logger.isWarn()&&0!=this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(h("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||{mongocr:new O(this.s.bson),x509:new C(this.s.bson),plain:new E(this.s.bson),gssapi:new I(this.s.bson),sspi:new N(this.s.bson),"scram-sha-1":new A(this.s.bson)},this.state=M,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.authenticating=!1,this.index=0,this.haTimeoutId=null,this.ismaster=null,m.call(this)};d(L,m),Object.defineProperty(L.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(L.prototype,"parserType",{enumerable:!0,get:function(){return _.native?"c++":"js"}}),L.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},r(this,T);var n=this.s.seedlist.map(function(e){return new w(S({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,inTopology:!0},{clientInfo:x(t.s.clientInfo)}))});o(this,"topologyOpening",{topologyId:this.id}),a(t,n)},L.prototype.lastIsMaster=function(){return this.ismaster},L.prototype.unref=function(){r(this,M);var e=this.connectedProxies.concat(this.connectingProxies);e.forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},L.prototype.destroy=function(e){r(this,D);var t=this.connectedProxies.concat(this.connectingProxies);this.haTimeoutId&&clearTimeout(this.haTimeoutId),t.forEach(function(t){t.destroy(e)}),o(this,"topologyClosed",{topologyId:this.id})},L.prototype.isConnected=function(){return this.connectedProxies.length>0},L.prototype.isDestroyed=function(){return this.state==D};var j=function(e,t,n,r,o,i){"function"==typeof o&&(i=o,o={},o=o||{}),o=o||{};var s=c(e);return s?void s[t](n,r,o,i):i(new v("no mongos proxy available"))};L.prototype.insert=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new v(h("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void j(this,"insert",e,t,n,r):r(new v("no mongos proxy available")):this.s.disconnectHandler.add("insert",e,t,n,r)},L.prototype.update=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new v(h("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void j(this,"update",e,t,n,r):r(new v("no mongos proxy available")):this.s.disconnectHandler.add("update",e,t,n,r)},L.prototype.remove=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new v(h("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void j(this,"remove",e,t,n,r):r(new v("no mongos proxy available")):this.s.disconnectHandler.add("remove",e,t,n,r)},L.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n={},n=n||{}),this.state==D)return r(new v(h("topology was destroyed")));var o=this,i=c(o);return null!=i&&i.isConnected()||null==this.s.disconnectHandler?null==i?r(new v("no mongos proxy available")):void i.command(e,t,n,r):this.s.disconnectHandler.add("command",e,t,n,r)},L.prototype.cursor=function(e,t,n){n=n||{};var r=n.cursorFactory||this.s.Cursor;return new r(this.s.bson,e,t,n,this,this.s.options)},L.prototype.auth=function(e,t){function n(n){var r=[e,t].concat(i.slice(0)),c=r.concat([function(e){if(u-=1,e&&a.push({name:n.name,err:e}),0==u){if(o.authenticating=!1,a.length)return s(v.create({message:"authentication fail",errors:a}),!1);s(null,o)}}]);n.lastIsMaster().arbiterOnly||n.auth.apply(n,c)}var r=Array.prototype.slice.call(arguments,0).slice(0),o=this,i=Array.prototype.slice.call(arguments,2),s=i.pop();if(null==this.authProviders[e]&&"default"!=e)return s(new v(h("auth provider %s does not exist",e)));if(this.authenticating)return s(new v("authentication or logout allready in process"));if(!o.isConnected()&&null!=o.s.disconnectHandler)return o.s.disconnectHandler.add("auth",t,r,{},s);this.authenticating=!0;var a=[],c=this.connectedProxies.slice(0);0==c.length&&(this.authenticating=!1,s(null,!0));for(var u=c.length;c.length>0;)n(c.shift())},L.prototype.logout=function(e,t){function n(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}var r=this;if(this.authenticating)throw new v("authentication or logout allready in process");this.authenticating=!0;for(var o=Object.keys(this.authProviders),i=0;i<o.length;i++)this.authProviders[o[i]].logout(e);var s=this.connectedProxies.slice(0),a=s.length;if(0==a)return t();var c=[];for(i=0;i<s.length;i++)n(s[i],function(){if(a-=1,0==a){if(r.authenticating=!1,c.length)return t(v.create({message:h("logout failed against db %s",e),errors:c}),!1);t()}})},L.prototype.getServer=function(){var e=c(this);return this.s.debug&&this.emit("pickedServer",null,e),e},L.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e},e.exports=L},function(e,t,n){"use strict";function r(e,t){var n={disconnected:[T,D,M],connecting:[T,D,B,M],connected:[B,M,D],destroyed:[D]},r=n[e.state];r&&r.indexOf(t)!=-1?e.state=t:e.logger.error(p("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,r))}function o(e){e.runningAttempReconnect||(e.runningAttempReconnect=!0,e.haTimeoutId=setTimeout(function(){function t(e,t){return function(){function n(){if(0==e.s.connectingServers.length){if(e.state==D)return;e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0}),e.s.replicaSetState.hasPrimary()?(e.emit("reconnect",e),i(e,e.s.replicaSetState.unknownServers,function(){e.s.logger.isDebug()&&e.s.logger.debug(p("attemptReconnect for replset with id successful resuming topologyMonitor",e.id)),e.runningAttempReconnect=!1,setTimeout(function(){s(e)},e.s.haInterval)})):(e.listeners("close").length>0&&e.emit("close",e),e.runningAttempReconnect=!1,o(e))}}if(e.state==D)return this.destroy();e.s.logger.isDebug()&&e.s.logger.debug(p("attemptReconnect for replset with id %s using server %s ended with event %s",e.id,this.name,t));for(var r=0;r<e.s.connectingServers.length;r++)e.s.connectingServers[r].equals(this)&&e.s.connectingServers.splice(r,1);var c=this;if(e.s.logger.isDebug()&&e.s.logger.debug(p("attemptReconnect in replset with id %s for",e.id)),"connect"!=t||e.authenticating)"connect"==t&&e.authenticating&&this.destroy();else{if(e.state==D)return c.destroy();if(e.s.replicaSetState.update(c)){for(c.lastIsMaster()&&c.lastIsMaster().ismaster&&(e.ismaster=c.lastIsMaster()),r=0;r<P.length;r++)c.removeAllListeners(P[r]);c.on("error",a(e,"error")),c.on("close",a(e,"close")),c.on("timeout",a(e,"timeout")),c.on("parseError",a(e,"parseError"))}else c.destroy()}n()}}function n(n,r){setTimeout(function(){n.once("connect",t(e,"connect")),n.once("close",t(e,"close")),n.once("timeout",t(e,"timeout")),n.once("error",t(e,"error")),n.once("parseError",t(e,"parseError")),n.on("serverOpening",function(t){e.emit("serverOpening",t)}),n.on("serverDescriptionChanged",function(t){e.emit("serverDescriptionChanged",t)}),n.on("serverClosed",function(t){e.emit("serverClosed",t)}),n.connect(e.s.connectOptions)},r)}if(e.state!=D){e.s.logger.isDebug()&&e.s.logger.debug(p("attemptReconnect for replset with id %s",e.id));var r=Object.keys(e.s.replicaSetState.set),c=r.map(function(t){return new v(S({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10)},{authProviders:e.authProviders,reconnect:!1,monitoring:!1,inTopology:!0},{clientInfo:x(e.s.clientInfo)}))});e.s.connectingServers=c.slice(0);for(var u=0;c.length>0;)n(c.shift(),u++)}},e.s.minHeartbeatFrequencyMS))}function i(e,t,n){function r(t,n){setTimeout(function(){if(e.state!=D){var n=new v(S({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10)},{authProviders:e.authProviders,reconnect:!1,monitoring:!1,inTopology:!0},{clientInfo:x(e.s.clientInfo)}));n.once("connect",i(e,"connect")),n.once("close",i(e,"close")),n.once("timeout",i(e,"timeout")),n.once("error",i(e,"error")),n.once("parseError",i(e,"parseError")),n.on("serverOpening",function(t){e.emit("serverOpening",t)}),n.on("serverDescriptionChanged",function(t){e.emit("serverDescriptionChanged",t)}),n.on("serverClosed",function(t){e.emit("serverClosed",t)}),n.connect(e.s.connectOptions)}},n)}var o=t.length,i=function(e,t){return function(){var r=this;if(o-=1,e.state==D)return this.destroy();if("connect"!=t||e.authenticating)"connect"==t&&e.authenticating&&this.destroy();else{if(e.state==D)return r.destroy();var i=e.s.replicaSetState.update(r);if(i){r.lastIsMaster()&&r.lastIsMaster().ismaster&&(e.ismaster=r.lastIsMaster());for(var s=0;s<P.length;s++)r.removeAllListeners(P[s]);r.on("error",a(e,"error")),r.on("close",a(e,"close")),r.on("timeout",a(e,"timeout")),r.on("parseError",a(e,"parseError"))}else r.destroy()}0==o&&n()}};if(0==o)return n();for(var s=0;s<t.length;s++)r(t[s],s)}function s(e,t){t=t||{},e.haTimeoutId=setTimeout(function(){function n(t,n,r){var o=(new Date).getTime();l(e,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},function(i,s){if(e.state==D)return n.destroy(),r(i,s);var a=(new Date).getTime()-o,c=process.hrtime();n.lastUpdateTime=1e3*c[0]+Math.round(c[1]/1e3),i?(l(e,"serverHeartbeatFailed",{durationMS:a,failure:i,connectionId:n.name}),t.s.replicaSetState.remove(n)):(n.ismaster=s.result,n.ismaster.lastWrite&&n.ismaster.lastWrite.lastWriteDate&&(n.lastWriteDate=n.ismaster.lastWrite.lastWriteDate.getTime()),n.lastIsMasterMS==-1?n.lastIsMasterMS=a:n.lastIsMasterMS&&(n.lastIsMasterMS=.2*a+.8*n.lastIsMasterMS),t.s.replicaSetState.update(n)&&n.lastIsMaster()&&n.lastIsMaster().ismaster&&(e.ismaster=n.lastIsMaster()),l(e,"serverHeartbeatSucceeded",{durationMS:a,reply:s.result,connectionId:n.name})),e.s.replicaSetState.updateServerMaxStaleness(n,e.s.haInterval),r(i,s)})}function a(){e.state!=D&&i(e,e.s.replicaSetState.unknownServers,function(){if(e.state!=D){if(t.haInterval)if(e.state==T&&e.s.replicaSetState.hasPrimaryAndSecondary())r(e,B),e.initialConnectState.connect=!0,e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick(function(){e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e)});else if(e.state==T&&e.s.replicaSetState.hasPrimary())r(e,B),e.initialConnectState.connect=!0,process.nextTick(function(){e.emit("connect",e)});else if(e.state==T&&e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)r(e,B),e.initialConnectState.connect=!0,process.nextTick(function(){e.emit("connect",e)});else{if(e.state==T)return e.emit("error",new b("no primary found in replicaset")),e.destroy();e.state==B&&e.s.replicaSetState.hasPrimaryAndSecondary()&&!e.initialConnectState.fullsetup&&(e.initialConnectState.fullsetup=!0,process.nextTick(function(){e.emit("fullsetup",e),e.emit("all",e)}))}t.haInterval||s(e)}})}if(e.state!=D){t.haInterval&&s(e),e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0});var c=e.s.replicaSetState.allServers();e.s.logger.isDebug()&&e.s.logger.debug(p("topologyMonitor in replset with id %s connected servers [%s]",e.id,c.map(function(e){return e.name})));var u=c.length;if(0==u&&!t.haInterval)return e.listeners("close").length>0&&e.emit("close",e),o(e);if(0==c.length&&e.s.replicaSetState.unknownServers.length>0&&t.haInterval)return a();if(0==c.length&&t.haInterval)return e.destroy(),e.emit("error",new b("no valid replicaset members found"));for(var f=0;f<c.length;f++)n(e,c[f],function(){u-=1,0==u&&a()})}},t.haInterval||e.s.haInterval)}function a(e,t){return function(){e.state!=D&&(e.s.logger.isDebug()&&e.s.logger.debug(p("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this))}}function c(e,t){return function(){if(e.s.logger.isDebug()&&e.s.logger.debug(p("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state==D)return this.destroy();if("connect"==t){var n=e.s.replicaSetState.update(this);if(1==n){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(e.ismaster=this.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(p("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,this.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(var r=0;r<P.length;r++)this.removeAllListeners(P[r]);this.on("error",a(e,"error")),this.on("close",a(e,"close")),this.on("timeout",a(e,"timeout")),this.on("parseError",a(e,"parseError"));
}else{if(n instanceof b)return this.destroy(),e.destroy(),e.emit("error",n);this.destroy()}}else e.emit("failed",this),e.s.replicaSetState.remove(this);for(r=0;r<e.s.connectingServers.length;r++)e.s.connectingServers[r].equals(this)&&e.s.connectingServers.splice(r,1);0==e.s.connectingServers.length&&s(e,{haInterval:1})}}function u(e,t){function n(t,n){setTimeout(function(){e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),t.once("close",c(e,"close")),t.once("timeout",c(e,"timeout")),t.once("parseError",c(e,"parseError")),t.once("error",c(e,"error")),t.once("connect",c(e,"connect")),t.on("serverOpening",function(t){e.emit("serverOpening",t)}),t.on("serverDescriptionChanged",function(t){e.emit("serverDescriptionChanged",t)}),t.on("serverClosed",function(t){e.emit("serverClosed",t)}),t.connect(e.s.connectOptions)},n)}e.s.connectingServers=e.s.connectingServers.concat(t);for(var r=0;t.length>0;)n(t.shift(),r++)}function l(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}var f=n(1).inherits,p=n(1).format,d=n(9).EventEmitter,h=n(43),m=n(58),y=n(7).retrieveBSON,g=n(15),b=n(4),v=n(79),w=n(188),S=n(12).assign,x=n(12).clone,k=n(12).createClientInfo,_=n(54),O=n(57),C=n(55),E=n(53),I=n(78),N=n(56),A=y(),M="disconnected",T="connecting",B="connected",D="destroyed",R=1,P=["connect","close","error","timeout","parseError"],L=function(e,t){var n=this;if(t=t||{},!Array.isArray(e))throw new b("seedlist must be an array");if(0==e.length)throw new b("seedlist must contain at least one entry");e.forEach(function(e){if("string"!=typeof e.host||"number"!=typeof e.port)throw new b("seedlist entry must contain a host and port")}),d.call(this),this.id=R++;var r=t.localThresholdMS||15;t.acceptableLatency&&(r=t.acceptableLatency);var o=g("ReplSet",t);this.s={options:S({},t),bson:t.bson||new A([A.Binary,A.Code,A.DBRef,A.Decimal128,A.Double,A.Int32,A.Long,A.Map,A.MaxKey,A.MinKey,A.ObjectId,A.BSONRegExp,A.Symbol,A.Timestamp]),Cursor:t.cursorFactory||m,logger:o,seedlist:e,replicaSetState:new w({id:this.id,setName:t.setName,acceptableLatency:r,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:o}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,clientInfo:k(t)},this.s.replicaSetState.on("topologyDescriptionChanged",function(e){n.emit("topologyDescriptionChanged",e)}),this.s.logger.isWarn()&&0!=this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(p("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.authProviders=t.authProviders||{mongocr:new _(this.s.bson),x509:new O(this.s.bson),plain:new C(this.s.bson),gssapi:new E(this.s.bson),sspi:new I(this.s.bson),"scram-sha-1":new N(this.s.bson)};var i=["joined","left"];i.forEach(function(e){n.s.replicaSetState.on(e,function(t,r){n.state===B&&"joined"===e&&"primary"==t&&n.emit("reconnect",n),n.emit(e,t,r)})}),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=M,this.haTimeoutId=null,this.authenticating=!1,this.ismaster=null};f(L,d),Object.defineProperty(L.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(L.prototype,"parserType",{enumerable:!0,get:function(){return A.native?"c++":"js"}}),L.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},r(this,T);var n=this.s.seedlist.map(function(e){return new v(S({},t.s.options,e,{authProviders:t.authProviders,reconnect:!1,monitoring:!1,inTopology:!0},{clientInfo:x(t.s.clientInfo)}))});return this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval?t.emit("error",new b(p("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout))):(l(this,"topologyOpening",{topologyId:this.id}),void u(t,n))},L.prototype.destroy=function(e){e=e||{},r(this,D),this.haTimeoutId&&clearTimeout(this.haTimeoutId),this.s.replicaSetState.destroy(e),this.s.connectingServers.forEach(function(t){t.destroy(e)}),l(this,"topologyClosed",{topologyId:this.id})},L.prototype.unref=function(){r(this,M),this.s.replicaSetState.allServers().forEach(function(e){e.unref()}),clearTimeout(this.haTimeoutId)},L.prototype.lastIsMaster=function(){return this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},L.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],n=0;n<e.length;n++)t=t.concat(e[n].connections());return t},L.prototype.isConnected=function(e){return e=e||{},!this.authenticating&&(e.readPreference&&e.readPreference.equals(h.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(h.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(h.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(h.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary())},L.prototype.isDestroyed=function(){return this.state==D},L.prototype.getServer=function(e){e=e||{};var t=this.s.replicaSetState.pickServer(e.readPreference);return this.s.debug&&this.emit("pickedServer",e.readPreference,t),t},L.prototype.getServers=function(){return this.s.replicaSetState.allServers()};var j=function(e,t,n,r,o,i){return"function"==typeof o&&(i=o,o={},o=o||{}),o=o||{},null==e.s.replicaSetState.primary?i(new b("no primary server found")):void e.s.replicaSetState.primary[t](n,r,o,i)};L.prototype.insert=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new b(p("topology was destroyed"))):this.s.replicaSetState.hasPrimary()||null==this.s.disconnectHandler?void j(this,"insert",e,t,n,r):this.s.disconnectHandler.add("insert",e,t,n,r)},L.prototype.update=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new b(p("topology was destroyed"))):this.s.replicaSetState.hasPrimary()||null==this.s.disconnectHandler?void j(this,"update",e,t,n,r):this.s.disconnectHandler.add("update",e,t,n,r)},L.prototype.remove=function(e,t,n,r){return"function"==typeof n&&(r=n,n={},n=n||{}),this.state==D?r(new b(p("topology was destroyed"))):this.s.replicaSetState.hasPrimary()||null==this.s.disconnectHandler?void j(this,"remove",e,t,n,r):this.s.disconnectHandler.add("remove",e,t,n,r)},L.prototype.command=function(e,t,n,r){if("function"==typeof n&&(r=n,n={},n=n||{}),this.state==D)return r(new b(p("topology was destroyed")));var o=this,i=n.readPreference?n.readPreference:h.primary;if("primary"==i.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("secondary"==i.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);if("primary"!=i.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,r);var s=this.s.replicaSetState.pickServer(i);return s instanceof v?(o.s.debug&&o.emit("pickedServer",h.primary,s),null==s?r(new b(p("no server found that matches the provided readPreference %s",i))):void s.command(e,t,n,r)):r(s)},L.prototype.auth=function(e,t){function n(n){var r=[e,t].concat(i.slice(0)),c=r.concat([function(e){if(u-=1,e&&a.push({name:n.name,err:e}),0==u){if(o.authenticating=!1,a.length)return s(b.create({message:"authentication fail",errors:a}),!1);s(null,o)}}]);n.lastIsMaster().arbiterOnly?c.pop()(null):n.auth.apply(n,c)}var r=Array.prototype.slice.call(arguments,0).slice(0),o=this,i=Array.prototype.slice.call(arguments,2),s=i.pop();if(null==this.authProviders[e]&&"default"!=e)return s(new b(p("auth provider %s does not exist",e)));if(this.authenticating)return s(new b("authentication or logout allready in process"));if(!o.s.replicaSetState.hasPrimary()&&null!=o.s.disconnectHandler)return o.s.disconnectHandler.add("auth",t,r,{},s);this.authenticating=!0;var a=[],c=this.s.replicaSetState.allServers();0==c.length&&(this.authenticating=!1,s(null,!0));for(var u=c.length;c.length>0;)n(c.shift())},L.prototype.logout=function(e,t){function n(t,n){t.logout(e,function(e){e&&c.push({name:t.name,err:e}),n()})}var r=this;if(this.authenticating)throw new b("authentication or logout allready in process");this.authenticating=!0;for(var o=Object.keys(this.authProviders),i=0;i<o.length;i++)this.authProviders[o[i]].logout(e);var s=this.s.replicaSetState.allServers(),a=s.length;if(0==a)return t();var c=[];for(i=0;i<s.length;i++)n(s[i],function(){if(a-=1,0==a){if(r.authenticating=!1,c.length)return t(b.create({message:p("logout failed against db %s",e),errors:c}),!1);t()}})},L.prototype.cursor=function(e,t,n){n=n||{};var r=n.cursorFactory||this.s.Cursor;return new r(this.s.bson,e,t,n,this,this.s.options)},e.exports=L},function(e,t,n){"use strict";function r(e,t){var n=[],r=(e.heartbeatFrequencyMS,1e3*t.maxStalenessSeconds);if(r<9e4)return new y("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&"secondary"!=t.preference&&n.push(e.primary);for(var o=0;o<e.secondaries.length;o++)n.push(e.secondaries[o]);if(n=w(t,n),n=n.filter(function(e){return e.staleness<=r}),n.sort(function(e,t){return e.lastIsMasterMS>t.lastIsMasterMS}),0==n.length)return null;e.index=e.index%n.length;var i=n[e.index];return e.index=e.index+1,i}function o(e,t){var n=[];e.primary&&"secondary"!=t.preference&&n.push(e.primary);for(var r=0;r<e.secondaries.length;r++)n.push(e.secondaries[r]);n=w(t,n),n.sort(function(e,t){return e.lastIsMasterMS>t.lastIsMasterMS});var o=n.length>0?n[0].lastIsMasterMS:0;if(n=n.filter(function(t){return t.lastIsMasterMS<=o+e.acceptableLatency}),0==n.length)return null;e.index=e.index%n.length;var i=n[e.index];return e.index=e.index+1,i}function i(e,t,n){for(var r=0;r<n.length;r++)if(n[r].name==t.name)return!0;return!1}function s(e,t,n,r,o){e.set[r.name.toLowerCase()].type=t,e.set[r.name.toLowerCase()].electionId=n?n.electionId:n,e.set[r.name.toLowerCase()].setName=n?n.setName:n,e.set[r.name.toLowerCase()].setVersion=n?n.setVersion:n,o.push(r)}function a(e,t){var n=new Buffer(e.toHexString(),"hex"),r=new Buffer(t.toHexString(),"hex");if(n===r)return 0;if("function"==typeof Buffer.compare)return Buffer.compare(n,r);for(var o=n.length,i=r.length,s=Math.min(o,i),a=0;a<s&&n[a]===r[a];a++);return a!==s&&(o=n[a],i=r[a]),o<i?-1:i<o?1:0}function c(e,t){for(var n=0;n<t.length;n++){if(t[n].equals&&t[n].equals(e))return t.splice(n,1),!0;if("string"==typeof t[n]&&t[n]==e.name)return t.splice(n,1),!0}return!1}function u(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",n=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var r={topologyType:t,setName:n,servers:[]};if(e.hasPrimary()){var o=e.primary.getDescription();o.type="RSPrimary",r.servers.push(o)}r.servers=r.servers.concat(e.secondaries.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t})),r.servers=r.servers.concat(e.arbiters.map(function(e){var t=e.getDescription();return t.type="RSArbiter",t})),r.servers=r.servers.concat(e.passives.map(function(e){var t=e.getDescription();return t.type="RSSecondary",t}));var i={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:r,diff:l(e.replicasetDescription,r)};e.emit("topologyDescriptionChanged",i),e.replicasetDescription=r}}function l(e,t){var n={servers:[]};e||(e={servers:[]});for(var r=0;r<e.servers.length;r++)for(var o=e.servers[r],i=0;i<t.servers.length;i++){var s=t.servers[i];o.address===s.address&&o.type!=s.type&&n.servers.push({address:o.address,from:o.type,to:s.type})}return n}var f=n(1).inherits,p=n(1).format,d=n(9).EventEmitter,h=n(15),m=n(43),y=n(4),g={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"},b={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"},v=function(e){e=e||{},d.call(this),this.topologyType=g.ReplicaSetNoPrimary,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||h("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]}};f(v,d),v.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},v.prototype.hasPrimary=function(){return null!=this.primary},v.prototype.hasSecondary=function(){return this.secondaries.length>0},v.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives)},v.prototype.destroy=function(e){this.primary&&this.primary.destroy(e),this.secondaries.forEach(function(t){t.destroy(e)}),this.arbiters.forEach(function(t){t.destroy(e)}),this.passives.forEach(function(t){t.destroy(e)}),this.ghosts.forEach(function(t){t.destroy(e)}),this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={}},v.prototype.remove=function(e,t){t=t||{};var n=this.primary?[this.primary]:[];n=n.concat(this.secondaries),n=n.concat(this.arbiters),n=n.concat(this.passives);for(var r=0;r<n.length;r++)if(!t.force&&n[r].equals(e)&&n[r].isConnected&&n[r].isConnected())return;this.set[e.name.toLowerCase()]&&(this.set[e.name.toLowerCase()].type=b.Unknown,this.set[e.name.toLowerCase()].electionId=null,this.set[e.name.toLowerCase()].setName=null,this.set[e.name.toLowerCase()].setVersion=null);var o=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=g.ReplicaSetNoPrimary,o="primary"),o=c(e,this.secondaries)?"secondary":o,o=c(e,this.arbiters)?"arbiter":o,o=c(e,this.passives)?"secondary":o,c(e,this.ghosts),c(e,this.unknownServers),o&&this.emit("left",o,e)},v.prototype.update=function(e){var t=this,n=e.lastIsMaster();if(n){var r=Array.isArray(n.hosts)?n.hosts:[];r=r.concat(Array.isArray(n.arbiters)?n.arbiters:[]),r=r.concat(Array.isArray(n.passives)?n.passives:[]);for(var o=0;o<r.length;o++)this.unknownServers.indexOf(r[o])!=-1||this.set[r[o].toLowerCase()]&&this.set[r[o].toLowerCase()].type!=b.Unknown||this.unknownServers.push(r[o]),this.set[r[o].toLowerCase()]||(this.set[r[o].toLowerCase()]={type:b.Unknown,electionId:null,setName:null,setVersion:null})}if(!n&&!i(n,e,this.unknownServers))return t.set[e.name.toLowerCase()]={type:b.Unknown,setVersion:null,electionId:null,setName:null},t.set[e.name.toLowerCase()].type=b.Unknown,t.set[e.name.toLowerCase()].electionId=n?n.electionId:n,t.set[e.name.toLowerCase()].setName=n?n.setName:n,t.set[e.name.toLowerCase()].setVersion=n?n.setVersion:n,t.unknownServers.indexOf(e.name)==-1&&t.unknownServers.push(e.name),!1;if(n&&"isdbgrid"==n.msg)return!1;if(n.setName&&n.hidden||n.setName&&!n.ismaster&&!n.secondary&&!n.arbiterOnly&&!n.passive)return t.set[e.name.toLowerCase()]={type:b.RSOther,setVersion:null,electionId:null,setName:n.setName},this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,n.setName&&(this.setName=n.setName),!1;if(n.isreplicaset)return t.set[e.name.toLowerCase()]={type:b.RSGhost,setVersion:null,electionId:null,setName:null},this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,n.setName&&(this.setName=n.setName),!1;if(n&&n.ismaster&&!n.setName)return this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.Unknown,this.remove(e,{force:!0}),!1;if(n&&!n.ismaster&&!n.secondary&&!n.arbiterOnly)return this.remove(e,{force:!0}),!1;if(n.me&&n.me!=e.name)return this.logger.isWarn()&&this.logger.warn(p("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,n.me)),delete this.set[e.name.toLowerCase()],this.primary&&!this.primary.equals(e)?this.topologyType=g.ReplicaSetWithPrimary:this.topologyType=g.ReplicaSetNoPrimary,!this.primary&&n.primary&&(this.set[n.primary.toLowerCase()]={type:b.PossiblePrimary,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&n.ismaster&&n.setName){var l=e.lastIsMaster().electionId;if(this.setName&&this.setName!=n.setName)return this.topologyType=g.ReplicaSetNoPrimary,new y(p("setName from ismaster does not match provided connection setName [%s] != [%s]",n.setName,this.setName));if(!this.maxElectionId&&l)this.maxElectionId=l;else if(this.maxElectionId&&l){var f=a(this.maxElectionId,l),d=e.lastIsMaster().setVersion;if(1==f)return this.topologyType=g.ReplicaSetNoPrimary,!1;if(0==f&&d&&d<this.maxSetVersion)return this.topologyType=g.ReplicaSetNoPrimary,!1;this.maxSetVersion=d,this.maxElectionId=l}var h=n.hosts.map(function(e){return e.toLowerCase()}),m=h.indexOf(e.name.toLowerCase());return m!=-1?(t.primary=e,t.set[e.name.toLowerCase()]={type:b.RSPrimary,setVersion:n.setVersion,electionId:n.electionId,setName:n.setName},this.topologyType=g.ReplicaSetWithPrimary,n.setName&&(this.setName=n.setName),c(e,t.unknownServers),c(e,t.secondaries),c(e,t.passives),t.emit("joined","primary",e)):this.topologyType=g.ReplicaSetNoPrimary,u(t),!0}if(n.ismaster&&n.setName){var v=t.set[t.primary.name.toLowerCase()].electionId,w=t.set[t.primary.name.toLowerCase()].setVersion,S=t.set[t.primary.name.toLowerCase()].setName;l=e.lastIsMaster().electionId,d=e.lastIsMaster().setVersion;var x=e.lastIsMaster().setName;if(this.primary.equals(e)&&S==x)return!1;if(S&&S!=x)return this.primary.equals(e)?this.topologyType=g.ReplicaSetNoPrimary:this.topologyType=g.ReplicaSetWithPrimary,!1;if(v&&l){if(f=a(v,l),1==f)return!1;if(0==f&&w>d)return!1}else if(!v&&l&&d&&d<this.maxSetVersion)return!1;if(!this.maxElectionId&&l)this.maxElectionId=l;else if(this.maxElectionId&&l){if(f=a(this.maxElectionId,l),1==f)return!1;if(0==f&&w&&d){if(d<this.maxSetVersion)return!1}else if(d<this.maxSetVersion)return!1;this.maxElectionId=l,this.maxSetVersion=d}else this.maxSetVersion=d;return t.set[t.primary.name.toLowerCase()]={type:b.Unknown,setVersion:null,electionId:null,setName:null},t.emit("left","primary",this.primary),t.primary.destroy(),t.primary=e,t.set[e.name.toLowerCase()]={type:b.RSPrimary,setVersion:n.setVersion,electionId:n.electionId,setName:n.setName},this.topologyType=g.ReplicaSetWithPrimary,n.setName&&(this.setName=n.setName),c(e,t.unknownServers),c(e,t.secondaries),c(e,t.passives),t.emit("joined","primary",e),u(t),!0}return!this.primary&&n.primary&&(t.set[n.primary.toLowerCase()]={type:b.PossiblePrimary,setVersion:null,electionId:null,setName:null}),n.secondary&&n.setName&&!i(n,e,this.secondaries)&&this.setName&&this.setName==n.setName?(s(t,b.RSSecondary,n,e,this.secondaries),this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,n.setName&&(this.setName=n.setName),c(e,t.unknownServers),this.primary&&this.primary.name==e.name&&(e.destroy(),this.primary=null,t.emit("left","primary",e)),t.emit("joined","secondary",e),u(t),!0):n.arbiterOnly&&n.setName&&!i(n,e,this.arbiters)&&this.setName&&this.setName==n.setName?(s(t,b.RSArbiter,n,e,this.arbiters),this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,n.setName&&(this.setName=n.setName),c(e,t.unknownServers),t.emit("joined","arbiter",e),u(t),!0):n.passive&&n.setName&&!i(n,e,this.passives)&&this.setName&&this.setName==n.setName?(s(t,b.RSSecondary,n,e,this.passives),this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,n.setName&&(this.setName=n.setName),c(e,t.unknownServers),this.primary&&this.primary.name==e.name&&(e.destroy(),this.primary=null,t.emit("left","primary",e)),t.emit("joined","secondary",e),u(t),!0):this.set[e.name.toLowerCase()]&&this.set[e.name.toLowerCase()].type==b.RSPrimary?(t.emit("left","primary",this.primary),this.primary.destroy(),this.primary=null,this.topologyType=g.ReplicaSetNoPrimary,!1):(this.topologyType=this.primary?g.ReplicaSetWithPrimary:g.ReplicaSetNoPrimary,!1)},v.prototype.updateServerMaxStaleness=function(e,t){for(var n=0,r=0;r<this.secondaries.length;r++)n=Math.max(n,this.secondaries[r].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=n-e.lastWriteDate+t)},v.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)},v.prototype.pickServer=function(e){if(e=e||m.primary,"primary"==e.preference&&null!=e.maxStalenessSeconds)return new y("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),null!=e.maxStalenessSeconds)for(var n=0;n<t.length;n++)if(t[n].ismaster.maxWireVersion<5)return new y("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"==e.preference&&null==e.maxStalenessSeconds)return o(this,e);if("nearest"==e.preference&&null!=e.maxStalenessSeconds)return r(this,e);var i=this.secondaries;if(e.equals(m.secondary)&&0==i.length)return new y("no secondary server available");if(e.equals(m.secondaryPreferred)&&0==i.length&&null==this.primary)return new y("no secondary or primary server available");if(e.equals(m.primary)&&null==this.primary)return new y("no primary server available");if(e.equals(m.secondaryPreferred)||e.equals(m.secondary)){if(i.length>0&&null==e.maxStalenessSeconds){var s=o(this,e);if(s)return s}else if(i.length>0&&null!=e.maxStalenessSeconds&&(s=r(this,e)))return s;return e.equals(m.secondaryPreferred)?this.primary:null}if(e.equals(m.primaryPreferred)){if(s=null,this.primary)return this.primary;if(i.length>0&&null==e.maxStalenessSeconds?s=o(this,e):i.length>0&&null!=e.maxStalenessSeconds&&(s=r(this,e)),s)return s}return this.primary};var w=function(e,t){if(null==e.tags)return t;for(var n=[],r=Array.isArray(e.tags)?e.tags:[e.tags],o=0;o<r.length;o++)for(var i=r[o],s=0;s<t.length;s++){var a=t[s].lastIsMaster().tags||{},c=!0;for(var u in i)a[u]!=i[u]&&(c=!1);c&&n.push(t[s])}return n};e.exports=v},function(e,t,n){"use strict";var r=n(80).Insert,o=n(80).Update,i=n(80).Remove,s=n(7).copy,a=n(7).retrieveBSON,c=n(5).KillCursor,u=n(5).GetMore,l=n(5).Query,f=n(1).format,p=n(105),d=n(4),h=n(81).getReadPreference,m=a(),y=m.Long,g=["w","wtimeout","j","fsync"],b=function(){};b.prototype.insert=function(e,t,n,o,i,s,a){s=s||{};var c="boolean"!=typeof s.ordered||s.ordered;if(i=Array.isArray(i)?i:[i],i.length>1e3)return a(new d("exceeded maximum write batch size of 1000"));var u=s.writeConcern||{w:1};return c&&0!=u.w?_("insert",r,t,n,o,e,i,s,a):O("insert",r,t,n,o,e,i,s,a)},b.prototype.update=function(e,t,n,r,i,s,a){s=s||{};var c="boolean"!=typeof s.ordered||s.ordered;i=Array.isArray(i)?i:[i];var u=s.writeConcern||{w:1};return c&&0!=u.w?_("update",o,t,n,r,e,i,s,a):O("update",o,t,n,r,e,i,s,a)},b.prototype.remove=function(e,t,n,r,o,s,a){s=s||{};var c="boolean"!=typeof s.ordered||s.ordered;o=Array.isArray(o)?o:[o];var u=s.writeConcern||{w:1};return c&&0!=u.w?_("remove",i,t,n,r,e,o,s,a):O("remove",i,t,n,r,e,o,s,a)},b.prototype.killCursor=function(e,t,n,r,o){var i=new c(e,[n]);r&&r.isConnected()&&r.write(i,{immediateRelease:!0,noResponse:!0}),"function"==typeof o&&o(null,null)},b.prototype.getMore=function(e,t,n,r,o,i,s,a){var c=new u(e,t,n.cursorId,{numberToReturn:r}),l=function(e,t){if(e)return a(e);var r=t.message;if(0!=(1&r.responseFlags))return a(new d("cursor does not exist, was killed or timed out"),null);var o="number"==typeof r.cursorId?y.fromNumber(r.cursorId):r.cursorId;n.documents=r.documents,n.cursorId=o,a(null,null,r.connection)};o&&(l.raw=o),"boolean"==typeof n.promoteLongs&&(l.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(l.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(l.promoteBuffers=n.promoteBuffers),i.write(c,l)},b.prototype.command=function(e,t,n,r,o,i){if(n.find)return v(e,t,n,r,o,i);if(null==r.cursorId){if(n)return w(e,t,n,r,o,i);throw new d(f("command %s does not return a cursor",JSON.stringify(n)))}};var v=function(e,t,n,r,o,i){i=i||{};var a=h(n,i);r.batchSize=n.batchSize||r.batchSize;var c=0;c=0==r.limit?r.batchSize:r.limit<0||r.limit<r.batchSize||r.limit>0&&0==r.batchSize?r.limit:r.batchSize;var u=r.skip||0,p={},m=!1;if("mongos"==o.type&&a&&(p.$readPreference=a.toJSON(),m=!0),n.sort&&(p.orderby=n.sort,m=!0),n.hint&&(p.$hint=n.hint,m=!0),n.snapshot&&(p.$snapshot=n.snapshot,m=!0),n.returnKey&&(p.$returnKey=n.returnKey,m=!0),n.maxScan&&(p.$maxScan=n.maxScan,m=!0),n.min&&(p.$min=n.min,m=!0),n.max&&(p.$max=n.max,m=!0),n.showDiskLoc&&(p.$showDiskLoc=n.showDiskLoc,m=!0),n.comment&&(p.$comment=n.comment,m=!0),n.maxTimeMS&&(p.$maxTimeMS=n.maxTimeMS,m=!0),n.explain&&(c=-Math.abs(n.limit||0),m=!0,p.$explain=!0),m?p.$query=n.query:p=n.query,n.readConcern&&"local"!=n.readConcern.level)throw new d(f("server find command does not support a readConcern level of %s",n.readConcern.level));n.readConcern&&(n=s(n),delete n.readConcern);var y="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,g="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined,b=new l(e,t,p,{numberToSkip:u,numberToReturn:c,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:y,ignoreUndefined:g});return b.slaveOk=a.slaveOk(),"boolean"==typeof n.tailable&&(b.tailable=n.tailable),"boolean"==typeof n.oplogReplay&&(b.oplogReplay=n.oplogReplay),"boolean"==typeof n.noCursorTimeout&&(b.noCursorTimeout=n.noCursorTimeout),"boolean"==typeof n.awaitData&&(b.awaitData=n.awaitData),"boolean"==typeof n.partial&&(b.partial=n.partial),b},w=function(e,t,n,r,o,i){i=i||{};var s=h(n,i),a={};for(var c in n)a[c]=n[c];var u=t.split(/\./);if(n.readConcern&&"local"!=n.readConcern.level)throw new d(f("server %s command does not support a readConcern level of %s",JSON.stringify(n),n.readConcern.level));n.readConcern&&delete n.readConcern;var p="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,m="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;"mongos"==o.type&&s&&"primary"!=s.preference&&(a={$query:a,$readPreference:s.toJSON()});var y=new l(e,f("%s.$cmd",u.shift()),a,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:p,ignoreUndefined:m});return y.slaveOk=s.slaveOk(),y},S=function(e){return!(!e.w&&!e.wtimeout&&1!=e.j&&1!=e.fsync&&0!=Object.keys(e).length)},x=function(e){var t={};return null!=e.w&&(t.w=e.w),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),null!=e.j&&(t.j=e.j),null!=e.fsync&&(t.fsync=e.fsync),t},k=function(e,t,n,r){var o={ok:1,n:0};"update"==e&&(o.nModified=0);for(var i=0;i<n.length;i++){var s=n[i],a=t[i];!s.upserted&&0!=s.updatedExisting||null!=o.upserted||(o.upserted=[]),s.upserted&&o.upserted.push({index:i,_id:s.upserted}),0==s.updatedExisting&&1==s.n&&null==s.upserted?o.upserted.push({index:i,_id:a.q._id}):1==s.updatedExisting&&(o.nModified+=s.n),1==s.ok&&"insert"==e&&null==s.err&&(o.n=o.n+1),null!=s&&0==s.ok||s.err||s.errmsg?(0==s.ok&&(o.ok=0),o.code=s.code,o.errmsg=s.errmsg||s.err||s.errMsg,11e3==s.code||11001==s.code||12582==s.code||16544==s.code||16538==s.code||16542==s.code||14==s.code||13511==s.code?(null==o.writeErrors&&(o.writeErrors=[]),o.writeErrors.push({index:i,code:s.code,errmsg:s.errmsg||s.err||s.errMsg})):o.writeConcernError={code:s.code,errmsg:s.errmsg||s.err||s.errMsg}):"number"==typeof s.n?o.n+=s.n:o.n+=1,null!=s&&s.lastOp&&(o.lastOp=s.lastOp)}return new p(o,r)},_=function(e,t,n,r,o,i,s,a,c){var u=s.slice(0),p=[],d=function(u,h){if(0==u.length)return process.nextTick(function(){h(null,k(e,s,p,null))});var m=u.shift(),y=new t(l.getRequestId(),n,o,r,[m],a),b=a.writeConcern||{w:1},v=x(b),w=r.split(".").shift();try{for(var S=[y],_={getlasterror:1},O=0;O<g.length;O++)null!=v[g[O]]&&(_[g[O]]=v[g[O]]);var C=new l(o,f("%s.$cmd",w),_,{numberToReturn:-1});S.push(C);var E=function(t,n){if(t)return c(t);var r=n.result;return p.push(r),0==r.ok||r.err||r.errmsg?c(null,k(e,s,p,n.connection)):void d(u,c)};i.write(S,E)}catch(t){p.push({ok:1,errmsg:"string"==typeof t?t:t.message,code:14}),process.nextTick(function(){h(null,k(e,s,p,null))})}};d(u,c)},O=function(e,t,n,r,o,i,s,a,c){for(var u,d=s.length,h=[],m=a.writeConcern||{w:1},y=x(m),b=0;b<s.length;b++){var v=new t(l.getRequestId(),n,o,r,[s[b]],a),w=r.split(".").shift();try{var _=[v];if(S(y)){for(var O={getlasterror:1},C=0;C<g.length;C++)null!=y[g[C]]&&(O[g[C]]=y[g[C]]);var E=new l(o,f("%s.$cmd",w),O,{numberToReturn:-1});_.push(E);var I=function(t){return function(n,r){n&&(u=n),d-=1,n||(h[t]=r.result),0==d&&process.nextTick(function(){return u?c(u):void c(null,k(e,s,h,r.connection))})}};i.write(_,I(b))}else i.write(_,{immediateRelease:!0,noResponse:!0})}catch(t){d-=1,h[b]={ok:1,errmsg:"string"==typeof t?t:t.message,code:14},0==d&&c(null,k(e,s,h,null))}}y&&0==y.w&&c&&c(null,new p({ok:1},null))};e.exports=b},function(e,t,n){"use strict";var r=n(7).copy,o=n(7).retrieveBSON,i=n(5).KillCursor,s=n(5).GetMore,a=n(5).Query,c=n(1).format,u=n(4),l=n(81).getReadPreference,f=o(),p=f.Long,d=function(){},h=function(e,t,n,r,o,i,s,l){if(0==i.length)throw new u("insert must contain at least one document");"function"==typeof s&&(l=s,s={},s=s||{});var f=o.split("."),p=f.shift(),d="boolean"!=typeof s.ordered||s.ordered,h=s.writeConcern,m={};m[n]=f.join("."),m[r]=i,m.ordered=d,h&&Object.keys(h).length>0&&(m.writeConcern=h),"boolean"==typeof s.bypassDocumentValidation&&(m.bypassDocumentValidation=s.bypassDocumentValidation);var y={command:!0},g={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"==n&&(g.checkKeys=!0),s.serializeFunctions&&(g.serializeFunctions=s.serializeFunctions),s.ignoreUndefined&&(g.ignoreUndefined=s.ignoreUndefined);try{var b=new a(t,c("%s.$cmd",p),m,g);e.write(b,y,l)}catch(e){l(e)}};d.prototype.insert=function(e,t,n,r,o,i,s){h(e,r,"insert","documents",n,o,i,s)},d.prototype.update=function(e,t,n,r,o,i,s){h(e,r,"update","updates",n,o,i,s)},d.prototype.remove=function(e,t,n,r,o,i,s){h(e,r,"delete","deletes",n,o,i,s)},d.prototype.killCursor=function(e,t,n,r,o){var s=new i(e,[n]);r&&r.isConnected()&&r.write(s,{immediateRelease:!0,noResponse:!0}),"function"==typeof o&&o(null,null)},d.prototype.getMore=function(e,t,n,r,o,i,a,c){var l=new s(e,t,n.cursorId,{numberToReturn:r}),f=function(e,t){if(e)return c(e);var r=t.message;if(0!=(1&r.responseFlags))return c(new u("cursor does not exist, was killed or timed out"),null);var o="number"==typeof r.cursorId?p.fromNumber(r.cursorId):r.cursorId;n.documents=r.documents,n.cursorId=o,c(null,null,r.connection)};o&&(f.raw=o),"boolean"==typeof n.promoteLongs&&(f.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(f.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(f.promoteBuffers=n.promoteBuffers),i.write(l,f)},d.prototype.command=function(e,t,n,r,o,i){if(n.find)return m(e,t,n,r,o,i);if(null==r.cursorId){if(n)return y(e,t,n,r,o,i);throw new u(c("command %s does not return a cursor",JSON.stringify(n)))}};var m=function(e,t,n,o,i,s){s=s||{};var f=l(n,s);o.batchSize=n.batchSize||o.batchSize;var p=0;p=0==o.limit?o.batchSize:o.limit<0||o.limit<o.batchSize||o.limit>0&&0==o.batchSize?o.limit:o.batchSize;var d=o.skip||0,h={},m=!1;if("mongos"==i.type&&f&&(h.$readPreference=f.toJSON(),m=!0),n.sort&&(h.orderby=n.sort,m=!0),n.hint&&(h.$hint=n.hint,m=!0),
n.snapshot&&(h.$snapshot=n.snapshot,m=!0),n.returnKey&&(h.$returnKey=n.returnKey,m=!0),n.maxScan&&(h.$maxScan=n.maxScan,m=!0),n.min&&(h.$min=n.min,m=!0),n.max&&(h.$max=n.max,m=!0),n.showDiskLoc&&(h.$showDiskLoc=n.showDiskLoc,m=!0),n.comment&&(h.$comment=n.comment,m=!0),n.maxTimeMS&&(h.$maxTimeMS=n.maxTimeMS,m=!0),n.explain&&(p=-Math.abs(n.limit||0),m=!0,h.$explain=!0),m?h.$query=n.query:h=n.query,n.readConcern&&"local"!=n.readConcern.level)throw new u(c("server find command does not support a readConcern level of %s",n.readConcern.level));n.readConcern&&(n=r(n),delete n.readConcern);var y="boolean"==typeof s.serializeFunctions&&s.serializeFunctions,g="boolean"==typeof s.ignoreUndefined&&s.ignoreUndefined,b=new a(e,t,h,{numberToSkip:d,numberToReturn:p,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:y,ignoreUndefined:g});return b.slaveOk=f.slaveOk(),"boolean"==typeof n.tailable&&(b.tailable=n.tailable),"boolean"==typeof n.oplogReplay&&(b.oplogReplay=n.oplogReplay),"boolean"==typeof n.noCursorTimeout&&(b.noCursorTimeout=n.noCursorTimeout),"boolean"==typeof n.awaitData&&(b.awaitData=n.awaitData),"boolean"==typeof n.partial&&(b.partial=n.partial),b},y=function(e,t,n,r,o,i){i=i||{};var s=l(n,i),f={};for(var p in n)f[p]=n[p];var d=t.split(/\./),h="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,m="boolean"==typeof i.ignoreUndefined&&i.ignoreUndefined;if(n.readConcern&&"local"!=n.readConcern.level)throw new u(c("server %s command does not support a readConcern level of %s",JSON.stringify(n),n.readConcern.level));n.readConcern&&delete n.readConcern,"mongos"==o.type&&s&&"primary"!=s.preference&&(f={$query:f,$readPreference:s.toJSON()});var y=new a(e,c("%s.$cmd",d.shift()),f,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:h,ignoreUndefined:m});return y.slaveOk=s.slaveOk(),y};e.exports=d},function(e,t,n){"use strict";var r=n(5).Query,o=n(7).retrieveBSON,i=n(1).format,s=n(4),a=n(81).getReadPreference,c=o(),u=c.Long,l=function(e){this.legacyWireProtocol=e},f=function(e,t,n,o,a,c,u,l){if(0==c.length)throw new s("insert must contain at least one document");"function"==typeof u&&(l=u,u={},u=u||{});var f=a.split("."),p=f.shift(),d="boolean"!=typeof u.ordered||u.ordered,h=u.writeConcern,m={};if(m[n]=f.join("."),m[o]=c,m.ordered=d,h&&Object.keys(h).length>0&&(m.writeConcern=h),u.collation)for(var y=0;y<m[o].length;y++)m[o][y].collation||(m[o][y].collation=u.collation);"boolean"==typeof u.bypassDocumentValidation&&(m.bypassDocumentValidation=u.bypassDocumentValidation);var g={command:!0},b={checkKeys:!1,numberToSkip:0,numberToReturn:1};"insert"==n&&(b.checkKeys=!0),u.serializeFunctions&&(b.serializeFunctions=u.serializeFunctions),u.ignoreUndefined&&(b.ignoreUndefined=u.ignoreUndefined);try{var v=new r(t,i("%s.$cmd",p),m,b);e.write(v,g,l)}catch(e){l(e)}};l.prototype.insert=function(e,t,n,r,o,i,s){f(e,r,"insert","documents",n,o,i,s)},l.prototype.update=function(e,t,n,r,o,i,s){f(e,r,"update","updates",n,o,i,s)},l.prototype.remove=function(e,t,n,r,o,i,s){f(e,r,"delete","deletes",n,o,i,s)},l.prototype.killCursor=function(e,t,n,o,a){var c=t.split(/\./),u=i("%s.$cmd",c.shift()),l={killCursors:c.join("."),cursors:[n]},f=new r(e,u,l,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});f.slaveOk=!0;var p=function(e,t){if(e){if("function"!=typeof a)return;return a(e)}var r=t.message;if(0!=(1&r.responseFlags)){if("function"!=typeof a)return;return a(new s("cursor killed or timed out"),null)}if(!Array.isArray(r.documents)||0==r.documents.length){if("function"!=typeof a)return;return a(new s(i("invalid killCursors result returned for cursor id %s",n)))}"function"==typeof a&&a(null,r.documents[0])};o&&o.isConnected()&&o.write(f,{command:!0},p)},l.prototype.getMore=function(e,t,n,o,a,c,l,f){l=l||{};var p=t.split(/\./),d=i("%s.$cmd",p.shift()),h={getMore:n.cursorId,collection:p.join("."),batchSize:Math.abs(o)};n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(h.maxTimeMS=n.cmd.maxAwaitTimeMS);var m=new r(e,d,h,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,returnFieldSelector:null});m.slaveOk=!0;var y=function(e,t){if(e)return f(e);var r=t.message;if(0!=(1&r.responseFlags))return f(new s("cursor killed or timed out"),null);if(a)return n.documents=r.documents,n.cursorId=r.cursorId,f(null,r.documents);if(0==r.documents[0].ok)return f(s.create(r.documents[0]));var o="number"==typeof r.documents[0].cursor.id?u.fromNumber(r.documents[0].cursor.id):r.documents[0].cursor.id;n.documents=r.documents[0].cursor.nextBatch,n.cursorId=o,f(null,r.documents[0],r.connection)},g={command:!0};a&&(g.raw=a),g.documentsReturnedIn="nextBatch","boolean"==typeof n.promoteLongs&&(g.promoteLongs=n.promoteLongs),"boolean"==typeof n.promoteValues&&(y.promoteValues=n.promoteValues),"boolean"==typeof n.promoteBuffers&&(y.promoteBuffers=n.promoteBuffers),c.write(m,g,y)},l.prototype.command=function(e,t,n,r,o,a){if(n.find){var c=p(e,t,n,r,o,a);return n.virtual=!1,c.documentsReturnedIn="firstBatch",c}if(null==r.cursorId){if(n)return d(e,t,n,r,o,a);throw new s(i("command %s does not return a cursor",JSON.stringify(n)))}};var p=function(e,t,n,o,s,c){c=c||{};var u=a(n,c);o.batchSize=n.batchSize||o.batchSize;var l=t.split(/\./),f=i("%s.$cmd",l.shift()),p={find:l.join(".")};n.query&&(n.query.$query?p.filter=n.query.$query:p.filter=n.query);var d=n.sort;if(Array.isArray(d)){var h={};if(d.length>0&&!Array.isArray(d[0])){var m=d[1];"asc"==m?m=1:"desc"==m&&(m=-1),h[d[0]]=m}else for(var y=0;y<d.length;y++)m=d[y][1],"asc"==m?m=1:"desc"==m&&(m=-1),h[d[y][0]]=m;d=h}n.sort&&(p.sort=d),n.fields&&(p.projection=n.fields),n.hint&&(p.hint=n.hint),n.skip&&(p.skip=n.skip),n.limit&&(p.limit=n.limit),"number"==typeof n.batchSize&&(p.batchSize=Math.abs(n.batchSize)),n.limit<0&&(p.limit=Math.abs(n.limit),p.singleBatch=!0),n.comment&&(p.comment=n.comment),n.maxScan&&(p.maxScan=n.maxScan),n.maxTimeMS&&(p.maxTimeMS=n.maxTimeMS),n.min&&(p.min=n.min),n.max&&(p.max=n.max),n.returnKey&&(p.returnKey=n.returnKey),n.showDiskLoc&&(p.showRecordId=n.showDiskLoc),n.snapshot&&(p.snapshot=n.snapshot),n.tailable&&(p.tailable=n.tailable),n.oplogReplay&&(p.oplogReplay=n.oplogReplay),n.noCursorTimeout&&(p.noCursorTimeout=n.noCursorTimeout),n.awaitData&&(p.awaitData=n.awaitData),n.awaitdata&&(p.awaitData=n.awaitdata),n.partial&&(p.partial=n.partial),n.collation&&(p.collation=n.collation),n.explain&&(p={explain:p}),n.readConcern&&(p.readConcern=n.readConcern);var g="boolean"==typeof c.serializeFunctions&&c.serializeFunctions,b="boolean"==typeof c.ignoreUndefined&&c.ignoreUndefined;"mongos"==s.type&&u&&"primary"!=u.preference&&(p={$query:p,$readPreference:u.toJSON()});var v=new r(e,f,p,{numberToSkip:0,numberToReturn:1,checkKeys:!1,returnFieldSelector:null,serializeFunctions:g,ignoreUndefined:b});return v.slaveOk=u.slaveOk(),v},d=function(e,t,n,o,s,c){c=c||{};var u=a(n,c),l={};for(var f in n)l[f]=n[f];var p=t.split(/\./),d="boolean"==typeof c.serializeFunctions&&c.serializeFunctions,h="boolean"==typeof c.ignoreUndefined&&c.ignoreUndefined;"mongos"==s.type&&u&&"primary"!=u.preference&&(l={$query:l,$readPreference:u.toJSON()});var m=new r(e,i("%s.$cmd",p.shift()),l,{numberToSkip:0,numberToReturn:-1,checkKeys:!1,serializeFunctions:d,ignoreUndefined:h});return m.slaveOk=u.slaveOk(),m};e.exports=l},function(e,t,n){var r=n(9).EventEmitter,o=n(1).inherits,i=n(26),s=n(19),a=n(82).OrderedBulkOperation,c=n(83).UnorderedBulkOperation,u=n(111),l=n(13),f=n(59),p=n(84),d={operationId:1,next:function(){return this.operationId++}},h={current:function(){return(new Date).getTime()},duration:function(e,t){return t-e}},m=["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"],y=function(e,t,o){t=t||{};var y=t.operationIdGenerator||d,g=t.timestampGenerator||h;r.call(this),this.overloads=[];var b=function(e){for(var t=[],n=[u,a,c,s,i,l,f,p],r=0;r<n.length;r++)n[r].define&&t.push(n[r].define.generate());e(null,t)};"function"==typeof o&&b(o);var v=this,w=["command","insert","update","remove"],S=e.Server.prototype;w.forEach(function(t){var n=S[t];v.overloads.push({proto:S,name:t,func:n}),S[t]=function(){var r=e.Query.nextRequestId(),o=Array.prototype.slice.call(arguments,0),i=o[0],s=o[1],a=o[2]||{},c=Object.keys(s),u=c[0],l=i.split(".")[0],f=i.split(".");f.shift(),f=f.join("."),"insert"==t?(u="insert",s={insert:f,documents:s},a.writeConcern&&Object.keys(a.writeConcern).length>0&&(s.writeConcern=a.writeConcern),s.ordered=void 0==a.ordered||a.ordered):"update"==t?(u="update",s={update:f,updates:s},a.writeConcern&&Object.keys(a.writeConcern).length>0&&(s.writeConcern=a.writeConcern),s.ordered=void 0==a.ordered||a.ordered):"remove"==t&&(u="delete",s={delete:f,deletes:s},a.writeConcern&&Object.keys(a.writeConcern).length>0&&(s.writeConcern=a.writeConcern),s.ordered=void 0==a.ordered||a.ordered);var p=o.pop(),d=p.operationId||y.next(),h=this.s.pool.get(),b={command:s,databaseName:l,commandName:u,requestId:r,operationId:d,connectionId:h};m.indexOf(u.toLowerCase())&&(b.commandObj={},b.commandObj[u]=!0),v.emit("started",b);var w=g.current();o.push(function(e,t){var n=g.current(),o={duration:g.duration(w,n),commandName:u,requestId:r,operationId:d,connectionId:h};e||t&&t.result&&0==t.result.ok?(o.failure=e||t.result.writeErrors||t.result,m.indexOf(u.toLowerCase())&&(o.failure={}),v.emit("failed",o)):s&&s.writeConcern&&0==s.writeConcern.w?(o.reply={ok:1},v.emit("succeeded",o)):(o.reply=t&&t.result?t.result:t,m.indexOf(u.toLowerCase())!=-1&&(o.reply={}),v.emit("succeeded",o)),p(e,t)}),n.apply(this,o)}}),w=["execute"];var x=[n(82).Bulk.prototype,n(83).Bulk.prototype];x.forEach(function(e){w.forEach(function(t){var n=e[t];v.overloads.push({proto:e,name:t,func:n}),e[t]=function(){var e=Array.prototype.slice.call(arguments,0);this.operationId=y.next();var t=e.pop();return"function"!=typeof t?n.apply(this,e):(e.push(function(e,n){t(e,n)}),void n.apply(this,e))}})}),w=["_find","_getmore","_killcursor"],x=[n(13).prototype,n(19).prototype,n(26).prototype];var k={_find:"find",_getmore:"getMore",_killcursor:"killCursors",_explain:"explain"};x.forEach(function(t){w.forEach(function(n){var r=t[n];v.overloads.push({proto:t,name:n,func:r}),t[n]=function(){var t=this,o=e.Query.nextRequestId(),i=y.next(),s=this.ns.split("."),a=s[0];s.shift();var c=s.join("."),u=this.query,l=this.s.cmd;"_find"==n&&(t.operationId=i),"_getmore"==n?(u={getMore:this.cursorState.cursorId,collection:c,batchSize:l.batchSize},l.maxTimeMS&&(u.maxTimeMS=l.maxTimeMS)):"_killcursor"==n?u={killCursors:c,cursors:[this.cursorState.cursorId]}:l.find?(u={find:c,filter:l.query},l.sort&&(u.sort=l.sort),l.fields&&(u.projection=l.fields),l.limit&&l.limit<0?(u.limit=Math.abs(l.limit),u.singleBatch=!0):l.limit&&(u.limit=Math.abs(l.limit)),l.skip&&(u.skip=l.skip),l.hint&&(u.hint=l.hint),l.batchSize&&(u.batchSize=l.batchSize),"boolean"==typeof l.returnKey&&(u.returnKey=l.returnKey),l.comment&&(u.comment=l.comment),l.min&&(u.min=l.min),l.max&&(u.max=l.max),l.maxScan&&(u.maxScan=l.maxScan),l.maxTimeMS&&(u.maxTimeMS=l.maxTimeMS),"boolean"==typeof l.awaitData&&(u.awaitData=l.awaitData),"boolean"==typeof l.snapshot&&(u.snapshot=l.snapshot),"boolean"==typeof l.tailable&&(u.tailable=l.tailable),"boolean"==typeof l.oplogReplay&&(u.oplogReplay=l.oplogReplay),"boolean"==typeof l.noCursorTimeout&&(u.noCursorTimeout=l.noCursorTimeout),"boolean"==typeof l.partial&&(u.partial=l.partial),"boolean"==typeof l.showDiskLoc&&(u.showRecordId=l.showDiskLoc),l.readConcern&&(u.readConcern=l.readConcern),l.explain&&(u.explain=l.explain),l.exhaust&&(u.exhaust=l.exhaust),l.explain&&(u={explain:u,verbosity:"allPlansExecution"},l.readConcern&&(u.readConcern=l.readConcern),n="_explain")):u=l;var f=null;this.connection&&(f=this.connection),!f&&this.server&&this.server.getConnection&&(f=this.server.getConnection());var p="_find"==n?Object.keys(u)[0]:k[n];u={command:u,databaseName:a,commandName:p,requestId:o,operationId:this.operationId,connectionId:f};var d=Array.prototype.slice.call(arguments,0),h=d.pop();if("function"!=typeof h&&"killCursors"!=u.commandName){d.push(h);var m=r.apply(this,d);return new t.s.promiseLibrary(function(e,n){var r=g.current();v.emit("started",u),m.then(function(){var e={duration:g.duration(r,g.current()),commandName:p,requestId:o,operationId:t.operationId,connectionId:t.server.getConnection(),reply:t.cursorState.documents};v.emit("succeeded",e)}).catch(function(e){var s={duration:g.duration(r,g.current()),commandName:p,requestId:o,operationId:i,connectionId:t.server.getConnection(),failure:e};v.emit("failed",s),n(e)})})}var b=g.current();return v.emit("started",u),"killCursors"==u.commandName&&this.server.lastIsMaster()&&this.server.lastIsMaster().maxWireVersion<4?(u={duration:g.duration(b,g.current()),commandName:p,requestId:o,operationId:t.operationId,connectionId:t.server.getConnection(),reply:[{ok:1}]},d.push(h),r.apply(this,d),v.emit("succeeded",u)):(d.push(function(e,n){if(e){var r={duration:g.duration(b,g.current()),commandName:p,requestId:o,operationId:i,connectionId:t.server.getConnection(),failure:e};v.emit("failed",r)}else"getmore"==p.toLowerCase()&&null==n?n={cursor:{id:t.cursorState.cursorId,ns:t.ns,nextBatch:t.cursorState.documents},ok:1}:"find"==p.toLowerCase()&&null==n?n={cursor:{id:t.cursorState.cursorId,ns:t.ns,firstBatch:t.cursorState.documents},ok:1}:"killcursors"==p.toLowerCase()&&null==n&&(n={cursorsUnknown:[t.cursorState.lastCursorId],ok:1}),r={duration:g.duration(b,g.current()),commandName:p,requestId:o,operationId:t.operationId,connectionId:t.server.getConnection(),reply:n&&n.result?n.result:n},v.emit("succeeded",r);h&&h(e,n)}),void r.apply(this,d))}})})};o(y,r),y.prototype.uninstrument=function(){for(var e=0;e<this.overloads.length;e++){var t=this.overloads[e];t.proto[t.name]=t.func}this.removeAllListeners("started"),this.removeAllListeners("succeeded"),this.removeAllListeners("failed")},e.exports=y},function(e,t,n){function r(e,t,n,r,o){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:r,init:!1,expectedEnd:0,file:null,options:o,readPreference:n},f.Readable.call(this)}function o(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function i(e){e.destroyed||e.s.cursor.next(function(t,n){if(!e.destroyed){if(t)return l(e,t);if(!n)return e.push(null),e.s.cursor.close(function(t){return t?l(e,t):void e.emit("close")});var r=e.s.file.length-e.s.bytesRead,o=e.s.expected++,i=Math.min(e.s.file.chunkSize,r);if(n.n>o){var s="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+o;return l(e,new Error(s))}if(n.n<o)return s="ExtraChunk: Got unexpected n: "+n.n+", expected: "+o,l(e,new Error(s));if(n.data.length()!==i)return r<=0?(s="ExtraChunk: Got unexpected n: "+n.n,l(e,new Error(s))):(s="ChunkIsWrongSize: Got unexpected length: "+n.data.length()+", expected: "+i,l(e,new Error(s)));if(e.s.bytesRead+=n.data.length(),0===n.data.buffer.length)return e.push(null);var a=null,c=null,u=n.data.buffer;null!=e.s.bytesToSkip&&(a=e.s.bytesToSkip,e.s.bytesToSkip=0),o===e.s.expectedEnd&&null!=e.s.bytesToTrim&&(c=e.s.bytesToTrim),e.s.options.end&&e.s.options.end-e.s.bytesToSkip<n.data.length()&&(c=e.s.options.end-e.s.bytesToSkip),null==a&&null==c||(u=u.slice(a||0,c||u.length)),e.push(u)}})}function s(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference),e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort),e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip),e.s.files.findOne(e.s.filter,t,function(t,n){if(t)return l(e,t);if(!n){var r=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,o="FileNotFound: file "+r+" was not found",i=new Error(o);return i.code="ENOENT",l(e,i)}return n.length<=0?void e.push(null):e.destroyed?void e.emit("close"):(e.s.cursor=e.s.chunks.find({files_id:n._id}).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n,e.s.bytesToSkip=c(e,n,e.s.cursor,e.s.options),e.s.bytesToTrim=u(e,n,e.s.cursor,e.s.options),void e.emit("file",n))})}function a(e,t){return e.s.file?t():(e.s.init||(s(e),e.s.init=!0),void e.once("file",function(){t()}))}function c(e,t,n,r){if(r&&null!=r.start){if(r.start>t.length)throw new Error("Stream start ("+r.start+") must not be more than the length of the file ("+t.length+")");if(r.start<0)throw new Error("Stream start ("+r.start+") must not be negative");if(null!=r.end&&r.end<r.start)throw new Error("Stream start ("+r.start+") must not be greater than stream end ("+r.end+")");return n.skip(Math.floor(r.start/t.chunkSize)),e.s.bytesRead=Math.floor(r.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(r.start/t.chunkSize),r.start-e.s.bytesRead}}function u(e,t,n,r){if(r&&null!=r.end){if(r.end>t.length)throw new Error("Stream end ("+r.end+") must not be more than the length of the file ("+t.length+")");if(r.start<0)throw new Error("Stream end ("+r.end+") must not be negative");var o=null!=r.start?Math.floor(r.start/t.chunkSize):0;return n.limit(Math.ceil(r.end/t.chunkSize)-o),e.s.expectedEnd=Math.ceil(r.end/t.chunkSize),Math.ceil(r.end/t.chunkSize)*t.chunkSize-r.end}}function l(e,t){e.emit("error",t)}var f=n(16),p=n(1);e.exports=r,p.inherits(r,f.Readable),r.prototype._read=function(){var e=this;this.destroyed||a(e,function(){i(e)})},r.prototype.start=function(e){return o(this),this.s.options.start=e,this},r.prototype.end=function(e){return o(this),this.s.options.end=e,this},r.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close(function(n){t.emit("close"),e&&e(n)}):(this.s.init||t.emit("close"),e&&e())}},function(e,t,n){function r(e,t){if(a.apply(this),this.setMaxListeners(0),t&&"object"==typeof t){t=l(t);for(var r=Object.keys(d),o=0;o<r.length;++o)t[r[o]]||(t[r[o]]=d[r[o]])}else t=d;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||("function"==typeof global.Promise?global.Promise:n(6).Promise)}}function o(e,t,n){e.s._filesCollection.deleteOne({_id:t},function(r,o){return r?n(r):void e.s._chunksCollection.deleteMany({files_id:t},function(e){if(e)return n(e);if(!o.result.n){var r="FileNotFound: no file with id "+t+" found";return n(new Error(r))}n()})})}function i(e,t,n,r){var o={_id:t},i={$set:{filename:n}};e.s._filesCollection.updateOne(o,i,function(e,n){return e?r(e):n.result.n?void r():r(f("File with id "+t+" not found"))})}function s(e,t){e.s._filesCollection.drop(function(n){return n?t(n):void e.s._chunksCollection.drop(function(e){return e?t(e):t()})})}var a=n(9).EventEmitter,c=n(193),u=n(195),l=n(2).shallowClone,f=n(2).toError,p=n(1),d={bucketName:"fs",chunkSizeBytes:261120};e.exports=r,p.inherits(r,a),r.prototype.openUploadStream=function(e,t){return t=t?l(t):{},t.chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new u(this,e,t)},r.prototype.openUploadStreamWithId=function(e,t,n){return n=n?l(n):{},n.chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=e,new u(this,t,n)},r.prototype.openDownloadStream=function(e,t){var n={_id:e};return t={start:t&&t.start,end:t&&t.end},new c(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,t)},r.prototype.delete=function(e,t){if("function"==typeof t)return o(this,e,t);var n=this;return new this.s.promiseLibrary(function(t,r){o(n,e,function(e,n){e?r(e):t(n)})})},r.prototype.find=function(e,t){e=e||{},t=t||{};var n=this.s._filesCollection.find(e);return null!=t.batchSize&&n.batchSize(t.batchSize),null!=t.limit&&n.limit(t.limit),null!=t.maxTimeMS&&n.maxTimeMS(t.maxTimeMS),null!=t.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",t.noCursorTimeout),null!=t.skip&&n.skip(t.skip),null!=t.sort&&n.sort(t.sort),n},r.prototype.openDownloadStreamByName=function(e,t){var n={uploadDate:-1},r=null;t&&null!=t.revision&&(t.revision>=0?(n={uploadDate:1},r=t.revision):r=-t.revision-1);var o={filename:e};return t={sort:n,skip:r,start:t&&t.start,end:t&&t.end},new c(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,o,t)},r.prototype.rename=function(e,t,n){if("function"==typeof n)return i(this,e,t,n);var r=this;return new this.s.promiseLibrary(function(n,o){i(r,e,t,function(e,t){e?o(e):n(t)})})},r.prototype.drop=function(e){if("function"==typeof e)return s(this,e);var t=this;return new this.s.promiseLibrary(function(e,n){s(t,function(t,r){t?n(t):e(r)})})}},function(e,t,n){function r(e,t,n){if(n=n||{},this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=n,this.id=n.id?n.id:m.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=new Buffer(this.chunkSizeBytes),this.length=0,this.md5=y.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var r=this;c(this,function(){r.bucket.s.checkedIndexes=!0,r.bucket.emit("index")})}}function o(e,t,n){if(!e.state.errored)return e.state.errored=!0,n?n(t):void e.emit("error",t)}function i(e,t,n){return{_id:m.BSON.ObjectId(),files_id:e,n:t,data:n}}function s(e,t){e.chunks.listIndexes().toArray(function(n,r){if(n){if(n.code===v){var o={files_id:1,n:1};return void e.chunks.createIndex(o,{background:!1,unique:!0},function(e){return e?t(e):void t()})}return t(n)}var i=!1;if(r.forEach(function(e){if(e.key){var t=Object.keys(e.key);2===t.length&&1===e.key.files_id&&1===e.key.n&&(i=!0)}}),i)t();else{o={files_id:1,n:1};var s=f(e);s.background=!1,s.unique=!0,e.chunks.createIndex(o,s,function(e){return e?t(e):void t()})}})}function a(e,t){if(e.state.streamEnd&&0===e.state.outstandingRequests&&!e.state.errored){var n=u(e.id,e.length,e.chunkSizeBytes,e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return!h(e,t)&&(e.files.insert(n,f(e),function(r){return r?o(e,r,t):void e.emit("finish",n)}),!0)}return!1}function c(e,t){e.files.findOne({},{_id:1},function(n,r){return n?t(n):r?t():void e.files.listIndexes().toArray(function(n,r){if(n){if(n.code===v){var o={filename:1,uploadDate:1};return void e.files.createIndex(o,{background:!1},function(n){return n?t(n):void s(e,t)})}return t(n)}var i=!1;if(r.forEach(function(e){var t=Object.keys(e.key);2===t.length&&1===e.key.filename&&1===e.key.uploadDate&&(i=!0)}),i)s(e,t);else{o={filename:1,uploadDate:1};var a=f(e);a.background=!1,e.files.createIndex(o,a,function(n){return n?t(n):void s(e,t)})}})})}function u(e,t,n,r,o,i,s,a){var c={_id:e,length:t,chunkSize:n,uploadDate:new Date,md5:r,filename:o};return i&&(c.contentType=i),s&&(c.aliases=s),a&&(c.metadata=a),c}function l(e,t,n,r){if(h(e,r))return!1;var s=Buffer.isBuffer(t)?t:new Buffer(t,n);if(e.length+=s.length,e.pos+s.length<e.chunkSizeBytes)return s.copy(e.bufToStore,e.pos),e.pos+=s.length,r&&r(),!0;for(var c=s.length,u=e.chunkSizeBytes-e.pos,l=Math.min(u,s.length),p=0;c>0;){var d=s.length-c;if(s.copy(e.bufToStore,e.pos,d,d+l),e.pos+=l,u-=l,0===u){e.md5.update(e.bufToStore);var m=i(e.id,e.n,e.bufToStore);if(++e.state.outstandingRequests,++p,h(e,r))return!1;e.chunks.insert(m,f(e),function(t){return t?o(e,t):(--e.state.outstandingRequests,--p,void(p||(e.emit("drain",m),r&&r(),a(e))))}),u=e.chunkSizeBytes,e.pos=0,++e.n}c-=l,l=Math.min(u,c)}return!1}function f(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function p(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",function(){t(!0)}),!0)}function d(e,t){if(0===e.pos)return a(e,t);++e.state.outstandingRequests;var n=new Buffer(e.pos);e.bufToStore.copy(n,0,0,e.pos),e.md5.update(n);var r=i(e.id,e.n,n);return!h(e,t)&&void e.chunks.insert(r,f(e),function(t){return t?o(e,t):(--e.state.outstandingRequests,void a(e))})}function h(e,t){return!!e.state.aborted&&("function"==typeof t&&t(new Error("this stream has been aborted")),!0)}var m=n(3),y=n(28),g=n(16),b=n(1),v=26;e.exports=r,b.inherits(r,g.Writable),r.prototype.write=function(e,t,n){var r=this;return p(this,function(){return l(r,e,t,n)})},r.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)}return this.state.aborted?(t=new Error("Cannot call abort() on a stream twice"),"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)):(this.state.aborted=!0,void this.chunks.deleteMany({files_id:this.id},function(t){"function"==typeof e&&e(t)}))},r.prototype.end=function(e,t,n){var r=this;if("function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),!h(this,n))return this.state.streamEnd=!0,n&&this.once("finish",function(e){n(null,e)}),e?void this.write(e,t,function(){d(r)}):void p(this,function(){d(r)})}},function(e,t,n){"use strict";var r=n(14),o=n(89),i=n(1).format;e.exports=function(e){var t="",n="",s="",a="admin",c=o.parse(e,!0);if("mongodb:"!=c.protocol)throw new Error("invalid schema, expected mongodb");if((null==c.hostname||""==c.hostname)&&e.indexOf(".sock")==-1)throw new Error("no hostname or hostnames provided in connection string");if("0"==c.port)throw new Error("invalid port (zero) with hostname");if(!isNaN(parseInt(c.port,10))&&parseInt(c.port,10)>65535)throw new Error("invalid port (larger than 65535) with hostname");if(c.path&&c.path.length>0&&"/"!=c.path[0]&&e.indexOf(".sock")==-1)throw new Error("missing delimiting slash between hosts and options");if(c.query)for(var u in c.query){if(u.indexOf("::")!=-1)throw new Error("double colon in host identifier");if(""==c.query[u])throw new Error("query parameter "+u+" is an incomplete value pair")}if(c.auth){var l=c.auth.split(":");if(e.indexOf(c.auth)!=-1&&l.length>2)throw new Error("Username with password containing an unescaped colon");if(e.indexOf(c.auth)!=-1&&c.auth.indexOf("@")!=-1)throw new Error("Username containing an unescaped at-sign")}for(var f=e.split("?").shift(),p=f.split(","),d=[],h=0;h<p.length;h++){var m=p[h];m.indexOf("mongodb")!=-1?m.indexOf("@")!=-1?d.push(m.split("@").pop()):d.push(m.substr("mongodb://".length)):m.indexOf("/")!=-1?d.push(m.split("/").shift()):m.indexOf("/")==-1&&d.push(m.trim())}for(h=0;h<d.length;h++){var y=o.parse(i("mongodb://%s",d[h].trim()));if(y.path&&y.path.indexOf(":")!=-1)throw new Error("double colon in host identifier")}if(e.indexOf("?")!=-1?(s=e.substr(e.indexOf("?")+1),t=e.substring("mongodb://".length,e.indexOf("?"))):t=e.substring("mongodb://".length),t.indexOf("@")!=-1&&(n=t.split("@")[0],t=t.split("@")[1]),t.indexOf(".sock")!=-1){if(t.indexOf(".sock/")!=-1){if(a=t.split(".sock/")[1],a.indexOf("/")!=-1){if(2==a.split("/").length&&0==a.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}t=t.split("/",t.indexOf(".sock")+".sock".length)}}else if(t.indexOf("/")!=-1){if(t.split("/").length>2){if(0==t.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}a=t.split("/")[1],t=t.split("/")[0]}var g={},b=n||"",v=b.split(":",2);v[0]=decodeURIComponent(v[0]),v[1]&&(v[1]=decodeURIComponent(v[1])),2==v.length&&(g.auth={user:v[0],password:v[1]});var w,S,x,k={socketOptions:{}},_={read_preference_tags:[]},O={socketOptions:{}},C={socketOptions:{}};if(g.server_options=k,g.db_options=_,g.rs_options=O,g.mongos_options=C,e.match(/\.sock/)){var E=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);E.indexOf("@")!=-1&&(E=E.split("@")[1]),x=[{domain_socket:E}]}else{w=t;var I={};x=w.split(",").map(function(e){var t,n,r;if(r=/\[([^\]]+)\](?:\:(.+))?/.exec(e))t=r[1],n=parseInt(r[2],10)||27017;else{var o=e.split(":",2);t=o[0]||"localhost",n=null!=o[1]?parseInt(o[1],10):27017,t.indexOf("?")!=-1&&(t=t.split(/\?/)[0])}return I[t+"_"+n]?null:(I[t+"_"+n]=1,{host:t,port:n})}).filter(function(e){return null!=e})}if(g.dbName=a||"admin",S=(s||"").split(/[&;]/),S.forEach(function(e){if(e){var t=e.split("="),n=t[0],o=t[1];switch(n){case"slaveOk":case"slave_ok":k.slave_ok="true"==o,_.slaveOk="true"==o;break;case"maxPoolSize":case"poolSize":k.poolSize=parseInt(o,10),O.poolSize=parseInt(o,10);break;case"appname":g.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":k.auto_reconnect="true"==o;break;case"minPoolSize":throw new Error("minPoolSize not supported");case"maxIdleTimeMS":throw new Error("maxIdleTimeMS not supported");case"waitQueueMultiple":throw new Error("waitQueueMultiple not supported");case"waitQueueTimeoutMS":throw new Error("waitQueueTimeoutMS not supported");case"uuidRepresentation":throw new Error("uuidRepresentation not supported");case"ssl":if("prefer"==o){k.ssl=o,O.ssl=o,C.ssl=o;break}k.ssl="true"==o,O.ssl="true"==o,C.ssl="true"==o;break;case"sslValidate":k.sslValidate="true"==o,O.sslValidate="true"==o,C.sslValidate="true"==o;break;case"replicaSet":case"rs_name":O.rs_name=o;break;case"reconnectWait":O.reconnectWait=parseInt(o,10);break;case"retries":O.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":O.read_secondary="true"==o;break;case"fsync":_.fsync="true"==o;break;case"journal":_.j="true"==o;break;case"safe":_.safe="true"==o;break;case"nativeParser":case"native_parser":_.native_parser="true"==o;break;case"readConcernLevel":_.readConcern={level:o};break;case"connectTimeoutMS":k.socketOptions.connectTimeoutMS=parseInt(o,10),O.socketOptions.connectTimeoutMS=parseInt(o,10),C.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":k.socketOptions.socketTimeoutMS=parseInt(o,10),O.socketOptions.socketTimeoutMS=parseInt(o,10),C.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":_.w=parseInt(o,10),isNaN(_.w)&&(_.w=o);break;case"authSource":_.authSource=o;break;case"gssapiServiceName":_.gssapiServiceName=o;break;case"authMechanism":if("GSSAPI"==o)if(null==g.auth){var i=decodeURIComponent(b);if(i.indexOf("@")==-1)throw new Error("GSSAPI requires a provided principal");g.auth={user:i,password:null}}else g.auth.user=decodeURIComponent(g.auth.user);else"MONGODB-X509"==o&&(g.auth={user:decodeURIComponent(b)});if("GSSAPI"!=o&&"MONGODB-X509"!=o&&"MONGODB-CR"!=o&&"DEFAULT"!=o&&"SCRAM-SHA-1"!=o&&"PLAIN"!=o)throw new Error("only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, SCRAM-SHA-1 or MONGODB-CR is supported by authMechanism");_.authMechanism=o;break;case"authMechanismProperties":var s=o.split(","),a={};s.forEach(function(e){var t=e.split(":");a[t[0]]=t[1]}),_.authMechanismProperties=a,"string"==typeof a.SERVICE_NAME&&(_.gssapiServiceName=a.SERVICE_NAME),"string"==typeof a.SERVICE_REALM&&(_.gssapiServiceRealm=a.SERVICE_REALM),"string"==typeof a.CANONICALIZE_HOST_NAME&&(_.gssapiCanonicalizeHostName="true"==a.CANONICALIZE_HOST_NAME);break;case"wtimeoutMS":_.wtimeout=parseInt(o,10);break;case"readPreference":if(!r.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");_.readPreference=o;break;case"maxStalenessSeconds":_.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":o=decodeURIComponent(o);var c={};if(null==o||""==o){_.read_preference_tags.push(c);break}for(var u=o.split(/\,/),l=0;l<u.length;l++){var f=u[l].trim().split(/\:/);c[f[0]]=f[1]}_.read_preference_tags.push(c)}}}),0===_.read_preference_tags.length&&(_.read_preference_tags=null),!(_.w!=-1&&0!=_.w||1!=_.journal&&1!=_.fsync&&1!=_.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");return _.readPreference||(_.readPreference="primary"),g.servers=x,g}},function(e,t,n){function r(e){return this instanceof r?void o.call(this,e):new r(e)}e.exports=r;var o=n(116),i=n(45);i.inherits=n(42),i.inherits(r,o),r.prototype._transform=function(e,t,n){
n(null,e)}},function(e,t,n){"use strict";var r=n(88),o=n(208);e.exports=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");e=r.resolve(e);var n=r.join(e,"noop.js");try{return o._resolveFilename(t,{id:n,filename:n,paths:o._nodeModulePaths(e)})}catch(e){return null}}},function(e,t,n){function r(e,t){if(e instanceof s)return e;if("string"!=typeof e)return null;if(e.length>Z)return null;var n=t?X[he]:X[fe];if(!n.test(e))return null;try{return new s(e,t)}catch(e){return null}}function o(e,t){var n=r(e,t);return n?n.version:null}function i(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}function s(e,t){if(e instanceof s){if(e.loose===t)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>Z)throw new TypeError("version is longer than "+Z+" characters");if(!(this instanceof s))return new s(e,t);Y("SemVer",e,t),this.loose=t;var n=e.trim().match(t?X[he]:X[fe]);if(!n)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>J||this.major<0)throw new TypeError("Invalid major version");if(this.minor>J||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>J||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<J)return t}return e}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}function a(e,t,n,r){"string"==typeof n&&(r=n,n=void 0);try{return new s(e,n).inc(t,r).version}catch(e){return null}}function c(e,t){if(S(e,t))return null;var n=r(e),o=r(t);if(n.prerelease.length||o.prerelease.length){for(var i in n)if(("major"===i||"minor"===i||"patch"===i)&&n[i]!==o[i])return"pre"+i;return"prerelease"}for(var i in n)if(("major"===i||"minor"===i||"patch"===i)&&n[i]!==o[i])return i}function u(e,t){var n=Ue.test(e),r=Ue.test(t);return n&&r&&(e=+e,t=+t),n&&!r?-1:r&&!n?1:e<t?-1:e>t?1:0}function l(e,t){return u(t,e)}function f(e,t){return new s(e,t).major}function p(e,t){return new s(e,t).minor}function d(e,t){return new s(e,t).patch}function h(e,t,n){return new s(e,n).compare(t)}function m(e,t){return h(e,t,!0)}function y(e,t,n){return h(t,e,n)}function g(e,n){return e.sort(function(e,r){return t.compare(e,r,n)})}function b(e,n){return e.sort(function(e,r){return t.rcompare(e,r,n)})}function v(e,t,n){return h(e,t,n)>0}function w(e,t,n){return h(e,t,n)<0}function S(e,t,n){return 0===h(e,t,n)}function x(e,t,n){return 0!==h(e,t,n)}function k(e,t,n){return h(e,t,n)>=0}function _(e,t,n){return h(e,t,n)<=0}function O(e,t,n,r){var o;switch(t){case"===":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e===n;break;case"!==":"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),o=e!==n;break;case"":case"=":case"==":o=S(e,n,r);break;case"!=":o=x(e,n,r);break;case">":o=v(e,n,r);break;case">=":o=k(e,n,r);break;case"<":o=w(e,n,r);break;case"<=":o=_(e,n,r);break;default:throw new TypeError("Invalid operator: "+t)}return o}function C(e,t){if(e instanceof C){if(e.loose===t)return e;e=e.value}return this instanceof C?(Y("comparator",e,t),this.loose=t,this.parse(e),this.semver===qe?this.value="":this.value=this.operator+this.semver.version,void Y("comp",this)):new C(e,t)}function E(e,t){if(e instanceof E&&e.loose===t)return e;if(!(this instanceof E))return new E(e,t);if(this.loose=t,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function I(e,t){return new E(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})}function N(e,t){return Y("comp",e),e=B(e,t),Y("caret",e),e=M(e,t),Y("tildes",e),e=R(e,t),Y("xrange",e),e=L(e,t),Y("stars",e),e}function A(e){return!e||"x"===e.toLowerCase()||"*"===e}function M(e,t){return e.trim().split(/\s+/).map(function(e){return T(e,t)}).join(" ")}function T(e,t){var n=t?X[Ce]:X[Oe];return e.replace(n,function(t,n,r,o,i){Y("tilde",e,t,n,r,o,i);var s;return A(n)?s="":A(r)?s=">="+n+".0.0 <"+(+n+1)+".0.0":A(o)?s=">="+n+"."+r+".0 <"+n+"."+(+r+1)+".0":i?(Y("replaceTilde pr",i),"-"!==i.charAt(0)&&(i="-"+i),s=">="+n+"."+r+"."+o+i+" <"+n+"."+(+r+1)+".0"):s=">="+n+"."+r+"."+o+" <"+n+"."+(+r+1)+".0",Y("tilde return",s),s})}function B(e,t){return e.trim().split(/\s+/).map(function(e){return D(e,t)}).join(" ")}function D(e,t){Y("caret",e,t);var n=t?X[Me]:X[Ae];return e.replace(n,function(t,n,r,o,i){Y("caret",e,t,n,r,o,i);var s;return A(n)?s="":A(r)?s=">="+n+".0.0 <"+(+n+1)+".0.0":A(o)?s="0"===n?">="+n+"."+r+".0 <"+n+"."+(+r+1)+".0":">="+n+"."+r+".0 <"+(+n+1)+".0.0":i?(Y("replaceCaret pr",i),"-"!==i.charAt(0)&&(i="-"+i),s="0"===n?"0"===r?">="+n+"."+r+"."+o+i+" <"+n+"."+r+"."+(+o+1):">="+n+"."+r+"."+o+i+" <"+n+"."+(+r+1)+".0":">="+n+"."+r+"."+o+i+" <"+(+n+1)+".0.0"):(Y("no pr"),s="0"===n?"0"===r?">="+n+"."+r+"."+o+" <"+n+"."+r+"."+(+o+1):">="+n+"."+r+"."+o+" <"+n+"."+(+r+1)+".0":">="+n+"."+r+"."+o+" <"+(+n+1)+".0.0"),Y("caret return",s),s})}function R(e,t){return Y("replaceXRanges",e,t),e.split(/\s+/).map(function(e){return P(e,t)}).join(" ")}function P(e,t){e=e.trim();var n=t?X[Se]:X[we];return e.replace(n,function(t,n,r,o,i,s){Y("xRange",e,t,n,r,o,i,s);var a=A(r),c=a||A(o),u=c||A(i),l=u;return"="===n&&l&&(n=""),a?t=">"===n||"<"===n?"<0.0.0":"*":n&&l?(c&&(o=0),u&&(i=0),">"===n?(n=">=",c?(r=+r+1,o=0,i=0):u&&(o=+o+1,i=0)):"<="===n&&(n="<",c?r=+r+1:o=+o+1),t=n+r+"."+o+"."+i):c?t=">="+r+".0.0 <"+(+r+1)+".0.0":u&&(t=">="+r+"."+o+".0 <"+r+"."+(+o+1)+".0"),Y("xRange return",t),t})}function L(e,t){return Y("replaceStars",e,t),e.trim().replace(X[je],"")}function j(e,t,n,r,o,i,s,a,c,u,l,f,p){return t=A(n)?"":A(r)?">="+n+".0.0":A(o)?">="+n+"."+r+".0":">="+t,a=A(c)?"":A(u)?"<"+(+c+1)+".0.0":A(l)?"<"+c+"."+(+u+1)+".0":f?"<="+c+"."+u+"."+l+"-"+f:"<="+a,(t+" "+a).trim()}function z(e,t){for(var n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length){for(var n=0;n<e.length;n++)if(Y(e[n].semver),e[n].semver!==qe&&e[n].semver.prerelease.length>0){var r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}function U(e,t,n){try{t=new E(t,n)}catch(e){return!1}return t.test(e)}function q(e,t,n){return e.filter(function(e){return U(e,t,n)}).sort(function(e,t){return y(e,t,n)})[0]||null}function F(e,t,n){return e.filter(function(e){return U(e,t,n)}).sort(function(e,t){return h(e,t,n)})[0]||null}function W(e,t){try{return new E(e,t).range||"*"}catch(e){return null}}function V(e,t,n){return G(e,t,"<",n)}function H(e,t,n){return G(e,t,">",n)}function G(e,t,n,r){e=new s(e,r),t=new E(t,r);var o,i,a,c,u;switch(n){case">":o=v,i=_,a=w,c=">",u=">=";break;case"<":o=w,i=k,a=v,c="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(U(e,t,r))return!1;for(var l=0;l<t.set.length;++l){var f=t.set[l],p=null,d=null;if(f.forEach(function(e){e.semver===qe&&(e=new C(">=0.0.0")),p=p||e,d=d||e,o(e.semver,p.semver,r)?p=e:a(e.semver,d.semver,r)&&(d=e)}),p.operator===c||p.operator===u)return!1;if((!d.operator||d.operator===c)&&i(e,d.semver))return!1;if(d.operator===u&&a(e,d.semver))return!1}return!0}function K(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}t=e.exports=s;var Y;Y="object"==typeof process&&{NODE_ENV:"production",CLIENT_VERSION:"1.0.1"}.NODE_DEBUG&&/\bsemver\b/i.test({NODE_ENV:"production",CLIENT_VERSION:"1.0.1"}.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var Z=256,J=Number.MAX_SAFE_INTEGER||9007199254740991,X=t.re=[],Q=t.src=[],$=0,ee=$++;Q[ee]="0|[1-9]\\d*";var te=$++;Q[te]="[0-9]+";var ne=$++;Q[ne]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var re=$++;Q[re]="("+Q[ee]+")\\.("+Q[ee]+")\\.("+Q[ee]+")";var oe=$++;Q[oe]="("+Q[te]+")\\.("+Q[te]+")\\.("+Q[te]+")";var ie=$++;Q[ie]="(?:"+Q[ee]+"|"+Q[ne]+")";var se=$++;Q[se]="(?:"+Q[te]+"|"+Q[ne]+")";var ae=$++;Q[ae]="(?:-("+Q[ie]+"(?:\\."+Q[ie]+")*))";var ce=$++;Q[ce]="(?:-?("+Q[se]+"(?:\\."+Q[se]+")*))";var ue=$++;Q[ue]="[0-9A-Za-z-]+";var le=$++;Q[le]="(?:\\+("+Q[ue]+"(?:\\."+Q[ue]+")*))";var fe=$++,pe="v?"+Q[re]+Q[ae]+"?"+Q[le]+"?";Q[fe]="^"+pe+"$";var de="[v=\\s]*"+Q[oe]+Q[ce]+"?"+Q[le]+"?",he=$++;Q[he]="^"+de+"$";var me=$++;Q[me]="((?:<|>)?=?)";var ye=$++;Q[ye]=Q[te]+"|x|X|\\*";var ge=$++;Q[ge]=Q[ee]+"|x|X|\\*";var be=$++;Q[be]="[v=\\s]*("+Q[ge]+")(?:\\.("+Q[ge]+")(?:\\.("+Q[ge]+")(?:"+Q[ae]+")?"+Q[le]+"?)?)?";var ve=$++;Q[ve]="[v=\\s]*("+Q[ye]+")(?:\\.("+Q[ye]+")(?:\\.("+Q[ye]+")(?:"+Q[ce]+")?"+Q[le]+"?)?)?";var we=$++;Q[we]="^"+Q[me]+"\\s*"+Q[be]+"$";var Se=$++;Q[Se]="^"+Q[me]+"\\s*"+Q[ve]+"$";var xe=$++;Q[xe]="(?:~>?)";var ke=$++;Q[ke]="(\\s*)"+Q[xe]+"\\s+",X[ke]=new RegExp(Q[ke],"g");var _e="$1~",Oe=$++;Q[Oe]="^"+Q[xe]+Q[be]+"$";var Ce=$++;Q[Ce]="^"+Q[xe]+Q[ve]+"$";var Ee=$++;Q[Ee]="(?:\\^)";var Ie=$++;Q[Ie]="(\\s*)"+Q[Ee]+"\\s+",X[Ie]=new RegExp(Q[Ie],"g");var Ne="$1^",Ae=$++;Q[Ae]="^"+Q[Ee]+Q[be]+"$";var Me=$++;Q[Me]="^"+Q[Ee]+Q[ve]+"$";var Te=$++;Q[Te]="^"+Q[me]+"\\s*("+de+")$|^$";var Be=$++;Q[Be]="^"+Q[me]+"\\s*("+pe+")$|^$";var De=$++;Q[De]="(\\s*)"+Q[me]+"\\s*("+de+"|"+Q[be]+")",X[De]=new RegExp(Q[De],"g");var Re="$1$2$3",Pe=$++;Q[Pe]="^\\s*("+Q[be]+")\\s+-\\s+("+Q[be]+")\\s*$";var Le=$++;Q[Le]="^\\s*("+Q[ve]+")\\s+-\\s+("+Q[ve]+")\\s*$";var je=$++;Q[je]="(<|>)?=?\\s*\\*";for(var ze=0;ze<$;ze++)Y(ze,Q[ze]),X[ze]||(X[ze]=new RegExp(Q[ze]));t.parse=r,t.valid=o,t.clean=i,t.SemVer=s,s.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},s.prototype.toString=function(){return this.version},s.prototype.compare=function(e){return Y("SemVer.compare",this.version,this.loose,e),e instanceof s||(e=new s(e,this.loose)),this.compareMain(e)||this.comparePre(e)},s.prototype.compareMain=function(e){return e instanceof s||(e=new s(e,this.loose)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)},s.prototype.comparePre=function(e){if(e instanceof s||(e=new s(e,this.loose)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var n=this.prerelease[t],r=e.prerelease[t];if(Y("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return u(n,r)}while(++t)},s.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);n===-1&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=a,t.diff=c,t.compareIdentifiers=u;var Ue=/^[0-9]+$/;t.rcompareIdentifiers=l,t.major=f,t.minor=p,t.patch=d,t.compare=h,t.compareLoose=m,t.rcompare=y,t.sort=g,t.rsort=b,t.gt=v,t.lt=w,t.eq=S,t.neq=x,t.gte=k,t.lte=_,t.cmp=O,t.Comparator=C;var qe={};C.prototype.parse=function(e){var t=this.loose?X[Te]:X[Be],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new s(n[2],this.loose):this.semver=qe},C.prototype.toString=function(){return this.value},C.prototype.test=function(e){return Y("Comparator.test",e,this.loose),this.semver===qe||("string"==typeof e&&(e=new s(e,this.loose)),O(e,this.operator,this.semver,this.loose))},t.Range=E,E.prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},E.prototype.toString=function(){return this.range},E.prototype.parseRange=function(e){var t=this.loose;e=e.trim(),Y("range",e,t);var n=t?X[Le]:X[Pe];e=e.replace(n,j),Y("hyphen replace",e),e=e.replace(X[De],Re),Y("comparator trim",e,X[De]),e=e.replace(X[ke],_e),e=e.replace(X[Ie],Ne),e=e.split(/\s+/).join(" ");var r=t?X[Te]:X[Be],o=e.split(" ").map(function(e){return N(e,t)}).join(" ").split(/\s+/);return this.loose&&(o=o.filter(function(e){return!!e.match(r)})),o=o.map(function(e){return new C(e,t)})},t.toComparators=I,E.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new s(e,this.loose));for(var t=0;t<this.set.length;t++)if(z(this.set[t],e))return!0;return!1},t.satisfies=U,t.maxSatisfying=q,t.minSatisfying=F,t.validRange=W,t.ltr=V,t.gtr=H,t.outside=G,t.prerelease=K},function(e,t,n){function r(e,t,n){var r=t&&n||0,o=t||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:c,f=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=void 0!==e.nsecs?e.nsecs:l+1,d=f-u+(p-l)/1e4;if(d<0&&void 0===e.clockseq&&(s=s+1&16383),(d<0||f>u)&&void 0===e.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=f,l=p,c=s,f+=122192928e5;var h=(1e4*(268435455&f)+p)%4294967296;o[r++]=h>>>24&255,o[r++]=h>>>16&255,o[r++]=h>>>8&255,o[r++]=255&h;var m=f/4294967296*1e4&268435455;o[r++]=m>>>8&255,o[r++]=255&m,o[r++]=m>>>24&15|16,o[r++]=m>>>16&255,o[r++]=s>>>8|128,o[r++]=255&s;for(var y=e.node||a,g=0;g<6;++g)o[r+g]=y[g];return t?t:i(o)}var o=n(121),i=n(120),s=o(),a=[1|s[0],s[1],s[2],s[3],s[4],s[5]],c=16383&(s[6]<<8|s[7]),u=0,l=0;e.exports=r},function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||i(s)}var o=n(121),i=n(120);e.exports=r},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("lodash@3.10.1")},function(e,t){e.exports=require("module")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("request@2.67.0")},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("winston")}]);